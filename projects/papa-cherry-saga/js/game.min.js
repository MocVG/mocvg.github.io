"use strict";function require(Qe){var ce={howler:window,"@sentry/browser":Sentry,"@sentry/types":Sentry,"css-element-queries":{ResizeSensor},"idb-keyval":idbKeyval};return ce[Qe]||window[Qe]}(function(Qe,ce){typeof module=="object"&&module.exports?module.exports=ce():Qe.game={config:ce()}})(typeof self!="undefined"?self:this,function(){function Qe(ce){Object.assign({days:0,hours:0,minutes:0,seconds:0,ms:0},ce);var mt=0;return typeof ce.days=="number"&&(mt+=ce.days*24*60*60*1e3),typeof ce.hours=="number"&&(mt+=ce.hours*60*60*1e3),typeof ce.minutes=="number"&&(mt+=ce.minutes*60*1e3),typeof ce.seconds=="number"&&(mt+=ce.seconds*1e3),typeof ce.ms=="number"&&(mt+=ce.ms),mt}return{build_time:"11.08.2022 09:49:07",build_version:641,publisher:"poki",game_title:"Papa Cherry Saga",game_slug:"papa-cherry-saga",wheel_unlock_level:15,second_chance_price:1e3,default_language:"en",feedback_enabled:!0,feedback_url:"https://api.steinhq.com/v1/storages/600187bcf62b6004b3eb6503/\u041B\u0438\u0441\u04421",analytics_enabled:!0,lives:{initialNum:5,refillInterval:Qe({minutes:30}),refillPrices:{lives_x1:1e3,lives_x3:3e3,lives_x5:5e3}},ads:{rewarded:!0,interstitials:!0,minIntervalMs:Qe({seconds:-1})},purchases:{enabled:!1,currency:{code:"RUB",conversionRate:10,template:{en:"# voices",ru:"# \u0433\u043E\u043B\u043E\u0441\u043E\u0432"}}},piggy_bank:{enabled:!0,breakMethod:"auto",max_capacity:2e3,min_amount_to_open:100},widget_button:{start_level_screen:{enabled:!1,frame:"popups/start_level/widget_button_2.png"},pause_screen:{enabled:!1,frame:"pause_screen/widget_button"}},greetings_screen:{enabled:!0,displayInterval:Qe({hours:8}),bonus:{unlimitedLivesMs:0,coins:500},superBonus:{unlimitedLivesMs:0,coins:1500}},fullscreen:{enabled:!1},pregame_boosters_unlock:{stripes:12,bomb:12,super_sphere:12},boosters_unlock:{glove:8,rolling_pin:10,lollipop:11},video_rewards:{lives:1,extra_moves:5,coins:1e3,stripes:2,bomb:2,super_sphere:1,glove:2,rolling_pin:1,lollipop:1,undo:4},wheel_rewards:{coins:500,stripes:1,bomb:1,undo:1,glove:1,rolling_pin:1,lollipop:1,super_sphere:1}}}),(()=>{var Qe=Object.create,ce=Object.defineProperty,mt=Object.defineProperties,Th=Object.getOwnPropertyDescriptor,_h=Object.getOwnPropertyDescriptors,yh=Object.getOwnPropertyNames,mi=Object.getOwnPropertySymbols,Ch=Object.getPrototypeOf,ma=Object.prototype.hasOwnProperty,bn=Object.prototype.propertyIsEnumerable,wn=(e,t,s)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,P=(e,t)=>{for(var s in t||(t={}))ma.call(t,s)&&wn(e,s,t[s]);if(mi)for(var s of mi(t))bn.call(t,s)&&wn(e,s,t[s]);return e},k=(e,t)=>mt(e,_h(t)),Sh=e=>ce(e,"__esModule",{value:!0}),fi=(e,t)=>{var s={};for(var i in e)ma.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(e!=null&&mi)for(var i of mi(e))t.indexOf(i)<0&&bn.call(e,i)&&(s[i]=e[i]);return s},Oh=(e,t)=>function(){return t||(0,e[Object.keys(e)[0]])((t={exports:{}}).exports,t),t.exports},bh=(e,t,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of yh(t))!ma.call(e,i)&&i!=="default"&&ce(e,i,{get:()=>t[i],enumerable:!(s=Th(t,i))||s.enumerable});return e},We=e=>bh(Sh(ce(e!=null?Qe(Ch(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),$=(e,t,s)=>new Promise((i,a)=>{var n=l=>{try{o(s.next(l))}catch(d){a(d)}},r=l=>{try{o(s.throw(l))}catch(d){a(d)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(n,r);o((s=s.apply(e,t)).next())}),Pn=Oh({"node_modules/screenfull/dist/screenfull.js"(e,t){(function(){"use strict";var s=typeof window!="undefined"&&typeof window.document!="undefined"?window.document:{},i=typeof t!="undefined"&&t.exports,a=function(){for(var o,l=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],d=0,f=l.length,S={};d<f;d++)if(o=l[d],o&&o[1]in s){for(d=0;d<o.length;d++)S[l[0][d]]=o[d];return S}return!1}(),n={change:a.fullscreenchange,error:a.fullscreenerror},r={request:function(o,l){return new Promise(function(d,f){var S=function(){this.off("change",S),d()}.bind(this);this.on("change",S),o=o||s.documentElement;var A=o[a.requestFullscreen](l);A instanceof Promise&&A.then(S).catch(f)}.bind(this))},exit:function(){return new Promise(function(o,l){if(!this.isFullscreen){o();return}var d=function(){this.off("change",d),o()}.bind(this);this.on("change",d);var f=s[a.exitFullscreen]();f instanceof Promise&&f.then(d).catch(l)}.bind(this))},toggle:function(o,l){return this.isFullscreen?this.exit():this.request(o,l)},onchange:function(o){this.on("change",o)},onerror:function(o){this.on("error",o)},on:function(o,l){var d=n[o];d&&s.addEventListener(d,l,!1)},off:function(o,l){var d=n[o];d&&s.removeEventListener(d,l,!1)},raw:a};if(!a){i?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1};return}Object.defineProperties(r,{isFullscreen:{get:function(){return Boolean(s[a.fullscreenElement])}},element:{enumerable:!0,get:function(){return s[a.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(s[a.fullscreenEnabled])}}}),i?t.exports=r:window.screenfull=r})()}}),wh=class{constructor(){this.name="Runtime Storage",this.storage={}}get namespace(){return this._namespace}init(){}setNamespace(e){this._namespace=e}saveValue(e,t){this.storage[this.getSaveKey(e)]=t}getValue(e){return this.storage[this.getSaveKey(e)]}getNumber(e){return this.getValue(e)||0}getBoolean(e){return this.getValue(e)||!1}getString(e){return this.getValue(e)||""}getObject(e){return this.getValue(e)||{}}getContent(e=!1){if(e)return this.storage;let t=Object.keys(this.storage).filter(i=>i.indexOf(this._namespace)>-1),s={};return t.forEach(i=>{s[i]=this.storage[i]}),s}clear(e=!1){if(e){this.storage={};return}Object.keys(this.storage).filter(t=>{t.includes(this._namespace)&&delete this.storage[t]})}getSaveKey(e){return this._namespace+"__"+e}},I;(function(e){e.UNDO="undo",e.GLOVE="glove",e.ROLLING_PIN="rolling_pin",e.LOLLIPOP="lollipop"})(I||(I={}));function Ln(){try{let e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}var Ph=class{constructor(e){this.type="LocalStorage",this.prefix=e}init(){return Promise.resolve()}saveValue(e,t){try{let s=this.stringify(t);return localStorage.setItem(this.getStorageKey(e),s),Promise.resolve()}catch(s){return Promise.reject(s)}}stringify(e){return typeof e=="string"?e:JSON.stringify(e)}getStorageKey(e){return`${this.prefix}__${e}`}getValue(e){return Promise.resolve(localStorage.getItem(this.getStorageKey(e)))}getNumber(e){return $(this,null,function*(){let t=yield this.getValue(e);if(t===null)return Promise.resolve(0);{let s=parseFloat(t)||0;return Promise.resolve(s)}})}getBoolean(e){return $(this,null,function*(){let t=yield this.getValue(e);if(t===null)return Promise.resolve(!1);{let s=t==="true";return Promise.resolve(s)}})}getString(e){return $(this,null,function*(){let t=yield this.getValue(e);return t===null?Promise.resolve(""):Promise.resolve(t)})}getObject(e){return $(this,null,function*(){let t=yield this.getValue(e),s=null;try{s=JSON.parse(t)}catch(i){}return Promise.resolve(s)})}remove(e){localStorage.removeItem(this.getStorageKey(e))}clear(){return Object.keys(localStorage).filter(e=>e.includes(this.prefix)).forEach(e=>{localStorage.removeItem(e)}),Promise.resolve()}},ft=We(require("idb-keyval"));function Lh(){return"indexedDB"in window}var Ih=class{constructor(e){this.type="IndexedDb",this.storeName=e,this.store=(0,ft.createStore)("robowhale",this.storeName)}init(){return $(this,null,function*(){try{let e="__test_key";yield(0,ft.set)(e,e,this.store),yield(0,ft.get)(e,this.store),yield(0,ft.del)(e)}catch(e){return Promise.reject(e)}})}saveValue(e,t){return(0,ft.set)(e,t,this.store)}getValue(e){return(0,ft.get)(e,this.store)}getNumber(e){return $(this,null,function*(){let t=yield this.getValue(e);return typeof t!="number"?Promise.resolve(0):t})}getBoolean(e){return $(this,null,function*(){let t=yield this.getValue(e);return typeof t!="boolean"?!1:t})}getString(e){return $(this,null,function*(){let t=yield this.getValue(e);return typeof t!="string"?"":t})}getObject(e){return $(this,null,function*(){let t=yield this.getValue(e);return typeof t!="object"?null:t})}remove(e){return(0,ft.del)(e,this.store)}clear(){return(0,ft.clear)(this.store)}},w=class{static get(e){let t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return i===null?null:decodeURIComponent(i[1].replace(/\+/g," "))}static has(e){return this.get(e)!==null}static getNumber(e,t=0){let s=this.get(e);if(s){let i=parseFloat(s);return isNaN(i)?t:i}return t}static getNumbers(e,t){let s=this.get(e);return s?s[0]!=="["||s[s.length-1]!=="]"?null:s.slice(1,s.length-1).split(",").map(a=>parseFloat(a)):t!=null?t:null}static getBool(e,t="1"){let s=this.get(e);return!!(s&&s===t)}},Ye;(function(e){e.LOW="low",e.MEDIUM="medium",e.HIGH="high"})(Ye||(Ye={}));function In(e){switch(e){case Ye.LOW:return .5;case Ye.MEDIUM:return .75;case Ye.HIGH:return 1;default:return 1}}function An(e){return Bt.includes(e)}var Bt=Object.values(Ye),Ah=typeof global=="object"&&global&&global.Object===Object&&global,xn=Ah,xh=typeof self=="object"&&self&&self.Object===Object&&self,Bh=xn||xh||Function("return this")(),Ve=Bh,kh=Ve.Symbol,Re=kh,Bn=Object.prototype,Mh=Bn.hasOwnProperty,Rh=Bn.toString,Ls=Re?Re.toStringTag:void 0;function Nh(e){var t=Mh.call(e,Ls),s=e[Ls];try{e[Ls]=void 0;var i=!0}catch(n){}var a=Rh.call(e);return i&&(t?e[Ls]=s:delete e[Ls]),a}var Dh=Nh,Hh=Object.prototype,Gh=Hh.toString;function Fh(e){return Gh.call(e)}var Uh=Fh,Wh="[object Null]",Yh="[object Undefined]",kn=Re?Re.toStringTag:void 0;function Vh(e){return e==null?e===void 0?Yh:Wh:kn&&kn in Object(e)?Dh(e):Uh(e)}var Et=Vh;function Kh(e){return e!=null&&typeof e=="object"}var Ke=Kh,zh="[object Symbol]";function jh(e){return typeof e=="symbol"||Ke(e)&&Et(e)==zh}var kt=jh;function Xh(e,t){for(var s=-1,i=e==null?0:e.length,a=Array(i);++s<i;)a[s]=t(e[s],s,e);return a}var Ze=Xh,$h=Array.isArray,Le=$h,qh=1/0,Mn=Re?Re.prototype:void 0,Rn=Mn?Mn.toString:void 0;function Nn(e){if(typeof e=="string")return e;if(Le(e))return Ze(e,Nn)+"";if(kt(e))return Rn?Rn.call(e):"";var t=e+"";return t=="0"&&1/e==-qh?"-0":t}var Dn=Nn,Qh=/\s/;function Zh(e){for(var t=e.length;t--&&Qh.test(e.charAt(t)););return t}var Jh=Zh,el=/^\s+/;function tl(e){return e&&e.slice(0,Jh(e)+1).replace(el,"")}var Hn=tl;function sl(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var xe=sl,Gn=0/0,il=/^[-+]0x[0-9a-f]+$/i,al=/^0b[01]+$/i,nl=/^0o[0-7]+$/i,rl=parseInt;function ol(e){if(typeof e=="number")return e;if(kt(e))return Gn;if(xe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=xe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Hn(e);var s=al.test(e);return s||nl.test(e)?rl(e.slice(2),s?2:8):il.test(e)?Gn:+e}var fa=ol,Fn=1/0,hl=17976931348623157e292;function ll(e){if(!e)return e===0?e:0;if(e=fa(e),e===Fn||e===-Fn){var t=e<0?-1:1;return t*hl}return e===e?e:0}var Ei=ll;function cl(e){var t=Ei(e),s=t%1;return t===t?s?t-s:t:0}var Ea=cl,dl="Expected a function";function ul(e,t){if(typeof t!="function")throw new TypeError(dl);return e=Ea(e),function(){if(--e<1)return t.apply(this,arguments)}}var vt=ul;function pl(e){return e}var Is=pl,gl="[object AsyncFunction]",ml="[object Function]",fl="[object GeneratorFunction]",El="[object Proxy]";function vl(e){if(!xe(e))return!1;var t=Et(e);return t==ml||t==fl||t==gl||t==El}var Un=vl,Tl=Ve["__core-js_shared__"],va=Tl,Wn=function(){var e=/[^.]+$/.exec(va&&va.keys&&va.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function _l(e){return!!Wn&&Wn in e}var yl=_l,Cl=Function.prototype,Sl=Cl.toString;function Ol(e){if(e!=null){try{return Sl.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Mt=Ol,bl=/[\\^$.*+?()[\]{}|]/g,wl=/^\[object .+?Constructor\]$/,Pl=Function.prototype,Ll=Object.prototype,Il=Pl.toString,Al=Ll.hasOwnProperty,xl=RegExp("^"+Il.call(Al).replace(bl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Bl(e){if(!xe(e)||yl(e))return!1;var t=Un(e)?xl:wl;return t.test(Mt(e))}var kl=Bl;function Ml(e,t){return e==null?void 0:e[t]}var Rl=Ml;function Nl(e,t){var s=Rl(e,t);return kl(s)?s:void 0}var Rt=Nl,Dl=Rt(Ve,"WeakMap"),Ta=Dl,Yn=Object.create,Hl=function(){function e(){}return function(t){if(!xe(t))return{};if(Yn)return Yn(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}(),Gl=Hl;function Fl(e,t,s){switch(s.length){case 0:return e.call(t);case 1:return e.call(t,s[0]);case 2:return e.call(t,s[0],s[1]);case 3:return e.call(t,s[0],s[1],s[2])}return e.apply(t,s)}var Vn=Fl;function Ul(){}var _a=Ul;function Wl(e,t){var s=-1,i=e.length;for(t||(t=Array(i));++s<i;)t[s]=e[s];return t}var ya=Wl,Yl=800,Vl=16,Kl=Date.now;function zl(e){var t=0,s=0;return function(){var i=Kl(),a=Vl-(i-s);if(s=i,a>0){if(++t>=Yl)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var jl=zl;function Xl(e){return function(){return e}}var $l=Xl,ql=function(){try{var e=Rt(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),vi=ql,Ql=vi?function(e,t){return vi(e,"toString",{configurable:!0,enumerable:!1,value:$l(t),writable:!0})}:Is,Zl=Ql,Jl=jl(Zl),ec=Jl;function tc(e,t){for(var s=-1,i=e==null?0:e.length;++s<i&&t(e[s],s,e)!==!1;);return e}var sc=tc;function ic(e,t,s,i){for(var a=e.length,n=s+(i?1:-1);i?n--:++n<a;)if(t(e[n],n,e))return n;return-1}var ac=ic;function nc(e){return e!==e}var rc=nc;function oc(e,t,s){for(var i=s-1,a=e.length;++i<a;)if(e[i]===t)return i;return-1}var hc=oc;function lc(e,t,s){return t===t?hc(e,t,s):ac(e,rc,s)}var Ti=lc;function cc(e,t){var s=e==null?0:e.length;return!!s&&Ti(e,t,0)>-1}var Ca=cc,dc=9007199254740991,uc=/^(?:0|[1-9]\d*)$/;function pc(e,t){var s=typeof e;return t=t==null?dc:t,!!t&&(s=="number"||s!="symbol"&&uc.test(e))&&e>-1&&e%1==0&&e<t}var _i=pc;function gc(e,t,s){t=="__proto__"&&vi?vi(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}var yi=gc;function mc(e,t){return e===t||e!==e&&t!==t}var Ci=mc,fc=Object.prototype,Ec=fc.hasOwnProperty;function vc(e,t,s){var i=e[t];(!(Ec.call(e,t)&&Ci(i,s))||s===void 0&&!(t in e))&&yi(e,t,s)}var Si=vc;function Tc(e,t,s,i){var a=!s;s||(s={});for(var n=-1,r=t.length;++n<r;){var o=t[n],l=i?i(s[o],e[o],o,s,e):void 0;l===void 0&&(l=e[o]),a?yi(s,o,l):Si(s,o,l)}return s}var Oi=Tc,Kn=Math.max;function _c(e,t,s){return t=Kn(t===void 0?e.length-1:t,0),function(){for(var i=arguments,a=-1,n=Kn(i.length-t,0),r=Array(n);++a<n;)r[a]=i[t+a];a=-1;for(var o=Array(t+1);++a<t;)o[a]=i[a];return o[t]=s(r),Vn(e,this,o)}}var yc=_c;function Cc(e,t){return ec(yc(e,t,Is),e+"")}var Nt=Cc,Sc=9007199254740991;function Oc(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Sc}var Sa=Oc;function bc(e){return e!=null&&Sa(e.length)&&!Un(e)}var Qt=bc;function wc(e,t,s){if(!xe(s))return!1;var i=typeof t;return(i=="number"?Qt(s)&&_i(t,s.length):i=="string"&&t in s)?Ci(s[t],e):!1}var Oa=wc,Pc=Object.prototype;function Lc(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||Pc;return e===s}var ba=Lc;function Ic(e,t){for(var s=-1,i=Array(e);++s<e;)i[s]=t(s);return i}var zn=Ic,Ac="[object Arguments]";function xc(e){return Ke(e)&&Et(e)==Ac}var jn=xc,Xn=Object.prototype,Bc=Xn.hasOwnProperty,kc=Xn.propertyIsEnumerable,Mc=jn(function(){return arguments}())?jn:function(e){return Ke(e)&&Bc.call(e,"callee")&&!kc.call(e,"callee")},wa=Mc;function Rc(){return!1}var Nc=Rc,$n=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qn=$n&&typeof module=="object"&&module&&!module.nodeType&&module,Dc=qn&&qn.exports===$n,Qn=Dc?Ve.Buffer:void 0,Hc=Qn?Qn.isBuffer:void 0,Gc=Hc||Nc,bi=Gc,Fc="[object Arguments]",Uc="[object Array]",Wc="[object Boolean]",Yc="[object Date]",Vc="[object Error]",Kc="[object Function]",zc="[object Map]",jc="[object Number]",Xc="[object Object]",$c="[object RegExp]",qc="[object Set]",Qc="[object String]",Zc="[object WeakMap]",Jc="[object ArrayBuffer]",ed="[object DataView]",td="[object Float32Array]",sd="[object Float64Array]",id="[object Int8Array]",ad="[object Int16Array]",nd="[object Int32Array]",rd="[object Uint8Array]",od="[object Uint8ClampedArray]",hd="[object Uint16Array]",ld="[object Uint32Array]",se={};se[td]=se[sd]=se[id]=se[ad]=se[nd]=se[rd]=se[od]=se[hd]=se[ld]=!0,se[Fc]=se[Uc]=se[Jc]=se[Wc]=se[ed]=se[Yc]=se[Vc]=se[Kc]=se[zc]=se[jc]=se[Xc]=se[$c]=se[qc]=se[Qc]=se[Zc]=!1;function cd(e){return Ke(e)&&Sa(e.length)&&!!se[Et(e)]}var dd=cd;function ud(e){return function(t){return e(t)}}var Dt=ud,Zn=typeof exports=="object"&&exports&&!exports.nodeType&&exports,As=Zn&&typeof module=="object"&&module&&!module.nodeType&&module,pd=As&&As.exports===Zn,Pa=pd&&xn.process,gd=function(){try{var e=As&&As.require&&As.require("util").types;return e||Pa&&Pa.binding&&Pa.binding("util")}catch(t){}}(),Zt=gd,Jn=Zt&&Zt.isTypedArray,md=Jn?Dt(Jn):dd,er=md,fd=Object.prototype,Ed=fd.hasOwnProperty;function vd(e,t){var s=Le(e),i=!s&&wa(e),a=!s&&!i&&bi(e),n=!s&&!i&&!a&&er(e),r=s||i||a||n,o=r?zn(e.length,String):[],l=o.length;for(var d in e)(t||Ed.call(e,d))&&!(r&&(d=="length"||a&&(d=="offset"||d=="parent")||n&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||_i(d,l)))&&o.push(d);return o}var tr=vd;function Td(e,t){return function(s){return e(t(s))}}var sr=Td,_d=sr(Object.keys,Object),yd=_d,Cd=Object.prototype,Sd=Cd.hasOwnProperty;function Od(e){if(!ba(e))return yd(e);var t=[];for(var s in Object(e))Sd.call(e,s)&&s!="constructor"&&t.push(s);return t}var bd=Od;function wd(e){return Qt(e)?tr(e):bd(e)}var Jt=wd;function Pd(e){var t=[];if(e!=null)for(var s in Object(e))t.push(s);return t}var Ld=Pd,Id=Object.prototype,Ad=Id.hasOwnProperty;function xd(e){if(!xe(e))return Ld(e);var t=ba(e),s=[];for(var i in e)i=="constructor"&&(t||!Ad.call(e,i))||s.push(i);return s}var Bd=xd;function kd(e){return Qt(e)?tr(e,!0):Bd(e)}var La=kd,Md=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Rd=/^\w*$/;function Nd(e,t){if(Le(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||kt(e)?!0:Rd.test(e)||!Md.test(e)||t!=null&&e in Object(t)}var Ia=Nd,Dd=Rt(Object,"create"),xs=Dd;function Hd(){this.__data__=xs?xs(null):{},this.size=0}var Gd=Hd;function Fd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Ud=Fd,Wd="__lodash_hash_undefined__",Yd=Object.prototype,Vd=Yd.hasOwnProperty;function Kd(e){var t=this.__data__;if(xs){var s=t[e];return s===Wd?void 0:s}return Vd.call(t,e)?t[e]:void 0}var zd=Kd,jd=Object.prototype,Xd=jd.hasOwnProperty;function $d(e){var t=this.__data__;return xs?t[e]!==void 0:Xd.call(t,e)}var qd=$d,Qd="__lodash_hash_undefined__";function Zd(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=xs&&t===void 0?Qd:t,this}var Jd=Zd;function es(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}es.prototype.clear=Gd,es.prototype.delete=Ud,es.prototype.get=zd,es.prototype.has=qd,es.prototype.set=Jd;var ir=es;function eu(){this.__data__=[],this.size=0}var tu=eu;function su(e,t){for(var s=e.length;s--;)if(Ci(e[s][0],t))return s;return-1}var wi=su,iu=Array.prototype,au=iu.splice;function nu(e){var t=this.__data__,s=wi(t,e);if(s<0)return!1;var i=t.length-1;return s==i?t.pop():au.call(t,s,1),--this.size,!0}var ru=nu;function ou(e){var t=this.__data__,s=wi(t,e);return s<0?void 0:t[s][1]}var hu=ou;function lu(e){return wi(this.__data__,e)>-1}var cu=lu;function du(e,t){var s=this.__data__,i=wi(s,e);return i<0?(++this.size,s.push([e,t])):s[i][1]=t,this}var uu=du;function ts(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}ts.prototype.clear=tu,ts.prototype.delete=ru,ts.prototype.get=hu,ts.prototype.has=cu,ts.prototype.set=uu;var Pi=ts,pu=Rt(Ve,"Map"),Bs=pu;function gu(){this.size=0,this.__data__={hash:new ir,map:new(Bs||Pi),string:new ir}}var mu=gu;function fu(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Eu=fu;function vu(e,t){var s=e.__data__;return Eu(t)?s[typeof t=="string"?"string":"hash"]:s.map}var Li=vu;function Tu(e){var t=Li(this,e).delete(e);return this.size-=t?1:0,t}var _u=Tu;function yu(e){return Li(this,e).get(e)}var Cu=yu;function Su(e){return Li(this,e).has(e)}var Ou=Su;function bu(e,t){var s=Li(this,e),i=s.size;return s.set(e,t),this.size+=s.size==i?0:1,this}var wu=bu;function ss(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var i=e[t];this.set(i[0],i[1])}}ss.prototype.clear=mu,ss.prototype.delete=_u,ss.prototype.get=Cu,ss.prototype.has=Ou,ss.prototype.set=wu;var Ii=ss,Pu="Expected a function";function Aa(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Pu);var s=function(){var i=arguments,a=t?t.apply(this,i):i[0],n=s.cache;if(n.has(a))return n.get(a);var r=e.apply(this,i);return s.cache=n.set(a,r)||n,r};return s.cache=new(Aa.Cache||Ii),s}Aa.Cache=Ii;var Lu=Aa,Iu=500;function Au(e){var t=Lu(e,function(i){return s.size===Iu&&s.clear(),i}),s=t.cache;return t}var xu=Au,Bu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ku=/\\(\\)?/g,Mu=xu(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Bu,function(s,i,a,n){t.push(a?n.replace(ku,"$1"):i||s)}),t}),Ru=Mu;function Nu(e){return e==null?"":Dn(e)}var ar=Nu;function Du(e,t){return Le(e)?e:Ia(e,t)?[e]:Ru(ar(e))}var Ai=Du,Hu=1/0;function Gu(e){if(typeof e=="string"||kt(e))return e;var t=e+"";return t=="0"&&1/e==-Hu?"-0":t}var ks=Gu;function Fu(e,t){t=Ai(t,e);for(var s=0,i=t.length;e!=null&&s<i;)e=e[ks(t[s++])];return s&&s==i?e:void 0}var xi=Fu;function Uu(e,t,s){var i=e==null?void 0:xi(e,t);return i===void 0?s:i}var Wu=Uu;function Yu(e,t){for(var s=-1,i=t.length,a=e.length;++s<i;)e[a+s]=t[s];return e}var xa=Yu,nr=Re?Re.isConcatSpreadable:void 0;function Vu(e){return Le(e)||wa(e)||!!(nr&&e&&e[nr])}var Ku=Vu;function rr(e,t,s,i,a){var n=-1,r=e.length;for(s||(s=Ku),a||(a=[]);++n<r;){var o=e[n];t>0&&s(o)?t>1?rr(o,t-1,s,i,a):xa(a,o):i||(a[a.length]=o)}return a}var Ba=rr,zu=sr(Object.getPrototypeOf,Object),ka=zu,ju="[object Object]",Xu=Function.prototype,$u=Object.prototype,or=Xu.toString,qu=$u.hasOwnProperty,Qu=or.call(Object);function Zu(e){if(!Ke(e)||Et(e)!=ju)return!1;var t=ka(e);if(t===null)return!0;var s=qu.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&or.call(s)==Qu}var Ju=Zu,ep="[object DOMException]",tp="[object Error]";function sp(e){if(!Ke(e))return!1;var t=Et(e);return t==tp||t==ep||typeof e.message=="string"&&typeof e.name=="string"&&!Ju(e)}var hr=sp,ip=Nt(function(e,t){try{return Vn(e,void 0,t)}catch(s){return hr(s)?s:new Error(s)}}),ap=ip,np="Expected a function";function rp(e,t){var s;if(typeof t!="function")throw new TypeError(np);return e=Ea(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=void 0),s}}var op=rp;function hp(e,t,s){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),s=s>a?a:s,s<0&&(s+=a),a=t>s?0:s-t>>>0,t>>>=0;for(var n=Array(a);++i<a;)n[i]=e[i+t];return n}var lp=hp;function cp(e,t,s){var i=e.length;return s=s===void 0?i:s,!t&&s>=i?e:lp(e,t,s)}var dp=cp,up="\\ud800-\\udfff",pp="\\u0300-\\u036f",gp="\\ufe20-\\ufe2f",mp="\\u20d0-\\u20ff",fp=pp+gp+mp,Ep="\\ufe0e\\ufe0f",vp="\\u200d",Tp=RegExp("["+vp+up+fp+Ep+"]");function _p(e){return Tp.test(e)}var yp=_p;function Cp(e){return e.split("")}var Sp=Cp,lr="\\ud800-\\udfff",Op="\\u0300-\\u036f",bp="\\ufe20-\\ufe2f",wp="\\u20d0-\\u20ff",Pp=Op+bp+wp,Lp="\\ufe0e\\ufe0f",Ip="["+lr+"]",Ma="["+Pp+"]",Ra="\\ud83c[\\udffb-\\udfff]",Ap="(?:"+Ma+"|"+Ra+")",cr="[^"+lr+"]",dr="(?:\\ud83c[\\udde6-\\uddff]){2}",ur="[\\ud800-\\udbff][\\udc00-\\udfff]",xp="\\u200d",pr=Ap+"?",gr="["+Lp+"]?",Bp="(?:"+xp+"(?:"+[cr,dr,ur].join("|")+")"+gr+pr+")*",kp=gr+pr+Bp,Mp="(?:"+[cr+Ma+"?",Ma,dr,ur,Ip].join("|")+")",Rp=RegExp(Ra+"(?="+Ra+")|"+Mp+kp,"g");function Np(e){return e.match(Rp)||[]}var Dp=Np;function Hp(e){return yp(e)?Dp(e):Sp(e)}var mr=Hp;function Gp(){this.__data__=new Pi,this.size=0}var Fp=Gp;function Up(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}var Wp=Up;function Yp(e){return this.__data__.get(e)}var Vp=Yp;function Kp(e){return this.__data__.has(e)}var zp=Kp,jp=200;function Xp(e,t){var s=this.__data__;if(s instanceof Pi){var i=s.__data__;if(!Bs||i.length<jp-1)return i.push([e,t]),this.size=++s.size,this;s=this.__data__=new Ii(i)}return s.set(e,t),this.size=s.size,this}var $p=Xp;function is(e){var t=this.__data__=new Pi(e);this.size=t.size}is.prototype.clear=Fp,is.prototype.delete=Wp,is.prototype.get=Vp,is.prototype.has=zp,is.prototype.set=$p;var Ms=is;function qp(e,t){return e&&Oi(t,Jt(t),e)}var Qp=qp;function Zp(e,t){return e&&Oi(t,La(t),e)}var Jp=Zp,fr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Er=fr&&typeof module=="object"&&module&&!module.nodeType&&module,eg=Er&&Er.exports===fr,vr=eg?Ve.Buffer:void 0,Tr=vr?vr.allocUnsafe:void 0;function tg(e,t){if(t)return e.slice();var s=e.length,i=Tr?Tr(s):new e.constructor(s);return e.copy(i),i}var sg=tg;function ig(e,t){for(var s=-1,i=e==null?0:e.length,a=0,n=[];++s<i;){var r=e[s];t(r,s,e)&&(n[a++]=r)}return n}var _r=ig;function ag(){return[]}var yr=ag,ng=Object.prototype,rg=ng.propertyIsEnumerable,Cr=Object.getOwnPropertySymbols,og=Cr?function(e){return e==null?[]:(e=Object(e),_r(Cr(e),function(t){return rg.call(e,t)}))}:yr,Na=og;function hg(e,t){return Oi(e,Na(e),t)}var lg=hg,cg=Object.getOwnPropertySymbols,dg=cg?function(e){for(var t=[];e;)xa(t,Na(e)),e=ka(e);return t}:yr,Sr=dg;function ug(e,t){return Oi(e,Sr(e),t)}var pg=ug;function gg(e,t,s){var i=t(e);return Le(e)?i:xa(i,s(e))}var Or=gg;function mg(e){return Or(e,Jt,Na)}var Da=mg;function fg(e){return Or(e,La,Sr)}var br=fg,Eg=Rt(Ve,"DataView"),Ha=Eg,vg=Rt(Ve,"Promise"),Ga=vg,Tg=Rt(Ve,"Set"),as=Tg,wr="[object Map]",_g="[object Object]",Pr="[object Promise]",Lr="[object Set]",Ir="[object WeakMap]",Ar="[object DataView]",yg=Mt(Ha),Cg=Mt(Bs),Sg=Mt(Ga),Og=Mt(as),bg=Mt(Ta),Ht=Et;(Ha&&Ht(new Ha(new ArrayBuffer(1)))!=Ar||Bs&&Ht(new Bs)!=wr||Ga&&Ht(Ga.resolve())!=Pr||as&&Ht(new as)!=Lr||Ta&&Ht(new Ta)!=Ir)&&(Ht=function(e){var t=Et(e),s=t==_g?e.constructor:void 0,i=s?Mt(s):"";if(i)switch(i){case yg:return Ar;case Cg:return wr;case Sg:return Pr;case Og:return Lr;case bg:return Ir}return t});var Rs=Ht,wg=Object.prototype,Pg=wg.hasOwnProperty;function Lg(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Pg.call(e,"index")&&(s.index=e.index,s.input=e.input),s}var Ig=Lg,Ag=Ve.Uint8Array,Bi=Ag;function xg(e){var t=new e.constructor(e.byteLength);return new Bi(t).set(new Bi(e)),t}var Fa=xg;function Bg(e,t){var s=t?Fa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}var kg=Bg,Mg=/\w*$/;function Rg(e){var t=new e.constructor(e.source,Mg.exec(e));return t.lastIndex=e.lastIndex,t}var Ng=Rg,xr=Re?Re.prototype:void 0,Br=xr?xr.valueOf:void 0;function Dg(e){return Br?Object(Br.call(e)):{}}var Hg=Dg;function Gg(e,t){var s=t?Fa(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}var Fg=Gg,Ug="[object Boolean]",Wg="[object Date]",Yg="[object Map]",Vg="[object Number]",Kg="[object RegExp]",zg="[object Set]",jg="[object String]",Xg="[object Symbol]",$g="[object ArrayBuffer]",qg="[object DataView]",Qg="[object Float32Array]",Zg="[object Float64Array]",Jg="[object Int8Array]",em="[object Int16Array]",tm="[object Int32Array]",sm="[object Uint8Array]",im="[object Uint8ClampedArray]",am="[object Uint16Array]",nm="[object Uint32Array]";function rm(e,t,s){var i=e.constructor;switch(t){case $g:return Fa(e);case Ug:case Wg:return new i(+e);case qg:return kg(e,s);case Qg:case Zg:case Jg:case em:case tm:case sm:case im:case am:case nm:return Fg(e,s);case Yg:return new i;case Vg:case jg:return new i(e);case Kg:return Ng(e);case zg:return new i;case Xg:return Hg(e)}}var om=rm;function hm(e){return typeof e.constructor=="function"&&!ba(e)?Gl(ka(e)):{}}var lm=hm,cm="[object Map]";function dm(e){return Ke(e)&&Rs(e)==cm}var um=dm,kr=Zt&&Zt.isMap,pm=kr?Dt(kr):um,gm=pm,mm="[object Set]";function fm(e){return Ke(e)&&Rs(e)==mm}var Em=fm,Mr=Zt&&Zt.isSet,vm=Mr?Dt(Mr):Em,Tm=vm,_m=1,ym=2,Cm=4,Rr="[object Arguments]",Sm="[object Array]",Om="[object Boolean]",bm="[object Date]",wm="[object Error]",Nr="[object Function]",Pm="[object GeneratorFunction]",Lm="[object Map]",Im="[object Number]",Dr="[object Object]",Am="[object RegExp]",xm="[object Set]",Bm="[object String]",km="[object Symbol]",Mm="[object WeakMap]",Rm="[object ArrayBuffer]",Nm="[object DataView]",Dm="[object Float32Array]",Hm="[object Float64Array]",Gm="[object Int8Array]",Fm="[object Int16Array]",Um="[object Int32Array]",Wm="[object Uint8Array]",Ym="[object Uint8ClampedArray]",Vm="[object Uint16Array]",Km="[object Uint32Array]",J={};J[Rr]=J[Sm]=J[Rm]=J[Nm]=J[Om]=J[bm]=J[Dm]=J[Hm]=J[Gm]=J[Fm]=J[Um]=J[Lm]=J[Im]=J[Dr]=J[Am]=J[xm]=J[Bm]=J[km]=J[Wm]=J[Ym]=J[Vm]=J[Km]=!0,J[wm]=J[Nr]=J[Mm]=!1;function ki(e,t,s,i,a,n){var r,o=t&_m,l=t&ym,d=t&Cm;if(s&&(r=a?s(e,i,a,n):s(e)),r!==void 0)return r;if(!xe(e))return e;var f=Le(e);if(f){if(r=Ig(e),!o)return ya(e,r)}else{var S=Rs(e),A=S==Nr||S==Pm;if(bi(e))return sg(e,o);if(S==Dr||S==Rr||A&&!a){if(r=l||A?{}:lm(e),!o)return l?pg(e,Jp(r,e)):lg(e,Qp(r,e))}else{if(!J[S])return a?e:{};r=om(e,S,o)}}n||(n=new Ms);var x=n.get(e);if(x)return x;n.set(e,r),Tm(e)?e.forEach(function(he){r.add(ki(he,t,s,he,e,n))}):gm(e)&&e.forEach(function(he,pe){r.set(pe,ki(he,t,s,pe,e,n))});var X=d?l?br:Da:l?La:Jt,Z=f?void 0:X(e);return sc(Z||e,function(he,pe){Z&&(pe=he,he=e[pe]),Si(r,pe,ki(he,t,s,pe,e,n))}),r}var zm=ki,jm=1,Xm=4;function $m(e){return zm(e,jm|Xm)}var ns=$m,qm="__lodash_hash_undefined__";function Qm(e){return this.__data__.set(e,qm),this}var Zm=Qm;function Jm(e){return this.__data__.has(e)}var ef=Jm;function Mi(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Ii;++t<s;)this.add(e[t])}Mi.prototype.add=Mi.prototype.push=Zm,Mi.prototype.has=ef;var Ri=Mi;function tf(e,t){for(var s=-1,i=e==null?0:e.length;++s<i;)if(t(e[s],s,e))return!0;return!1}var sf=tf;function af(e,t){return e.has(t)}var Ns=af,nf=1,rf=2;function of(e,t,s,i,a,n){var r=s&nf,o=e.length,l=t.length;if(o!=l&&!(r&&l>o))return!1;var d=n.get(e),f=n.get(t);if(d&&f)return d==t&&f==e;var S=-1,A=!0,x=s&rf?new Ri:void 0;for(n.set(e,t),n.set(t,e);++S<o;){var X=e[S],Z=t[S];if(i)var he=r?i(Z,X,S,t,e,n):i(X,Z,S,e,t,n);if(he!==void 0){if(he)continue;A=!1;break}if(x){if(!sf(t,function(pe,H){if(!Ns(x,H)&&(X===pe||a(X,pe,s,i,n)))return x.push(H)})){A=!1;break}}else if(!(X===Z||a(X,Z,s,i,n))){A=!1;break}}return n.delete(e),n.delete(t),A}var Hr=of;function hf(e){var t=-1,s=Array(e.size);return e.forEach(function(i,a){s[++t]=[a,i]}),s}var lf=hf;function cf(e){var t=-1,s=Array(e.size);return e.forEach(function(i){s[++t]=i}),s}var Ua=cf,df=1,uf=2,pf="[object Boolean]",gf="[object Date]",mf="[object Error]",ff="[object Map]",Ef="[object Number]",vf="[object RegExp]",Tf="[object Set]",_f="[object String]",yf="[object Symbol]",Cf="[object ArrayBuffer]",Sf="[object DataView]",Gr=Re?Re.prototype:void 0,Wa=Gr?Gr.valueOf:void 0;function Of(e,t,s,i,a,n,r){switch(s){case Sf:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Cf:return!(e.byteLength!=t.byteLength||!n(new Bi(e),new Bi(t)));case pf:case gf:case Ef:return Ci(+e,+t);case mf:return e.name==t.name&&e.message==t.message;case vf:case _f:return e==t+"";case ff:var o=lf;case Tf:var l=i&df;if(o||(o=Ua),e.size!=t.size&&!l)return!1;var d=r.get(e);if(d)return d==t;i|=uf,r.set(e,t);var f=Hr(o(e),o(t),i,a,n,r);return r.delete(e),f;case yf:if(Wa)return Wa.call(e)==Wa.call(t)}return!1}var bf=Of,wf=1,Pf=Object.prototype,Lf=Pf.hasOwnProperty;function If(e,t,s,i,a,n){var r=s&wf,o=Da(e),l=o.length,d=Da(t),f=d.length;if(l!=f&&!r)return!1;for(var S=l;S--;){var A=o[S];if(!(r?A in t:Lf.call(t,A)))return!1}var x=n.get(e),X=n.get(t);if(x&&X)return x==t&&X==e;var Z=!0;n.set(e,t),n.set(t,e);for(var he=r;++S<l;){A=o[S];var pe=e[A],H=t[A];if(i)var re=r?i(H,pe,A,t,e,n):i(pe,H,A,e,t,n);if(!(re===void 0?pe===H||a(pe,H,s,i,n):re)){Z=!1;break}he||(he=A=="constructor")}if(Z&&!he){var le=e.constructor,we=t.constructor;le!=we&&"constructor"in e&&"constructor"in t&&!(typeof le=="function"&&le instanceof le&&typeof we=="function"&&we instanceof we)&&(Z=!1)}return n.delete(e),n.delete(t),Z}var Af=If,xf=1,Fr="[object Arguments]",Ur="[object Array]",Ni="[object Object]",Bf=Object.prototype,Wr=Bf.hasOwnProperty;function kf(e,t,s,i,a,n){var r=Le(e),o=Le(t),l=r?Ur:Rs(e),d=o?Ur:Rs(t);l=l==Fr?Ni:l,d=d==Fr?Ni:d;var f=l==Ni,S=d==Ni,A=l==d;if(A&&bi(e)){if(!bi(t))return!1;r=!0,f=!1}if(A&&!f)return n||(n=new Ms),r||er(e)?Hr(e,t,s,i,a,n):bf(e,t,l,s,i,a,n);if(!(s&xf)){var x=f&&Wr.call(e,"__wrapped__"),X=S&&Wr.call(t,"__wrapped__");if(x||X){var Z=x?e.value():e,he=X?t.value():t;return n||(n=new Ms),a(Z,he,s,i,n)}}return A?(n||(n=new Ms),Af(e,t,s,i,a,n)):!1}var Mf=kf;function Yr(e,t,s,i,a){return e===t?!0:e==null||t==null||!Ke(e)&&!Ke(t)?e!==e&&t!==t:Mf(e,t,s,i,Yr,a)}var Vr=Yr,Rf=1,Nf=2;function Df(e,t,s,i){var a=s.length,n=a,r=!i;if(e==null)return!n;for(e=Object(e);a--;){var o=s[a];if(r&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++a<n;){o=s[a];var l=o[0],d=e[l],f=o[1];if(r&&o[2]){if(d===void 0&&!(l in e))return!1}else{var S=new Ms;if(i)var A=i(d,f,l,e,t,S);if(!(A===void 0?Vr(f,d,Rf|Nf,i,S):A))return!1}}return!0}var Hf=Df;function Gf(e){return e===e&&!xe(e)}var Kr=Gf;function Ff(e){for(var t=Jt(e),s=t.length;s--;){var i=t[s],a=e[i];t[s]=[i,a,Kr(a)]}return t}var Uf=Ff;function Wf(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==void 0||e in Object(s))}}var zr=Wf;function Yf(e){var t=Uf(e);return t.length==1&&t[0][2]?zr(t[0][0],t[0][1]):function(s){return s===e||Hf(s,e,t)}}var Vf=Yf;function Kf(e,t){return e!=null&&t in Object(e)}var zf=Kf;function jf(e,t,s){t=Ai(t,e);for(var i=-1,a=t.length,n=!1;++i<a;){var r=ks(t[i]);if(!(n=e!=null&&s(e,r)))break;e=e[r]}return n||++i!=a?n:(a=e==null?0:e.length,!!a&&Sa(a)&&_i(r,a)&&(Le(e)||wa(e)))}var Xf=jf;function $f(e,t){return e!=null&&Xf(e,t,zf)}var qf=$f,Qf=1,Zf=2;function Jf(e,t){return Ia(e)&&Kr(t)?zr(ks(e),t):function(s){var i=Wu(s,e);return i===void 0&&i===t?qf(s,e):Vr(t,i,Qf|Zf)}}var eE=Jf;function tE(e){return function(t){return t==null?void 0:t[e]}}var sE=tE;function iE(e){return function(t){return xi(t,e)}}var aE=iE;function nE(e){return Ia(e)?sE(ks(e)):aE(e)}var rE=nE;function oE(e){return typeof e=="function"?e:e==null?Is:typeof e=="object"?Le(e)?eE(e[0],e[1]):Vf(e):rE(e)}var rs=oE;function hE(e,t,s,i){for(var a=-1,n=e==null?0:e.length;++a<n;){var r=e[a];t(i,r,s(r),e)}return i}var lE=hE;function cE(e){return function(t,s,i){for(var a=-1,n=Object(t),r=i(t),o=r.length;o--;){var l=r[e?o:++a];if(s(n[l],l,n)===!1)break}return t}}var dE=cE,uE=dE(),pE=uE;function gE(e,t){return e&&pE(e,t,Jt)}var jr=gE;function mE(e,t){return function(s,i){if(s==null)return s;if(!Qt(s))return e(s,i);for(var a=s.length,n=t?a:-1,r=Object(s);(t?n--:++n<a)&&i(r[n],n,r)!==!1;);return s}}var fE=mE,EE=fE(jr),Xr=EE;function vE(e,t,s,i){return Xr(e,function(a,n,r){t(i,a,s(a),r)}),i}var TE=vE;function _E(e,t){return function(s,i){var a=Le(s)?lE:TE,n=t?t():{};return a(s,e,rs(i,2),n)}}var Ya=_E,yE=Object.prototype,CE=yE.hasOwnProperty,SE=Ya(function(e,t,s){CE.call(e,s)?++e[s]:yi(e,s,1)}),$r=SE,OE=function(){return Ve.Date.now()},Va=OE,bE="Expected a function",wE=Math.max,PE=Math.min;function LE(e,t,s){var i,a,n,r,o,l,d=0,f=!1,S=!1,A=!0;if(typeof e!="function")throw new TypeError(bE);t=fa(t)||0,xe(s)&&(f=!!s.leading,S="maxWait"in s,n=S?wE(fa(s.maxWait)||0,t):n,A="trailing"in s?!!s.trailing:A);function x(z){var Pe=i,gt=a;return i=a=void 0,d=z,r=e.apply(gt,Pe),r}function X(z){return d=z,o=setTimeout(pe,t),f?x(z):r}function Z(z){var Pe=z-l,gt=z-d,vh=t-Pe;return S?PE(vh,n-gt):vh}function he(z){var Pe=z-l,gt=z-d;return l===void 0||Pe>=t||Pe<0||S&&gt>=n}function pe(){var z=Va();if(he(z))return H(z);o=setTimeout(pe,Z(z))}function H(z){return o=void 0,A&&i?x(z):(i=a=void 0,r)}function re(){o!==void 0&&clearTimeout(o),d=0,i=l=a=o=void 0}function le(){return o===void 0?r:H(Va())}function we(){var z=Va(),Pe=he(z);if(i=arguments,a=this,l=z,Pe){if(o===void 0)return X(l);if(S)return clearTimeout(o),o=setTimeout(pe,t),x(l)}return o===void 0&&(o=setTimeout(pe,t)),r}return we.cancel=re,we.flush=le,we}var Ka=LE;function IE(e){return Ke(e)&&Qt(e)}var Ds=IE;function AE(e,t,s){for(var i=-1,a=e==null?0:e.length;++i<a;)if(s(t,e[i]))return!0;return!1}var za=AE,xE=200;function BE(e,t,s,i){var a=-1,n=Ca,r=!0,o=e.length,l=[],d=t.length;if(!o)return l;s&&(t=Ze(t,Dt(s))),i?(n=za,r=!1):t.length>=xE&&(n=Ns,r=!1,t=new Ri(t));e:for(;++a<o;){var f=e[a],S=s==null?f:s(f);if(f=i||f!==0?f:0,r&&S===S){for(var A=d;A--;)if(t[A]===S)continue e;l.push(f)}else n(t,S,i)||l.push(f)}return l}var ja=BE,kE=Nt(function(e,t){return Ds(e)?ja(e,Ba(t,1,Ds,!0)):[]}),ME=kE;function RE(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Di=RE;function NE(e){return typeof e=="function"?e:Is}var DE=NE;function HE(e,t,s){var i;return s(e,function(a,n,r){if(t(a,n,r))return i=n,!1}),i}var GE=HE;function FE(e,t){return GE(e,rs(t,3),jr)}var Be=FE;function UE(e,t){var s=-1,i=Qt(e)?Array(e.length):[];return Xr(e,function(a,n,r){i[++s]=t(a,n,r)}),i}var WE=UE,YE=Object.prototype,VE=YE.hasOwnProperty,KE=Ya(function(e,t,s){VE.call(e,s)?e[s].push(t):yi(e,s,[t])}),qr=KE;function zE(e,t){return e>t}var jE=zE;function XE(e,t){return Ze(t,function(s){return e[s]})}var $E=XE;function qE(e){return e==null?[]:$E(e,Jt(e))}var QE=qE,ZE=Math.min;function JE(e,t,s){for(var i=s?za:Ca,a=e[0].length,n=e.length,r=n,o=Array(n),l=Infinity,d=[];r--;){var f=e[r];r&&t&&(f=Ze(f,Dt(t))),l=ZE(f.length,l),o[r]=!s&&(t||a>=120&&f.length>=120)?new Ri(r&&f):void 0}f=e[0];var S=-1,A=o[0];e:for(;++S<a&&d.length<l;){var x=f[S],X=t?t(x):x;if(x=s||x!==0?x:0,!(A?Ns(A,X):i(d,X,s))){for(r=n;--r;){var Z=o[r];if(!(Z?Ns(Z,X):i(e[r],X,s)))continue e}A&&A.push(X),d.push(x)}}return d}var ev=JE;function tv(e){return Ds(e)?e:[]}var sv=tv,iv=Nt(function(e){var t=Ze(e,sv);return t.length&&t[0]===e[0]?ev(t):[]}),Qr=iv;function av(e,t){return e<t}var nv=av;function rv(e,t,s){for(var i=-1,a=e.length;++i<a;){var n=e[i],r=t(n);if(r!=null&&(o===void 0?r===r&&!kt(r):s(r,o)))var o=r,l=n}return l}var Zr=rv;function ov(e,t){return e&&e.length?Zr(e,rs(t,2),jE):void 0}var ze=ov;function hv(e,t){return e&&e.length?Zr(e,rs(t,2),nv):void 0}var Gt=hv;function lv(e,t,s,i){if(!xe(e))return e;t=Ai(t,e);for(var a=-1,n=t.length,r=n-1,o=e;o!=null&&++a<n;){var l=ks(t[a]),d=s;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(a!=r){var f=o[l];d=i?i(f,l,o):void 0,d===void 0&&(d=xe(f)?f:_i(t[a+1])?[]:{})}Si(o,l,d),o=o[l]}return e}var cv=lv;function dv(e,t,s){for(var i=-1,a=t.length,n={};++i<a;){var r=t[i],o=xi(e,r);s(o,r)&&cv(n,Ai(r,e),o)}return n}var uv=dv;function pv(e,t){if(e==null)return{};var s=Ze(br(e),function(i){return[i]});return t=rs(t),uv(e,s,function(i,a){return t(i,a[0])})}var gv=pv;function mv(e){return op(2,e)}var os=mv;function fv(e,t){var s=e.length;for(e.sort(t);s--;)e[s]=e[s].value;return e}var Ev=fv;function vv(e,t){if(e!==t){var s=e!==void 0,i=e===null,a=e===e,n=kt(e),r=t!==void 0,o=t===null,l=t===t,d=kt(t);if(!o&&!d&&!n&&e>t||n&&r&&l&&!o&&!d||i&&r&&l||!s&&l||!a)return 1;if(!i&&!n&&!d&&e<t||d&&s&&a&&!i&&!n||o&&s&&a||!r&&a||!l)return-1}return 0}var Tv=vv;function _v(e,t,s){for(var i=-1,a=e.criteria,n=t.criteria,r=a.length,o=s.length;++i<r;){var l=Tv(a[i],n[i]);if(l){if(i>=o)return l;var d=s[i];return l*(d=="desc"?-1:1)}}return e.index-t.index}var yv=_v;function Cv(e,t,s){t.length?t=Ze(t,function(n){return Le(n)?function(r){return xi(r,n.length===1?n[0]:n)}:n}):t=[Is];var i=-1;t=Ze(t,Dt(rs));var a=WE(e,function(n,r,o){var l=Ze(t,function(d){return d(n)});return{criteria:l,index:++i,value:n}});return Ev(a,function(n,r){return yv(n,r,s)})}var Sv=Cv,Ov=Ya(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]}),bv=Ov;function wv(e,t,s,i){for(var a=s-1,n=e.length;++a<n;)if(i(e[a],t))return a;return-1}var Pv=wv,Lv=Array.prototype,Jr=Lv.splice;function Iv(e,t,s,i){var a=i?Pv:Ti,n=-1,r=t.length,o=e;for(e===t&&(t=ya(t)),s&&(o=Ze(e,Dt(s)));++n<r;)for(var l=0,d=t[n],f=s?s(d):d;(l=a(o,f,l,i))>-1;)o!==e&&Jr.call(o,l,1),Jr.call(e,l,1);return e}var Av=Iv;function xv(e,t){return e&&e.length&&t&&t.length?Av(e,t):e}var Bv=xv,kv=Nt(Bv),hs=kv,Mv=Math.floor,Rv=Math.random;function Nv(e,t){return e+Mv(Rv()*(t-e+1))}var Dv=Nv,Hv=Math.ceil,Gv=Math.max;function Fv(e,t,s,i){for(var a=-1,n=Gv(Hv((t-e)/(s||1)),0),r=Array(n);n--;)r[i?n:++a]=e,e+=s;return r}var Uv=Fv;function Wv(e){return function(t,s,i){return i&&typeof i!="number"&&Oa(t,s,i)&&(s=i=void 0),t=Ei(t),s===void 0?(s=t,t=0):s=Ei(s),i=i===void 0?t<s?1:-1:Ei(i),Uv(t,s,i,e)}}var Yv=Wv,Vv=Yv(),Kv=Vv;function zv(e,t){var s=-1,i=e.length,a=i-1;for(t=t===void 0?i:t;++s<t;){var n=Dv(s,a),r=e[n];e[n]=e[s],e[s]=r}return e.length=t,e}var eo=zv;function jv(e){return eo(ya(e))}var Xv=jv;function $v(e){return eo(QE(e))}var qv=$v;function Qv(e){var t=Le(e)?Xv:qv;return t(e)}var Zv=Qv,Jv=Nt(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Oa(e,t[0],t[1])?t=[]:s>2&&Oa(t[0],t[1],t[2])&&(t=[t[0]]),Sv(e,Ba(t,1),[])}),to=Jv,eT="Expected a function";function tT(e,t,s){var i=!0,a=!0;if(typeof e!="function")throw new TypeError(eT);return xe(s)&&(i="leading"in s?!!s.leading:i,a="trailing"in s?!!s.trailing:a),Ka(e,t,{leading:i,maxWait:t,trailing:a})}var Ft=tT,sT=9007199254740991,Xa=4294967295,iT=Math.min;function aT(e,t){if(e=Ea(e),e<1||e>sT)return[];var s=Xa,i=iT(e,Xa);t=DE(t),e-=Xa;for(var a=zn(i,t);++s<e;)t(s);return a}var ke=aT;function nT(e,t){for(var s=e.length;s--&&Ti(t,e[s],0)>-1;);return s}var rT=nT;function oT(e,t){for(var s=-1,i=e.length;++s<i&&Ti(t,e[s],0)>-1;);return s}var hT=oT;function lT(e,t,s){if(e=ar(e),e&&(s||t===void 0))return Hn(e);if(!e||!(t=Dn(t)))return e;var i=mr(e),a=mr(t),n=hT(i,a),r=rT(i,a)+1;return dp(i,n,r).join("")}var cT=lT,dT=1/0,uT=as&&1/Ua(new as([,-0]))[1]==dT?function(e){return new as(e)}:_a,pT=uT,gT=200;function mT(e,t,s){var i=-1,a=Ca,n=e.length,r=!0,o=[],l=o;if(s)r=!1,a=za;else if(n>=gT){var d=t?null:pT(e);if(d)return Ua(d);r=!1,a=Ns,l=new Ri}else l=t?[]:o;e:for(;++i<n;){var f=e[i],S=t?t(f):f;if(f=s||f!==0?f:0,r&&S===S){for(var A=l.length;A--;)if(l[A]===S)continue e;t&&l.push(S),o.push(f)}else a(l,S,s)||(l!==o&&l.push(S),o.push(f))}return o}var $a=mT;function fT(e){return e&&e.length?$a(e):[]}var ot=fT,ET=Nt(function(e,t){return Ds(e)?ja(e,t):[]}),Tt=ET;function vT(e,t,s){var i=e.length;if(i<2)return i?$a(e[0]):[];for(var a=-1,n=Array(i);++a<i;)for(var r=e[a],o=-1;++o<i;)o!=a&&(n[a]=ja(n[a]||r,e[o],t,s));return $a(Ba(n,1),t,s)}var TT=vT,_T=Nt(function(e){return TT(_r(e,Ds))}),yT=_T;function CT(e,t,s){for(var i=-1,a=e.length,n=t.length,r={};++i<a;){var o=i<n?t[i]:void 0;s(r,e[i],o)}return r}var ST=CT;function OT(e,t){return ST(e||[],t||[],Si)}var bT=OT,Je;(function(e){e.SHORT="short",e.LONG="long",e.OFF="off"})(Je||(Je={}));function qa(e){switch(e){case Je.SHORT:return 3e3;case Je.LONG:return 6e3;case Je.OFF:return Number.MAX_VALUE;default:let t=e}}var wT=Object.values(Je),g;(function(e){e.LANGUAGE="language",e.GRAPHICS_QUALITY="graphics_quality",e.GRAPHICS_QUALITY_MANUALLY="graphics_quality_manually",e.HINT_DELAY="hint_delay",e.MUSIC_MUTED="music_muted",e.SOUND_MUTED="sound_muted",e.LEVELS="levels",e.COMPLETE_TUTORIALS="complete_tutorials",e.EDITOR_ZOOM="editor_zoom",e.BOOSTERS="boosters",e.PREGAME_BOOSTERS="pregame_boosters",e.LIVES="lives",e.LIVES_REFILL_TIMER_START="lives_refill_timestamp",e.LIVES_REFILL_TIMER_DURATION="lives_refill_timer_duration",e.LIVES_UNLIMITED_TIMER_START="lives_unlimited_timestamp",e.LIVES_UNLIMITED_TIMER_DURATION="lives_unlimited_timer_duration",e.COINS="coins",e.PIGGY_BANK_COINS="piggy_bank_coins",e.GIFT_STARS_NUM="gift_stars_num",e.GIFTS_OPENED="gifts_opened",e.WHEEL_LOCKED="wheel_locked",e.WHEEL_RESET_TIMESTAMP="wheel_reset_timestamp",e.GAVE_FEEDBACK="gave_feedback",e.BUILD="build",e.INTERSTITIAL_ADS_WATCHED="interstitial_ads_watched",e.REWARDED_ADS_WATCHED="rewarded_ads_watched",e.SHOP_SPECIAL_OFFER_BOUGHT="shop_special_offer_bought",e.SHOP_ANY_PURCHASE_COMPLETE="shop_any_purchase_complete",e.SHOP_SPECIAL_OFFER_DISPLAY_TS="shop_special_offer_display_ts",e.GREETING_GIFT_OPEN_TS="greeting_gift_open_ts",e.LOGIN_NUM="login_num"})(g||(g={}));var ht;(function(e){e.CLEAR="__CLEAR",e.SAVE="__SAVE"})(ht||(ht={}));var PT=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.game=e,this.storeName=t,this.sendSaveErrorToSentry=os((s,i)=>{var a;(a=this.game.sentry)==null||a.captureException("Save error",{extra:{error:s,saveKey:i}})}),this.initRuntimeStorage()}initRuntimeStorage(){this._runtimeStorage=new wh,this._runtimeStorage.setNamespace(this.storeName)}initActualStorage(){return $(this,null,function*(){var e,t,s,i,a;let n=this.getStorages();for(let o of n)try{yield o();break}catch(l){(e=this.game.analytics)==null||e.sendError(`Storage:Init_Error ${this.stringifyError(l)}`)}let r=(s=(t=this._storage)==null?void 0:t.type)!=null?s:"none";(i=this.game.sentry)==null||i.setTag("storage",r),(a=this.game.analytics)==null||a.sendDesignEvent(`Storage:${r}`),this.logStorageType(r)})}getStorages(){let e=w.get("storage");return e==="idb"||e==="indexedDB"||e==="indexed"?[this.useIndexedDb.bind(this),this.useLocalStorage.bind(this)]:[this.useLocalStorage.bind(this),this.useIndexedDb.bind(this)]}useLocalStorage(){if(Ln()===!1)return Promise.reject("localStorage is not available");let e=new Ph("Papa Cherry Saga");return this.setStorage(e),Promise.resolve()}useIndexedDb(){return $(this,null,function*(){if(Lh()===!1)return Promise.reject("indexedDB is not available");try{let e=new Ih(this.storeName);return yield e.init(),this.setStorage(e),Promise.resolve()}catch(e){return Promise.reject(e)}})}stringifyError(e){return typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}setStorage(e){this._storage=e}logStorageType(e){}getValue(e){return this._runtimeStorage.getValue(e)}getBoolean(e){return this._runtimeStorage.getBoolean(e)}getNumber(e){return this._runtimeStorage.getNumber(e)}getObject(e){return this._runtimeStorage.getObject(e)}saveValue(e,t){var s;(s=this._storage)==null||s.saveValue(e,t).catch(i=>{var a;this.sendSaveErrorToSentry(i,e),(a=this.game.analytics)==null||a.sendError("Storage:Save_Error")}),this._runtimeStorage.saveValue(e,t),this.emit(`${ht.SAVE}-${e}`,t)}changeNumber(e,t,s=-Number.MAX_VALUE,i=Number.MAX_VALUE){let n=this.getNumber(e)+t;return n=Phaser.Math.Clamp(n,s,i),this.saveValue(e,n),n}loadInitialValues(){return $(this,null,function*(){yield Promise.all([this.loadValue(g.LANGUAGE,""),this.loadValue(g.GRAPHICS_QUALITY,Ye.HIGH),this.loadValue(g.GRAPHICS_QUALITY_MANUALLY,!1),this.loadValue(g.HINT_DELAY,Je.LONG),this.loadValue(g.SOUND_MUTED,!1),this.loadValue(g.MUSIC_MUTED,!1),this.loadValue(g.EDITOR_ZOOM,1),this.loadValue(g.PREGAME_BOOSTERS,{}),this.loadValue(g.BOOSTERS,{[I.UNDO]:2}),this.loadValue(g.LEVELS,{}),this.loadValue(g.LIVES,window.game.config.lives.initialNum),this.loadValue(g.LIVES_REFILL_TIMER_START,0),this.loadValue(g.LIVES_REFILL_TIMER_DURATION,0),this.loadValue(g.LIVES_UNLIMITED_TIMER_START,0),this.loadValue(g.LIVES_UNLIMITED_TIMER_DURATION,0),this.loadValue(g.COINS,0),this.loadValue(g.PIGGY_BANK_COINS,0),this.loadValue(g.GIFT_STARS_NUM,0),this.loadValue(g.GIFTS_OPENED,0),this.loadValue(g.COMPLETE_TUTORIALS,[]),this.loadValue(g.WHEEL_LOCKED,!1),this.loadValue(g.WHEEL_RESET_TIMESTAMP,0),this.loadValue(g.GAVE_FEEDBACK,!1),this.loadValue(g.BUILD,window.game.config.build_version),this.loadValue(g.INTERSTITIAL_ADS_WATCHED,0),this.loadValue(g.REWARDED_ADS_WATCHED,0),this.loadValue(g.SHOP_SPECIAL_OFFER_BOUGHT,!1),this.loadValue(g.SHOP_ANY_PURCHASE_COMPLETE,!1),this.loadValue(g.SHOP_SPECIAL_OFFER_DISPLAY_TS,0),this.loadValue(g.GREETING_GIFT_OPEN_TS,0),this.loadValue(g.LOGIN_NUM,0)])})}loadValue(e,t,s,i){return $(this,null,function*(){if(!this._storage){this._runtimeStorage.saveValue(e,t);return}const a=s||this.getLoadCallbackByValueType(t),n=i||this._storage,o=(yield a.call(n,e))||t;this._runtimeStorage.saveValue(e,o)})}getLoadCallbackByValueType(e){switch(typeof e){case"number":return this._storage.getNumber;case"string":return this._storage.getValue;case"boolean":return this._storage.getBoolean;case"object":return this._storage.getObject;default:return this._storage.getValue}}checkLoadedValues(){let e=Object.keys(g).map(i=>g[i]),t=Object.keys(this._runtimeStorage.getContent()).map(i=>i.split("__")[1]),s=yT(e,t);s.length>0}resetSaveData(){return $(this,null,function*(){this.getNumber(g.LIVES)>this.game.lives.getInitialLivesNum()&&this.saveValue(g.LIVES,this.game.lives.getInitialLivesNum()),this.saveValue(g.PREGAME_BOOSTERS,{}),this.saveValue(g.BOOSTERS,{}),this.saveValue(g.LEVELS,{}),this.saveValue(g.COINS,0),this.saveValue(g.PIGGY_BANK_COINS,0),this.saveValue(g.COMPLETE_TUTORIALS,[]),this.saveValue(g.GIFT_STARS_NUM,0),this.saveValue(g.GIFTS_OPENED,0),this.saveValue(g.SHOP_SPECIAL_OFFER_BOUGHT,!1),this.saveValue(g.SHOP_ANY_PURCHASE_COMPLETE,!1),this.saveValue(g.LIVES_UNLIMITED_TIMER_START,0),this.saveValue(g.LIVES_UNLIMITED_TIMER_DURATION,0),this.saveValue(g.SHOP_SPECIAL_OFFER_DISPLAY_TS,0),this.saveValue(g.GREETING_GIFT_OPEN_TS,0),this.saveValue(g.LOGIN_NUM,1),this.emit(ht.CLEAR,this)})}migrateSaveData(){try{Object.keys(localStorage).filter(e=>e.includes("Papa Cherry Saga")).forEach(e=>{let t=e.split("__")[1],s=localStorage.getItem(e),i=JSON.parse(s);this.saveValue(t,i),localStorage.removeItem(e)})}catch(e){}}isLevelComplete(e){let t=this.getLevelResult(e);return t&&t.complete}getLevelResult(e){return this.getObject(g.LEVELS)[e]}saveLevelResult(e,t){let s=this.getObject(g.LEVELS),i=P(P({},s),{[e]:t});this.saveValue(g.LEVELS,i)}removeLevelResult(e){let t=this.getObject(g.LEVELS);delete t[e],this.saveValue(g.LEVELS,t)}getCompletedLevelNumbers(){let e=this.game.store.getObject(g.LEVELS);return Object.keys(e).filter(i=>e[i].complete).map(i=>parseInt(i))}getCompleteLevelsNum(){return this.getCompletedLevelNumbers().length}fixLevelResults(){this.getCompletedLevelNumbers().forEach(e=>{var t,s,i;let a=this.getLevelResult(e);a&&((t=a.pregameBoostersUsedNum)!=null||(a.pregameBoostersUsedNum=0),(s=a.boostersUsedNum)!=null||(a.boostersUsedNum=0),(i=a.secondChancesNum)!=null||(a.secondChancesNum=0))})}};function so(e,t=[]){Object.getOwnPropertyNames(e).forEach(s=>{let i=typeof e[s]=="function",a=t.includes(s);i&&a===!1&&e[s]()})}var io=class{static polyfill(){so(io,["polyfill"])}static nodeRemove(){let e=[Element,CharacterData,DocumentType],t=[];e.forEach(function(s){s&&t.push(s.prototype)}),function(s){s.forEach(function(i){i.hasOwnProperty("remove")||Object.defineProperty(i,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}(t)}},_;(function(e){e.PRESS="button_press",e.RELEASE="button_release"})(_||(_={}));var ls=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,t,s);this._enabled=!0,this.originalScale=1,this.areTweensEnabled=!0,this.checkIfOver=!0,this.soundKey="tap",this.soundVolume=1,i?i.add(this):this.scene.add.existing(this),this.setInteractive(),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onScenePointerUp,this),this.input.cursor="pointer"}onPointerDown(e){this.playPressedTween(),this.playSound(),this.emit(_.PRESS,this,e),this.currentPointer=e}playPressedTween(){!this.areTweensEnabled||(this.originalScale=this.scale,this.scene.tweens.add({targets:this,scale:this.scale*.9,ease:Phaser.Math.Easing.Cubic.Out,duration:50}))}playSound(){this.scene.audio.play(this.soundKey,{volume:this.soundVolume})}onScenePointerUp(e,t){if(this.currentPointer&&this.currentPointer===e){this.currentPointer=null;let s=t.includes(this);(this.checkIfOver===!1||s)&&(this.onPointerUp(),this.emit(_.RELEASE,this,e)),this.playReleasedTween()}}playReleasedTween(){!this.scene||!this.areTweensEnabled||this.scene.tweens.add({targets:this,scale:this.originalScale,ease:Phaser.Math.Easing.Back.Out,duration:300})}onPointerUp(){}enableInput(){this._enabled||(this._enabled=!0,this.setInteractive())}disableInput(){this._enabled!==!1&&(this._enabled=!1,this.disableInteractive())}inflateHitArea(e,t){let s=this.input.hitArea;s&&s instanceof Phaser.Geom.Rectangle&&Phaser.Geom.Rectangle.Inflate(s,e,t)}emulatePressEvent(e=[]){this.emit(_.PRESS,this,...e)}emulateReleaseEvent(e=[]){this.emit(_.RELEASE,this,...e)}destroy(){this.scene&&this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onScenePointerUp,this),super.destroy()}},ao;(function(e){e[e.STATE_1=1]="STATE_1",e[e.STATE_2=2]="STATE_2"})(ao||(ao={}));var LT=class extends ls{constructor(e,t,s,i,a){super(e,t,s,a);this.frame_1=s,this.frame_2=i,this._buttonState=1}onPointerUp(){super.onPointerUp(),this.toggleFrames()}toggleFrames(){this.buttonState=this._buttonState===1?2:1}get buttonState(){return this._buttonState}set buttonState(e){this._buttonState=e,this._buttonState===1?this.setFrame(this.frame_1):this.setFrame(this.frame_2)}},no=We(require("howler")),u;(function(e){e.MUSIC_LOOP="music_loop_short",e.TAP="tap",e.FANCY_TAP="fancy_tap",e.APPLE_COLLECT="apple_collect",e.BOMB_IGNITE="bomb_ignite",e.BOMB="bomb_1",e.STAR_WHOOSH="star_whoosh",e.BOOSTER_WHOOSH="booster_whoosh",e.BOOSTER_LAND="booster_land",e.BOOSTER_CANT_USE="booster_cant",e.BOOSTER_GLOVE="booster_glove_2",e.BOOSTER_LOLLIPOP="booster_lollipop",e.BOOSTER_ROLLING_PIN="booster_piping_bag",e.CANDY_BOTTLE_OPEN="candy_bottle_open",e.CANT_SWAP="cant_swap_1",e.COLOR_CAKE_BITE="color_cake_bite",e.COLOR_CAKE_EXPLODE="color_cake_explode",e.COLOR_CAKE_INFLATE="color_cake_inflate",e.BISCUIT_COLLECT="cookie_collect",e.COOKIE_UNLOCK="cookie_unlock",e.DONUT_BITE="donut_bite",e.DONUT_BOX_CLOSE="donut_box_close",e.DOUBLE_SPHERES_CHARGE="double_spheres_charge",e.DOUBLE_SPHERES_EXPLODE="double_spheres_explode",e.DROP_ITEM_COLLECT="drop_item_collect",e.EXTRA_MOVES="extra_moves",e.GOAL_UPDATE="goal_update_3",e.GOAL_COMPLETE="goal_complete",e.LEVEL_FAILED="level_failed_2",e.LEVEL_ICON_UNLOCK="level_icon_unlock_2",e.LEVEL_PRE_COMPLETE="level_pre_complete_2",e.LEVEL_PRE_COMPLETE_MUSIC="level_pre_complete_music",e.VICTORY="victory",e.LIFE_GRANTED="life_granted_2",e.MATCH_1="match_1",e.MATCH_2="match_2",e.MATCH_3="match_3",e.MATCH_4="match_4",e.MATCH_5="match_5",e.STRIPES_CREATED="stripes_created",e.BOMB_CREATED="bomb_created",e.SPHERE_CREATED="sphere_created",e.MOVES_WARNING="moves_warning",e.OUT_OF_MOVES="out_of_moves",e.POWERUP_FROM_CHEF="powerup_from_chef",e.POWERUP_TO_CHEF="powerup_to_chef",e.STRIPES="stripes_3",e.SUPER_SPHERE="super_sphere",e.SWAP="swap_1",e.SWAP_BACK="swap_back_3",e.UNDO="undo",e.WHEEL_OPEN="wheel_open",e.WHEEL_SPIN_TICK="wheel_spin_tick_2",e.WHEEL_REWARD="wheel_reward",e.SHUFFLE="shuffle_2",e.WHOOSH_1="whoosh_1",e.WHOOSH_2="whoosh_2",e.COIN_ADD="coin_add_5",e.COIN_SPEND="coin_spend",e.TWINKLE_1="twinkle_1",e.TWINKLE_2="twinkle_2",e.TWINKLE_3="twinkle_3",e.TWINKLE_4="twinkle_4",e.GIFT_REVEAL="gift_reveal",e.GIFT_DROP="gift_drop",e.GIFT_EXPLODE="gift_explode",e.GUMMY_COLLECT="gummy_1",e.GUMMY_BLOCK_DROP="gummy_block_drop_3",e.MYSTERY_BOX="mystery_box_1",e.CUPCAKE="cupcake_1",e.CHICK="chick_1",e.GENERATOR="generator_1",e.SHOP_OPEN="shop_open_2"})(u||(u={}));var lt;(function(e){e.DEVELOP="develop",e.PRODUCTION="production"})(lt||(lt={}));var ro=!1;function IT(){window.environment===lt.PRODUCTION&&typeof cacheBusters!="undefined"&&typeof cacheBustingMethod!="undefined"&&(ro=!0,AT())}function AT(){let e=i=>{typeof i.url=="string"&&(i.url=Ut(i.url))},t=Phaser.Utils.String.UUID(),s=Phaser.Loader.LoaderPlugin.prototype;s[t]=s.addFile,s.addFile=function(i){return Array.isArray(i)?i.forEach(a=>e(a)):e(i),this[t](i)}}function Ut(e){if(ro){let t=cacheBusters[e];return t?xT(e,t):e}return e}function xT(e,t){return cacheBustingMethod==="filenames"?BT(e,t):`${e}?v=${t}`}function BT(e,t){let s=e.indexOf("."),i=e.slice(0,s),a=e.slice(s);return`${i}.${t}${a}`}var Qa;(function(e){e.MP3="mp3",e.WAV="wav",e.WEBM="webm",e.OGG="ogg"})(Qa||(Qa={}));var _t;(function(e){e.SOUND_MUTE_CHANGE="__SOUND_MUTE_CHANGE",e.MUSIC_MUTE_CHANGE="__MUSIC_MUTE_CHANGE"})(_t||(_t={}));var kT=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.musicLoopVolume=.2,this._soundMute=!1,this._musicMute=!1,this.wasMuted=!1,this.game=e,this.options=t,this.global=no.Howler,this.global.autoUnlock=!0,this.sounds={},t.muteTrigger==="hidden"?(this.game.events.on(Phaser.Core.Events.HIDDEN,this.onPageHidden,this),this.game.events.on(Phaser.Core.Events.VISIBLE,this.onPageVisible,this)):(this.onPageVisibleDebounced=Ka(this.onPageVisible.bind(this),150),this.game.events.on(Phaser.Core.Events.BLUR,this.onPageHidden,this),this.game.events.on(Phaser.Core.Events.FOCUS,this.onPageVisibleDebounced))}onPageHidden(){this.suspendAudioContext()}onPageVisible(){var e;((e=this.game.adsHelper)==null?void 0:e.adInProgress)||this.resumeAudioContext()}loadSound(e,t,s){return this.sounds[t]?(""+t,e):e.rexAwait(t,{callback:(i,a)=>{let n=this.doLoadSound(t,s);n.on("loaderror",(r,o)=>a(r,o)),n.on("load",()=>i())}})}doLoadSound(e,t){var s;let a=((s=t==null?void 0:t.formats)!=null?s:[Qa.MP3]).map(o=>Ut(`assets/audio/${e}.${o}`)),n=e===u.MUSIC_LOOP?this._musicMute:this._soundMute,r=new no.Howl(P({src:a,mute:n},t));return this.sounds[e]=r,r}has(e){return!!this.sounds[e]}get(e){return this.sounds[e]}play(e,t,s=!1){if(this.isLocked()&&s===!1)return;let i=this.get(e);if(i!==void 0)return i.state()!=="loaded"||(typeof(t==null?void 0:t.volume)!="undefined"&&i.volume(t.volume),typeof(t==null?void 0:t.rate)!="undefined"&&i.rate(t.rate),typeof(t==null?void 0:t.seek)!="undefined"&&i.seek(t.seek),typeof(t==null?void 0:t.loop)!="undefined"&&i.loop(t.loop),i.play()),i}stop(e,t){let s=this.get(e);s&&s.stop(t)}playClick(e){return this.play(u.TAP,e,!0)}addMusicLooop(){if(this.musicLoop=this.get(u.MUSIC_LOOP),!!this.musicLoop){if(this.global.usingWebAudio===!1){this.playMusicLoop();return}this.onAudioUnlocked().then(()=>{this.playMusicLoop()})}}onAudioUnlocked(){return new Promise((e,t)=>{if(this.global._audioUnlocked)return e();this.musicLoop.once("unlock",()=>e())})}playMusicLoop(){!this.musicLoop||(this.musicLoop.play(),this.musicLoop.mute(this._musicMute),this.musicLoop.loop(!0),this.musicLoop.fade(0,this.musicLoopVolume,1e3))}fadeInMusicLoop(e){var t;(t=this.musicLoop)==null||t.fade(0,this.musicLoopVolume,e)}fadeOutMusicLoop(e){var t;(t=this.musicLoop)==null||t.fade(this.musicLoop.volume(),0,e)}suspendAudioContext(){let e=this.global.ctx;return e?e.state!=="running"?Promise.resolve():e.suspend():(this.wasMuted=Boolean(this.global._muted),this.global.mute(!0),Promise.resolve())}resumeAudioContext(){let e=this.global.ctx;if(!e)return this.global.mute(this.wasMuted),Promise.resolve();let t=e.state;return t==="suspended"||t==="interrupted"?e.resume():Promise.resolve()}isLocked(){return this.global.usingWebAudio===!1?!1:!this.global._audioUnlocked}set rate(e){Object.values(this.sounds).forEach(t=>{t.rate(e)})}get musicMute(){return this._musicMute}set musicMute(e){var t;this._musicMute=e,(t=this.musicLoop)==null||t.mute(this._musicMute),this.emit(_t.MUSIC_MUTE_CHANGE,this,this._musicMute)}get soundMute(){return this._soundMute}set soundMute(e){this._soundMute=e,Object.values(this.sounds).forEach(t=>{t!==this.musicLoop&&t.mute(this._soundMute)}),this.emit(_t.SOUND_MUTE_CHANGE,this,this._soundMute)}},MT=class extends ls{constructor(e,t,s,i,a){super(e,t,s,a);this.frame_1=s,this.frame_2=i,this.store=this.scene.game.store,this.soundManager=this.scene.audio,this.soundManager.on(_t.SOUND_MUTE_CHANGE,this.onMuteChange,this),this.updateFrame(this.soundManager.soundMute)}onMuteChange(e,t){this.updateFrame(t)}updateFrame(e){this.setFrame(e?this.frame_2:this.frame_1)}onPointerUp(){super.onPointerUp(),this.soundManager.soundMute=!this.soundManager.soundMute,this.store.saveValue(g.SOUND_MUTED,this.soundManager.soundMute)}destroy(){this.soundManager.off(_t.SOUND_MUTE_CHANGE,this.onMuteChange,this),super.destroy()}},RT=class extends Phaser.GameObjects.Text{constructor(e,t,s,i,a){super(e,t,s,i,a);this.maxWidth=0,this.maxHeight=0,this.setOrigin(.5,.5)}setMaxSize(e,t){this.maxWidth=e,this.maxHeight=t,this.adjustTextSize()}setText(e){return super.setText(e),this.adjustTextSize(),this}adjustTextSize(){for(let e=0;e<3;e++)this.setWordWrapWidth(this.maxWidth/this.scale,!0),this.scale=this.maxHeight/this.height}},fe=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.soundKey="tap",this.soundVolume=1,this.areTweensEnabled=!0,this.checkIfOver=!0,this.originalScale=1,i?i.add(this):this.scene.add.existing(this),this.name="button_"+s,this.addBack(t,s),this.setSize(this.back.width,this.back.height),this.setInteractive(),this.input.cursor="pointer",this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onScenePointerUp,this)}enableInput(){this.setInteractive()}disableInput(){this.disableInteractive()}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}onPointerDown(e){this.currentPointer=e,this.playSound(),this.playPressedTween(),this.emit(_.PRESS,this,...Array.from(arguments))}playSound(){this.scene.audio.play(this.soundKey,{volume:this.soundVolume})}playPressedTween(){!this.areTweensEnabled||this.scene.tweens.add({targets:this,scale:this.originalScale*.9,ease:Phaser.Math.Easing.Cubic.Out,duration:50})}onScenePointerUp(e,t){if(!this.currentPointer||this.currentPointer!==e)return;this.currentPointer=null;let s=t.includes(this);(this.checkIfOver===!1||s)&&(this.onPointerUp(),this.emit(_.RELEASE,this,...Array.from(arguments))),this.playReleasedTween()}onPointerUp(){}playReleasedTween(){var e;this.areTweensEnabled&&((e=this.scene)==null||e.tweens.add({targets:this,scale:this.originalScale,ease:Phaser.Math.Easing.Back.Out,duration:300}))}addIcon(e,t,s=0,i=0){return this.icon=this.scene.make.image({key:e,frame:t},!1),this.icon.x=s,this.icon.y=i,this.add(this.icon),this.icon}addBitmapText(e,t,s,i=0,a=0){return this.bitmapText=this.scene.make.bitmapText({font:t,size:s,text:e,add:!1}),this.bitmapText.align=Phaser.Display.Align.CENTER,this.bitmapText.setOrigin(.5,.5),this.bitmapText.x=this.back.x+i,this.bitmapText.y=this.back.y+a,this.add(this.bitmapText),this.bitmapText}addText(e,t,s=0,i=0){return this.text=this.scene.make.text({text:e,style:t}),this.text.setOrigin(.5,.5),this.text.x=this.back.x+s,this.text.y=this.back.y+i,this.add(this.text),this.text}inflateHitArea(e,t){let s=this.input.hitArea;s&&s instanceof Phaser.Geom.Rectangle&&Phaser.Geom.Rectangle.Inflate(s,e,t)}emulatePressEvent(e=[]){this.emit(_.PRESS,this,...e)}emulateReleaseEvent(e=[]){this.emit(_.RELEASE,this,...e)}preDestroy(){var e;(e=this.scene)==null||e.input.off(Phaser.Input.Events.POINTER_UP,this.onScenePointerUp,this),super.preDestroy()}},NT=class extends ls{constructor(e,t,s,i,a){super(e,t,s,a);this.frame_1=s,this.frame_2=i,this.store=this.scene.game.store,this.soundManager=this.scene.audio,this.soundManager.on(_t.MUSIC_MUTE_CHANGE,this.onMuteChange,this),this.updateFrame(this.soundManager.musicMute)}onMuteChange(e,t){this.updateFrame(t)}updateFrame(e){this.setFrame(e?this.frame_2:this.frame_1)}onPointerUp(){super.onPointerUp(),this.soundManager.musicMute=!this.soundManager.musicMute,this.store.saveValue(g.MUSIC_MUTED,this.soundManager.musicMute)}destroy(){this.soundManager.off(_t.MUSIC_MUTE_CHANGE,this.onMuteChange,this),super.destroy()}},oo=class{static extend(){so(oo,["extend"])}static extendGroup(){Phaser.GameObjects.Group.prototype.createItems=function(e){let t=[];for(let s=0;s<e;s++)t.push(this.create());return t}}static extendGraphics(){Phaser.GameObjects.Graphics.prototype.inverseSlice=function(e,t,s,i,a,n,r){let o=a,l=i;return this.slice(e,t,s,o,l,n,r)}}static extendTweens(){Phaser.Tweens.TweenManager.prototype.addYoyoTween=function(e){var t;let s=(t=e.base)!=null?t:e.target[e.property],i=0,a=e,{target:n,property:r,base:o,delta:l}=a,d=fi(a,["target","property","base","delta"]);return this.add(k(P({ease:Phaser.Math.Easing.Sine.Out},d),{targets:e.target,yoyo:!0,[e.property]:(f,S)=>++i%2==0?s-e.delta:s+e.delta}))},Phaser.Tweens.TweenManager.prototype.addCircleTween=function(e){var t,s;return(t=e.startAngle)!=null||(e.startAngle=-90),(s=e.endAngle)!=null||(e.endAngle=e.startAngle+360),this.addCounter(k(P({},e),{onUpdate:(i,a,n)=>{let r=e.startAngle+(e.endAngle-e.startAngle)*a.value,o=Phaser.Math.DegToRad(r);e.target.x=e.centerX+Math.cos(o)*e.radius,e.target.y=e.centerY+Math.sin(o)*e.radius,e.onUpdate&&e.onUpdate(i,a,n)}}))},Phaser.Tweens.TweenManager.prototype.addCurveTween=function(e){var t;let s=new Phaser.Math.Vector2,i;return e.rotateToCurve&&(i=new Phaser.Math.Vector2,(t=e.rotateOffset)!=null||(e.rotateOffset=0)),this.addCounter(k(P({},e),{onUpdate:(a,n,r)=>{e.curve.getPoint(n.value,s),e.target.x=s.x,e.target.y=s.y,e.rotateToCurve&&(e.curve.getTangent(n.value,i),e.target.angle=i.angle()*Phaser.Math.RAD_TO_DEG+e.rotateOffset),e.onUpdate&&e.onUpdate(a,n,r)}}))},Phaser.Tweens.TweenManager.prototype.killTweensByProperty=function(e,...t){return this.getTweensOf(e).filter(s=>s.data.some(i=>t.includes(i.key))).forEach(s=>s.stop()),this}}static addGetGlobalPosition(){let e=function(i){let a=this.getWorldTransformMatrix();return i=i!=null?i:{x:0,y:0},i.x=a.tx,i.y=a.ty,i},t=function(){let i=this.getCenter();return this.prepareBoundsOutput(i,!0)},s=[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText].forEach(i=>{i.prototype.getWorldPosition=e,i.prototype.hasOwnProperty("getCenter")&&i.prototype.hasOwnProperty("prepareBoundsOutput")&&(i.prototype.getGlobalCenter=t)})}static addKillRevive(){let e=function(){this.visible=!1,this.active=!1},t=function(){this.visible=!0,this.active=!0},s=[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Particles.ParticleEmitter,Phaser.GameObjects.Particles.ParticleEmitterManager].forEach(i=>{i.prototype.kill=e,i.prototype.revive=t})}static extendContainer(){Phaser.GameObjects.Container.prototype.gridAlign=function(e,t,s){typeof t=="undefined"&&(t=0),typeof s=="undefined"&&(s=this.length);let i=this.list.slice(t,s);return Phaser.Actions.GridAlign(i,e),this}}static extendAnimationManager(){if(typeof Phaser.Animations=="undefined")return;let e=(s,i)=>{let a=t(s),n=t(i);return a-n},t=(s,i=4)=>parseInt(s.slice(-i));Phaser.Animations.AnimationManager.prototype.getFrameNames=function(s,i){return this.game.textures.get(s).getFrameNames().filter(r=>r.includes(i)).sort(e).map(r=>({key:s,frame:r}))}}static extendMath(){Phaser.Math.Sign=e=>e>=0?1:-1,Phaser.Math.MapLinear=function(e,t,s,i,a){return i+(e-t)*(a-i)/(s-t)}}static extendRandomDataGenerator(){Phaser.Math.RandomDataGenerator.prototype.bool=function(){return this.frac()>.5},Phaser.Math.RandomDataGenerator.prototype.pickMultiple=function(e,t){t=Math.min(t,e.length);let s=[];for(;s.length<t;){let i=this.pick(e);s.includes(i)===!1&&s.push(i)}return s},Phaser.Math.RandomDataGenerator.prototype.pickExcept=function(e,t){let s,i=e.length;do s=this.pick(e);while(t===s&&--i>0);return s},Phaser.Math.RandomDataGenerator.prototype.pickExceptMultiple=function(e,t,s=100){let i;do i=this.pick(e);while(t.includes(i)&&--s>0);return i}}static extendFactory(){let e=Phaser.GameObjects.GameObjectFactory.prototype;e.existingMultiple=function(t){return t.map(s=>this.existing(s))},e.button=function(t,s,i){return new ls(this.scene,t,s,i)},e.toggleButton=function(t,s,i,a){return new LT(this.scene,t,s,i,a)},e.soundButton=function(t,s,i,a){return new MT(this.scene,t,s,i,a)},e.musicButton=function(t,s,i,a){return new NT(this.scene,t,s,i,a)},e.complexButton=function(t,s,i){return new fe(this.scene,t,s,i)},e.autoText=function(t,s,i){let a=new RT(this.scene,0,0,t,s);return i?i.add(a):this.scene.add.existing(a),a}}static addScaleMethods(){let e=t=>typeof t.setScale!="undefined";Phaser.GameObjects.GameObject.prototype.fitWidth=function(t){e(this)!==!1&&(this.setScale(1),this.setScale(t/this.width))},Phaser.GameObjects.GameObject.prototype.fitHeight=function(t){e(this)!==!1&&this.setScale(Math.min(1,t/this.height))},Phaser.GameObjects.GameObject.prototype.fitIn=function(t,s){if(e(this)===!1)return;let i=t/this.width,a=s/this.height;this.scale=Math.min(1,i,a)},Phaser.GameObjects.GameObject.prototype.fillWidth=function(t){e(this)!==!1&&this.setScale(Math.max(1,t/this.width))},Phaser.GameObjects.GameObject.prototype.fillHeight=function(t){e(this)!==!1&&this.setScale(Math.max(1,t/this.height))},Phaser.GameObjects.GameObject.prototype.envelop=function(t,s){if(e(this)===!1)return;let i=t/this.width,a=s/this.height;this.scale=Math.max(i,a)}}static addAlighMethods(){Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"top",{get:function(){return Phaser.Display.Bounds.GetTop(this)},set:function(e){return Phaser.Display.Bounds.SetTop(this,e)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"right",{get:function(){return Phaser.Display.Bounds.GetRight(this)},set:function(e){return Phaser.Display.Bounds.SetRight(this,e)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"bottom",{get:function(){return Phaser.Display.Bounds.GetBottom(this)},set:function(e){return Phaser.Display.Bounds.SetBottom(this,e)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"left",{get:function(){return Phaser.Display.Bounds.GetLeft(this)},set:function(e){return Phaser.Display.Bounds.SetLeft(this,e)}})}static extendLoader(){Phaser.Loader.LoaderPlugin.prototype.scriptTag=function(e,t,s,i){return this.rexAwait(e,{callback:(a,n)=>{let r=document.createElement("script");r.setAttribute("src",t),r.setAttribute("type","text/javascript"),r.onload=o=>{s==null||s(o),a()},r.onerror=o=>{i==null||i(o),n()},document.head.appendChild(r)}})},Phaser.Loader.LoaderPlugin.prototype.bitmapFontFromAtlas=function(e,t,s,i,a,n){let r=e+"_data";return this.xml(r,i),this.once(Phaser.Loader.Events.COMPLETE,()=>{Phaser.GameObjects.BitmapText.ParseFromAtlas(this.scene,e,t,s,r,a,n)===!1&&""+e}),this}}},DT=class{static isDesktop(){let e=navigator.userAgent,t={android:!1,chromeOS:!1,cordova:!1,crosswalk:!1,desktop:!1,ejecta:!1,electron:!1,iOS:!1,iOSVersion:0,iPad:!1,iPhone:!1,kindle:!1,linux:!1,macOS:!1,node:!1,nodeWebkit:!1,pixelRatio:1,webApp:!1,windows:!1,windowsPhone:!1};/Windows/.test(e)?t.windows=!0:/Mac OS/.test(e)&&!/like Mac OS/.test(e)?t.macOS=!0:/Android/.test(e)?t.android=!0:/Linux/.test(e)?t.linux=!0:/iP[ao]d|iPhone/i.test(e)?(t.iOS=!0,navigator.appVersion.match(/OS (\d+)/),t.iOSVersion=parseInt(RegExp.$1,10),t.iPhone=e.toLowerCase().indexOf("iphone")!==-1,t.iPad=e.toLowerCase().indexOf("ipad")!==-1):/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)?t.kindle=!0:/CrOS/.test(e)&&(t.chromeOS=!0),(/Windows Phone/i.test(e)||/IEMobile/i.test(e))&&(t.android=!1,t.iOS=!1,t.macOS=!1,t.windows=!0,t.windowsPhone=!0);let s=/Silk/.test(e);return(t.windows||t.macOS||t.linux&&!s||t.chromeOS)&&(t.desktop=!0),(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(t.desktop=!1),t.macOS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(t.desktop=!1),t.desktop}};function ho(){try{if(typeof navigator.deviceMemory=="number")return navigator.deviceMemory*1024}catch(e){}}var je=class{},E=je;E.SERVER_URL="https://robowhale.com/html5/papa-louie-levels/",E.SOURCE_GAME_WIDTH=750,E.SOURCE_GAME_HEIGHT=1e3,E.IS_LANDSCAPE=je.SOURCE_GAME_WIDTH>je.SOURCE_GAME_HEIGHT,E.IS_PORTRAIT=je.SOURCE_GAME_HEIGHT>=je.SOURCE_GAME_WIDTH,E.GAME_WIDTH=je.SOURCE_GAME_WIDTH,E.GAME_HEIGHT=je.SOURCE_GAME_HEIGHT,E.HALF_GAME_WIDTH=je.GAME_WIDTH*.5,E.HALF_GAME_HEIGHT=je.GAME_HEIGHT*.5,E.ASPECT_RATIO=je.SOURCE_GAME_WIDTH/je.SOURCE_GAME_HEIGHT,E.ASSETS_SCALE=1;var yt;(function(e){e.WEBGL="webgl",e.CANVAS="canvas"})(yt||(yt={}));var cs;(function(e){e.NO_AUDIO="no_audio",e.HTML5_AUDIO="html5_audio",e.WEB_AUDIO="web_audio"})(cs||(cs={}));var HT=class{static create(){return{scale:this.getScaleConfig(),parent:"canvas-container",type:this.getRenderType(),fps:{deltaHistory:20},render:{clearBeforeRender:!1,transparent:!1,failIfMajorPerformanceCaveat:!0,maxTextures:this.getMaxTexturesNum()},banner:{background:["rgba(0,0,255,0.4)"]},audio:{noAudio:!0},plugins:{global:[{key:"rexWebfontLoader",plugin:rexwebfontloaderplugin,start:!0},{key:"rexawaitloaderplugin",plugin:rexawaitloaderplugin,start:!0}]},callbacks:{preBoot:this.preBootCallback.bind(this),postBoot:this.postBootCallback.bind(this)}}}static getMaxTexturesNum(){if(w.has("maxTextures"))return w.getNumber("maxTextures",0)}static getScaleConfig(){return DT.isDesktop()?this.getDesktopScaleConfig():this.getMobileScaleConfig()}static getDesktopScaleConfig(){let e={width:E.SOURCE_GAME_WIDTH,height:E.SOURCE_GAME_HEIGHT,autoCenter:Phaser.Scale.CENTER_BOTH,mode:Phaser.Scale.FIT};return w.getBool("originalSize")&&(e.max={width:E.SOURCE_GAME_WIDTH,height:E.SOURCE_GAME_HEIGHT}),e}static getMobileScaleConfig(){return{width:E.SOURCE_GAME_WIDTH,height:E.SOURCE_GAME_HEIGHT,mode:Phaser.Scale.NONE}}static getRenderType(){return w.getBool("forceCanvas")?Phaser.CANVAS:Phaser.AUTO}static preBootCallback(e){}static postBootCallback(e){}},M;(function(e){e.GLOBAL="GLOBAL",e.BOOT="BOOT",e.PRELOADER="PRELOADER",e.LEVEL_MAP="LEVEL_MAP",e.GAMEPLAY_ROOT="GAMEPLAY_ROOT",e.GAMEPLAY="GAMEPLAY",e.GAMEPLAY_GUI="GAMEPLAY_GUI",e.LEVEL_MAP_EDITOR="LEVEL_MAP_EDITOR",e.LEVEL_EDITOR_ROOT="LEVEL_EDITOR_ROOT",e.LEVEL_EDITOR="LEVEL_EDITOR",e.LEVEL_EDITOR_GUI="LEVEL_EDITOR_GUI"})(M||(M={}));var GT=Phaser.Renderer.Canvas.CanvasRenderer,FT=class{constructor(e){this.scene=e,this.gameLoop=this.scene.game.loop,this.renderer=this.scene.game.renderer,this.span=document.createElement("span"),this.span.id="stats",this.span.addEventListener("click",this.toggleVisibility.bind(this)),document.body.appendChild(this.span),this.scene.scale.on(Phaser.Scale.Events.RESIZE,this.onResize,this),this.onResize()}toggleVisibility(){this.span.style.opacity==="0"?this.span.style.opacity="1":this.span.style.opacity="0"}onResize(){if(this.scene.scale.scaleMode===Phaser.Scale.FIT){let e=this.scene.scale.canvasBounds;this.span.style.left=e.left+"px"}}update(e){this.updateStats(e)}updateStats(e){let t=`FPS: ${Math.round(this.gameLoop.actualFps)}`,s=`MS: ${this.gameLoop.delta.toFixed(1)}`,i=`DC: ${this.getDrawCallsNum()}`,a=`${t} | ${s} | ${i}`;this.span.innerText=a}getDrawCallsNum(){return this.renderer instanceof GT?0:this.renderer.textureFlush}},Wt;(function(e){e.NORMAL="400",e.BOLD="700"})(Wt||(Wt={}));var Hs;(function(e){e.POETSEN="PoetsenOne",e.SANS_SERIF="sans-serif"})(Hs||(Hs={}));var p=class{};p.DEFAULT_FAMILY=Hs.POETSEN,p.DEFAULT_WEIGHT=Wt.NORMAL;var B;(function(e){e.LEVEL_EDITOR_GRID="LEVEL_EDITOR_GRID",e.GAME_FIELD_LABELS="GAME_FIELD_LABELS",e.LEVEL_ICONS_CLASSIC="LEVEL_ICONS_CLASSIC",e.LEVEL_ICONS_HARD="LEVEL_ICONS_HARD",e.POPUP_GOAL_LABELS="POPUP_GOAL_LABELS",e.PREGAME_BOOSTERS_LABELS="PREGAME_BOOSTERS_LABELS",e.TOP_PANEL_GOAL_LABELS="TOP_PANEL_GOAL_LABELS",e.MOVES_LABEL="MOVES_LABEL",e.LEVEL_MAP_BOTTOM_LABELS="LEVEL_MAP_BOTTOM_LABELS",e.LEVEL_MAP_TOP_PANEL="LEVEL_MAP_TOP_PANEL",e.LEVELS_EDITOR_LIST="LEVELS_EDITOR_LIST",e.POWERUP_CHEF="POWERUP_CHEF",e.BOOSTER_LABELS="BOOSTER_LABELS",e.SHOP_COINS="SHOP_COINS",e.LABELS_POPUPS="LABELS_POPUPS",e.LABELS_GAMEPLAY_GUI="LABELS_GAMEPLAY_GUI",e.GENERATOR_TURNS="GENERATOR_TURNS"})(B||(B={}));var lo="\u221E",UT=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="toast",this.options=t,this.addBack(),this.addText(t.message),this.setSize(this.back.width,this.back.height),this.setInteractive(),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.dismiss,this),this.input.cursor="pointer"}addBack(){this.back=this.scene.add.graphics({fillStyle:{color:0,alpha:.8},lineStyle:{width:0,color:0,alpha:1}});let e=E.SOURCE_GAME_WIDTH*.7,t=110;this.back.fillRoundedRect(-e/2,-t/2,e,t,{tl:20,bl:0,br:0,tr:20}),this.back.stroke(),this.back.width=e,this.back.height=t,this.add(this.back)}addText(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#ffffff",align:"center",padding:{x:0,y:4}};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setLineSpacing(0),this.text.setWordWrapWidth(this.back.width*.85,!0),this.text.setShadow(0,3,"rgba(0,0,0,0.5)",0),this.add(this.text),this.adjustTextSize()}adjustTextSize(){let e=this.back.height*.8;this.text.scale=Math.min(1,e/this.text.height)}show(e){let t=20;this.alpha=0,this.y+=t,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:this.y-t,onComplete:this.onShowCompelete.bind(this,e)})}onShowCompelete(e){this.dismissTimerEvent=this.scene.time.delayedCall(e,()=>{this.dismiss()})}dismiss(){var e,t;(e=this.dismissTimerEvent)==null||e.remove(),(t=this.scene)==null||t.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear,alpha:0,y:"+=15",onComplete:()=>this.destroy(!1)})}preDestroy(){var e;(e=this.dismissTimerEvent)==null||e.remove(),this.scene.tweens.killTweensOf(this)}},co=class{constructor(){this.pins=new Map}pin(e,t,s,i,a){this.pins.set(e,{obj:e,x:Phaser.Math.Clamp(t,0,1),y:Phaser.Math.Clamp(s,0,1),offsetX:i!=null?i:0,offsetY:a!=null?a:0})}unpin(e){this.pins.delete(e)}getPin(e){return this.pins.get(e)}align(e,t,s,i){let a=this.getPin(e);a&&this.usePin(a,t,s,i)}onResize(e,t,s){this.pins.forEach(i=>{this.usePin(i,e,t,s)})}usePin(e,t,s,i){e.obj.x=t*e.x+e.offsetX*i,e.obj.y=s*e.y+e.offsetY*i,typeof e.obj.originalX!="undefined"&&(e.obj.originalX=e.obj.x),typeof e.obj.originalY!="undefined"&&(e.obj.originalY=e.obj.y)}destroy(){this.pins.clear(),this.pins=null}},b;(function(e){e.SHOW="__SHOW",e.HIDE_START="__HIDE_START",e.HIDE_COMPLETE="__HIDE_COMPLETE"})(b||(b={}));var ie=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);var s;this.name=(s=t.name)!=null?s:"screen",this.options=P({backgroundKey:"__BLACK",backgroundAlpha:.8,backgroundPadding:4,backgroundInteractive:!0},t),this.pinner=new co,this.setSize(E.SOURCE_GAME_WIDTH,E.SOURCE_GAME_HEIGHT),this.addBackground(),this.updateScreenSize()}addBackground(){this.background=this.scene.add.image(0,0,this.options.backgroundKey,this.options.backgroundFrame),this.background.alpha=this.options.backgroundAlpha,this.background.name=this.name+"_bg",this.background.setOrigin(.5,.5),this.background.displayWidth=this.width+this.options.backgroundPadding,this.background.displayHeight=this.height+this.options.backgroundPadding,this.add(this.background),this.options.backgroundInteractive&&this.background.setInteractive()}updateScreenSize(){E.IS_PORTRAIT?(this.screenWidth=this.width,this.screenHeight=E.GAME_HEIGHT/this.scale):(this.screenWidth=E.GAME_WIDTH/this.scale,this.screenHeight=this.height),this.screenCenter={x:this.screenWidth/2,y:this.screenHeight/2}}resize(){E.IS_PORTRAIT?(this.scale=E.GAME_WIDTH/this.width,this.background.displayHeight=(E.GAME_HEIGHT+this.options.backgroundPadding)/this.scale):(this.scale=E.GAME_HEIGHT/this.height,this.background.displayWidth=(E.GAME_WIDTH+this.options.backgroundPadding)/this.scale),this.updateScreenSize(),this.pinner.onResize(this.screenWidth,this.screenHeight,1),this.background.x=this.screenCenter.x,this.background.y=this.screenCenter.y}pin(e,t,s,i,a){this.pinner.pin(e,t,s,i,a)}emitShowEvent(...e){this.emit(b.SHOW,this,...e)}emitHideStartEvent(...e){this.emit(b.HIDE_START,this,...e)}emitHideCompleteEvent(...e){this.emit(b.HIDE_COMPLETE,this,...e)}showBackground(e={}){var t,s,i;this.background.alpha=0,this.scene.tweens.add({targets:this.background,duration:(t=e.duration)!=null?t:150,ease:(s=e.ease)!=null?s:Phaser.Math.Easing.Cubic.Out,alpha:(i=e.targetAlpha)!=null?i:this.options.backgroundAlpha})}},WT=class extends ie{constructor(e){super(e,{name:"toasts",backgroundAlpha:0,backgroundInteractive:!1,backgroundKey:"level_map",backgroundFrame:"black_rect"});this.toasts=[]}show(e){this.dismissAll();let t=new UT(this.scene,e);this.toasts.push(t),this.add(t),this.pin(t,.5,1,0,-t.height/2+1),this.pinner.align(t,this.screenWidth,this.screenHeight,1),t.once(Phaser.GameObjects.Events.DESTROY,this.onToastDestroy,this),t.show(e.lifespan)}showVideoAdWarning(){this.show({lifespan:3e3,message:this.getRewardedAdsWarningText()})}getRewardedAdsWarningText(){let e=this.scene.texts,t,s=this.scene.game.texts.language;return s==="ru"||s==="en"?t=e.ads.no_rewarded_ads+" "+e.ads.adblock_rewarded_ads:t=e.ads.no_rewarded_ads,t}onToastDestroy(e){let t=this.toasts.indexOf(e);t>-1&&(this.toasts.splice(t,1),this.pinner.unpin(e))}dismissAll(){this.toasts.forEach(e=>e.dismiss())}resize(){super.resize()}},ds;(function(e){e[e.TOASTS=1]="TOASTS",e[e.SCENE_TRANSITION=2]="SCENE_TRANSITION",e[e.AD_OVERLAY=3]="AD_OVERLAY",e[e.PURCHASE_OVERLAY=4]="PURCHASE_OVERLAY"})(ds||(ds={}));var Gs;(function(e){e.GAMEPLAY_ASSETS_READY="__GAMEPLAY_ASSETS_READY"})(Gs||(Gs={}));var YT=class extends Phaser.Loader.LoaderPlugin{constructor(e){super(e);this.areGameplayAssetsReady=!1,this.howler=e.game.audio}startLoading(){this.once(Phaser.Loader.Events.COMPLETE,this.onGameplayAssetsLoaded,this),this.loadGameplayAssets(),this.start()}loadGameplayAssets(){this.image("gameplay_bg_1","assets/graphics/gameplay_bg_1.jpg"),this.atlas("gameplay","assets/graphics/gameplay.png","assets/graphics/gameplay.json"),this.atlas("gameplay_gui","assets/graphics/gameplay_gui.png","assets/graphics/gameplay_gui.json"),this.bitmapFontFromAtlas(B.GAME_FIELD_LABELS,"gameplay","field_labels","assets/fonts/bitmap/field_labels.xml"),this.bitmapFontFromAtlas(B.TOP_PANEL_GOAL_LABELS,"gameplay_gui","top_panel_goal_labels","assets/fonts/bitmap/top_panel_goal_labels.xml"),this.bitmapFontFromAtlas(B.MOVES_LABEL,"gameplay_gui","moves_label","assets/fonts/bitmap/moves_label.xml"),this.bitmapFontFromAtlas(B.POWERUP_CHEF,"gameplay_gui","powerup_chef_label","assets/fonts/bitmap/powerup_chef_label.xml"),this.bitmapFontFromAtlas(B.BOOSTER_LABELS,"gameplay_gui","boosters/booster_labels","assets/fonts/bitmap/booster_labels.xml"),this.bitmapFontFromAtlas(B.LABELS_GAMEPLAY_GUI,"gameplay_gui","level_complete/labels/labels","assets/fonts/bitmap/labels.xml"),this.bitmapFontFromAtlas(B.GENERATOR_TURNS,"gameplay","generator_turns","assets/fonts/bitmap/generator_turns.xml")}onGameplayAssetsLoaded(){this.areGameplayAssetsReady=!0,this.emit(Gs.GAMEPLAY_ASSETS_READY,this),this.once(Phaser.Loader.Events.COMPLETE,this.onSoundsLoaded,this),this.on(Phaser.Loader.Events.FILE_COMPLETE,this.onFileComplete,this),this.loadSounds(),this.start()}loadSounds(){this.loadSound(u.STRIPES_CREATED),this.loadSound(u.BOMB_CREATED),this.loadSound(u.SPHERE_CREATED),this.loadSound(u.FANCY_TAP),this.loadSound(u.WHOOSH_1),this.loadSound(u.WHOOSH_2),this.loadSound(u.BOMB_IGNITE),this.loadSound(u.DROP_ITEM_COLLECT),this.loadSound(u.APPLE_COLLECT),this.loadSound(u.CANDY_BOTTLE_OPEN),this.loadSound(u.DONUT_BITE),this.loadSound(u.DONUT_BOX_CLOSE),this.loadSound(u.COOKIE_UNLOCK),this.loadSound(u.COLOR_CAKE_BITE),this.loadSound(u.COLOR_CAKE_INFLATE),this.loadSound(u.COLOR_CAKE_EXPLODE),this.loadSound(u.BISCUIT_COLLECT),this.loadSound(u.SHUFFLE),this.loadSound(u.STAR_WHOOSH),this.loadSound(u.BOOSTER_WHOOSH),this.loadSound(u.BOOSTER_LAND),this.loadSound(u.BOOSTER_CANT_USE,{volume:.33}),this.loadSound(u.BOOSTER_GLOVE),this.loadSound(u.BOOSTER_ROLLING_PIN),this.loadSound(u.BOOSTER_LOLLIPOP),this.loadSound(u.UNDO),this.loadSound(u.DOUBLE_SPHERES_CHARGE),this.loadSound(u.DOUBLE_SPHERES_EXPLODE),this.loadSound(u.EXTRA_MOVES),this.loadSound(u.VICTORY),this.loadSound(u.LEVEL_FAILED),this.loadSound(u.LEVEL_ICON_UNLOCK),this.loadSound(u.COIN_ADD),this.loadSound(u.COIN_SPEND),this.loadSound(u.LEVEL_PRE_COMPLETE),this.loadSound(u.LEVEL_PRE_COMPLETE_MUSIC),this.loadSound(u.LIFE_GRANTED),this.loadSound(u.MOVES_WARNING),this.loadSound(u.OUT_OF_MOVES),this.loadSound(u.POWERUP_FROM_CHEF),this.loadSound(u.POWERUP_TO_CHEF),this.loadSound(u.WHEEL_OPEN),this.loadSound(u.WHEEL_SPIN_TICK),this.loadSound(u.WHEEL_REWARD),this.loadSound(u.TWINKLE_1),this.loadSound(u.TWINKLE_2),this.loadSound(u.TWINKLE_3),this.loadSound(u.TWINKLE_4),this.loadSound(u.GIFT_REVEAL),this.loadSound(u.GIFT_EXPLODE),this.loadSound(u.GIFT_DROP),this.loadSound(u.GUMMY_COLLECT),this.loadSound(u.GUMMY_BLOCK_DROP),this.loadSound(u.MYSTERY_BOX),this.loadSound(u.CUPCAKE),this.loadSound(u.GENERATOR),this.loadSound(u.MUSIC_LOOP)}loadSound(e,t){this.howler.loadSound(this,e,t)}onFileComplete(e){e===u.MUSIC_LOOP&&this.scene.audio.addMusicLooop()}onSoundsLoaded(){}},uo=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);s?s.add(this):e.add.existing(this),this.options=t,this.addDots()}addDots(){let e="spinner_dot_"+Phaser.Math.RND.uuid(),t=this.scene.make.graphics({fillStyle:{color:16777215}},!1);t.fillCircle(this.options.dotRadius,this.options.dotRadius,this.options.dotRadius),t.generateTexture(e,this.options.dotRadius*2,this.options.dotRadius*2),t.destroy(),this.dots=ke(this.options.dotsNum,s=>{let i=this.scene.add.image(0,0,e);return i.displayOriginY=this.options.radius,i.angle=s*16,i.originalAngle=i.angle,this.add(i),i})}startAnimation(){this.dots.forEach(e=>{e.angle=e.originalAngle}),this.scene.tweens.add({targets:this.dots.slice().reverse(),duration:1800,ease:Phaser.Math.Easing.Cubic.InOut,angle:"+=360",repeat:-1,repeatDelay:0,delay:this.scene.tweens.stagger(33)})}stopAnimation(){this.scene.tweens.killTweensOf(this.dots)}},VT=class extends Phaser.GameObjects.Text{constructor(e){super(e,0,0,"0",{fontFamily:"Arial",fontSize:"40px",color:"#ffffff",align:"center"})}},de;(function(e){e.INTERSTITIAL="interstitial",e.REWARDED="rewarded"})(de||(de={}));var KT=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.adInProgress=!1,this.options=t,this.game=e}onBeforeAdStart(e){return this.adInProgress?Promise.reject(`${e} ad in progress`):(this.adInProgress=!0,this.disableInput(),this.showAdOverlay(e),this.mute())}disableInput(){this.options.disableInput!==!1&&(this.wasInputEnabled=this.game.input.enabled,this.game.input.enabled=!1)}showAdOverlay(e){!this.adOverlay||(this.adOverlay.off(Ct.CLOSE_BUTTON_CLICK),this.adOverlay.once(Ct.CLOSE_BUTTON_CLICK,this.onAdComplete.bind(this,e)),this.adOverlay.show(e))}mute(){return this.options.muteMethod==="context_suspend"?this.game.audio.suspendAudioContext():(this.wasMuted=this.game.audio.global._muted,this.game.audio.global.mute(!0),Promise.resolve())}onAdComplete(e){this.adInProgress!==!1&&(this.adInProgress=!1,this.enableInput(),this.hideAdOverlay(e),this.unmute())}enableInput(){this.options.disableInput!==!1&&(this.game.input.enabled=this.wasInputEnabled)}hideAdOverlay(e){var t,s;(t=this.adOverlay)==null||t.off(Ct.CLOSE_BUTTON_CLICK),(s=this.adOverlay)==null||s.hide(e)}unmute(){if(this.options.muteMethod==="context_suspend"){this.game.audio.resumeAudioContext();return}this.game.audio.global.mute(this.wasMuted)}onLanguageChange(){var e;(e=this.adOverlay)==null||e.onLanguageChange()}waitUntilAdTimeComplete(){return!this.adOverlay||!this.adOverlay.isTimerRunning?Promise.resolve():new Promise(e=>{this.adOverlay.once(Ct.TIMER_COMPLETE,()=>e())})}get adOverlay(){return this.game.globalScene.adOverlay}},po=class extends fe{static createTexture(e){let t="ad_close_button",s=3,i=e.make.graphics({fillStyle:{alpha:0,color:0},lineStyle:{color:16777215,width:s}}),a=240,n=60;return i.strokeRoundedRect(s/2,s/2,a,n,25),i.generateTexture(t,a+s,n+s),i.destroy(),t}constructor(e){super(e,po.createTexture(e),null)}},Ct;(function(e){e.TIMER_COMPLETE="__TIMER_COMPLETE",e.CLOSE_BUTTON_CLICK="__CLOSE_BUTTON_CLICK"})(Ct||(Ct={}));var zT=class extends ie{constructor(e,t){super(e,{name:"ad_overlay",backgroundAlpha:1});this._isTimerRunning=!1,this.adOptions=t,this.addSpinner(),this.addTimer(),this.addCloseButton()}get isTimerRunning(){return this._isTimerRunning}addSpinner(){this.spinner=new uo(this.scene,{dotsNum:8,dotRadius:5,radius:50},this),this.spinner.angle=180,this.pin(this.spinner,.5,.5)}addTimer(){this.timer=new VT(this.scene),this.timer.setOrigin(.5,.5),this.add(this.timer),this.pin(this.timer,.5,1,0,-85)}addCloseButton(){let e=this.pinner.getPin(this.timer);this.closeButton=new po(this.scene),this.closeButton.addText("\u0417\u0430\u043A\u0440\u044B\u0442\u044C",{fontFamily:"Arial, serif",fontSize:"22px"}),this.closeButton.on(_.PRESS,this.onCloseButtonClick,this),this.closeButton.kill(),this.add(this.closeButton),this.pin(this.closeButton,e.x,e.y,e.offsetX,e.offsetY)}onCloseButtonClick(){this.emit(Ct.CLOSE_BUTTON_CLICK,this)}resize(){super.resize(),this.timer.originalY=this.timer.y,this.closeButton.originalY=this.closeButton.y}show(e){this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear,alpha:1}),this.showSpinner(),this.timer.kill(),this.closeButton.kill(),e===de.REWARDED&&this.adOptions.displayTimer&&this.startTimer()}showSpinner(){this.spinner.startAnimation(),this.spinner.scale=1.5,this.scene.tweens.add({targets:this.spinner,duration:200,scale:1,ease:Phaser.Math.Easing.Quadratic.Out})}startTimer(){this._isTimerRunning=!0;let e=this.adOptions.timeoutSeconds,t=0;this.timer.text=e.toString(),this.timerIntervalId=setInterval(()=>{--e==0&&this.onTimerComplete(),++t==3&&this.showTimer(),this.timer.text=e.toString()},1e3)}showTimer(){this.timer.revive(),this.timer.alpha=0,this.timer.y=this.timer.originalY+20,this.scene.tweens.add({targets:this.timer,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,y:this.timer.originalY,alpha:1})}onTimerComplete(){clearInterval(this.timerIntervalId),this.timer.kill(),this._isTimerRunning=!1,this.adOptions.displayCloseButton&&this.showCloseButton(),this.emit(Ct.TIMER_COMPLETE,this)}showCloseButton(){this.closeButton.revive(),this.closeButton.alpha=0,this.closeButton.y=this.closeButton.originalY+20,this.scene.tweens.add({targets:this.closeButton,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,y:this.closeButton.originalY,alpha:1})}hide(e){clearInterval(this.timerIntervalId),this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.kill(),this.spinner.stopAnimation()}})}onLanguageChange(){this.closeButton.text.setText(this.scene.texts.ads.close)}},jT=class extends ie{constructor(e){super(e,{name:"purchase_overlay",backgroundAlpha:.85});this.addSpinner()}addSpinner(){this.spinner=new uo(this.scene,{dotsNum:8,dotRadius:5,radius:50},this),this.spinner.angle=180,this.pin(this.spinner,.5,.5)}resize(){super.resize()}show(){this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear,alpha:1}),this.showSpinner()}showSpinner(){this.spinner.startAnimation(),this.spinner.scale=1.5,this.scene.tweens.add({targets:this.spinner,duration:200,scale:1,ease:Phaser.Math.Easing.Quadratic.Out})}hide(){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.kill(),this.spinner.stopAnimation()}})}},XT=class extends Phaser.Scene{init(){}create(){this.addRenderStats(),this.addAdOverlay(),this.addPurchaseOverlay(),this.resize()}addRenderStats(){w.getBool("stats")!==!1&&(this.renderStats=new FT(this))}addAdOverlay(){let e={displayTimer:!0,displayCloseButton:!1,timeoutSeconds:15};this.adOverlay=new zT(this,e),this.adOverlay.setDepth(ds.AD_OVERLAY),this.adOverlay.kill(),this.add.existing(this.adOverlay)}addPurchaseOverlay(){this.purchaseOverlay=new jT(this),this.purchaseOverlay.setDepth(ds.PURCHASE_OVERLAY),this.purchaseOverlay.kill(),this.add.existing(this.purchaseOverlay)}addSceneTranstion(e){this.sceneTransition=e,this.sceneTransition.setDepth(ds.SCENE_TRANSITION),this.sceneTransition.visible=!1,this.sceneTransition.active=!1,this.add.existing(this.sceneTransition)}addToasts(){return this.toasts=new WT(this),this.toasts.setDepth(ds.TOASTS),this.toasts.resize(),this.add.existing(this.toasts),this.toasts}addBlackRect(){return this.blackRect=this.make.image({key:"gameplay",frame:"black_rect_big"},!1),this.blackRect.alpha=.85,this.blackRect}addDelayedLoader(){return this.delayedLoader=new YT(this),this.delayedLoader}update(e,t){this.renderStats&&this.renderStats.update(t)}resize(){var e,t,s;(e=this.toasts)==null||e.resize(),(t=this.sceneTransition)==null||t.resize(),this.adOverlay.resize(),(s=this.purchaseOverlay)==null||s.resize()}},W;(function(e){e.STRIPES="stripes",e.BOMB="bomb",e.SUPER_SPHERE="super_sphere"})(W||(W={}));function $T(){try{if(typeof WebAssembly=="object"&&typeof WebAssembly.instantiate=="function"){let e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1}function qT(){try{return window.self!==window.top}catch(e){return!0}}var QT=Phaser.Scale.ScaleModes,ZT=Phaser.Renderer.WebGL.WebGLRenderer,ue;(function(e){e.COINS="coins",e.BOOSTERS="boosters",e.PREGAME_BOOSTERS="pregameBoosters"})(ue||(ue={}));var Te;(function(e){e.COIN="coin",e.STRIPES="stripes",e.BOMB="bomb",e.SUPER_SPHERE="super_sphere",e.UNDO="undo",e.GLOVE="glove",e.ROLLING_PIN="rolling_pin",e.LOLLIPOP="lollipop"})(Te||(Te={}));var us;(function(e){e[e.Clicked=1]="Clicked",e[e.Show=2]="Show",e[e.FailedShow=3]="FailedShow",e[e.RewardReceived=4]="RewardReceived"})(us||(us={}));var St;(function(e){e[e.Video=1]="Video",e[e.RewardedVideo=2]="RewardedVideo",e[e.Playable=3]="Playable",e[e.Interstitial=4]="Interstitial",e[e.OfferWall=5]="OfferWall",e[e.Banner=6]="Banner"})(St||(St={}));var go;(function(e){e[e.Undefined=0]="Undefined",e[e.Unknown=1]="Unknown",e[e.Offline=2]="Offline",e[e.NoFill=3]="NoFill",e[e.InternalError=4]="InternalError",e[e.InvalidRequest=5]="InvalidRequest",e[e.UnableToPrecache=6]="UnableToPrecache"})(go||(go={}));var Za;(function(e){e[e.Undefined=0]="Undefined",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical"})(Za||(Za={}));var mo;(function(e){e[e.Source=1]="Source",e[e.Sink=2]="Sink"})(mo||(mo={}));var fo;(function(e){e[e.Start=1]="Start",e[e.Complete=2]="Complete",e[e.Fail=3]="Fail"})(fo||(fo={}));var Ot;(function(e){e.SKIP_FIRST_INTERSTITIAL="skip_1st_ad",e.LIVES_NUM="lives_num",e.MOVES_DELTA="moves_delta"})(Ot||(Ot={}));var JT={[Ot.SKIP_FIRST_INTERSTITIAL]:"true",[Ot.LIVES_NUM]:"5",[Ot.MOVES_DELTA]:"0"},e_=class extends Phaser.Events.EventEmitter{constructor(e){super();if(this.isEnabled=!1,this.game=e,typeof gameanalytics=="undefined"){this.isEnabled=!1;return}this.ga=gameanalytics.GameAnalytics,this.isEnabled=!0,this.loadingTimes={},this.setCustomDimensions(),this.checkRemoteConfigKeys()}setCustomDimensions(){this.ga.setCustomDimension01(window.game.config.publisher),this.ga.setCustomDimension02(this.game.rendererType)}checkRemoteConfigKeys(){Object.values(Ot).forEach(t=>{let s=t.length;(s<1||s>12)&&""+t+s})}sendLevelStart(e){this.sendProgressionEvent(1,e)}sendLevelComplete(e,t){this.sendProgressionEvent(2,e,t)}sendLevelFail(e,t){this.sendProgressionEvent(3,e,t)}sendProgressionEvent(e,t,s){if(this.isEnabled===!1)return;let i="level_"+t.toString().padStart(3,"0");this.ga.addProgressionEvent(e,i,"","",s)}sendAdEvent(e,t,s,i){this.isEnabled!==!1&&this.ga.addAdEvent(e,t,i,s)}sendAdFailedEvent(e,t,s,i){this.isEnabled!==!1&&(typeof i=="undefined"?this.ga.addAdEvent(3,e,s,t):this.ga.addAdEventWithNoAdReason(3,e,s,t,i))}sendBusinessEvent(e,t,s,i,a){this.isEnabled!==!1&&this.ga.addBusinessEvent(e,t,s,i,a)}addResource(e,t=1,s,i){this.isEnabled!==!1&&this.ga.addResourceEvent(1,e,t,this.getResourceItemType(s),i)}subtractResource(e,t=1,s,i){this.isEnabled!==!1&&this.ga.addResourceEvent(2,e,t,this.getResourceItemType(s),i)}getResourceItemType(e){switch(e){case Te.COIN:return Te.COIN;case W.STRIPES:return Te.STRIPES;case W.BOMB:return Te.BOMB;case W.SUPER_SPHERE:return Te.SUPER_SPHERE;case I.UNDO:return Te.UNDO;case I.GLOVE:return Te.GLOVE;case I.ROLLING_PIN:return Te.ROLLING_PIN;case I.LOLLIPOP:return Te.LOLLIPOP;default:break}}sendLoadingEvent(e,t){if(this.isEnabled!==!1&&(t==="start"&&(this.loadingTimes[e]=Date.now(),this.ga.addDesignEvent(`Loading:${e}:${t}`)),t==="complete")){let s=Date.now()-this.loadingTimes[e],i=Phaser.Math.RoundTo(s/1e3,-1);this.ga.addDesignEvent(`Loading:${e}:${t}`,i)}}sendDesignEvent(e,t){this.isEnabled!==!1&&this.ga.addDesignEvent(e,t)}sendError(e,t=4){this.isEnabled!==!1&&this.ga.addErrorEvent(t,e)}sendBrowser(){if(this.isEnabled===!1)return;let e=["chrome","edge","firefox","ie","mobileSafari","opera","safari","silk","trident","other"],t=this.getCurrentBrowser(e);this.sendDesignEvent(`Browser:${t}`)}getCurrentBrowser(e){var t;let s,i=this.game.device;return i.os.android&&i.browser.chrome?s="chrome-android":s=(t=e.find(a=>i.browser[a]===!0))!=null?t:"other",s==="mobileSafari"&&(s="safari-mobile"),s}sendAvifStatus(e){let t=e?"avif:supported":"avif:not_supported";this.sendDesignEvent(t)}sendWebpStatus(e){let t=e?"webp:supported":"webp:not_supported";this.sendDesignEvent(t)}sendDesktopScreenResolution(){if(this.game.scale.scaleMode===QT.FIT!==!1)try{let{width:t,height:s}=screen;t>0&&s>0&&this.sendDesignEvent(`Screen:Resolution:${t}x${s}`)}catch(t){}}sendWebWorkerStatus(){let t=typeof Worker=="function"?"WebWorker:supported":"WebWorker:not_supported";this.sendDesignEvent(t)}sendServiceWorkerStatus(){let t="serviceWorker"in navigator?"ServiceWorker:supported":"ServiceWorker:not_supported";this.sendDesignEvent(t)}sendDeviceMemory(){let e=ho(),t=`DeviceMemory:${e!=null?e:"Unknown"}`;this.sendDesignEvent(t)}sendWebAssemblyStatus(){let t=$T()?"WebAssembly:supported":"WebAssembly:not_supported";this.sendDesignEvent(t)}sendWebGlParams(){let e=this.game.renderer;e instanceof ZT&&(this.sendDesignEvent(`WebGL:MaxTextures:${e.maxTextures}`),this.sendDesignEvent(`WebGL:TextureSize:${e.getMaxTextureSize()}`),this.sendTextureCompressionInfo(e.gl))}sendTextureCompressionInfo(e){let t="WEBGL_compressed_texture_",s="WEBKIT_"+t,i=o=>e.getExtension(t+o)||e.getExtension(s+o),a={ETC1:i("etc1"),PVRTC:i("pvrtc"),S3TC:i("s3tc"),ASTC:i("astc")},n=gv(a,o=>o!==null);if(Object.keys(n).length>0===!1){this.sendDesignEvent("WebGL:TextureCompression:not_supported");return}Object.keys(n).forEach(o=>{this.sendDesignEvent(`WebGL:TextureCompression:${o}`)})}sendReferrer(){let e=this.getReferrer()||"unknown",t=e.indexOf("?");t>-1&&(e=e.slice(0,t));let s=e.indexOf("//");s>-1&&(e=e.slice(s+2)),e=e.replace(new RegExp("(:|/|#)","g"),"_");let i=64;e.length>i&&(e=e.slice(0,i+1)),this.sendDesignEvent(`Referrer:${e}`)}getReferrer(){return qT()?document.referrer:location.host+location.pathname}getRemoteConfigValue(e,t){return t!=null||(t=JT[e]),this.isEnabled===!1?t:this.ga.getRemoteConfigsValueAsString(e,t)}loadRemoteConfig(){return this.isEnabled===!1?Promise.reject():this.ga.isRemoteConfigsReady()?(this.onRemoteConfigsReady(),Promise.resolve()):new Promise(e=>{this.ga.addRemoteConfigsListener({onRemoteConfigsUpdated:()=>{this.onRemoteConfigsReady(),e()}})})}onRemoteConfigsReady(){this.ga.getRemoteConfigsContentAsString(),this.ga.getABTestingId(),this.ga.getABTestingVariantId()}},t_=We(require("css-element-queries")),s_=class{constructor(e,t){this._quality=Ye.HIGH,this.game=e,this.options=t,this.scale=this.game.scale,this.canvas=this.scale.canvas,this.rotateOverlay=document.getElementById("rotate"),this.game.config.scaleMode===Phaser.Scale.NONE&&(this.scale.zoom=Phaser.Scale.NO_ZOOM,this.setupCanvasStyle(),this.addResizeListener(),this.updateScreenConstants())}get quality(){return this._quality}get qualityValue(){return In(this._quality)}setupCanvasStyle(){let e=this.canvas.parentElement.style;e.width="100%",e.height="100%",e.position="absolute",e.top="0",e.bottom="0"}addResizeListener(){let e=this.onCanvasResize.bind(this),t=this.options.resizeDebounceInterval>0?Ka(e,200,{leading:!1}):e,s=new t_.ResizeSensor(this.canvas.parentElement,t)}onCanvasResize(e){if(typeof this.resizeTimeoutId!="undefined"&&clearTimeout(this.resizeTimeoutId),document.hidden)return;let t=e.width,s=e.height;if(t===0||s===0){this.scheduleResize();return}let i=Math.min(E.SOURCE_GAME_WIDTH/t,2),a=In(this._quality);this.addResizeBreadcrumb(t,s,i),this.canvas.style.width=`${t}px`,this.canvas.style.height=`${s}px`,this.scale.resize(t*i*a,s*i*a),this.isCorrectOrientation(t,s)?(this.updateScreenConstants(),this.resizeActiveScenes(),this.hideRotateIcon()):this.showRotateIcon()}scheduleResize(e=1e3){this.resizeTimeoutId=setTimeout(()=>{let t=this.canvas.getBoundingClientRect();this.onCanvasResize({width:t.width,height:t.height})},e)}addResizeBreadcrumb(e,t,s){this.game.sentry.addBreadcrumb({category:"game",message:"resize",data:{width:e,height:t,zoom:s}})}isCorrectOrientation(e,t){let s=t>e,i=e>t,a=E.IS_PORTRAIT&&s,n=E.IS_LANDSCAPE&&i;return a||n}resizeActiveScenes(){let e=this.game.scene.getScenes(!0),t=this.game.scene.getScene(M.PRELOADER);e.includes(t)===!1&&t.scene.settings.status===Phaser.Scenes.LOADING&&e.push(t),e.forEach(s=>{s.resize&&s.resize()})}updateScreenConstants(){E.GAME_WIDTH=this.game.scale.width,E.GAME_HEIGHT=this.game.scale.height,E.HALF_GAME_WIDTH=E.GAME_WIDTH*.5,E.HALF_GAME_HEIGHT=E.GAME_HEIGHT*.5,E.ASPECT_RATIO=E.GAME_WIDTH/E.GAME_HEIGHT,E.ASSETS_SCALE=E.IS_PORTRAIT?E.GAME_WIDTH/E.SOURCE_GAME_WIDTH:E.GAME_HEIGHT/E.SOURCE_GAME_HEIGHT}showRotateIcon(){this.rotateOverlay.style.display="flex"}hideRotateIcon(){this.rotateOverlay.style.display="none"}setQuality(e){if(e===this._quality)return;this._quality=e;let{width:t,height:s}=this.canvas.getBoundingClientRect();this.onCanvasResize({width:t,height:s})}},i_=We(require("howler")),bt;(function(e){e.START="start",e.COMPLETE="complete"})(bt||(bt={}));var Ce=We(require("@sentry/browser")),a_=We(require("@sentry/types")),n_=class{constructor(e){this._isEnabled=!1,this.game=e,this._isEnabled=typeof Ce.getCurrentHub().getClient()!="undefined"}get isEnabled(){return this._isEnabled}addBreadcrumb(e){this._isEnabled!==!1&&Ce.addBreadcrumb(e)}setTag(e,t){this._isEnabled!==!1&&Ce.setTag(e,t)}setTags(e){this._isEnabled!==!1&&Ce.setTags(e)}trackGameGlobalEvents(){if(this._isEnabled===!1)return;let e=this.game.events,t="game.global";e.on(Phaser.Core.Events.HIDDEN,()=>{Ce.addBreadcrumb({category:t,message:"document hidden"})}),e.on(Phaser.Core.Events.VISIBLE,()=>{Ce.addBreadcrumb({category:t,message:"document visible"})}),e.on(Phaser.Core.Events.CONTEXT_LOST,()=>{Ce.addBreadcrumb({category:t,message:"WebGL context lost",level:a_.Severity.Warning})}),e.on(Phaser.Core.Events.CONTEXT_RESTORED,()=>{Ce.addBreadcrumb({category:t,message:"WebGL context restored"})})}addInitialBreadcrumb(){this._isEnabled!==!1&&this.addBreadcrumb({message:"sentry init",data:{"document.visibility":document.hidden===!0?"hidden":"visible","renderer.state":this.getRendererState()}})}getRendererState(){let e=this.game.renderer;return e instanceof Phaser.Renderer.Canvas.CanvasRenderer?"canvas_renderer":e.contextLost?"webgl_context_lost":"webgl_context_is_fine"}setTagsOnStart(){this._isEnabled!==!1&&Ce.setTags({renderer:this.game.rendererType,audio:this.game.audioType,webp:this.game.webp.toString(),avif:this.game.avif.toString()})}trackSceneChanges(e){this._isEnabled!==!1&&e.on(bt.COMPLETE,this.onSceneTransitionComplete,this)}onSceneTransitionComplete(e,t,s,i){let a=k(P({currentScene:s},i&&{currentSceneData:this.prettifySceneData(i)}),{lastScene:t});Ce.addBreadcrumb({category:"game.flow",message:`transition ${t} => ${s}`,data:{newSceneData:i}}),Ce.setContext("game",P({},a)),this.trackSceneInput(s)}prettifySceneData(e){let t={};return Object.keys(e).forEach(s=>{let i=e[s];typeof i=="object"?t[s]=JSON.stringify(i):t[s]=i}),t}trackSceneInput(e){var t;if(this._isEnabled===!1)return;let s=this.game.scene.getScene(e);s&&(s.events.once(Phaser.Scenes.Events.SHUTDOWN,this.removePointerDownListener.bind(this,s)),(t=s.input)==null||t.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this))}removePointerDownListener(e){var t;(t=e.input)==null||t.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this)}onPointerDown(e,t){let s=t.map(i=>{var a,n;return i.name||((a=i.frame)==null?void 0:a.name)||((n=i.texture)==null?void 0:n.key)});s.length!==0&&Ce.addBreadcrumb({category:"game.click",data:{objects:s.join(),scene:t[0].scene.scene.key,parent:t[0].parentContainer?t[0].parentContainer.name:"scene"}})}captureMessage(e,t){this._isEnabled&&Ce.captureMessage(e,t)}captureException(e,t){this._isEnabled&&Ce.captureException(e,t)}sendFeedback(e,t){return this._isEnabled===!1?Promise.reject():new Promise(s=>{Ce.withScope(i=>{let a=this.game.store.getCompletedLevelNumbers();i.setContext("feedback",{completedLevels:a.join(", "),completedLevelsNum:a.length,email:t!=null?t:"<empty>",message:e!=null?e:"<empty>"});let n=Ce.captureMessage("Feedback");s(n)})})}getGameSnapshotAsBlob(e={format:"image/jpeg",quality:.25}){return new Promise((t,s)=>{this.game.renderer.snapshot(i=>$(this,null,function*(){let a=i.src,n=yield fetch(a).then(r=>r.blob());t(n)}),e.format,e.quality)})}};function r_(e){if(w.getBool("noWebp")||window.environment===lt.DEVELOP)return!1;let i="robowhale__webp";if((e==null?void 0:e.getItem(i))==="true")return!0;let a=o_();return a&&(e==null||e.setItem(i,"true")),a}function o_(){let e=navigator.userAgent.match(/(Edge|Firefox)\/(\d+)\.(\d*)/);if(e&&e[1]==="Firefox"&&+e[2]>=65)return!0;if(e&&e[1]==="Edge"&&+e[2]==18&&+e[3]==17763)return!1;let t=Phaser.Display.Canvas.CanvasPool.create(document),s=t.toDataURL?t.toDataURL("image/webp").indexOf("data:image/webp")==0:!1;return Phaser.Display.Canvas.CanvasPool.remove(t),s}function h_(e){if(w.getBool("noAvif")||window.environment===lt.DEVELOP)return Promise.resolve(!1);let i="robowhale__avif";return(e==null?void 0:e.getItem(i))==="true"?Promise.resolve(!0):new Promise(a=>{let n=()=>{r.height===2?(e==null||e.setItem(i,"true"),a(!0)):a(!1)},r=new Image;r.onload=n,r.onerror=n,r.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="})}var Eo=Phaser.Renderer.WebGL.WebGLRenderer,l_=Phaser.Loader.FileTypes.ImageFile,c_=class extends Phaser.Scene{init(){return $(this,null,function*(){let e=Ln()?window.localStorage:null;this.game.avif=yield h_(e),this.game.webp=r_(e),(this.game.avif||this.game.webp)&&this.patchImageLoader()})}patchImageLoader(){let e=this.getDefaultImageFormat(),t=[".png",".jpg"],s=i=>{if(i instanceof l_&&typeof i.url=="string"){let a=i.url,n=t.find(r=>a.includes(r));n&&(i.url=i.url.replace(n,e))}};Phaser.Loader.LoaderPlugin.prototype.addFileOld=Phaser.Loader.LoaderPlugin.prototype.addFile,Phaser.Loader.LoaderPlugin.prototype.addFile=function(i){return Array.isArray(i)?i.forEach(a=>s(a)):s(i),this.addFileOld(i)}}getDefaultImageFormat(){return this.game.avif?".avif":this.game.webp?".webp":".png"}preload(){this.loadWebFonts(),this.loadPokiSdk(),this.loadGameAnalytics()}loadWebFonts(){this.load.rexWebFont({custom:{families:["PoetsenOne:n4"],urls:[Ut("css/fonts.css")]}}),this.load.on("webfontinactive",(e,t)=>{})}loadPokiSdk(){w.getBool("gdDisable")||this.load.scriptTag("poki-sdk","patch/js/poki-sdk.js")}loadGameAnalytics(){window.game.config.analytics_enabled!==!1&&w.getBool("analytics","0")!==!0&&this.load.script("game-analytics",Ut("js/GameAnalytics.min.js"))}create(){this.setupSentry(),this.setupAnalytics(),this.addBlackTexture(),this.removeUnusedPipelines(),this.addScaler(),this.addCpuThrottling(),this.disableScrollBySpacebar(),this.game.injectIntoScenes(this.game.audio,"audio"),PokiSDK.init().finally(()=>{w.getBool("pokiDebug")&&PokiSDK.setDebug(!0),this.launchGlobalScene()})}setupSentry(){this.game.audioType=this.getAudioType(i_.Howler),this.game.rendererType=this.getRendererType(this.game.renderer),this.game.sentry=new n_(this.game),this.game.sentry.trackGameGlobalEvents(),this.game.sentry.addInitialBreadcrumb(),this.game.sentry.setTagsOnStart(),this.game.injectIntoScenes(this.game.sentry,"sentry")}getAudioType(e){return e.noAudio?cs.NO_AUDIO:e.usingWebAudio?cs.WEB_AUDIO:cs.HTML5_AUDIO}getRendererType(e){return e instanceof Eo?yt.WEBGL:yt.CANVAS}setupAnalytics(){this.game.analytics=new e_(this.game),this.game.analytics.sendBrowser(),this.game.analytics.sendAvifStatus(this.game.avif),this.game.analytics.sendWebpStatus(this.game.webp),this.game.analytics.sendDesktopScreenResolution(),this.game.analytics.sendWebAssemblyStatus(),this.game.analytics.sendWebWorkerStatus(),this.game.analytics.sendServiceWorkerStatus(),this.game.analytics.sendWebGlParams(),this.game.analytics.sendReferrer();try{let e="webgl_error",t=localStorage.getItem(e);t&&(localStorage.removeItem(e),this.game.analytics.sendError(`WebGL:${t}`))}catch(e){}this.game.injectIntoScenes(this.game.analytics,"analytics")}addBlackTexture(){let e=this.make.graphics({fillStyle:{color:0}},!1);e.fillRect(0,0,1,1),e.generateTexture("__BLACK",1,1),e.destroy()}removeUnusedPipelines(){let e=this.renderer;if(!(e instanceof Eo))return;let{pipelines:t}=e,s=Phaser.Renderer.WebGL.Pipelines;[s.LIGHT_PIPELINE,s.POINTLIGHT_PIPELINE,s.ROPE_PIPELINE,s.BITMAPMASK_PIPELINE].forEach(a=>{var n;(n=t.get(a))==null||n.destroy(),t.remove(a)})}addScaler(){let t={resizeDebounceInterval:ye.development?0:200};this.game.scaler=new s_(this.game,t)}addCpuThrottling(){let e=w.getNumber("throttle");e<=0||(this.events.on(Phaser.Scenes.Events.PRE_UPDATE,()=>{let t=e*1e6,s=0;for(;--t;)s+=Math.sqrt(t)}),""+e)}disableScrollBySpacebar(){this.game.device.os.desktop||this.game.input.keyboard.addCapture(32)}launchGlobalScene(){let e=this.scene.get(M.GLOBAL);e.events.once(Phaser.Scenes.Events.READY,this.onGlobalSceneReady.bind(this,e)),e.scene.start(M.GLOBAL)}onGlobalSceneReady(e){this.game.globalScene=e,e.scene.launch(M.PRELOADER),e.scene.bringToTop()}},d_={ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",en:"English",fr:"Fran\xE7ais",it:"Italiano",de:"Deutsch",es:"Espa\xF1ol",nl:"Nederlands",no:"Norsk",fi:"Suomi",br:"Brasileiro",pt:"Portugu\xEAs",jp:"\u65E5\u672C\u8A9E",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",tr:"T\xFCrk\xE7e",se:"Svenska",pl:"Polski"};function vo(e){return d_[e]}function To(e){switch(e){case"pt-BR":return"br";case"ja-JP":case"ja-jp":case"ja":return"jp";case"uk-UA":case"uk-ua":case"uk":return"ru";default:return e.split("-")[0].toLowerCase()}}var u_=Phaser.Events.EventEmitter,Ne;(function(e){e.TEXTS_READY="__TEXTS_READY",e.LANGUAGE_CHANGE="__LANGUAGE_CHANGE"})(Ne||(Ne={}));var p_=class extends u_{get language(){return this._language}constructor(e){super();this.game=e,this.allTexts=this.game.cache.json.get("texts"),this.allLanguages=this.getSupportedLanguages(),this._language=this.detectLanguage(),this.texts=this.allTexts[this._language],this.setSentryLanguageTag(),this.setDocumentLanguage(),this.updateDefaultFont(),this.sendLanguagesToAnalytics(),""+this._language}getSupportedLanguages(){return Object.keys(this.allTexts).filter(t=>{let s=this.allTexts[t];return Object.keys(s).length>0})}detectLanguage(){return this.getLanguageFromUrlParam()||this.getSavedLanguage()||this.getLanguageFromBrowser()||window.game.config.default_language}getLanguageFromUrlParam(){let e=w.get("language")||w.get("lang");return e&&this.isLanguageSupported(e)?e:null}getSavedLanguage(){let e=this.game.store.getValue(g.LANGUAGE);return e&&this.isLanguageSupported(e)?e:null}getLanguageFromBrowser(){let e=To(navigator.language);if(e&&this.isLanguageSupported(e))return e;if(typeof navigator.languages!="undefined"){let s=navigator.languages.map(i=>To(i)).find(i=>this.isLanguageSupported(i));if(s)return s}return null}isLanguageSupported(e){return this.allLanguages.includes(e)}injectTextsIntoScenes(){this.game.scene.getScenes(!1).forEach(e=>{e.texts=this.texts})}setLanguage(e){return this.isLanguageSupported(e)?(this._language=e,this.texts=this.allTexts[e],this.injectTextsIntoScenes(),this.setSentryLanguageTag(),this.setDocumentLanguage(),this.updateDefaultFont(),this.emit(Ne.LANGUAGE_CHANGE,e),this.game.events.emit(Ne.LANGUAGE_CHANGE,this),this._language,!0):(""+e,!1)}setSentryLanguageTag(){this.game.sentry.setTag("language",this._language)}setDocumentLanguage(){document.documentElement.lang=this._language}updateDefaultFont(){this._language==="jp"?(p.DEFAULT_FAMILY=Hs.SANS_SERIF,p.DEFAULT_WEIGHT=Wt.BOLD):(p.DEFAULT_FAMILY=Hs.POETSEN,p.DEFAULT_WEIGHT=Wt.NORMAL)}sendLanguagesToAnalytics(){var e,t;(e=this.game.analytics)==null||e.sendDesignEvent(`Language:browser:${navigator.language}`),(t=this.game.analytics)==null||t.sendDesignEvent(`Language:game:${this._language}`)}},g_=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,t,s);this.sceneManager=this.scene.game.scene}changeScene(e,t,s){if(this.instantChange){this.emit(bt.START,this,e,t,s),this.emit(bt.COMPLETE,this,e,t,s),this.sceneManager.getScene(e).scene.start(t,s);return}this.emit(bt.START,this,e,t,s),this.resize(),this.fadeIn(e,t,s)}fadeIn(e,t,s){this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Quadratic.In,alpha:1,onComplete:()=>{this.doChangeScenes(e,t,s)}})}doChangeScenes(e,t,s){let i=this.sceneManager.getScene(e);i.events.once(Phaser.Scenes.Events.SHUTDOWN,this.fadeOut.bind(this,e,t)),i.scene.start(t,s),this.emit(bt.COMPLETE,this,e,t,s)}fadeOut(){this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Quadratic.In,alpha:0,onComplete:()=>{this.kill()}})}resize(){this.setDisplaySize(E.GAME_WIDTH+4,E.GAME_HEIGHT+4),this.x=E.HALF_GAME_WIDTH,this.y=E.HALF_GAME_HEIGHT}destroy(){super.destroy()}},et;(function(e){e.EXACT="EXACT",e.FIT="FIT",e.FILL="FILL",e.ENVELOP="ENVELOP"})(et||(et={}));var m_=class{constructor(e){this.scene=e,this.items=new Map}scale(e,t=et.EXACT,s){this.items.set(e,{obj:e,type:t,options:s})}onResize(){this.items.forEach(e=>{switch(e.type){case et.FILL:e.obj.displayWidth=E.GAME_WIDTH,e.obj.displayHeight=E.GAME_HEIGHT;break;case et.ENVELOP:let t=(E.GAME_WIDTH+2)/e.obj.width,s=(E.GAME_HEIGHT+2)/e.obj.height;e.obj.scale=Math.max(t,s);break;case et.FIT:let i=E.GAME_WIDTH/e.obj.width,a=E.GAME_HEIGHT/e.obj.height;e.obj.scale=Math.min(i,a);break;default:e.obj.scale=E.ASSETS_SCALE;break}})}destroy(){this.items.clear(),this.items=null}},Hi;(function(e){e.START="__START",e.STOP="__STOP"})(Hi||(Hi={}));var f_=class extends Phaser.Events.EventEmitter{constructor(e){super();this.isActive=!1,this._timeScale=1,this.scene=e}get timeScale(){return this._timeScale}start(e){this.isActive||(this.isActive=!0,this._timeScale=e,this.scene.tweens.timeScale=e,this.scene.time.timeScale=e,this.getFastForwardables().forEach(t=>t.timeScale=e),this.emit(Hi.START,this,e))}stop(){this.isActive!==!1&&(this.isActive=!1,this._timeScale=1,this.scene.tweens.timeScale=1,this.scene.time.timeScale=1,this.getFastForwardables().forEach(e=>e.timeScale=1),this.emit(Hi.STOP,this))}getFastForwardables(){return this.scene.sys.updateList.getActive().filter(e=>this.isFastForwardable(e))}isFastForwardable(e){return typeof e.timeScale=="number"}destroy(){this.stop(),super.destroy()}},ct=class extends Phaser.Scene{get keyboard(){return this.input.keyboard}get activePointer(){return this.input.activePointer}init(e){var t,s;this.initData=e!=null?e:void 0,this.events.once("shutdown",this.onShutdown,this),this.pinner=new co,this.sizer=new m_(this),this.fastForward=new f_(this),this.shiftKey=(t=this.shiftKey)!=null?t:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),this.ctrlKey=(s=this.ctrlKey)!=null?s:this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.CTRL)}create(){}size(e,t=et.EXACT,s){this.sizer.scale(e,t,s)}pin(e,t,s,i,a){this.pinner.pin(e,t,s,i,a)}resize(){this.sizer.onResize(),this.pinner.onResize(E.GAME_WIDTH,E.GAME_HEIGHT,E.ASSETS_SCALE)}restart(e){this.game.restartScene(this.scene.key,e!=null?e:this.initData)}offKeyDown(e,t,s){this.keyboard.off(`keydown-${e}`,t,s)}onKeyDown(e,t,s){this.keyboard.on(`keydown-${e}`,t,s)}onceKeyDown(e,t,s){this.keyboard.once(`keydown-${e}`,t,s)}changeScene(e,t){this.game.changeScene(this.scene.key,e,t)}onShutdown(){this.pinner.destroy(),this.pinner=null,this.sizer.destroy(),this.sizer=null,this.fastForward.destroy(),this.fastForward=null}},E_=Phaser.Events.EventEmitter,wt;(function(e){e.NUM_CHANGED="IngameBooster_NUM_CHANGED"})(wt||(wt={}));var v_=class extends E_{get num(){return this._num}set num(e){this._num=Math.max(0,e),this.emit(wt.NUM_CHANGED,this)}get type(){return this._type}constructor(e,t){super();this._type=e,this._num=t}},T_=class{constructor(e){this.game=e,this.store=this.game.store,this.store.on(ht.CLEAR,this.onSaveDataCleared,this),this.texts=this.game.texts,this.texts.on(Ne.LANGUAGE_CHANGE,this.onLanguageChange,this),this.createBoosters()}onSaveDataCleared(){this.boosters.forEach(e=>{e.num=0})}onLanguageChange(){let e=this.game.texts.texts.boosters;this.boosters.forEach(t=>{let s=e[t.type];t.title=s.title,t.hint=s.hint})}createBoosters(){let e=this.game.texts.texts.boosters,t=this.store.getValue(g.BOOSTERS),s=[I.GLOVE,I.ROLLING_PIN,I.LOLLIPOP,I.UNDO];this.boosters=s.map(i=>{var a;let n=(a=t[i])!=null?a:0,r=e[i],o=new v_(i,n);return o.title=r.title,o.hint=r.hint,o.on(wt.NUM_CHANGED,this.onBoosterNumChanged,this),o})}onBoosterNumChanged(e){let t=this.store.getValue(g.BOOSTERS),s=k(P({},t),{[e.type]:e.num});this.store.saveValue(g.BOOSTERS,s)}getByType(e){return this.boosters.find(t=>t.type===e)}getRandom(){return Phaser.Math.RND.pick(this.boosters)}save(){return{[I.GLOVE]:this.getByType(I.GLOVE).num,[I.ROLLING_PIN]:this.getByType(I.ROLLING_PIN).num,[I.LOLLIPOP]:this.getByType(I.LOLLIPOP).num}}restore(e){Object.entries(e).forEach(([t,s])=>{this.getByType(t).num=s})}},__=Phaser.Events.EventEmitter,ps;(function(e){e.NUM_CHANGED="PregameBooster_NUM_CHANGED"})(ps||(ps={}));var y_=class extends __{get num(){return this._num}set num(e){this._num=Math.max(0,e),this.emit(ps.NUM_CHANGED,this)}get type(){return this._type}constructor(e,t){super();this._type=e,this._num=t}updateTexts(e){let t=e.pregame_boosters;this.title=t[this._type]}},C_=class{constructor(e){this.game=e,this.store=this.game.store,this.store.on(ht.CLEAR,this.onSaveDataCleared,this),this.texts=this.game.texts,this.texts.on(Ne.LANGUAGE_CHANGE,this.onLanguageChange,this),this.initBoosters()}onSaveDataCleared(){this.items.forEach(e=>{e.num=0})}onLanguageChange(){this.items.forEach(e=>{e.updateTexts(this.texts.texts)})}initBoosters(){let e=this.store.getValue(g.PREGAME_BOOSTERS),t=[W.STRIPES,W.BOMB,W.SUPER_SPHERE];this.items=t.map(s=>{var i;let a=(i=e[s])!=null?i:0,n=new y_(s,a);return n.updateTexts(this.texts.texts),n.on(ps.NUM_CHANGED,this.onBoosterNumChanged,this),n})}onBoosterNumChanged(e){let t=g.PREGAME_BOOSTERS,s=this.store.getValue(t),i=k(P({},s),{[e.type]:e.num});this.store.saveValue(t,i)}getByType(e){return this.items.find(t=>t.type===e)}},Yt;(function(e){e.START="LifeTimer_START",e.COMPLETE="LifeTimer_COMPLETE"})(Yt||(Yt={}));var _o=class extends Phaser.Events.EventEmitter{constructor(e){super();this._isRunning=!1,this.isPaused=!1,this._timer=0,this.game=e}static getDefaulDuration(){return w.has("lifeTimerMs")?w.getNumber("lifeTimerMs",1e4):window.game.config.lives.refillInterval}get isRunning(){return this._isRunning}start(e){this.startTime=Date.now(),this.duration=e,this._timer=0,this._isRunning=!0,this.game.events.on(Phaser.Core.Events.STEP,this.update,this),this.emit(Yt.START,this)}update(){this._isRunning===!1||this.isPaused||(this._timer=Date.now()-this.startTime,this._timer>=this.duration&&this.onTimerComplete())}getRemainingMs(){return this.duration-this._timer}getRemainingSeconds(){return Math.ceil(this.getRemainingMs()/1e3)}getFormattedTime(){let e=this.getRemainingMs(),t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4),i=Math.floor(e%36e4%6e4/1e3),a=t.toString().padStart(2,"0"),n=s.toString().padStart(2,"0"),r=i.toString().padStart(2,"0");return t>0?`${a}:${n}:${r}`:`${n}:${r}`}onTimerComplete(){this._isRunning=!1,this.game.events.off(Phaser.Core.Events.STEP,this.update,this),this.emit(Yt.COMPLETE,this)}pause(){this.isPaused=!0}resume(){this.isPaused=!1}forceComplete(){this._timer=this.duration,this.onTimerComplete()}destroy(){this.game.events.off(Phaser.Core.Events.STEP,this.update,this)}},Pt=_o;Pt.DURATION_MS=_o.getDefaulDuration();var N;(function(e){e.REFILL_TIMER_START="__REFILL_TIMER_START",e.REFILL_TIMER_COMPLETE="__REFILL_TIMER_COMPLETE",e.UNLIMITED_TIMER_START="__UNLIMITED_TIMER_START",e.UNLIMITED_TIMER_COMPLETE="__UNLIMITED_TIMER_COMPLETE",e.LIVES_ADDED="__LIFE_ADDED",e.PAGE_VISIBLE="__PAGE_VISIBLE"})(N||(N={}));var S_=class extends Phaser.Events.EventEmitter{constructor(e){super();this.livesOnHidden=0,this.game=e,this.game.store.on(ht.CLEAR,this.onSaveDataReset,this),this.checkUrlParam(),this.initUnlimitedTimerOnStart(),this.initRefillTimerOnStart(),this.addVisibilityEventHandlers()}get refillTimer(){return this._refillTimer}get unlimitedTimer(){return this._unlimitedTimer}onSaveDataReset(){this._unlimitedTimer&&this.onUnlimitedTimerComplete()}checkUrlParam(){if(w.has("lives")===!1)return;let e=w.getNumber("lives",this.getInitialLivesNum()),t=Phaser.Math.Clamp(Math.round(e),0,this.getInitialLivesNum());this.game.store.saveValue(g.LIVES,t),this.game.store.saveValue(g.LIVES_REFILL_TIMER_START,Date.now()),this.game.store.saveValue(g.LIVES_REFILL_TIMER_DURATION,Pt.DURATION_MS)}initUnlimitedTimerOnStart(){let e=this.game.store.getNumber(g.LIVES_UNLIMITED_TIMER_START),t=this.game.store.getNumber(g.LIVES_UNLIMITED_TIMER_DURATION),s=w.getNumber("livesUnlim",0);s>0&&(e=Date.now(),t=s);let i=e+t,a=Date.now();if(a<i){let n=i-a;this.startUnlimitedTimer(n)}}initRefillTimerOnStart(){if(this.isFull()||this.isUnlimited())return;let e=this.game.store.getNumber(g.LIVES_REFILL_TIMER_START),t=this.game.store.getNumber(g.LIVES_REFILL_TIMER_DURATION),s=e+t,i=Date.now()-e,a=Date.now();if(a<s){let o=s-a;this.startRefillTimer(o);return}a>=s&&(i-=t,this.changeLivesNum(1));let n=Math.floor(i/Pt.DURATION_MS);if(this.changeLivesNum(n)<this.getInitialLivesNum()){let o=i-n*Pt.DURATION_MS,l=Pt.DURATION_MS-o;this.startRefillTimer(l)}}addVisibilityEventHandlers(){this.game.events.on(Phaser.Core.Events.HIDDEN,this.onHidden,this),this.game.events.on(Phaser.Core.Events.VISIBLE,this.onVisible,this)}onHidden(){this.livesOnHidden=this.getLivesNum(),this.removeRefillTimer()}onVisible(){this.initRefillTimerOnStart();let e=this.getLivesNum()-this.livesOnHidden;this.emit(N.PAGE_VISIBLE,this,e)}addLives(e){this.isUnlimited()||(this.changeLivesNum(e),this.isFull()&&(this.removeRefillTimer(),this.emit(N.REFILL_TIMER_COMPLETE,this)),this.emit(N.LIVES_ADDED,this,e))}removeLife(){this.isUnlimited()||(this.changeLivesNum(-1),this.removeRefillTimer(),this.startRefillTimer())}removeRefillTimer(){!this._refillTimer||(this._refillTimer.off(Yt.COMPLETE,this.onRefillTimerComplete,this),this._refillTimer.destroy(),this._refillTimer=null)}startRefillTimer(e=Pt.DURATION_MS){this._refillTimer=new Pt(this.game),this._refillTimer.once(Yt.COMPLETE,this.onRefillTimerComplete,this),this._refillTimer.start(e),this.game.store.saveValue(g.LIVES_REFILL_TIMER_START,Date.now()),this.game.store.saveValue(g.LIVES_REFILL_TIMER_DURATION,e),this.emit(N.REFILL_TIMER_START,this,this._refillTimer.getRemainingSeconds())}onRefillTimerComplete(e=!0){this.changeLivesNum(1),this.removeRefillTimer(),this.emit(N.REFILL_TIMER_COMPLETE,this),e&&this.isFull()===!1&&this.startRefillTimer()}changeLivesNum(e){return this.game.store.changeNumber(g.LIVES,e,0,this.getInitialLivesNum())}getLivesNum(){return this.game.store.getNumber(g.LIVES)}getInitialLivesNum(){return window.game.config.lives.initialNum}isFull(){return this.getLivesNum()>=this.getInitialLivesNum()}startUnlimitedLives(e){this.refillAllLives(),this.removeRefillTimer();let t=0;this._unlimitedTimer&&(t=this._unlimitedTimer.getRemainingMs(),this._unlimitedTimer.destroy(),this._unlimitedTimer=null),this.startUnlimitedTimer(e+t)}refillAllLives(){if(this.getLivesNum()>=this.getInitialLivesNum())return;let e=this.getInitialLivesNum()-this.getLivesNum();this.changeLivesNum(e)}startUnlimitedTimer(e){this._unlimitedTimer=new Pt(this.game),this._unlimitedTimer.once(Yt.COMPLETE,this.onUnlimitedTimerComplete,this),this._unlimitedTimer.start(e),this.game.store.saveValue(g.LIVES_UNLIMITED_TIMER_START,Date.now()),this.game.store.saveValue(g.LIVES_UNLIMITED_TIMER_DURATION,e),this.emit(N.UNLIMITED_TIMER_START,this,this._unlimitedTimer.getRemainingSeconds())}onUnlimitedTimerComplete(){this._unlimitedTimer.destroy(),this._unlimitedTimer=null,this.emit(N.UNLIMITED_TIMER_COMPLETE,this),this.isFull()===!1&&this.startRefillTimer()}isUnlimited(){return Boolean(this._unlimitedTimer)}},Fs;(function(e){e.COLLECT_START="__COLLECT_START",e.COLLECT_COMPLETE="__COLLECT_COMPLETE"})(Fs||(Fs={}));var R;(function(e){e.COINS="coins",e.UNDO="undo",e.GLOVE="glove",e.ROLLING_PIN="rolling_pin",e.LOLLIPOP="lollipop",e.STRIPES="stripes",e.BOMB="bomb",e.SUPER_SPHERE="super_sphere"})(R||(R={}));var dt=class{static getAllTypes(){return Object.values(R)}static getRewardNum(e){var t;return(t=window.game.config.wheel_rewards[e])!=null?t:1}static getRewardData(e){return{type:e,num:this.getRewardNum(e)}}},O_=class extends Phaser.Events.EventEmitter{constructor(e){super();this.game=e,this.store=this.game.store,w.getBool("resetGift")&&(this.store.saveValue(g.GIFT_STARS_NUM,0),this.store.saveValue(g.GIFTS_OPENED,0))}getCurrentStars(){return this.store.getNumber(g.GIFT_STARS_NUM)}getTargetStars(){let e=this.getOpenedGiftsNum();return e===0?11:e===1?9:10}getOpenedGiftsNum(){return this.store.getNumber(g.GIFTS_OPENED)}getGiftRewards(e){return this.getOpenedGiftsNum()===0?[dt.getRewardData(R.STRIPES),dt.getRewardData(R.BOMB),dt.getRewardData(R.SUPER_SPHERE)]:Zv(dt.getAllTypes()).slice(0,e).map(i=>dt.getRewardData(i))}saveRewards(...e){e.forEach(t=>{this.saveReward(t.type,t.num)})}saveReward(e,t){switch(e){case R.STRIPES:this.game.pregameBoosters.getByType(W.STRIPES).num+=t,this.game.analytics.addResource(ue.PREGAME_BOOSTERS,t,W.STRIPES,"Gift");break;case R.BOMB:this.game.pregameBoosters.getByType(W.BOMB).num+=t,this.game.analytics.addResource(ue.PREGAME_BOOSTERS,t,W.BOMB,"Gift");break;case R.SUPER_SPHERE:this.game.pregameBoosters.getByType(W.SUPER_SPHERE).num+=t,this.game.analytics.addResource(ue.PREGAME_BOOSTERS,t,W.SUPER_SPHERE,"Gift");break;case R.UNDO:this.game.boosters.getByType(I.UNDO).num+=t,this.game.analytics.addResource(ue.BOOSTERS,t,I.UNDO,"Gift");break;case R.GLOVE:this.game.boosters.getByType(I.GLOVE).num+=t,this.game.analytics.addResource(ue.BOOSTERS,t,I.GLOVE,"Gift");break;case R.ROLLING_PIN:this.game.boosters.getByType(I.ROLLING_PIN).num+=t,this.game.analytics.addResource(ue.BOOSTERS,t,I.ROLLING_PIN,"Gift");break;case R.LOLLIPOP:this.game.boosters.getByType(I.LOLLIPOP).num+=t,this.game.analytics.addResource(ue.BOOSTERS,t,I.LOLLIPOP,"Gift");break;case R.COINS:this.game.store.changeNumber(g.COINS,t),this.game.analytics.addResource(ue.COINS,t,Te.COIN,"Gift");break;default:break}}onGiftOpen(){this.store.changeNumber(g.GIFT_STARS_NUM,-this.getTargetStars(),0),this.store.changeNumber(g.GIFTS_OPENED,1)}},c;(function(e){e.BISCUIT="BISCUIT",e.COOKIE="COOKIE",e.MARSHMALLOW="MARSHMALLOW",e.DROP_ITEM="DROP_ITEM",e.CHOCOLATE="CHOCOLATE",e.DONUT_BOX="DONUT_BOX",e.CANDY_BOTTLE="CANDY_BOTTLE",e.APPLE_PLATTER="APPLE_PLATTER",e.COLOR_CAKE="COLOR_CAKE",e.LICORICE="LICORICE",e.GUMMY="GUMMY",e.GUMMY_BLOCKER="GUMMY_BLOCKER",e.MYSTERY_BOX="MYSTERY_BOX",e.GENERATOR="GENERATOR",e.CHICK="CHICK"})(c||(c={}));var h;(function(e){e.COOKIE_RED="COOKIE_RED",e.COOKIE_BLUE="COOKIE_BLUE",e.COOKIE_ORANGE="COOKIE_ORANGE",e.COOKIE_PURPLE="COOKIE_PURPLE",e.COOKIE_PINK="COOKIE_PINK",e.COOKIE_YELLOW="COOKIE_YELLOW",e.MARSHMALLOW_COMMON="MARSHMALLOW_COMMON",e.MARSHMALLOW_RED="MARSHMALLOW_RED",e.MARSHMALLOW_BLUE="MARSHMALLOW_BLUE",e.MARSHMALLOW_ORANGE="MARSHMALLOW_ORANGE",e.MARSHMALLOW_PURPLE="MARSHMALLOW_PURPLE",e.MARSHMALLOW_PINK="MARSHMALLOW_PINK",e.MARSHMALLOW_YELLOW="MARSHMALLOW_YELLOW",e.MARSHMALLOW_DOUBLE="MARSHMALLOW_DOUBLE",e.CHOCOLATE_COMMON="CHOCOLATE_COMMON",e.CHOCOLATE_RED="CHOCOLATE_RED",e.CHOCOLATE_BLUE="CHOCOLATE_BLUE",e.CHOCOLATE_ORANGE="CHOCOLATE_ORANGE",e.CHOCOLATE_PURPLE="CHOCOLATE_PURPLE",e.CHOCOLATE_PINK="CHOCOLATE_PINK",e.CHOCOLATE_YELLOW="CHOCOLATE_YELLOW",e.CHOCOLATE_DOUBLE="CHOCOLATE_DOUBLE",e.CHOCOLATE_TRIPLE="CHOCOLATE_TRIPLE",e.GUMMY_VERTICAL="GUMMY_VERTICAL",e.GUMMY_VERTICAL_LARGE="GUMMY_VERTICAL_LARGE",e.GUMMY_HORIZONTAL="GUMMY_HORIZONTAL",e.GUMMY_HORIZONTAL_LARGE="GUMMY_HORIZONTAL_LARGE",e.GUMMY_BLOCKER="GUMMY_BLOCKER",e.LICORICE_CHOCO="LICORICE_CHOCO",e.LICORICE_YELLOW="LICORICE_YELLOW",e.BISCUIT="BISCUIT",e.CANDY_BOTTLE="CANDY_BOTTLE",e.DROP_ITEM="DROP_ITEM",e.DONUT_BOX="DONUT_BOX",e.APPLES_PLATTER="APPLES_PLATTER",e.COLOR_CAKE="COLOR_CAKE",e.MYSTERY_BOX="MYSTERY_BOX",e.GENERATOR="GENERATOR",e.CHICK="CHICK"})(h||(h={}));var Ja=class{static getAllTypes(){return Object.values(h)}static getAllSuperTypes(){return Object.values(c)}static getItemTypeByFrame(e){return Be(Ja.ITEM_TYPES_FRAMES_MAP,t=>t===e)}static getFrameByItemType(e){return Ja.ITEM_TYPES_FRAMES_MAP[e]}static getSubtypes(e){return this.ITEM_SUPER_TYPES_MAP[e]}static getItemSuperType(e){return Be(this.ITEM_SUPER_TYPES_MAP,t=>t.includes(e))}},O=Ja;O.ITEM_TYPES_FRAMES_MAP={[h.COOKIE_RED]:"cookies/Circle-Cookie-Red",[h.COOKIE_BLUE]:"cookies/Cube-Cookie-Blue",[h.COOKIE_ORANGE]:"cookies/Polygon-Cookie-Orange",[h.COOKIE_PURPLE]:"cookies/Donut-Cookie-Purple",[h.COOKIE_PINK]:"cookies/Moon-Cookie-Pink",[h.COOKIE_YELLOW]:"cookies/Heart-Cookie-Yellow",[h.MARSHMALLOW_COMMON]:"marshmallows/marshmallow_common",[h.MARSHMALLOW_RED]:"marshmallows/marshmallow_red",[h.MARSHMALLOW_BLUE]:"marshmallows/marshmallow_blue",[h.MARSHMALLOW_ORANGE]:"marshmallows/marshmallow_orange",[h.MARSHMALLOW_PURPLE]:"marshmallows/marshmallow_purple",[h.MARSHMALLOW_PINK]:"marshmallows/marshmallow_pink",[h.MARSHMALLOW_YELLOW]:"marshmallows/marshmallow_yellow",[h.MARSHMALLOW_DOUBLE]:"marshmallows/marshmallow_double",[h.CHOCOLATE_COMMON]:"chocolate/chocolate",[h.CHOCOLATE_RED]:"chocolate/chocolate-red",[h.CHOCOLATE_BLUE]:"chocolate/chocolate-blue",[h.CHOCOLATE_ORANGE]:"chocolate/chocolate-orange",[h.CHOCOLATE_PURPLE]:"chocolate/chocolate-purple",[h.CHOCOLATE_PINK]:"chocolate/chocolate-pink",[h.CHOCOLATE_YELLOW]:"chocolate/chocolate-yellow",[h.CHOCOLATE_DOUBLE]:"chocolate/chocolate-double",[h.CHOCOLATE_TRIPLE]:"chocolate/chocolate-triple",[h.GUMMY_VERTICAL]:"gummies/gummy_vertical",[h.GUMMY_VERTICAL_LARGE]:"gummies/gummy_vertical_large",[h.GUMMY_HORIZONTAL]:"gummies/gummy_horizontal",[h.GUMMY_HORIZONTAL_LARGE]:"gummies/gummy_horizontal_large",[h.BISCUIT]:"biscuits/biscuit",[h.DROP_ITEM]:"drop_items/cookie_2",[h.DONUT_BOX]:"donut_box/box_00",[h.CANDY_BOTTLE]:"candy_bottle/candy_bottle",[h.APPLES_PLATTER]:"apples_platter/Tray_00",[h.COLOR_CAKE]:"color_cake/Cake_00",[h.MYSTERY_BOX]:"mystery_box/mystery_box_2",[h.GENERATOR]:"generator/generator",[h.CHICK]:"chick/Cupcake",[h.GUMMY_BLOCKER]:"gummies/blocker",[h.LICORICE_CHOCO]:"licorice/Cream-Choco",[h.LICORICE_YELLOW]:"licorice/Cream-Yellow"},O.ITEM_SUPER_TYPES_MAP={[c.BISCUIT]:[h.BISCUIT],[c.COOKIE]:[h.COOKIE_PURPLE,h.COOKIE_ORANGE,h.COOKIE_BLUE,h.COOKIE_RED,h.COOKIE_PINK,h.COOKIE_YELLOW],[c.MARSHMALLOW]:[h.MARSHMALLOW_COMMON,h.MARSHMALLOW_PURPLE,h.MARSHMALLOW_ORANGE,h.MARSHMALLOW_BLUE,h.MARSHMALLOW_RED,h.MARSHMALLOW_PINK,h.MARSHMALLOW_YELLOW,h.MARSHMALLOW_DOUBLE],[c.DROP_ITEM]:[h.DROP_ITEM],[c.CHOCOLATE]:[h.CHOCOLATE_COMMON,h.CHOCOLATE_PURPLE,h.CHOCOLATE_ORANGE,h.CHOCOLATE_BLUE,h.CHOCOLATE_RED,h.CHOCOLATE_PINK,h.CHOCOLATE_YELLOW,h.CHOCOLATE_DOUBLE,h.CHOCOLATE_TRIPLE],[c.DONUT_BOX]:[h.DONUT_BOX],[c.CANDY_BOTTLE]:[h.CANDY_BOTTLE],[c.APPLE_PLATTER]:[h.APPLES_PLATTER],[c.COLOR_CAKE]:[h.COLOR_CAKE],[c.LICORICE]:[h.LICORICE_YELLOW,h.LICORICE_CHOCO],[c.GUMMY]:[h.GUMMY_VERTICAL,h.GUMMY_VERTICAL_LARGE,h.GUMMY_HORIZONTAL,h.GUMMY_HORIZONTAL_LARGE],[c.GUMMY_BLOCKER]:[h.GUMMY_BLOCKER],[c.MYSTERY_BOX]:[h.MYSTERY_BOX],[c.GENERATOR]:[h.GENERATOR],[c.CHICK]:[h.CHICK]};var C;(function(e){e.COOKIE_RED="COOKIE_RED",e.COOKIE_BLUE="COOKIE_BLUE",e.COOKIE_ORANGE="COOKIE_ORANGE",e.COOKIE_PURPLE="COOKIE_PURPLE",e.COOKIE_PINK="COOKIE_PINK",e.COOKIE_YELLOW="COOKIE_YELLOW",e.LICORICE="LICORICE",e.BISCUIT="BISCUIT",e.MARSHMALLOW="MARSHMALLOW",e.CHOCOLATE="CHOCOLATE",e.DROP_ITEM="DROP_ITEM",e.CANDY="CANDY",e.APPLE="APPLE",e.DONUT="DONUT",e.GUMMY="GUMMY",e.CHICK="CHICK"})(C||(C={}));var v;(function(e){e.COOKIE_RED="COOKIE_RED",e.COOKIE_BLUE="COOKIE_BLUE",e.COOKIE_ORANGE="COOKIE_ORANGE",e.COOKIE_PURPLE="COOKIE_PURPLE",e.COOKIE_PINK="COOKIE_PINK",e.COOKIE_YELLOW="COOKIE_YELLOW",e.MARSHMALLOW_COMMON="MARSHMALLOW_COMMON",e.MARSHMALLOW_RED="MARSHMALLOW_RED",e.MARSHMALLOW_BLUE="MARSHMALLOW_BLUE",e.MARSHMALLOW_ORANGE="MARSHMALLOW_ORANGE",e.MARSHMALLOW_PURPLE="MARSHMALLOW_PURPLE",e.MARSHMALLOW_PINK="MARSHMALLOW_PINK",e.MARSHMALLOW_YELLOW="MARSHMALLOW_YELLOW",e.MARSHMALLOW_DOUBLE="MARSHMALLOW_DOUBLE",e.CHOCOLATE_COMMON="CHOCOLATE_COMMON",e.CHOCOLATE_RED="CHOCOLATE_RED",e.CHOCOLATE_BLUE="CHOCOLATE_BLUE",e.CHOCOLATE_ORANGE="CHOCOLATE_ORANGE",e.CHOCOLATE_PURPLE="CHOCOLATE_PURPLE",e.CHOCOLATE_PINK="CHOCOLATE_PINK",e.CHOCOLATE_YELLOW="CHOCOLATE_YELLOW",e.CHOCOLATE_DOUBLE="CHOCOLATE_DOUBLE",e.CHOCOLATE_TRIPLE="CHOCOLATE_TRIPLE",e.LICORICE="LICORICE",e.BISCUIT="BISCUIT",e.CANDY="CANDY",e.DROP_ITEM="DROP_ITEM",e.DONUT="DONUT",e.APPLE="APPLE",e.CHICK="CHICK",e.GUMMY_VERTICAL="GUMMY_VERTICAL",e.GUMMY_VERTICAL_LARGE="GUMMY_VERTICAL_LARGE",e.GUMMY_HORIZONTAL="GUMMY_HORIZONTAL",e.GUMMY_HORIZONTAL_LARGE="GUMMY_HORIZONTAL_LARGE"})(v||(v={}));var ut=class{static createGoalsArray(e){return Object.keys(e).filter(s=>e[s]>0).map(s=>({type:s,collectedNum:0,targetNum:e[s]}))}static getAllTypes(){return Object.values(C)}static getGoalType(e){return Be(this.SUBTYPES_MAP,t=>t.includes(e))}static getItemTypes(e){return this.GOALS_ITEM_TYPES_MAP[e]}};ut.SUBTYPES_MAP={[C.LICORICE]:[v.LICORICE],[C.BISCUIT]:[v.BISCUIT],[C.COOKIE_PURPLE]:[v.COOKIE_PURPLE],[C.COOKIE_RED]:[v.COOKIE_RED],[C.COOKIE_YELLOW]:[v.COOKIE_YELLOW],[C.COOKIE_PINK]:[v.COOKIE_PINK],[C.COOKIE_BLUE]:[v.COOKIE_BLUE],[C.COOKIE_ORANGE]:[v.COOKIE_ORANGE],[C.DROP_ITEM]:[v.DROP_ITEM],[C.MARSHMALLOW]:[v.MARSHMALLOW_COMMON,v.MARSHMALLOW_PURPLE,v.MARSHMALLOW_ORANGE,v.MARSHMALLOW_BLUE,v.MARSHMALLOW_RED,v.MARSHMALLOW_PINK,v.MARSHMALLOW_YELLOW,v.MARSHMALLOW_DOUBLE],[C.CHOCOLATE]:[v.CHOCOLATE_COMMON,v.CHOCOLATE_PURPLE,v.CHOCOLATE_ORANGE,v.CHOCOLATE_BLUE,v.CHOCOLATE_RED,v.CHOCOLATE_PINK,v.CHOCOLATE_YELLOW,v.CHOCOLATE_DOUBLE,v.CHOCOLATE_TRIPLE],[C.DONUT]:[v.DONUT],[C.CANDY]:[v.CANDY],[C.APPLE]:[v.APPLE],[C.GUMMY]:[v.GUMMY_VERTICAL,v.GUMMY_VERTICAL_LARGE,v.GUMMY_HORIZONTAL,v.GUMMY_HORIZONTAL_LARGE],[C.CHICK]:[v.CHICK]},ut.GOALS_ITEM_TYPES_MAP={[C.COOKIE_BLUE]:[h.COOKIE_BLUE],[C.COOKIE_RED]:[h.COOKIE_RED],[C.COOKIE_ORANGE]:[h.COOKIE_ORANGE],[C.COOKIE_YELLOW]:[h.COOKIE_YELLOW],[C.COOKIE_PINK]:[h.COOKIE_PINK],[C.COOKIE_PURPLE]:[h.COOKIE_PURPLE],[C.APPLE]:[h.APPLES_PLATTER],[C.DROP_ITEM]:[h.DROP_ITEM],[C.MARSHMALLOW]:O.getSubtypes(c.MARSHMALLOW),[C.CHOCOLATE]:O.getSubtypes(c.CHOCOLATE),[C.BISCUIT]:[h.BISCUIT],[C.LICORICE]:O.getSubtypes(c.LICORICE),[C.DONUT]:[h.DONUT_BOX],[C.CANDY]:[h.CANDY_BOTTLE],[C.GUMMY]:O.getSubtypes(c.GUMMY),[C.CHICK]:[h.CHICK]};var T;(function(e){e.VERTICAL_STRIPES="VERTICAL_STRIPES",e.HORIZONTAL_STRIPES="HORIZONTAL_STRIPES",e.BOMB="BOMB",e.SUPER_SPHERE="SUPER_SPHERE"})(T||(T={}));var b_=[T.VERTICAL_STRIPES,T.HORIZONTAL_STRIPES,T.BOMB,T.SUPER_SPHERE],Us=class{constructor(e){this.allConfigs=e}removeGaps(){let e=this.getLevelNumbers();for(let t=0;t<e.length-1;t++){let s=e[t],i=e[t+1];if(i-s>1)return this.allConfigs[s+1]=ns(this.allConfigs[i]),this.allConfigs[s+1].levelNumber=s+1,this.allConfigs[s+1].originalLevelNumber=i,""+i+(s+1),delete this.allConfigs[i],this.removeGaps()}this.fixConfigs()}fixConfigs(){this.getAll().forEach(e=>{}),this.saveLocally().then(()=>{}).catch(()=>{})}getAll(){return Object.values(this.allConfigs)}get(e){return this.allConfigs[e]}remove(e){delete this.allConfigs[e.toString()]}removeAndShift(e){if(this.check(e)===!1)return;this.remove(e);let t={};Object.entries(this.allConfigs).forEach(([s,i])=>{let a=parseInt(s),n=a>e?a-1:a;i.levelNumber=n,t[n]=i}),this.allConfigs=t}check(e){return this.allConfigs.hasOwnProperty(e.toString())}add(e){this.allConfigs[e.levelNumber]=e}create(e,t=!0){let s=this.createDefaultLevelConfig(e);return t&&(this.allConfigs[e]=s),s}createDefaultLevelConfig(e){return{levelNumber:e,originalLevelNumber:e,showHintOnStart:!0,verticalStripesChance:.5,hard:!1,moves:10,background:"background_001",generator:this.createDefaultGeneratorConfig(),goals:this.createDefaultGoals(),chefPowerups:this.createDefaultChefPowerupsConfig(),boosters:this.createDefaultBoostersConfig(),preGameBoosters:this.createDefaulPregameBoostersConfig(),preGameBoostersHints:this.createDefaulPregameBoostersHintsConfig(),tutorial:{autoGenerated:!0,steps:[]},grid:{columns:9,rows:10},field:[],items:[],newElement:"none",mysteryBoxes:Us.createDefaultMysteryBoxesConfig(),newItemsTypes:""}}createDefaultGeneratorConfig(){return{weights:Us.getDefaultWeights()}}static getDefaultWeights(){let e=50;return{[h.COOKIE_ORANGE]:e,[h.COOKIE_RED]:e,[h.COOKIE_BLUE]:e,[h.COOKIE_PURPLE]:e,[h.COOKIE_PINK]:e,[h.COOKIE_YELLOW]:0,[h.MYSTERY_BOX]:0}}createDefaultGoals(){let e=ut.getAllTypes(),t=e.map(i=>0);return bT(e,t)}createDefaultChefPowerupsConfig(){return{isEnabled:!0,powerupsNum:5,[T.VERTICAL_STRIPES]:50,[T.HORIZONTAL_STRIPES]:50,[T.BOMB]:25,[T.SUPER_SPHERE]:10}}createDefaultBoostersConfig(){return{[I.UNDO]:!0,[I.GLOVE]:!0,[I.ROLLING_PIN]:!0,[I.LOLLIPOP]:!0}}createDefaulPregameBoostersConfig(){return{[W.STRIPES]:!0,[W.BOMB]:!0,[W.SUPER_SPHERE]:!0}}createDefaulPregameBoostersHintsConfig(){return{[W.STRIPES]:!1,[W.BOMB]:!1,[W.SUPER_SPHERE]:!1}}static createDefaultMysteryBoxesConfig(){return{COOKIE_BASIC:0,COOKIE_STRIPED:0,COOKIE_BOMB:0,COOKIE_SUPER_SPHERE:0,[h.CHOCOLATE_COMMON]:0,[h.MARSHMALLOW_COMMON]:0,[h.MARSHMALLOW_DOUBLE]:0,MARSHMALLOW_COLORED:0,[h.CANDY_BOTTLE]:0,[h.DONUT_BOX]:0}}saveLocally(){if(typeof window.___browserSync___!="undefined"===!1)return Promise.resolve(!1);let t=`${location.protocol}//${location.host}/files`,s="dev/assets/configs/";return this.doSave(t,s)}saveRemotely(){let e=E.SERVER_URL+"upload.php";return this.doSave(e,"")}doSave(e,t){return new Promise((s,i)=>{var a;let n=(a=w.get("levelsFile"))!=null?a:"levels",r={filename:t+n+".json",content:JSON.stringify(this.allConfigs)},o=new XMLHttpRequest;o.open("POST",e,!0),o.onload=function(){s(o)},o.onerror=function(){i(o)},o.send(this.convertObjectToURLSearchParams(r))})}convertObjectToURLSearchParams(e){return new URLSearchParams(e)}getLevelNumbers(){return Object.keys(this.allConfigs).map(t=>parseInt(t))}getPrevExistingLevel(e){let t=this.getLevelNumbers(),s=t.indexOf(e);if(s!==-1)return t[s-1]}getNextExistingLevel(e){let t=this.getLevelNumbers(),s=t.indexOf(e);if(s!==-1)return t[s+1]}isLastLevel(e){let t=this.getLevelNumbers();return t.indexOf(e)===t.length-1}getLastLevelNumber(){return Math.max(...this.getLevelNumbers())}getGaps(){let e=[],t=this.getLastLevelNumber();for(let s=1;s<t;s++)this.check(s)===!1&&e.push(s);return e}getHardLevelNumbers(){return this.getAll().filter(e=>e.hard).map(e=>e.levelNumber)}},w_=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.isRunning=!1,this.sceneStartTs=0,this.game=e,this.options=t}track(e){e.on(bt.COMPLETE,this.onSceneTransitionComplete,this)}onSceneTransitionComplete(e,t,s,i){let a=this.game.scene.getScene(s);a.events.once(Phaser.Scenes.Events.UPDATE,this.start.bind(this,s)),a.events.once(Phaser.Scenes.Events.SHUTDOWN,this.stop,this)}start(e){this.isRunning||(this.isRunning=!0,this.sceneStartTs=Date.now(),this.updateTimer=this.options.updateInterval,this.currentSceneKey=e,this.history=[],this.game.events.on(Phaser.Core.Events.POST_STEP,this.onPostStep,this))}stop(){if(this.isRunning===!1)return;if(this.isRunning=!1,this.game.events.off(Phaser.Core.Events.POST_STEP,this.onPostStep,this),Date.now()-this.sceneStartTs>this.options.minSceneDuration&&this.history.length>10){let t=this.getMedianFps();this.sendToAnalytics(t),this.adjustGraphicsQuality(t)}}onPostStep(e,t){this.updateTimer-=t,this.updateTimer<0&&(this.updateTimer+=this.options.updateInterval,this.history.push(this.game.loop.actualFps))}sendToAnalytics(e){var t;(t=this.game.analytics)==null||t.sendDesignEvent(`Fps:${this.currentSceneKey}`,e)}adjustGraphicsQuality(e){if(this.options.graphicsQualityAutoAdjustment.enabled===!1||this.game.store.getBoolean(g.GRAPHICS_QUALITY_MANUALLY))return;if(e<this.options.graphicsQualityAutoAdjustment.lowFps){this.downgradeGraphicsQuality();return}if(e>this.options.graphicsQualityAutoAdjustment.highFps){this.upgradeGraphicsQuality();return}}downgradeGraphicsQuality(){var e,t;let s=this.game.scaler.quality,i=Bt.indexOf(s);if(i<=0)return;let a=Bt[i-1];this.game.scaler.setQuality(a);let n=`Graphics quality was downgraded! (${s} -> ${a})`;(e=this.game.sentry)==null||e.addBreadcrumb({message:n}),(t=this.game.analytics)==null||t.sendDesignEvent(`Fps:DowngradeTo:${a}`)}upgradeGraphicsQuality(){var e,t;let s=this.game.scaler.quality,i=Bt.indexOf(s);if(i===Bt.length-1)return;let a=Bt[i+1];this.game.scaler.setQuality(a);let n=`Graphics quality was upgraded! (${s} -> ${a})`;(e=this.game.sentry)==null||e.addBreadcrumb({message:n}),(t=this.game.analytics)==null||t.sendDesignEvent(`Fps:UpgradeTo:${a}`)}getMedianFps(){return this.history?Math.round(Phaser.Math.Median(this.history)):0}};function Gi(e){let t=0;return typeof e.days=="number"&&(t+=e.days*24*60*60*1e3),typeof e.hours=="number"&&(t+=e.hours*60*60*1e3),typeof e.minutes=="number"&&(t+=e.minutes*60*1e3),typeof e.seconds=="number"&&(t+=e.seconds*1e3),typeof e.ms=="number"&&(t+=e.ms),t}var P_=class extends Phaser.Events.EventEmitter{constructor(e,t,s){super();this.game=e,this.store=this.game.store,this.offers=t,this.overlay=s,this.currency=window.game.config.purchases.currency.code}make(e,t){return this.overlay.show(),new Promise((s,i)=>{this.game.globalScene.time.delayedCall(1e3,()=>{this.overlay.hide(),this.sendPurchaseCompleteEvent(e,t),s()})})}isTestPurchase(e){return!1}sendPurchaseCompleteEvent(e,t="Shop"){var s;let a=this.getOfferById(e).price*window.game.config.purchases.currency.conversionRate,n="bundle",r=e;(s=this.game.analytics)==null||s.sendBusinessEvent(this.currency,a,n,r,t)}getOfferById(e){return this.offers.find(t=>t.id===e)}sendPurchaseErrorToSentry(e,t="Unknown"){var s;this.shouldIgnorePurchaseError(t)||(s=this.game.sentry)==null||s.captureMessage("Purchase error",{extra:{offerId:e,error:t,description:this.stringifyPurchaseError(t)}})}shouldIgnorePurchaseError(e){return!1}stringifyPurchaseError(e){return e.message?e.message:e.toString()}isSpecialOffer(e){var t;return(t=this.getOfferById(e))==null?void 0:t.isSpecial}wasSpecialOfferBought(){return this.store.getBoolean(g.SHOP_SPECIAL_OFFER_BOUGHT)}wasAnyPurchaseMade(){return this.store.getBoolean(g.SHOP_ANY_PURCHASE_COMPLETE)}savePurchase(e){let t=this.getOfferById(e);if(t===void 0){""+e;return}this.store.saveValue(g.SHOP_ANY_PURCHASE_COMPLETE,!0),this.isSpecialOffer(e)&&this.store.saveValue(g.SHOP_SPECIAL_OFFER_BOUGHT,!0),this.applyOfferContent(t.content)}applyOfferContent(e){this.store.changeNumber(g.COINS,e.coins),this.applyUnlimitedLives(e.lives)}applyUnlimitedLives(e){let t=Gi({hours:e});this.game.lives.startUnlimitedLives(t)}},L_=class extends Phaser.Events.EventEmitter{constructor(e){super();this.game=e}reset(){this.game.store.saveValue(g.PIGGY_BANK_COINS,0)}setCoinsNum(e){let t=Phaser.Math.Clamp(e,0,this.getMaxCoins());this.game.store.saveValue(g.PIGGY_BANK_COINS,t)}changeCoinsNum(e){let t=Phaser.Math.Clamp(this.getCurrentCoins()+e,0,this.getMaxCoins());this.game.store.saveValue(g.PIGGY_BANK_COINS,t)}getCurrentCoins(){return this.game.store.getNumber(g.PIGGY_BANK_COINS)}getMaxCoins(){return window.game.config.piggy_bank.max_capacity}getBreakMethod(){let e=window.game.config.piggy_bank.breakMethod;return!e||e==="auto"?this.calculateBreakMethod():e}calculateBreakMethod(){return this.game.purchases?"purchase":"rewarded_ad"}isFull(){return this.getCurrentCoins()>=this.getMaxCoins()}isAlmostFull(){return this.getFullnessPercent()>=.9}getFullnessPercent(){return Math.min(1,this.getCurrentCoins()/this.getMaxCoins())}},I_=We(Pn()),A_=We(Pn());function x_(e){let t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild}var B_=class{constructor(e){this.game=e,this.game.events.on(Ne.TEXTS_READY,this.onTextsUpdate,this),this.game.events.on(Ne.LANGUAGE_CHANGE,this.onTextsUpdate,this),this.screenful=A_.default,this.screenful.on("error",this.onFullscreenError.bind(this)),this.screenful.on("change",this.onFullscreenChange.bind(this)),this.button=this.createButton(),this.button.style.display="block",this.button.addEventListener("click",this.onClick.bind(this)),this.icon=this.button.querySelector("img"),this.setStateBasedOnFullscreenState()}onFullscreenError(e){var t;(t=this.game.sentry)==null||t.addBreadcrumb({message:"fullscreen error",data:{event:e}})}onFullscreenChange(e){var t;(t=this.game.sentry)==null||t.addBreadcrumb({message:`fullscreen ${this.screenful.isFullscreen?"enter":"exit"}`})}createButton(){return x_(`
			<button id="fullscreen" title="Fullscreen">
				<img src="css/fullscreen-enter.svg" alt="Fullscreen"/>
			</button>`)}getState(){return this.screenful.isFullscreen?"exit_fullscreen":"enter_fullscreen"}setStateBasedOnFullscreenState(){let{icon:e,hint:t}=this.getButtonAttributes(this.getState());this.icon.setAttribute("src",e),this.icon.setAttribute("hint",t),this.button.setAttribute("title",t)}getButtonAttributes(e){return e==="enter_fullscreen"?{icon:Ut("css/fullscreen-enter.svg"),hint:this.getButtonHint(e)}:{icon:Ut("css/fullscreen-exit.svg"),hint:this.getButtonHint(e)}}getButtonHint(e){let t=this.game.texts;return t?e==="enter_fullscreen"?t.texts.fullscreen.enter:t.texts.fullscreen.exit:e==="enter_fullscreen"?"Enter fullscreen":"Exit fullscreen"}onClick(){this.screenful.toggle().then(()=>{this.setStateBasedOnFullscreenState()})}onTextsUpdate(){let e=this.getState();this.icon.setAttribute("hint",this.getButtonHint(e)),this.button.setAttribute("title",this.getButtonHint(e))}},k_=class extends Error{constructor(e){super(e);this.name="TimeoutError"}};function M_(e,t,s,i){let a;const n=new Promise((r,o)=>{if(typeof t!="number"||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===Number.POSITIVE_INFINITY){r(e);return}i=P({customTimers:{setTimeout,clearTimeout}},i),a=i.customTimers.setTimeout.call(void 0,()=>{if(typeof s=="function"){try{r(s())}catch(f){o(f)}return}const l=typeof s=="string"?s:`Promise timed out after ${t} milliseconds`,d=s instanceof Error?s:new k_(l);typeof e.cancel=="function"&&e.cancel(),o(d)},t),(()=>$(this,null,function*(){try{r(yield e)}catch(l){o(l)}finally{i.customTimers.clearTimeout.call(void 0,a)}}))()});return n.clear=()=>{clearTimeout(a),a=void 0},n}var R_=class extends ct{init(e){super.init(e),this.decoratePage(),this.game.loadingScreen.showPreloader()}decoratePage(){if(this.game.config.scaleMode===Phaser.Scale.FIT===!1||w.getBool("noDecor"))return;let s=this.game.canvas;s.parentElement.style.backgroundImage=this.getBackgroundImageUrl(),s.parentElement.style.backgroundColor="#EB8F4E",s.style.boxShadow="0px 0px 16px 16px rgba(0, 0, 0, 0.1)",this.surroundCanvasWithSidebars(s),this.scale.updateBounds()}getBackgroundImageUrl(){let e=this.getDefaultImageFormat();return`url('${Ut(`assets/graphics/page_background.${e}`)}')`}getDefaultImageFormat(){return this.game.avif?"avif":this.game.webp?"webp":"jpg"}surroundCanvasWithSidebars(e){let t=document.createElement("div");t.className="sidebar",t.id="left-sidebar",e.parentNode.insertBefore(t,e);let s=document.createElement("div");if(s.className="sidebar",s.id="right-sidebar",e.parentNode.insertBefore(s,e.nextSibling),window.game.config.fullscreen.enabled&&I_.default.isEnabled){let i=new B_(this.game);s.appendChild(i.button)}}preload(){PokiSDK.gameLoadingStart(),this.analytics.sendLoadingEvent("main","start"),this.load.on(Phaser.Loader.Events.PROGRESS,this.onLoadProgress,this),this.load.on(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.loadGraphics(),this.loadFonts(),this.loadAudio(),this.loadOtherAssets(),this.loadShopOffers(),this.loadEditor(),this.loadSaveData(),this.loadRemoteConfig()}onLoadProgress(){this.game.loadingScreen.preloader.updateProgress(this.load.progress)}onLoadComplete(){this.load.off(Phaser.Loader.Events.PROGRESS,this.onLoadProgress,this),this.load.off(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this)}loadAudio(){this.loadSound(u.TAP),this.loadSound(u.SWAP),this.loadSound(u.SWAP_BACK),this.loadSound(u.CANT_SWAP),this.loadSound(u.MATCH_1),this.loadSound(u.MATCH_2),this.loadSound(u.MATCH_3),this.loadSound(u.MATCH_4),this.loadSound(u.MATCH_5),this.loadSound(u.STRIPES),this.loadSound(u.BOMB),this.loadSound(u.SUPER_SPHERE),this.loadSound(u.GOAL_UPDATE),this.loadSound(u.GOAL_COMPLETE),window.game.config.purchases.enabled&&this.loadSound(u.SHOP_OPEN)}loadSound(e,t){this.audio.loadSound(this.load,e,t)}loadOtherAssets(){this.load.json("texts","assets/texts.json"),this.load.json("levels","assets/configs/levels.json"),this.load.json("level_map_config","assets/configs/level_map_config.json"),w.getBool("replay")&&this.load.json("replay","assets/replay.json")}loadShopOffers(){window.game.config.purchases.enabled!==!1&&this.load.json("shop_offers","assets/configs/shop_offers.json")}loadFonts(){this.load.bitmapFontFromAtlas(B.POPUP_GOAL_LABELS,"popups","goal_num_label.png","assets/fonts/bitmap/goal_num_label.xml"),this.load.bitmapFontFromAtlas(B.PREGAME_BOOSTERS_LABELS,"popups","pregame_boosters_labels.png","assets/fonts/bitmap/pregame_boosters_labels.xml"),this.load.bitmapFontFromAtlas(B.SHOP_COINS,"popups","popups/shop/shop_coins.png","assets/fonts/bitmap/shop_coins.xml"),this.load.bitmapFontFromAtlas(B.LABELS_POPUPS,"popups","labels.png","assets/fonts/bitmap/labels.xml"),this.load.bitmapFontFromAtlas(B.LEVEL_ICONS_CLASSIC,"level_map","level_icons/level_icons_classic","assets/fonts/bitmap/level_icons_classic.xml"),this.load.bitmapFontFromAtlas(B.LEVEL_MAP_TOP_PANEL,"level_map","level_map_top_panel_font","assets/fonts/bitmap/level_map_top_panel_font.xml"),this.load.bitmapFontFromAtlas(B.LEVEL_MAP_BOTTOM_LABELS,"level_map","level_map_bottom_labels","assets/fonts/bitmap/level_map_bottom_labels.xml"),this.load.bitmapFontFromAtlas(B.LEVEL_ICONS_HARD,"level_map","level_icons/level_icons_hard","assets/fonts/bitmap/level_icons_hard.xml")}loadGraphics(){this.load.atlas("rewards","assets/graphics/rewards.png","assets/graphics/rewards.json"),this.load.atlas("popups","assets/graphics/popups.png","assets/graphics/popups.json"),this.load.image("level_map_bg_1","assets/graphics/level_map_1.jpg"),this.load.image("level_map_bg_2","assets/graphics/level_map_2.jpg"),this.load.image("level_map_bg_3","assets/graphics/level_map_3.jpg"),this.load.image("level_map_bg_4","assets/graphics/level_map_4.jpg"),this.load.atlas("level_map","assets/graphics/level_map.png","assets/graphics/level_map.json")}loadEditor(){ye.editorEnabled!==!1&&(this.load.script("tweakpane","js/tweakpane.min.js"),this.load.css("editor-css","css/editor.css"),this.load.atlas("editor","assets/graphics/editor.png","assets/graphics/editor.json"),this.load.bitmapFontFromAtlas(B.LEVEL_EDITOR_GRID,"editor","grid_labels","assets/fonts/bitmap/grid_labels.xml"),this.load.bitmapFontFromAtlas(B.LEVELS_EDITOR_LIST,"editor","levels_list","assets/fonts/bitmap/levels_list.xml"))}loadSaveData(){this.load.rexAwait("init_game_store",{callback:e=>{this.game.store.initActualStorage().catch(t=>{this.game.analytics.sendError("Storage:Not_Available")}).finally(()=>$(this,null,function*(){yield this.game.store.loadInitialValues(),this.game.store.fixLevelResults(),e()}))}})}loadRemoteConfig(){this.load.rexAwait("remote_config",{callback:(e,t)=>{M_(this.analytics.loadRemoteConfig(),5e3).then(()=>e()).catch(()=>t())}})}create(){this.initStore(),this.initGraphicsQuality(),this.initGifts(),this.initLives(),this.initTexts(),this.initLevelConfigs(),this.initPregameBoosters(),this.initBoosters(),this.initAudio(),this.addDelayedLoader(),this.addScenesTransition(),this.addFpsTracker(),this.addToasts(),this.addPurchaseManager(),this.addPiggyBank(),PokiSDK.gameLoadingFinished(),this.analytics.sendLoadingEvent("main","complete"),this.game.ads.preloadAd(),PokiSDK.commercialBreak().finally(()=>{this.startGame()})}initStore(){w.getBool("resetWheel")&&this.game.store.saveValue(g.WHEEL_LOCKED,!1);let e=w.getNumber("coins",-1);e>-1&&this.game.store.saveValue(g.COINS,e),this.game.store.changeNumber(g.LOGIN_NUM,1)}initGraphicsQuality(){let e=w.get("quality");if(An(e)){this.game.scaler.setQuality(e);return}let t=this.game.store.getValue(g.GRAPHICS_QUALITY);if(An(t)){this.game.scaler.setQuality(t);return}}initGifts(){this.game.gifts=new O_(this.game)}initLives(){this.game.lives=new S_(this.game)}initTexts(){this.game.texts=new p_(this.game),this.game.texts.injectTextsIntoScenes(),this.game.events.emit(Ne.TEXTS_READY,this.game.texts),this.game.adsHelper.onLanguageChange(),this.game.texts.on(Ne.LANGUAGE_CHANGE,()=>{this.game.adsHelper.onLanguageChange()})}initLevelConfigs(){let e=this.cache.json.get("levels");this.game.levelConfigs=new Us(e),this.game.injectIntoScenes(this.game.levelConfigs,"configs");let t=parseInt(this.analytics.getRemoteConfigValue(Ot.MOVES_DELTA,"0"));this.game.levelConfigs.getAll().forEach(s=>s.moves+=t)}initPregameBoosters(){this.game.pregameBoosters=new C_(this.game);let e=w.getNumber("pregameBoosters",-1);e>-1&&this.game.pregameBoosters.items.forEach(t=>{t.num=e})}initBoosters(){this.game.boosters=new T_(this.game);let e=w.getNumber("boosters",-1);e>-1&&this.game.boosters.boosters.forEach(s=>{s.type!==I.UNDO&&(s.num=e)});let t=w.getNumber("undo",-1);t>-1&&(this.game.boosters.getByType(I.UNDO).num=t)}initAudio(){this.audio.soundMute=this.game.store.getBoolean(g.SOUND_MUTED),this.audio.musicMute=this.game.store.getBoolean(g.MUSIC_MUTED)}addDelayedLoader(){this.game.globalScene.addDelayedLoader(),!w.getBool("noExtraLoad")&&this.game.globalScene.delayedLoader.startLoading()}addScenesTransition(){let e=new g_(this.game.globalScene,"level_map","black_rect");this.game.globalScene.addSceneTranstion(e),this.game.globalScene.sceneTransition.instantChange=w.getBool("instantSceneChange"),this.game.sentry.trackSceneChanges(e)}addFpsTracker(){this.game.fpsTracker=new w_(this.game,{updateInterval:250,minSceneDuration:8e3,graphicsQualityAutoAdjustment:{enabled:window.environment===lt.PRODUCTION,highFps:57,lowFps:45}}),this.game.fpsTracker.track(this.game.globalScene.sceneTransition)}addToasts(){this.game.toasts=this.game.globalScene.addToasts()}addPurchaseManager(){if(window.game.config.purchases.enabled===!1)return;let e=this.cache.json.get("shop_offers");this.game.purchases=new P_(this.game,e,this.game.globalScene.purchaseOverlay)}addPiggyBank(){if(window.game.config.piggy_bank.enabled===!1)return;let e=window.game.config.ads.rewarded,t=Boolean(this.game.purchases);if(!e&&!t)return;this.game.piggyBank=new L_(this.game);let s=w.getNumber("piggyBank",-1);s>-1&&this.game.piggyBank.setCoinsNum(s)}startGame(){if(w.getBool("replay")&&this.isReplayConfigValid()){this.startLevelReplay();return}let t=w.getNumber("level");if(t&&this.game.levelConfigs.check(t)){this.startLevel(t);return}let s=w.getNumber("levelEditor");if(s){this.startLevelEditor(s);return}this.startScene(M.LEVEL_MAP)}startScene(e,t){this.game.changeScene(this.scene.key,e,t)}isReplayConfigValid(){let e=this.cache.json.get("replay"),t=JSON.stringify(e)==="{}",s=e&&t===!1;return s}startLevelReplay(){this.startScene(M.GAMEPLAY_ROOT,{type:"replay",session:this.cache.json.get("replay")})}startLevel(e,t=[]){this.startScene(M.GAMEPLAY_ROOT,{type:"play",levelNumber:e,pregameBoosters:t})}startLevelEditor(e){this.startScene(M.LEVEL_EDITOR_ROOT,{levelNumber:e})}resize(){super.resize()}onShutdown(){super.onShutdown(),this.game.loadingScreen.fadeOut()}},m;(function(e){e.Linear="Linear",e.Stepped="Stepped",e.QuadIn="Quadratic.In",e.CubicIn="Cubic.In",e.QuartIn="Quartic.In",e.QuintIn="Quintic.In",e.SineIn="Sine.In",e.ExpoIn="Expo.In",e.CircIn="Circular.In",e.ElasticIn="Elastic.In",e.BackIn="Back.In",e.BounceIn="Bounce.In",e.QuadOut="Quadratic.Out",e.CubicOut="Cubic.Out",e.QuartOut="Quartic.Out",e.QuintOut="Quintic.Out",e.SineOut="Sine.Out",e.ExpoOut="Expo.Out",e.CircOut="Circular.Out",e.ElasticOut="Elastic.Out",e.BackOut="Back.Out",e.BounceOut="Bounce.Out",e.QuadInOut="Quadratic.InOut",e.CubicInOut="Cubic.InOut",e.QuartInOut="Quartic.InOut",e.QuintInOut="Quintic.InOut",e.SineInOut="Sine.InOut",e.ExpoInOut="Expo.InOut",e.CircInOut="Circular.InOut",e.ElasticInOut="Elastic.InOut",e.BackInOut="Back.InOut",e.BounceInOut="Bounce.InOut"})(m||(m={}));var gs={Bell:(e,t=1)=>Math.pow(4,t)*Math.pow(e*(1-e),t),BellCbrt:e=>Math.cbrt(4)*Math.cbrt(e*(1-e)),BellSqrt:e=>Math.sqrt(4)*Math.sqrt(e*(1-e)),BellBasic:e=>4*(e*(1-e)),BellQuad:e=>4*4*(e*(1-e)*(e*(1-e))),BellCubic:e=>4*4*4*(e*(1-e)*(e*(1-e))*(e*(1-e)))},N_=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.goalNum=0,this.name=`goal_${t}`,this.goalType=t,this.goalNum=s,this.addIconParticles(),this.addIcon(),this.addTick(),this.addTickParticles(),this.addText(),this.playDecrementTweensThrottled=Ft(this.playDecrementTweens.bind(this),500,{trailing:!1})}addIconParticles(){this.iconParticles=this.scene.add.particles("gameplay_gui"),this.add(this.iconParticles),this.largeCirclesEmitter=this.iconParticles.createEmitter({frame:"particles/circle_fx",scale:{start:.33,end:1.4,ease:m.ExpoOut},alpha:{start:.9,end:0,ease:m.ExpoOut},lifespan:2e3,on:!1})}addIcon(){let e="top_panel/goals/"+this.goalType.toLowerCase();this.icon=this.scene.add.image(0,0,"gameplay_gui",e),this.add(this.icon)}addTick(){this.tick=this.scene.add.image(0,0,"gameplay_gui","top_panel/goals/tick"),this.tick.kill(),this.tick.x=20,this.tick.y=16,this.tick.originalY=this.tick.y,this.add(this.tick)}addText(){let e=this.goalNum.toString();this.text=this.scene.add.bitmapText(0,0,B.TOP_PANEL_GOAL_LABELS,e,24),this.text.setOrigin(.5,.5),this.text.x=this.tick.x,this.text.y=this.tick.y+1,this.text.originalY=this.text.y,this.add(this.text)}addTickParticles(){this.tickParticles=this.scene.add.particles("gameplay_gui"),this.add(this.tickParticles),this.circlesEmitter=this.tickParticles.createEmitter({frame:"particles/circle_fx",scale:{start:0,end:1.2,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:2e3,on:!1})}decrementNum(){this.goalNum>0&&(--this.goalNum==0?(this.text.kill(),this.tick.revive(),this.showTick(),this.showTickParticles(),this.scene.gameplay.sounds.goalComplete()):this.text.setText(this.goalNum.toString())),this.scene.gameplay.sounds.goalUpdate(),this.playDecrementTweensThrottled()}playDecrementTweens(){this.tweenIcon(),this.tweenTickOrText(),this.isComplete()===!1&&this.largeCirclesEmitter.explode(1,this.icon.x,this.icon.y)}tweenIcon(){this.icon.scale=1,this.scene.tweens.killTweensOf(this.icon),this.scene.tweens.add({targets:this.icon,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,yoyo:!0})}tweenTickOrText(){let e=this.tick.visible?this.tick:this.text;e.y=e.originalY,this.scene.tweens.killTweensByProperty(e,"y"),this.scene.tweens.add({targets:e,duration:200,ease:Phaser.Math.Easing.Sine.InOut,y:"-=10",yoyo:!0})}showTick(){this.tick.alpha=0,this.scene.tweens.add({targets:this.tick,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.tick.scale=1.33,this.scene.tweens.add({targets:this.tick,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})}showTickParticles(){this.circlesEmitter.explode(1,this.tick.x,this.tick.y)}updateNum(e){this.goalNum=e,this.goalNum===0?(this.tick.revive(),this.text.kill()):(this.tick.kill(),this.text.revive(),this.text.setText(this.goalNum.toString()))}isComplete(){return this.goalNum===0}},D_=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.columns=2,this.cellWidth=84,this.cellHeight=62,this.name="goals",this.goals=t,this.addViews(),this.alignViews(),this.centerLastView();let s=Math.ceil(this.views.length/this.columns);this.setSize(this.columns*this.cellWidth,s*this.cellHeight)}addViews(){this.views=this.goals.map(e=>{let t=new N_(this.scene,e.type,e.targetNum);return this.add(t),t})}alignViews(){this.gridAlign({cellWidth:this.cellWidth,cellHeight:this.cellHeight,position:Phaser.Display.Align.CENTER,width:this.columns,x:this.cellWidth/2,y:this.cellWidth/2})}centerLastView(){this.views.length%2!=0&&(this.views[this.views.length-1].x+=this.cellWidth/2)}updateData(e){e.forEach(t=>{let s=this.views.find(i=>i.goalType===t.type);s&&s.updateNum(t.targetNum-t.collectedNum)})}getViewByGoalType(e){return this.views.find(t=>t.goalType===e)}},H_=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.scheduleSwapIconAlign=!1,this.scene.sys.updateList.add(this),this.name="moves_label",this.addSwapIcon(),this.addMovesNumText(),this.scheduleSwapIconAlign=!0}addSwapIcon(){this.swapIcon=this.scene.add.image(0,0,"gameplay_gui","top_panel/swap_icon_2"),this.swapIcon.y=-6,this.add(this.swapIcon)}addMovesNumText(){let e="0";this.movesNumText=this.scene.add.bitmapText(0,0,B.MOVES_LABEL,e,62),this.movesNumText.setOrigin(.5,.5),this.movesNumText.originalY=this.movesNumText.y,this.add(this.movesNumText)}updateMovesNum(e,t=!0){if(t){this.movesNumText.setText(e.toString()),this.scheduleSwapIconAlign=!0;return}this.scene.tweens.add({targets:this.movesNumText,duration:333,ease:Phaser.Math.Easing.Cubic.Out,scale:.75,onUpdate:()=>{this.scheduleSwapIconAlign=!0},onComplete:()=>{this.movesNumText.setText(e.toString()),this.scene.tweens.add({targets:this.movesNumText,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1,onUpdate:()=>{this.scheduleSwapIconAlign=!0}})}})}onExtraMovesGranted(e){this.updateMovesNum(e,!0),this.movesNumText.alpha=0,this.scene.tweens.add({targets:this.movesNumText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.movesNumText.scale=.5,this.scene.tweens.add({targets:this.movesNumText,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1,onUpdate:()=>{this.scheduleSwapIconAlign=!0}})}decrementNum(){let e=parseInt(this.movesNumText.text);this.updateMovesNum(e-1,!0)}preUpdate(e,t){this.scheduleSwapIconAlign&&(this.scheduleSwapIconAlign=!1,this.swapIcon.x=this.movesNumText.x-this.movesNumText.width/2-18)}preDestroy(){this.scene.sys.updateList.remove(this),super.preDestroy()}},Ws=class{constructor(e,t){this.weights=e,this.rnd=new Phaser.Math.RandomDataGenerator([t!=null?t:Date.now().toString()]),this.items=this.generateItems(this.weights)}generateItems(e){let t=[];return Object.entries(e).forEach(([s,i])=>{for(let a=0;a<i;a++)t.push(s)}),this.rnd.shuffle(t)}getItem(){return this.items.length===0&&(this.items=this.generateItems(this.weights)),this.items.pop()}getState(){return{rnd:this.rnd.state(),items:this.items.slice(0)}}setState(e){this.rnd.state(e.rnd),this.items=e.items}getItemTypes(){return Object.keys(this.weights).filter(e=>this.weights[e]>0)}},yo=Phaser.Math.DegToRad,Fi;(function(e){e.PROGRESS="__PROGRESS"})(Fi||(Fi={}));var G_=class extends Phaser.GameObjects.Graphics{constructor(e,t){super(e);this.progress=1,this.options=t,this.setStyles(t),this.thickness=t.thickness,this.radius=t.radius,this.startAngle=Phaser.Math.Angle.Normalize(yo(t.startAngle)),this.endAngle=Phaser.Math.Angle.Normalize(yo(t.endAngle)),this.totalRange=Math.PI*2-Math.abs(Phaser.Math.Angle.ShortestBetween(this.startAngle,this.endAngle))}setStyles(e){this.setDefaultStyles({fillStyle:{color:e.color},lineStyle:{width:e.thickness,color:e.color}})}setProgressInstant(e){if(this.progress=Phaser.Math.Clamp(e,0,1),this.progress===0){this.clear(),this.emit(Fi.PROGRESS,this.progress,0,0);return}let t=this.endAngle-this.totalRange*this.progress,s=this.endAngle;this.clear(),this.beginPath(),this.arc(0,0,this.radius,t,s),this.strokePath(),this.options.useRoundCaps&&(this.fillCircle(this.radius*Math.cos(t),this.radius*Math.sin(t),this.thickness/2),this.fillCircle(this.radius*Math.cos(s),this.radius*Math.sin(s),this.thickness/2)),this.emit(Fi.PROGRESS,this.progress,t,s)}setProgress(e){var t;let s=Math.abs(e-this.progress),i=Math.max(200,s*1e3);(t=this.progressTween)==null||t.remove(),this.progressTween=this.scene.tweens.add({targets:this,duration:i,ease:Phaser.Math.Easing.Quadratic.Out,progress:Phaser.Math.Clamp(e,0,1),onUpdate:()=>{this.setProgressInstant(this.progress)}})}stopProgressTween(){var e;(e=this.progressTween)==null||e.remove()}},F_=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.config=t,this.current=0,this.total=this.config.powerupsNum,this.name="powerup_chef",this.createPowerupTypesGenerator(s),this.addBack(),this.addChef(),this.addProgressBarBack(),this.addProgressBarFill(),this.addLabel(),this.config.isEnabled===!1&&(this.label.kill(),this.progressBarBack.kill(),this.progressBarFill.kill())}createPowerupTypesGenerator(e){let t=this.config,{isEnabled:s,powerupsNum:i}=t,a=fi(t,["isEnabled","powerupsNum"]);this.powerupTypesGenerator=new Ws(a,e)}addProgressBarBack(){this.progressBarBack=this.scene.add.image(0,0,"gameplay_gui","powerup_chef/progress_bar_back"),this.progressBarBack.y=25,this.add(this.progressBarBack)}addProgressBarFill(){let e=24,t={radius:85,thickness:13,color:16733558,startAngle:-e,endAngle:180+e,useRoundCaps:!0};this.progressBarFill=new G_(this.scene,t),this.progressBarFill.x=this.progressBarBack.x,this.progressBarFill.y=this.progressBarBack.y-25,this.progressBarFill.setProgressInstant(0),this.add(this.progressBarFill)}addLabel(){let e=this.getLabelContent();this.label=this.scene.add.bitmapText(0,0,B.POWERUP_CHEF,e,25),this.label.setLetterSpacing(1),this.label.setOrigin(.5,.5),this.label.x=-2,this.label.y=this.back.bottom+15,this.add(this.label)}getLabelContent(){return`${this.current}/${this.total}`}updateLabelContent(){this.label.text=this.getLabelContent()}animateLabel(){this.label.scale=1,this.scene.tweens.killTweensOf(this.label),this.scene.tweens.add({targets:this.label,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,yoyo:!0})}addBack(){this.back=this.scene.add.image(0,0,"gameplay_gui","powerup_chef/Moves Circle"),this.back.scale=.96,this.add(this.back)}addChef(){this.chef=this.scene.add.image(0,0,"gameplay_gui","powerup_chef/chef"),this.chef.x=0,this.chef.y=this.back.bottom-4,this.chef.originalY=this.chef.y,this.add(this.chef)}incrementCurrent(){this.current++,this.updateProgress()}updateProgress(){let e=Phaser.Math.Clamp(this.current/this.total,0,1);this.progressBarFill.setProgress(e),this.updateLabelContent(),this.animateLabel()}isPowerupReady(){return this.current>=this.total}emitPowerup(){return this.current-=this.total,this.updateProgress(),this.playEmitTweens(),this.powerupTypesGenerator.getItem()}resetProgress(){this.current=0,this.progressBarFill.stopProgressTween(),this.progressBarFill.setProgressInstant(0),this.updateLabelContent(),this.animateLabel()}playEmitTweens(){this.scene.tweens.add({targets:this.chef,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0})}},U_=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="top_panel",this.addBack(),this.addGoalsPanel(t.goals),this.addLevelLabelBack(),this.addLevelLabel(t.levelNumber),this.addMovesLabel(t.moves),this.addPowerupChef(t),t.hard&&this.addSkullIcon(),this.bringToTop(this.movesLabel),this.bringToTop(this.levelLabel),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"gameplay_gui","top_panel/top_panel_back"),this.back.clicksNum=0,this.back.clicksEnabled=!0,this.back.lastClickTs=0,this.back.eventsSent=0,this.back.setInteractive(),this.add(this.back),w.getBool("fastSwitch")||ye.development?this.back.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackClickDev,this):this.back.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackClick,this)}onBackClickDev(e,t,s){t>this.back.width*.66?this.scene.events.emit(q.GOTO_NEXT_LEVEL):t<this.back.width*.33?this.scene.events.emit(q.GOTO_PREV_LEVEL):this.handleBackCenterClick()}onBackClick(e,t,s){t>this.back.width*.33&&t<this.back.width*.66&&this.handleBackCenterClick()}handleBackCenterClick(){if(this.back.clicksEnabled===!1)return;if(Date.now()-this.back.lastClickTs>500){this.back.lastClickTs=Date.now(),this.back.clicksNum=0;return}this.back.lastClickTs=Date.now(),this.back.clicksNum++,this.back.clicksNum===5&&(++this.back.eventsSent==3&&(this.back.clicksEnabled=!1),this.back.clicksNum=0,this.back.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackClick,this),this.scene.audio.play(u.FANCY_TAP),this.scene.events.emit(q.SEND_GAMEPLAY_SESSION))}addGoalsPanel(e){let t=this.back.getCenter(),s=ut.createGoalsArray(e);this.goalsPanel=new D_(this.scene,s),this.goalsPanel.x=t.x-this.goalsPanel.width/2-212,this.goalsPanel.y=t.y-this.goalsPanel.height/2-30,this.add(this.goalsPanel)}addPowerupChef(e){let t=this.back.getCenter();this.chef=new F_(this.scene,e.chefPowerups,this.scene.gameplay.initData.rndSeed),this.chef.y=t.y-12,this.add(this.chef)}addSkullIcon(){let e=this.scene.add.image(0,0,"gameplay_gui","top_panel/skull_small");e.x=286,e.y=128,e.angle=2,this.add(e)}addMovesLabel(e){let t=this.back.getCenter();this.movesLabel=new H_(this.scene),this.movesLabel.updateMovesNum(e,!0),this.movesLabel.x=t.x+220,this.movesLabel.y=t.y+3,this.add(this.movesLabel)}addLevelLabelBack(){this.levelLabelBack=this.scene.add.image(0,0,"gameplay_gui","top_panel/PopupCreamChoco"),this.levelLabelBack.x=this.back.getCenter().x+210,this.levelLabelBack.y=32,this.add(this.levelLabelBack)}addLevelLabel(e){let t=`~ ${e} ~`,s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"22px",color:"#FFE0AD",align:"center"};this.levelLabel=this.scene.add.text(0,0,t,s),this.levelLabel.setOrigin(.5,.5),this.levelLabel.x=this.levelLabelBack.x+4,this.levelLabel.y=this.levelLabelBack.y-10,this.add(this.levelLabel)}},ee;(function(e){e[e.TOP_PANEL=0]="TOP_PANEL",e[e.GOAL_ITEMS=1]="GOAL_ITEMS",e[e.MOVES_WARNING=2]="MOVES_WARNING",e[e.BOOSTER_HINT_SCREEN=3]="BOOSTER_HINT_SCREEN",e[e.BOOSTER_HINT_WARNING=4]="BOOSTER_HINT_WARNING",e[e.BOOSTERS_PANEL=5]="BOOSTERS_PANEL",e[e.GOALS_SCREEN=6]="GOALS_SCREEN",e[e.PARTICLES=7]="PARTICLES",e[e.TUTORIAL=8]="TUTORIAL",e[e.SECOND_CHANCE_SCREEN=9]="SECOND_CHANCE_SCREEN",e[e.LEVEL_FAILED_SCREEN=10]="LEVEL_FAILED_SCREEN",e[e.START_LEVEL_SCREEN=11]="START_LEVEL_SCREEN",e[e.VIDEO_REWARDS_SCREEN=12]="VIDEO_REWARDS_SCREEN",e[e.PIGGY_BANK_SCREEN=13]="PIGGY_BANK_SCREEN",e[e.LIVES_SCREEN=14]="LIVES_SCREEN",e[e.SHOP_SCREEN=15]="SHOP_SCREEN",e[e.LEVEL_PRE_COMPLETE_SCREEN=16]="LEVEL_PRE_COMPLETE_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=17]="LEVEL_COMPLETE_SCREEN",e[e.PAUSE_SCREEN=18]="PAUSE_SCREEN",e[e.QUIT_SCREEN=19]="QUIT_SCREEN",e[e.UNDO_OVERLAY=20]="UNDO_OVERLAY",e[e.DEBUG_GUIDES=21]="DEBUG_GUIDES"})(ee||(ee={}));var Co=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="num_label",this.addBack(),this.addText()}addBack(){this.back=this.scene.add.image(0,0,"gameplay_gui","boosters/Booster Amound Circle"),this.add(this.back)}addText(){let e="0";this.text=this.scene.add.bitmapText(0,0,B.BOOSTER_LABELS,e,22),this.text.setLetterSpacing(-1),this.text.setOrigin(.5,.5),this.text.x=0,this.text.y=5,this.add(this.text)}updateNum(e){this.text.setText(e.toString())}},So=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this._isSelected=!1,this.originalY=0,this.name="booster_"+t.type,this.isLocked=!s,this._booster=t,this._booster.on(wt.NUM_CHANGED,this.onBoosterNumChanged,this),this.addParticles(),this.addIcon(),this.addNumLabelEmitter(),this.addNumLabel(),this.addPlusButton(),this.addCloseButton(),this.setSize(this.icon.width,this.icon.height),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onInputDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onInputUp,this),this.enableInteractive(),this.updateView()}get isSelected(){return this._isSelected}get booster(){return this._booster}onBoosterNumChanged(){this.updateView()}updateView(){if(this.isLocked){let e="boosters/booster_disabled";this.icon.setFrame(e),this.plusButton.kill(),this.numLabel.kill();return}this._booster.num===0?(this.plusButton.revive(),this.numLabel.kill()):(this.plusButton.kill(),this.numLabel.revive(),this.numLabel.updateNum(this._booster.num))}enableInteractive(){this.setInteractive(),this.input.cursor="pointer"}onInputDown(e){this.currentPointer=e,this.scene.tweens.add({targets:this,scale:this.scale*.9,ease:Phaser.Math.Easing.Cubic.Out,duration:50}),this.scene.cache.audio.has(u.TAP)&&this.scene.sound.play(u.TAP,{volume:1})}onInputUp(e){this.currentPointer&&this.currentPointer===e&&(this.currentPointer=null,this.scene.tweens.add({targets:this,scale:1,ease:Phaser.Math.Easing.Back.Out,duration:300}))}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.emitter=this.particles.createEmitter({frame:"particles/circle_fx",scale:{start:1.1,end:1.5,ease:m.ExpoOut},alpha:{start:.66,end:0,ease:m.ExpoOut},lifespan:2e3,frequency:500,on:!1}),this.add(this.particles)}addIcon(){let e="boosters/"+this._booster.type;this.icon=this.scene.add.image(0,0,"gameplay_gui",e),this.add(this.icon)}addNumLabelEmitter(){this.numLabelEmitter=this.particles.createEmitter({frame:"particles/circle_fx",scale:{start:.4,end:1,ease:m.ExpoOut},alpha:{start:.66,end:0,ease:m.ExpoOut},lifespan:2e3,frequency:500,on:!1})}addNumLabel(){let e=this.icon.width/2-15;this.numLabel=new Co(this.scene),this.numLabel.updateNum(this._booster.num),this.numLabel.x=e,this.numLabel.y=e-6,this.numLabel.originalX=this.numLabel.x,this.add(this.numLabel)}addPlusButton(){this.plusButton=this.scene.add.image(0,0,"gameplay_gui","boosters/plus_button_3"),this.plusButton.x=this.numLabel.x-1,this.plusButton.y=this.numLabel.y-1,this.add(this.plusButton)}addCloseButton(){this.closeButton=this.scene.add.image(0,0,"gameplay_gui","boosters/button_close"),this.closeButton.x=this.plusButton.x+2,this.closeButton.y=-36,this.closeButton.originalY=this.closeButton.y,this.closeButton.kill(),this.add(this.closeButton)}highlight(){this._isSelected=!0,this.emitter.flow(800),this.showCloseButton(),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Quadratic.InOut,y:this.originalY-12})}showCloseButton(){this.closeButton.revive(),this.closeButton.alpha=0,this.closeButton.y=this.closeButton.originalY-20,this.scene.tweens.killTweensOf(this.closeButton),this.scene.tweens.add({targets:this.closeButton,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1,y:this.closeButton.originalY})}resetHighlight(){this._isSelected=!1,this.emitter.on=!1,this.emitter.killAll(),this.hideCloseButton(),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Quadratic.InOut,y:this.originalY})}hideCloseButton(){this.scene.tweens.killTweensOf(this.closeButton),this.closeButton.kill()}dim(){this.alpha=.4,this.isLocked===!1&&(this.numLabel.alpha=0,this.plusButton.alpha=0,this.disableInteractive())}resetDim(){this.alpha=1,this.isLocked===!1&&(this.numLabel.alpha=1,this.plusButton.alpha=1,this.enableInteractive())}onBoosterIncrease(){this.scene.audio.play(u.TWINKLE_3,{volume:.5}),this.numLabelEmitter.emitParticle(1,this.numLabel.x,this.numLabel.y),this.scene.tweens.killTweensOf(this.numLabel),this.numLabel.alpha=0,this.scene.tweens.add({targets:this.numLabel,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.numLabel.scale=2,this.scene.tweens.add({targets:this.numLabel,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}preDestroy(){this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onInputUp,this),this._booster.off(wt.NUM_CHANGED,this.onBoosterNumChanged,this),super.preDestroy()}},Ys;(function(e){e.SHOW="__SHOW",e.HIDE_COMPLETE="__HIDE_COMPLETE"})(Ys||(Ys={}));var W_=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="booster_locked_popover",this.addBack(t,s),this.addTitleBack(),this.addTitle(),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addTitleBack(){this.titleBack=this.scene.add.image(0,0,"gameplay_gui","boosters/popover_hint"),this.titleBack.y=this.back.top+6,this.add(this.titleBack)}addTitle(){let e="Booster",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#ffffff",align:"center",padding:{x:0,y:4}};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.setShadow(0,2,"rgba(0,0,0,0.2)",0),this.title.x=this.titleBack.x,this.title.y=this.titleBack.y-2,this.add(this.title),this.adjustTitleSize()}addText(){let e=this.scene.texts.booster_lock,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(300,!0),this.text.setLineSpacing(-2),this.add(this.text),this.adjustTextSize()}show(e){this.emit(Ys.SHOW,this),this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.hide(e.duration)}})}hide(e){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.emit(Ys.HIDE_COMPLETE,this),this.kill()}})}forceHide(){this.scene.tweens.killTweensOf(this),this.emit(Ys.HIDE_COMPLETE,this),this.kill()}updateContent(e,t){this.title.text=e,this.adjustTitleSize(),this.text.text=t,this.adjustTextSize()}adjustTitleSize(){let e=this.titleBack.width*.8;this.title.scale=Math.min(1,e/this.title.width)}adjustTextSize(){let e=this.titleBack.bottom-16,s=this.back.top+126-e,i=s*.7;this.text.scale=Math.min(1,i/this.text.height),this.text.y=e+s/2}},tt;(function(e){e.SELECT="__SELECT",e.CANCEL="__CANCEL",e.BUY_BOOSTER="__BUY_BOOSTER"})(tt||(tt={}));var Y_=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.cellWidth=140,this.cellHeight=110,this.originalY=0,this.name="boosters_panel",this.addIcons(t,s),this.alignIcons(),this.addPopover(),this.setSize(this.icons.length*this.cellWidth,this.cellHeight),this.addOverlay()}addIcons(e,t){this.icons=e.map(s=>{let i=new So(this.scene,s,t[s.type]);return i.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onIconClick.bind(this,i)),this.add(i),i}),this.iconsReversed=this.icons.slice().reverse()}onIconClick(e){if(this.scene.audio.playClick(),e.isLocked){this.showPopoverAt(e);return}if(e.booster.num===0){this.emit(tt.BUY_BOOSTER,e.booster);return}e.isSelected?this.emit(tt.CANCEL,e.booster):this.emit(tt.SELECT,e.booster)}alignIcons(){this.gridAlign({cellWidth:this.cellWidth,cellHeight:this.cellHeight,x:this.cellWidth/2,y:this.cellHeight/2,position:Phaser.Display.Align.CENTER,height:1}),this.icons.forEach(e=>{e.originalY=e.y})}addPopover(){this.icons.some(t=>t.isLocked)!==!1&&(this.popover=new W_(this.scene,"gameplay_gui","boosters/popover"),this.popover.kill(),this.add(this.popover),this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onScenePointerDown,this))}onScenePointerDown(e,t){this.popover.visible===!1||t.some(i=>i instanceof So&&i.isLocked)||this.popover.hide(0)}showPopoverAt(e){let t=e.booster,s=window.game.config.boosters_unlock[t.type],i=this.scene.texts.booster_lock.replace("#",s.toString());this.popover.x=e.x,this.popover.y=e.y-50,this.popover.updateContent(t.title,i),this.popover.show({duration:1700})}addOverlay(){this.overlay=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.overlay.displayWidth=this.width,this.overlay.displayHeight=this.height*1.2,this.overlay.x=this.width/2,this.overlay.y=this.height/2,this.overlay.alpha=.001,this.overlay.visible=!1,this.overlay.setInteractive(),this.add(this.overlay)}show(){this.revive(),this.iconsReversed.forEach(e=>{e.alpha=0,e.y=e.originalY-10,this.scene.tweens.add({delay:150,targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:e.originalY})})}hide(){this.scene.tweens.add({targets:this.icons,duration:100,ease:Phaser.Math.Easing.Linear,alpha:0,y:"+=10"}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,()=>{this.kill()})}getIconByType(e){return this.icons.find(t=>t.booster.type===e)}highlight(e){this.icons.forEach(t=>{t.booster.type===e?t.highlight():t.dim()})}resetHighlight(){this.icons.forEach(e=>{e.isSelected?e.resetHighlight():e.resetDim()})}killIconsExcept(e){this.icons.forEach(t=>{t.booster.type!==e&&t.kill()})}reviveAllIcons(){this.icons.forEach(e=>e.revive())}enableInput(){this.overlay.visible=!1}disableInput(){this.overlay.visible=!0}emulateClickOnIcon(e){this.onIconClick(this.getIconByType(e))}preDestroy(){super.preDestroy(),this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onScenePointerDown,this)}},y=78;function j(e,t){return{x:y/2+e*y,y:y/2+t*y}}function Vs(e,t){return{column:Math.floor(e/y),row:Math.floor(t/y)}}function en(e){return Vs(e.x,e.y)}function V_(e){let t=Gt(e,"column").column,s=ze(e,"column").column,i=Gt(e,"row").row,a=ze(e,"row").row,n=s-t+1,r=a-i+1;return{width:n,height:r,top:i,left:t}}function Ks(e,t,s,i){return Phaser.Math.Distance.Between(e,t,s,i)}function ge(e,t,s){t=t!=null?t:e.column,s=s!=null?s:e.row;let i=j(t,s);e.x=i.x,e.y=i.y}function tn(e,t,s){t=t!=null?t:e.column,s=s!=null?s:e.row;let i=j(t,s);e.x=i.x+e.displayWidth/2-y/2,e.y=i.y+e.displayHeight/2-y/2}function Ui(e,t){return e.row===t.row?e.column-t.column:e.row-t.row}function sn(e,t){return e.row===t.row?t.column-e.column:t.row-e.row}function an(e){let t=Gt(e,"column"),s=ze(e,"column"),i=Gt(e,"row"),a=ze(e,"row");return{left:t.column,right:s.column,top:i.row,bottom:a.row,width:s.column-t.column+1,height:a.row-i.row+1}}function K_(e){let t=[],s=[];return e.forEach((i,a)=>{t[a]=i.column,s[a]=i.row}),{column:Phaser.Math.Median(t),row:Phaser.Math.Median(s)}}var ms=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="tap_hand",this.addHand(t,s)}addHand(e,t){this.hand=this.scene.add.image(0,0,e,t),this.add(this.hand)}playAnimation(e=0,t=800){var s,i,a;this.hand.alpha=0,(s=this.scene)==null||s.tweens.add({delay:e,targets:this.hand,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.hand.scale=1.5,(i=this.scene)==null||i.tweens.add({delay:e,targets:this.hand,duration:400,ease:Phaser.Math.Easing.Cubic.Out,scale:1}),this.hand.angle=30,(a=this.scene)==null||a.tweens.add({delay:e,targets:this.hand,duration:400,ease:Phaser.Math.Easing.Cubic.Out,angle:0,onComplete:()=>{var n;(n=this.scene)==null||n.tweens.add({delay:200,targets:this.hand,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.hand.x=0,this.hand.y=0,this.playAnimation(t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}},z_=class extends ie{constructor(e,t){super(e,{name:"booster_hint_screen",backgroundKey:"gameplay_gui",backgroundFrame:"black_rect",backgroundAlpha:.001,backgroundInteractive:!1});this.gameplay=t,this.background.kill(),this.addHand(),this.addBoosterTitle(),this.addBoosterHint()}addHand(){this.hand=new ms(this.scene,"gameplay_gui","tutorial/hand"),this.add(this.hand)}addBoosterTitle(){let e=this.scene.texts.boosters.lollipop.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"50px",color:"#FCE916",align:"center",padding:{x:0,y:10}};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.setShadow(0,3,"#AC4717",2),this.add(this.title)}addBoosterHint(){let e=this.scene.texts.boosters.lollipop.hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#ffffff",align:"center",padding:{x:0,y:10}};this.hint=this.scene.add.text(0,0,e,t),this.hint.setOrigin(.5,.5),this.hint.setShadow(0,4,"rgba(0,0,0,0.5)",0),this.add(this.hint)}resize(){super.resize(),this.alignHand(),this.alignHint(),this.alignTitle()}alignHand(){var e,t;let s=(e=this.hand.column)!=null?e:0,i=(t=this.hand.row)!=null?t:0,a=j(s,i),n=this.gameplay.camera.getWorldPosition(a),r=this.pointToContainer(n);this.hand.x=r.x+70,this.hand.y=r.y+80}alignHint(){let e=0,s=this.getFieldTop()-5*this.scale-e;this.hint.setWordWrapWidth(this.screenWidth*.8,!0),this.hint.x=this.screenCenter.x,this.hint.y=e+s*.66,this.hint.originalY=this.hint.y}alignTitle(){let e=0,s=this.hint.y-this.hint.height/2-e,i=e+s/2;this.title.x=this.screenCenter.x,this.title.y=Math.max(i,this.hint.y-this.hint.height/2-this.title.height/2-8),this.title.originalY=this.title.y}getFieldTop(){let e=this.gameplay.camera.camera,t=e.centerY-e.y+this.gameplay.camera.getTopOffset(),a=this.gameplay.field.dimensions.height*y*e.zoom;return(t-a/2)/this.scale}updateData(e,t){this.title.text=e.title,this.hint.text=e.hint,this.alignTitle(),t?(this.hand.column=t.column,this.hand.row=t.row,this.alignHand(),this.hand.revive()):this.hand.kill()}show(){this.revive(),this.scene.tweens.killTweensOf(this),this.alpha=1,this.showTexts(),this.showHand(300)}showTexts(){[this.hint,this.title].forEach((t,s)=>{let i=s*66;t.alpha=0,this.scene.tweens.add({delay:i,targets:t,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.scale=.75,this.scene.tweens.add({delay:i,targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),t.y=t.originalY-30,this.scene.tweens.add({delay:i,targets:t,duration:500,ease:Phaser.Math.Easing.Back.Out,y:t.originalY})})}showHand(e){this.hand.visible!==!1&&(this.hand.kill(),this.showHandTimerEvent=this.scene.time.delayedCall(e,()=>{this.hand.revive(),this.hand.playAnimation()}))}hide(){var e;this.emitHideStartEvent(),this.hand.visible&&((e=this.showHandTimerEvent)==null||e.remove(),this.hand.stopAnimation()),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emitHideCompleteEvent()}})}},j_=class extends fe{get undoBooster(){return this._undoBooster}constructor(e,t){super(e,"gameplay_gui","Blue-RectangleButton");this._undoBooster=t,this._undoBooster.on(wt.NUM_CHANGED,this.onBoosterNumChange,this),this.setName("undo_button"),this.addIcon("gameplay_gui","Repeat-Left-Icon"),this.addParticles(),this.addNumLabel(),this.addPlusButton(),this.updateView()}onBoosterNumChange(){this.updateView()}updateView(){this._undoBooster.num===0?this.setEmptyView():this.setNonEmptyView()}setEmptyView(){this.numLabel.updateNum(0),window.game.config.ads.rewarded?(this.numLabel.kill(),this.plusButton.revive()):this.plusButton.kill()}setNonEmptyView(){this.numLabel.revive(),this.numLabel.updateNum(this._undoBooster.num),this.plusButton.kill()}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.emitter=this.particles.createEmitter({frame:"particles/circle_fx",scale:{start:.4,end:1,ease:m.ExpoOut},alpha:{start:.66,end:0,ease:m.ExpoOut},lifespan:2e3,frequency:500,on:!1}),this.add(this.particles)}addNumLabel(){this.numLabel=new Co(this.scene),this.numLabel.x=-34,this.numLabel.y=-34,this.numLabel.originalX=this.numLabel.x,this.numLabel.originalY=this.numLabel.y,this.add(this.numLabel)}addPlusButton(){this.plusButton=this.scene.add.image(0,0,"gameplay_gui","boosters/plus_button_3"),this.plusButton.x=this.numLabel.x,this.plusButton.y=this.numLabel.y,this.add(this.plusButton)}shakeNumLabel(){this.numLabel.scale=1,this.scene.tweens.killTweensByProperty(this.numLabel,"scale"),this.scene.tweens.add({targets:this.numLabel,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.33,hold:200,yoyo:!0})}onRewardGranted(){this.scene.audio.play(u.TWINKLE_3,{volume:.5}),this.emitter.emitParticle(1,this.numLabel.x,this.numLabel.y),this.scene.tweens.killTweensOf(this.numLabel),this.numLabel.alpha=0,this.scene.tweens.add({targets:this.numLabel,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.numLabel.scale=2,this.scene.tweens.add({targets:this.numLabel,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}preDestroy(){super.preDestroy(),this._undoBooster.off(wt.NUM_CHANGED,this.onBoosterNumChange,this)}},zs;(function(e){e.PREGAME_BOOSTER="PREGAME_BOOSTER",e.BOOSTER="BOOSTER",e.OTHER="OTHER"})(zs||(zs={}));var D;(function(e){e.COINS="coins",e.LIVES="lives",e.STRIPES="stripes",e.BOMB="bomb",e.SUPER_SPHERE="super_sphere",e.UNDO="undo",e.GLOVE="glove",e.ROLLING_PIN="rolling_pin",e.LOLLIPOP="lollipop",e.EXTRA_MOVES="extra_moves"})(D||(D={}));var Oo=class{static isPregameBooster(e){return e===D.BOMB||e===D.STRIPES||e===D.SUPER_SPHERE}static getRewardByPregameBooster(e){return this.PREGAME_BOOSTERS_REWARDS_MAP[e]}static getPregameBoosterByReward(e){return Be(this.PREGAME_BOOSTERS_REWARDS_MAP,t=>t===e)}static getRewardByBooster(e){return this.BOOSTERS_REWARDS_MAP[e]}static getBoosterByReward(e){return Be(this.BOOSTERS_REWARDS_MAP,t=>t===e)}static getRewardNum(e){var t;return(t=window.game.config.video_rewards[e])!=null?t:0}static getVideoRewardScreenData(e,t){let s=Oo.getRewardNum(e),{title:i,description:a}=t.video_rewards[e];return{rewardType:e,rewardNum:s,title:i,description:a}}},Oe=Oo;Oe.SUBTYPES={[zs.PREGAME_BOOSTER]:[D.STRIPES,D.BOMB,D.SUPER_SPHERE],[zs.BOOSTER]:[D.UNDO,D.GLOVE,D.ROLLING_PIN,D.LOLLIPOP],[zs.OTHER]:[D.COINS,D.LIVES]},Oe.PREGAME_BOOSTERS_REWARDS_MAP={[W.STRIPES]:D.STRIPES,[W.BOMB]:D.BOMB,[W.SUPER_SPHERE]:D.SUPER_SPHERE},Oe.BOOSTERS_REWARDS_MAP={[I.UNDO]:D.UNDO,[I.GLOVE]:D.GLOVE,[I.ROLLING_PIN]:D.ROLLING_PIN,[I.LOLLIPOP]:D.LOLLIPOP};var X_=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="booster_icon",this.addIcon(),this.addBubble(),this.addLabel(),this.setSize(this.bubble.width,this.bubble.height)}addIcon(){this.icon=this.scene.add.image(0,0,"popups","popups/reward/bomb.png"),this.add(this.icon)}addBubble(){this.bubble=this.scene.add.image(0,0,"popups","popups/reward/booster_bubble.png"),this.add(this.bubble)}addLabel(){let e="x0";this.label=this.scene.add.bitmapText(0,0,B.PREGAME_BOOSTERS_LABELS,e,40),this.label.setOrigin(.5,.5),this.label.x=60,this.label.y=56,this.add(this.label)}updateData(e,t){let s=`popups/reward/${this.getIconFrameByRewardType(e)}.png`;this.icon.setFrame(s),this.label.text=`+${t}`}getIconFrameByRewardType(e){let t={[D.LIVES]:"lives",[D.EXTRA_MOVES]:"extra_moves",[D.COINS]:"coins",[D.STRIPES]:"stripes",[D.BOMB]:"bomb",[D.SUPER_SPHERE]:"super_sphere",[D.UNDO]:"undo",[D.GLOVE]:"glove",[D.ROLLING_PIN]:"rolling_pin",[D.LOLLIPOP]:"lollipop"};return t[e]||t[D.COINS]}startFloat(e=0){this.scene.tweens.add({targets:[this.bubble,this.icon],duration:600,ease:Phaser.Math.Easing.Sine.InOut,y:"-=10",delay:this.scene.tweens.stagger(133,{start:e}),yoyo:!0,repeat:-1})}},bo=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="reward_popup",this.addBack(),this.addTitleText(),this.addCloseButton(),this.addRewardBubble(),this.addTextBack(),this.addText(),this.addPlayButton(),this.bringToTop(this.rewardBubble),this.bringToTop(this.title),this.bringToTop(this.text),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/popup_back.png"),this.add(this.back)}addTitleText(){let e="Reward",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"40px",color:"#FFE0AD",align:"center",stroke:"#522923",strokeThickness:10};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.scale=Math.min(1,290/this.title.width),this.title.y=this.back.top+62,this.add(this.title)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46}addRewardBubble(){this.rewardBubble=new X_(this.scene),this.rewardBubble.y=-150,this.rewardBubble.startFloat(),this.add(this.rewardBubble)}addTextBack(){this.textBack=this.scene.add.image(0,0,"popups","popups/reward/Sale Background.png"),this.textBack.y=this.rewardBubble.y+this.textBack.height/2+24,this.add(this.textBack)}addText(){let e="Long reward description",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"40px",color:"#ffffff",align:"center",stroke:"#E69969",strokeThickness:8};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.lineSpacing=-8,this.text.y=this.textBack.y+22,this.text.setWordWrapWidth(this.textBack.width*.85,!0),this.adjustTextSize(),this.add(this.text)}adjustTextSize(){let e=this.textBack.height*.65;this.text.scale=Math.min(1,e/this.text.height)}addPlayButton(){this.playButton=new fe(this.scene,"popups","popups/Pink-Button-Long.png",this),this.playButton.addIcon("popups","popups/reward/watch ad.png",0,-20),this.playButton.y=204}updateData(e){this.name=`reward_popup_${e.rewardType}`,this.rewardType=e.rewardType,this.rewardNum=e.rewardNum,this.rewardBubble.updateData(this.rewardType,this.rewardNum),this.title.text=e.title,this.text.text=e.description,this.adjustTextSize()}onShow(){this.startAnimatingPlayButton()}onHide(){this.stopAnimatingPlayButton()}startAnimatingPlayButton(){this.playButtonAnimateEvent=this.scene.time.addEvent({repeat:-1,startAt:2500,delay:3e3,callback:this.shakePlayButton,callbackScope:this})}stopAnimatingPlayButton(){var e;(e=this.playButtonAnimateEvent)==null||e.remove(),this.scene.tweens.killTweensOf(this.playButton),this.playButton.scale=1,this.scene.tweens.killTweensOf(this.playButton.icon),this.playButton.icon.y=-20}shakePlayButton(){this.scene.tweens.add({targets:this.playButton,duration:600,ease:Phaser.Math.Easing.Quadratic.Out,scale:.83,onComplete:()=>{this.scene.tweens.add({targets:this.playButton,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})}}),this.scene.tweens.add({targets:this.playButton.icon,duration:600,ease:Phaser.Math.Easing.Quadratic.Out,y:"-=14",onComplete:()=>{this.scene.tweens.add({targets:this.playButton.icon,duration:1100,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],y:"+=14"})}})}},$_=class extends bo{constructor(e){super(e);this.playButton.kill(),this.addCoinsButton(),this.addVideoButton(),window.game.config.ads.rewarded===!1&&this.hideVideoButton()}addCoinsButton(){let e=window.game.config.second_chance_price,t=e.toString(),s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"35px",color:"#ffffff",align:"center"};this.coinsButton=new fe(this.scene,"popups","popups/second_chance/button_coins.png",this),this.coinsButton.addIcon("popups","popups/second_chance/coin.png",-44,-7),this.coinsButton.addText(t,s,36,this.coinsButton.icon.y-6),this.coinsButton.text.setShadow(0,3,"rgba(0,0,0,0.2)",0),this.coinsButton.x=-126,this.coinsButton.y=this.playButton.y+4,this.coinsButton.coinsNum=e}addVideoButton(){this.videoButton=new fe(this.scene,"popups","popups/second_chance/button_video.png",this),this.videoButton.addIcon("popups","popups/reward/watch ad.png",0,-26).setScale(.85),this.videoButton.x=126,this.videoButton.y=this.playButton.y+4}enableButtons(){this.videoButton.enableInput(),this.coinsButton.enableInput()}disableButtons(){this.videoButton.disableInput(),this.coinsButton.disableInput()}onShow(){this.showButtons({delay:200})}showButtons(e){[this.coinsButton,this.videoButton].forEach(t=>{t.alpha=0,this.scene.tweens.add({delay:e.delay,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let s=t.scale;t.scale=s*.75,this.scene.tweens.add({delay:e.delay,targets:t,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:s})})}onHide(){}hideVideoButton(){this.videoButton.kill(),this.coinsButton.x=0,this.coinsButton.scale=1.1,this.coinsButton.originalScale=this.coinsButton.scale}hideCoinsButton(){this.coinsButton.kill(),this.videoButton.x=0,this.videoButton.scale=1.1,this.videoButton.originalScale=this.coinsButton.scale}},Wi=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="label",this.options=t,this.addBack(),this.addCircleParticles(),this.addIcon(),this.addSparksParticles(),this.addText(),this.doSetSize()}addCircleParticles(){this.circlesParticles=this.scene.add.particles(this.options.atlas),this.circlesParticles.setPosition(this.options.iconOffset.x,this.options.iconOffset.y),this.add(this.circlesParticles),this.circlesEmitter=this.circlesParticles.createEmitter({frame:"particles/circle_fx_3",scale:{start:.5,end:2,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1600,on:!1})}addSparksParticles(){this.sparksManager=this.scene.add.particles(this.options.atlas),this.sparksManager.setPosition(this.options.iconOffset.x,this.options.iconOffset.y),this.add(this.sparksManager);let e=10;this.sparksEmitter=this.sparksManager.createEmitter({delay:{min:0,max:500,steps:e},frame:"particles/star_particle",lifespan:400,scale:{start:0,end:1,ease:gs.BellQuad},on:!1}),this.sparksEmitter.setEmitZone({source:new Phaser.Geom.Circle(0,0,this.icon.displayWidth*.5),type:"random",quantity:360}),this.sparksEmitter.reserve(e)}addBack(){this.back=this.scene.add.image(0,0,this.options.atlas,this.options.backFrame),this.back.setOrigin(0,.5),this.add(this.back)}addIcon(){this.icon=this.scene.add.image(0,0,this.options.atlas,this.options.iconFrame),this.icon.x+=this.options.iconOffset.x,this.icon.y+=this.options.iconOffset.y,this.add(this.icon)}addText(){this.text=this.createText(this.options.text),this.text.setOrigin(1,.5),this.text.originalX=this.text.x,this.add(this.text)}createText(e){let t="0000";return e.type==="text"?this.createCanvasText(t):this.createBitmapText(e,t)}createCanvasText(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#912D13",align:"center"},s=this.scene.add.text(0,0,e,t);return s.x=this.back.right-24,s.y=-2,s}createBitmapText(e,t){let s=this.scene.add.bitmapText(0,0,e.font,t,28);return s.x=this.back.right-24,s.y=2,s.setLetterSpacing(-1),s}doSetSize(){let e=this.icon.left,s=this.back.right-e;this.setSize(s,this.back.displayHeight)}setInteractive(){return super.setInteractive(),this.input.cursor="pointer",this.input.hitArea.x=this.icon.left+this.width/2,this}getTextContent(){return this.text.text}updateTextContent(e){this.text.text=e}playTextTween(){this.text.x=this.text.originalX,this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:this.text,duration:233,ease:Phaser.Math.Easing.Sine.InOut,x:this.text.originalX-12,yoyo:!0})}playAnimation(){this.circlesEmitter.emitParticle(1),this.sparksEmitter.explode(10,0,0),this.scene.tweens.add({targets:this.icon,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,yoyo:!0})}showTextFx(e){let t=this.createTextFx(e);t.setOrigin(.5,.5),t.setShadow(0,3,"rgba(0,0,0,0.33)",0,!0,!1),t.x=this.back.x+this.back.displayWidth/2+4,t.y=this.text.y+22,this.add(t),this.animateTextFx(t)}createTextFx(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#912D13",align:"center",stroke:"#FFCFB2",strokeThickness:5};return this.scene.add.text(0,0,e,t)}animateTextFx(e){e.alpha=0,this.scene.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({delay:1300,targets:e,duration:500,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{e.destroy()}})}}),e.scale=.5,this.scene.tweens.add({targets:e,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1}),this.scene.tweens.add({targets:e,duration:1800,ease:Phaser.Math.Easing.Linear,y:"+=25"})}},fs=class extends Wi{constructor(e,t){super(e,t);this.coinsNum=0,this.text.originalX=this.text.x}updateCoinsNumInstant(e){this.coinsNum=e,this.text.text=this.coinsNum.toLocaleString()}updateCoinsNum(e){var t;let s=this.coinsNum;this.coinsNum=e,(t=this.counterTween)==null||t.remove(),this.counterTween=this.scene.tweens.addCounter({from:s,to:e,onUpdate:i=>{let a=Math.round(i.getValue()).toLocaleString();this.updateTextContent(a)}})}shakeText(){var e;this.text.x=this.text.originalX,(e=this.shakeTextTween)==null||e.remove(),this.shakeTextTween=this.scene.tweens.add({targets:this.text,duration:33,ease:Phaser.Math.Easing.Sine.InOut,x:"-=10",yoyo:!0,repeat:3})}syncWithGameStore(e){let t=this.scene.game.store.getNumber(g.COINS);e?this.updateCoinsNumInstant(t):this.updateCoinsNum(t)}},wo=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name=t,this.addIcon(t),this.addText(s),this.setSize(this.icon.width,this.icon.height)}addIcon(e){let t=`popups/start_level/goals/${e.toLowerCase()}.png`;this.icon=this.scene.add.image(0,0,"popups",t),this.add(this.icon)}addText(e){let t=e.toString();this.text=this.scene.add.bitmapText(0,0,B.POPUP_GOAL_LABELS,t,29),this.text.setOrigin(.5,.5),this.text.x=30,this.text.y=30,this.add(this.text)}},q_=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="panel",this.addBack(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/goals_popup/Small Popup Background.png"),this.add(this.back)}updateData(e){this.goals&&(this.goals.destroy(),this.goals=null),this.addGoals(e)}addGoals(e){let t=120;this.goals=this.scene.add.container(0,0,this.createGoalViews(e)),this.goals.gridAlign({width:this.goals.length,cellWidth:t,cellHeight:t,position:Phaser.Display.Align.CENTER,x:t/2,y:t/2}),this.goals.setSize(this.goals.length*t,t),this.goals.x=-this.goals.width/2,this.goals.y=-this.goals.height/2-6,this.add(this.goals)}createGoalViews(e){return e.filter(t=>t.collectedNum!==t.targetNum).map(t=>new wo(this.scene,t.type,t.targetNum-t.collectedNum))}},Q_=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="pre_second_chance",this.addTitle(),this.addSubtitle(),this.addPanel(),this.doSetSize()}addTitle(){let e=this.scene.texts.out_of_moves.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"74px",color:"#FFDFAD",align:"center",stroke:"#8C463B",strokeThickness:14},s=E.SOURCE_GAME_WIDTH*.8;this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.setShadow(0,6,"rgba(0,0,0,0.25)",0,!0,!1),this.title.scale=Math.min(1,s/this.title.width),this.title.originalScale=this.title.scale,this.title.y=this.title.height/2,this.title.originalY=this.title.y,this.add(this.title)}addSubtitle(){let e=this.scene.texts.out_of_moves.subtitle,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#FFDFAD",align:"center"};this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.setShadow(0,4,"rgba(0,0,0,0.25)"),this.subtitle.y=this.title.y+this.title.displayHeight/2+22,this.subtitle.originalY=this.subtitle.y,this.add(this.subtitle)}addPanel(){this.panel=new q_(this.scene),this.panel.y=this.subtitle.y+100,this.panel.originalY=this.panel.y,this.add(this.panel)}doSetSize(){let e=this.title.top,s=this.panel.y+this.panel.height/2-e;this.setSize(this.panel.width,s)}updateData(e){this.panel.updateData(e)}show(){this.showTitle(0),this.showItems(1600)}showTitle(e){this.title.alpha=0,this.scene.tweens.add({delay:e,targets:this.title,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.title.scale=this.title.originalScale*.75,this.scene.tweens.add({delay:e,targets:this.title,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.title.originalScale,onComplete:()=>{this.startTitleAnimation()}}),this.title.y=this.height/2,this.scene.tweens.add({delay:e+1e3,targets:this.title,duration:600,ease:Phaser.Math.Easing.Back.InOut,y:this.title.originalY})}showItems(e){[this.subtitle,this.panel].forEach((s,i)=>{let a=e+i*100;s.alpha=0,this.scene.tweens.add({delay:a,targets:s,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),s.y=s.originalY+50,this.scene.tweens.add({delay:a,targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.6],y:s.originalY})})}startTitleAnimation(){this.scene.tweens.add({delay:700,targets:this.title,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:this.title.originalScale*.95,yoyo:!0,repeat:-1})}stopTitleAnimation(){this.scene.tweens.killTweensOf(this.title)}hide(){this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.stopTitleAnimation(),this.kill()}})}},Vt;(function(e){e.PROCEED="__PROCEED",e.SHOW_SHOP="__SHOW_SHOP"})(Vt||(Vt={}));var Z_=class extends ie{constructor(e){super(e,{name:"second_chance_screen",backgroundAlpha:.85,backgroundKey:"popups",backgroundFrame:"popups/black_rect.png"});this.isDeactivated=!1,this.gameplay=this.scene.gameplay,this.addOutOfMovesPopup(),this.addSecondChancePopup(),this.addCoinsLabel(),this.addShowFieldHint()}addOutOfMovesPopup(){this.outOfMovesPopup=new Q_(this.scene),this.add(this.outOfMovesPopup),this.pin(this.outOfMovesPopup,.5,.5,0,-this.outOfMovesPopup.height/2)}addSecondChancePopup(){let e=D.EXTRA_MOVES,t=this.scene.texts.second_chance,s={rewardType:e,rewardNum:Oe.getRewardNum(e),title:t.title,description:t.description};this.secondChancePopup=new $_(this.scene),this.secondChancePopup.updateData(s),this.secondChancePopup.coinsButton.on(_.PRESS,this.onCoinsButtonClick,this),this.secondChancePopup.videoButton.on(_.RELEASE,this.onVideoButtonClick,this),this.add(this.secondChancePopup),this.pin(this.secondChancePopup,.5,.5)}onCoinsButtonClick(e){let t=this.scene.game.store.getNumber(g.COINS),s=e.coinsNum;if(s>t){this.onNotEnoughCoins();return}let i=this.scene.game.store.changeNumber(g.COINS,-s);this.coinsLabel.updateCoinsNum(i),this.secondChancePopup.hideCoinsButton(),this.scene.analytics.subtractResource(ue.COINS,s,Te.COIN,`Level_${this.gameplay.levelNumber}.SecondChance`),this.giveSecondChance()}onNotEnoughCoins(){if(this.scene.game.purchases){this.emit(Vt.SHOW_SHOP,this);return}this.scene.audio.play(u.BOOSTER_CANT_USE),this.coinsLabel.shakeText()}onVideoButtonClick(){this.scene.game.ads.showRewardedAd("Gameplay:SecondChanceScreen").then(e=>{e&&(this.secondChancePopup.hideVideoButton(),this.giveSecondChance())})}giveSecondChance(){this.scene.audio.fadeInMusicLoop(500),this.secondChancePopup.disableButtons(),this.activateGameplay(),this.emit(Vt.PROCEED,this)}addCoinsLabel(){let e={atlas:"gameplay_gui",backFrame:"level_complete/labels/label_back",iconOffset:{x:0,y:0},iconFrame:"level_complete/labels/Coin_2",text:{type:"bitmap",font:B.LABELS_GAMEPLAY_GUI}};this.coinsLabel=new fs(this.scene,e),this.coinsLabel.syncWithGameStore(!0),this.pin(this.coinsLabel,0,0,70,66),this.add(this.coinsLabel),this.scene.game.purchases&&(this.coinsLabel.setInteractive(),this.coinsLabel.input.cursor="pointer",this.coinsLabel.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onCoinsLabelClick,this))}onCoinsLabelClick(){this.emit(Vt.SHOW_SHOP,this)}addShowFieldHint(){let e=this.scene.texts.second_chance.hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.25)",strokeThickness:8,padding:{x:20,y:20}};this.hint=this.scene.add.text(0,0,e,t),this.hint.setOrigin(.5,.5),this.hint.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.75,!0),this.hint.setLineSpacing(-12),this.hint.setInteractive(),this.hint.input.cursor="pointer",this.hint.name="show_board_text",this.hint.originalScale=1,this.add(this.hint)}resize(){super.resize(),this.coinsLabel.originalY=this.coinsLabel.y,this.secondChancePopup.originalY=this.secondChancePopup.y,this.resizeSecondChancePopup(),this.alignShowFieldHint()}resizeSecondChancePopup(){let e=this.screenHeight*.75;this.secondChancePopup.scale=Math.min(1,e/this.secondChancePopup.height),this.secondChancePopup.originalScale=this.secondChancePopup.scale}alignShowFieldHint(){let e=this.secondChancePopup.y+this.secondChancePopup.displayHeight/2-40,s=this.screenHeight-e;this.hint.x=this.screenWidth/2,this.hint.y=e+s/2,this.hint.originalY=this.hint.y}show(){var e;this.revive(),this.reset(),(e=this.scene.audio.play(u.OUT_OF_MOVES))==null||e.fade(0,.75,500),this.scene.audio.fadeOutMusicLoop(200),this.showBackground({duration:1e3,ease:m.QuadIn}),this.coinsLabel.kill(),this.secondChancePopup.kill(),this.hint.kill(),this.outOfMovesPopup.show();let t=this.scene.time.delayedCall(6e3,()=>{this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.hideOutOfMovesPopup()});this.scene.time.delayedCall(400,()=>{this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{t.remove(),this.hideOutOfMovesPopup()})})}reset(){this.alpha=1,this.outOfMovesPopup.alpha=1,this.outOfMovesPopup.revive()}hideOutOfMovesPopup(){this.fadeOutOfMovesSound(),this.outOfMovesPopup.hide(),this.scene.time.delayedCall(100,()=>{this.deactivateGameplay(),this.coinsLabel.revive(),this.secondChancePopup.revive(),this.hint.revive(),this.showCoinsLabel(),this.showItems(),this.hint.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.revealGameField,this)})}fadeOutOfMovesSound(){let e=this.scene.audio.get(u.OUT_OF_MOVES);e&&e.playing()&&e.fade(e.volume(),0,1e3)}showCoinsLabel(){this.coinsLabel.alpha=0,this.scene.tweens.add({targets:this.coinsLabel,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.coinsLabel.y=this.coinsLabel.originalY-50,this.scene.tweens.add({targets:this.coinsLabel,duration:400,ease:Phaser.Math.Easing.Cubic.Out,y:this.coinsLabel.originalY})}showItems(){[this.secondChancePopup,this.hint].forEach((t,s)=>{let i=s*100;t.alpha=0,this.scene.tweens.add({delay:i,targets:t,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.y=t.originalY+50,this.scene.tweens.add({delay:i,targets:t,duration:400,ease:Phaser.Math.Easing.Cubic.Out,y:t.originalY})}),this.secondChancePopup.onShow(),this.secondChancePopup.enableButtons()}revealGameField(){this.activateGameplay(),this.scene.audio.playClick(),this.scene.tweens.killTweensOf(this.list),this.scene.tweens.add({targets:this.background,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:.001}),this.scene.tweens.add({targets:this.coinsLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=50"}),this.scene.tweens.add({targets:[this.hint,this.secondChancePopup],duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=50"}),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.hideGameField,this)}hideGameField(){this.deactivateGameplay(),this.scene.tweens.killTweensOf(this.list),this.scene.tweens.add({targets:this.background,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.options.backgroundAlpha}),this.scene.tweens.add({targets:this.coinsLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({targets:this.coinsLabel,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.coinsLabel.originalY}),[this.secondChancePopup,this.hint].forEach((t,s)=>{let i=s*66;this.scene.tweens.add({delay:i,targets:t,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.y=t.originalY+50,this.scene.tweens.add({delay:i,targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,y:t.originalY})}),this.hint.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.revealGameField,this)}hideFast(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.secondChancePopup.onHide(),this.kill(),this.emitHideCompleteEvent()}})}hide(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.secondChancePopup.onHide(),this.kill(),this.emitHideCompleteEvent()}})}activateGameplay(){this.gameplay.scene.setActive(!0),this.gameplay.scene.setVisible(!0)}deactivateGameplay(){this.gameplay.scene.setActive(!1),this.gameplay.scene.setVisible(!1)}activate(){this.isDeactivated!==!1&&(this.isDeactivated=!1,this.coinsLabel.revive(),this.secondChancePopup.revive(),this.hint.revive())}deactivate(){this.isDeactivated||(this.isDeactivated=!0,this.coinsLabel.kill(),this.secondChancePopup.kill(),this.hint.kill())}},J_=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="goal",this.addBack(),this.addIcon(),this.addNumLabel(),this.addCross(),this.addCheck(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/level_failed/Cookie Background Box.png"),this.add(this.back)}addIcon(){this.icon=this.scene.add.image(0,0,"popups","popups/start_level/goals/apple.png"),this.add(this.icon)}addNumLabel(){let e="0/0";this.numLabel=this.scene.add.bitmapText(0,0,B.POPUP_GOAL_LABELS,e,28),this.numLabel.setOrigin(.5,.5),this.numLabel.y=this.back.bottom+25,this.add(this.numLabel)}updateData(e){this.icon.setFrame(`popups/start_level/goals/${e.type.toLowerCase()}.png`),this.numLabel.text=`${e.collectedNum}/${e.targetNum}`,e.collectedNum>=e.targetNum?this.check.revive():this.cross.revive()}addCross(){this.cross=this.scene.add.image(0,0,"popups","popups/level_failed/cross.png"),this.cross.x=this.back.right-8,this.cross.y=this.back.bottom-12,this.cross.kill(),this.add(this.cross)}addCheck(){this.check=this.scene.add.image(0,0,"popups","popups/level_failed/check.png"),this.check.x=this.back.right-8,this.check.y=this.back.bottom-13,this.check.kill(),this.add(this.check)}},ey=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.cellWidth=110,this.name="goals_panel",this.addViews(),this.alignViews(),this.updateSize()}addViews(){this.views=ke(3,()=>{let e=new J_(this.scene);return this.add(e),e})}alignViews(){this.gridAlign({cellWidth:this.cellWidth,width:this.views.length,position:Phaser.Display.Align.CENTER,x:this.cellWidth/2,y:this.views[0].height/2})}updateSize(){let e=this.views.filter(t=>t.visible).length;this.setSize(this.cellWidth*e,this.views[0].height)}updateData(e){this.updateViews(e),this.updateSize()}updateViews(e){this.views.forEach((t,s)=>{let i=e[s];i?(t.revive(),t.updateData(i)):t.kill()})}},ty=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="level_failed_popup",this.addBack(),this.addTitleText(),this.addLevelText(),this.addGoalsPanelBack(),this.addChef(),this.addTears(),this.addGoalsPanel(),this.addCloseButton(),this.alignGoalsPanel(),this.bringToTop(this.goalsPanel),this.bringToTop(this.tears),this.bringToTop(this.title),this.bringToTop(this.level),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/popup_small_back.png"),this.add(this.back)}addTitleText(){let e=this.scene.texts.level_failed,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"40px",color:"#FFE0AD",align:"center",stroke:"#522923",strokeThickness:10};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.scale=Math.min(1,290/this.title.width),this.title.y=-214,this.add(this.title)}addLevelText(){let e=this.getLevelTextContent(0),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"42px",color:"#B86D52",align:"center"};this.level=this.scene.add.text(0,0,e,t),this.level.setOrigin(.5,.5),this.level.x=112,this.level.y=-96,this.add(this.level)}getLevelTextContent(e){return this.scene.texts.level.replace("#",e.toString())}addGoalsPanelBack(){this.goalsPanelBack=this.scene.add.image(0,0,"popups","popups/level_failed/popup_panel_wide.png"),this.goalsPanelBack.scaleX=.99,this.goalsPanelBack.x=1.5,this.goalsPanelBack.y=46,this.add(this.goalsPanelBack)}addChef(){this.chef=this.scene.add.image(0,0,"popups","popups/level_failed/chef_sad.png"),this.chef.x=-190,this.chef.y=this.goalsPanelBack.bottom-10,this.add(this.chef)}addTears(){this.tears=this.scene.add.particles("popups"),this.add(this.tears),this.leftTears=this.createTearEmitter(),this.leftTears.setPosition(this.chef.x-10,0),this.rightTears=this.createTearEmitter(325),this.rightTears.setPosition(this.chef.x+53,5)}createTearEmitter(e=0){return this.tears.createEmitter({delay:e,frame:"popups/level_failed/tear.png",lifespan:1200,speedY:{min:40,max:60},gravityY:50,frequency:700,quantity:1,scale:{start:0,end:.3,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1})}addGoalsPanel(){this.goalsPanel=new ey(this.scene),this.goalsPanel.y=this.goalsPanelBack.y-this.goalsPanel.displayHeight/2-16,this.add(this.goalsPanel)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46}alignGoalsPanel(){let e=-90,s=this.goalsPanelBack.right-e;this.goalsPanel.x=e+(s-this.goalsPanel.displayWidth)/2}updateData(e){this.level.text=this.getLevelTextContent(e.levelNumber),this.updateGoalsPanel(e.goals)}updateGoalsPanel(e){this.goalsPanel.updateData(e),this.alignGoalsPanel()}onShow(){this.showChef(100),this.showTears(300)}showChef(e){this.chef.alpha=0,this.scene.tweens.add({delay:e,targets:this.chef,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.chef.scale=.8,this.scene.tweens.add({delay:e,targets:this.chef,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.playChefAnimation()}})}showTears(e){this.scene.time.delayedCall(e,()=>{this.leftTears.on=!0,this.rightTears.on=!0})}playChefAnimation(){this.scene.tweens.add({targets:this.chef,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.03,scaleY:.97,yoyo:!0,repeat:-1})}onHide(){this.leftTears.on=!1,this.rightTears.on=!1,this.tears.kill(),this.stopChefAnimation()}stopChefAnimation(){this.scene.tweens.killTweensOf(this.chef),this.chef.scale=1}},sy=class extends ie{constructor(e){super(e,{name:"level_failed_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.addPopup(),this.addBrokenHeart(),this.addRestartText()}addPopup(){this.popup=new ty(this.scene),this.add(this.popup),this.pin(this.popup,.5,.47)}addBrokenHeart(){this.brokenHeart=this.scene.add.image(0,0,"popups","popups/level_failed/broken_heart.png"),this.pin(this.brokenHeart,.5,.25),this.add(this.brokenHeart)}addRestartText(){let e=this.scene.texts.tap_to_continue,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"45px",color:"#FFCFB2",align:"center",padding:{x:40,y:40}};this.restartText=this.scene.add.text(0,0,e,t),this.restartText.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.66,!0),this.restartText.setLineSpacing(-5),this.restartText.setOrigin(.5,.5),this.restartText.setInteractive(),this.restartText.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onRestartTextClick,this),this.restartText.input.cursor="pointer",this.add(this.restartText)}onRestartTextClick(){this.scene.audio.playClick()}resize(){super.resize(),this.alignBrokenHeart(),this.alignRestartText()}alignBrokenHeart(){this.brokenHeart.y=this.popup.y-this.popup.displayHeight/2-10*this.scale,this.brokenHeart.originalY=this.brokenHeart.y}alignRestartText(){let e=this.popup.y+this.popup.displayHeight/2-54,s=this.screenHeight-e;this.restartText.x=this.screenWidth/2,this.restartText.y=e+s/2,this.restartText.originalY=this.restartText.y}updateData(e){this.popup.updateData(e)}show(e){e.smooth?this.showSmooth():this.showFast()}showSmooth(){this.onShow(),this.showBackground({duration:600,ease:m.Linear}),this.showPopupSmooth(200),this.showRestartTextSmooth(200),this.showBrokenHeart(600)}showPopupSmooth(e){this.popup.alpha=0,this.scene.tweens.add({delay:e,targets:this.popup,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.popup.y-=50,this.scene.tweens.add({delay:e,targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.6],y:"+=50"}),this.popup.onShow()}showRestartTextSmooth(e){this.restartText.alpha=0,this.scene.tweens.add({delay:e,targets:this.restartText,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.restartText.y+=50,this.scene.tweens.add({delay:e,targets:this.restartText,duration:500,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.6],y:"-=50",onComplete:()=>{this.animateRestartText()}})}showFast(){this.onShow(),this.showPopup(),this.showRestartText(),this.showBrokenHeart(200)}onShow(){var e;this.scene.onceKeyDown("SPACE",()=>{this.restartText.emit(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.restartText.disableInteractive()}),this.scene.audio.fadeOutMusicLoop(300),(e=this.scene.audio.play(u.LEVEL_FAILED))==null||e.fade(0,.66,1e3),this.emitShowEvent(),this.revive()}showPopup(){this.popup.onShow(),this.popup.alpha=0,this.scene.tweens.add({targets:this.popup,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.popup.scale=.85,this.scene.tweens.add({targets:this.popup,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.popup.y-=50,this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.Out,y:"+=50"})}showRestartText(){this.restartText.alpha=0,this.scene.tweens.add({targets:this.restartText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.restartText.scale=.85,this.scene.tweens.add({targets:this.restartText,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1,onComplete:()=>{this.animateRestartText({startAt:3e3})}}),this.restartText.y=this.restartText.originalY+50,this.scene.tweens.add({targets:this.restartText,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.restartText.originalY})}showBrokenHeart(e){this.brokenHeart.alpha=0,this.scene.tweens.add({delay:e,targets:this.brokenHeart,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.brokenHeart.y=this.brokenHeart.originalY,this.scene.tweens.add({delay:e,targets:this.brokenHeart,duration:3800,ease:Phaser.Math.Easing.Linear,y:"-=200"}),this.brokenHeart.scale=.66,this.scene.tweens.add({delay:e,targets:this.brokenHeart,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],scale:1,onComplete:()=>{this.scene.tweens.add({targets:this.brokenHeart,duration:500,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,scale:1.4,onComplete:()=>{this.scene.tweens.killTweensOf(this.brokenHeart),this.brokenHeart.kill()}})}})}hide(){this.scene.audio.fadeInMusicLoop(1e3),this.fadeOutFailedSound(),this.popup.onHide(),this.kill()}fadeOutFailedSound(){let e=this.scene.audio.get(u.LEVEL_FAILED);e&&e.fade(e.volume(),0,200)}animateRestartText(e={startAt:1500}){this.scene.time.addEvent({repeat:-1,delay:3e3,startAt:e.startAt,callback:this.shakeRestartText,callbackScope:this})}shakeRestartText(){this.scene.tweens.add({targets:this.restartText,duration:333,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,repeat:2,yoyo:!0})}preDestroy(){this.fadeOutFailedSound(),super.preDestroy()}},iy=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,t,s);this.angularVelocity=0,this.deltaScale=0,this.speedX=0,this.speedY=0}onEmit(){this.active=!0,this.visible=!0,this.scaleY=1,this.angularVelocity=Phaser.Math.RND.realInRange(.1,.15)*Phaser.Math.RND.sign(),this.deltaScale=this.angularVelocity/20,this.speedX=Phaser.Math.RND.realInRange(-.08,.08),this.speedY=Phaser.Math.RND.realInRange(.18,.3)}update(e){!this.visible||(this.x+=this.speedX*e,this.y+=this.speedY*e,this.angle+=this.angularVelocity*e,this.updateScale(e))}updateScale(e){this.scaleY+=this.deltaScale*e,this.scaleY<-1?(this.scaleY=-1,this.deltaScale*=-1):this.scaleY>1&&(this.scaleY=1,this.deltaScale*=-1)}},ay=class{constructor(e,t,s=100){this.timer=0,this.frequency=66,this.particlesEmitAmount=1,this.isPaused=!1,this.scene=e,this.parent=t,this.frames=[1,2,3].map(i=>`level_complete/confetti/particle_Confetti_${i}`),this.createParticles(s)}createParticles(e){this.particles=ke(e,t=>this.createNewParticle())}createNewParticle(){let e=Phaser.Math.RND.pick(this.frames),t=new iy(this.scene,"gameplay_gui",e);return t.kill(),this.parent.add(t),t}update(e){this.isPaused||(this.emit(e),this.updateParticles(e))}emit(e){this.timer+=e,this.timer>this.frequency&&(this.timer-=this.frequency,this.doEmit())}doEmit(){for(let e=0;e<this.particlesEmitAmount;e++){let t=this.particles.find(s=>s.active===!1);t||(t=this.createNewParticle(),this.particles.push(t)),t.x=Phaser.Math.RND.between(0,this.parent.screenWidth),t.y=0,t.onEmit()}}updateParticles(e){let t=50,s=-t,i=this.parent.screenWidth+t,a=this.parent.screenHeight+t;this.particles.forEach(n=>{!n.visible||(n.update(e),(n.x<s||n.x>i||n.y>a)&&n.kill())})}destroy(){this.particles.forEach(e=>e.destroy()),this.particles.length=0}hideInstant(){this.isPaused=!0,this.particles.forEach(e=>e.kill())}hide(e){this.scene.tweens.add({targets:this.particles,duration:e,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.isPaused=!0}})}},Me=class{static getEmitCircle(e,t,s){}static onEmitRandom(e,t){return{onEmit:()=>Phaser.Math.RND.realInRange(e,t)}}static getTextureEmitZone(e,t){let s=t.getTopLeft(),i,a,n;return{getRandomPoint:o=>{do i=Phaser.Math.Between(0,t.width),a=Phaser.Math.Between(0,t.height),n=e.textures.getPixel(i,a,t.texture.key);while(n.alpha<255);return o.setTo(i+s.x,a+s.y)}}}static getCircleEdgeEmitZone(e,t=360,s=!0){let a={source:new Phaser.Geom.Circle(0,0,e),type:"edge",quantity:t},n=o=>{let l=o.emitter,d=l.follow?l.follow.x:l.x.propertyValue,f=l.follow?l.follow.y:l.y.propertyValue;return Math.atan2(o.y-f,o.x-d)};return k(P({},s?{emitCallback:(o,l)=>{let d=l.emitZone;d.counter=Phaser.Math.RND.between(0,d.points.length)}}:{}),{emitZone:a,angle:{onEmit:o=>n(o)*Phaser.Math.RAD_TO_DEG},rotate:{onEmit:o=>(n(o)+Math.PI/2)*Phaser.Math.RAD_TO_DEG}})}},ny=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="star",this.addExplodeParticles(),this.addGlow(),this.addStar(),this.addIdleParticles(),this.setSize(this.star.displayWidth,this.star.displayHeight)}addExplodeParticles(){this.explodeParticles=this.scene.add.particles("gameplay_gui"),this.add(this.explodeParticles),this.explodeSparks=this.explodeParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(90,100)),{frame:"particles/particle_star_4",lifespan:3e3,speed:{min:80,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},on:!1}))}addIdleParticles(){this.idleParticles=this.scene.add.particles("gameplay_gui"),this.add(this.idleParticles),this.idleSparks=this.idleParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(80,100)),{frame:"particles/particle_star_4",lifespan:1400,speed:{min:50,max:100},alpha:{start:0,end:1,ease:m.ExpoOut},scale:{start:1.33,end:0},on:!1}))}addGlow(){this.glow=this.scene.add.image(0,0,"gameplay_gui","level_complete/star_glow"),this.glow.x=2,this.glow.y=2,this.glow.kill(),this.add(this.glow)}addStar(){this.star=this.scene.add.image(0,0,"gameplay_gui","level_complete/Star"),this.add(this.star)}show(e){this.showStar(e),this.showCirleFx(e),this.showGlow(e+800),this.scene.time.delayedCall(e+33,()=>{this.explodeSparks.explode(80,0,0)}),this.scene.time.delayedCall(e+1e3,()=>{this.idleSparks.flow(66)})}showStar(e){this.star.alpha=0,this.scene.tweens.add({delay:e,targets:this.star,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.star.scale=1.5,this.scene.tweens.add({delay:e,targets:this.star,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],scale:1}),this.scene.tweens.add({delay:e,targets:this,duration:800,ease:Phaser.Math.Easing.Sine.InOut,y:"-=10",yoyo:!0,repeat:-1})}showCirleFx(e){let t=this.scene.add.image(0,0,"gameplay_gui","level_complete/star_circle_fx");t.scale=0,this.addAt(t,0),this.scene.tweens.add({targets:t,duration:1600,ease:Phaser.Math.Easing.Quartic.Out,alpha:0,onComplete:()=>{t.destroy()}}),this.scene.tweens.add({delay:e,targets:t,duration:1600,ease:Phaser.Math.Easing.Expo.Out,scale:2.33})}showGlow(e){this.glow.revive(),this.glow.alpha=0,this.scene.tweens.add({delay:e,targets:this.glow,duration:1200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({targets:this.glow,duration:1e3,ease:Phaser.Math.Easing.Sine.InOut,alpha:.5,yoyo:!0,repeat:-1})}})}onCollect(){this.scene.tweens.killTweensOf(this),this.idleSparks.on=!1,this.idleSparks.killAll(),this.hideGlow()}hideGlow(){this.scene.tweens.killTweensOf(this.glow),this.scene.tweens.add({targets:this.glow,duration:200,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.glow.kill()}})}},ry=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.totalCoinsNum=0,this.name="earned_coins",this.addCoin(),this.addBaseCoinsText(),this.addBonusCoinsText()}addCoin(){this.coin=this.scene.add.image(0,0,"gameplay_gui","level_complete/coin_big"),this.add(this.coin)}addBaseCoinsText(){let e="100",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"44px",color:"#FCE916",align:"center"};this.baseCoinsText=this.scene.add.text(0,0,e,t),this.baseCoinsText.setShadow(0,4,"#AC4717"),this.baseCoinsText.setOrigin(.5,.5),this.baseCoinsText.y=this.coin.y+76,this.add(this.baseCoinsText)}addBonusCoinsText(){let e="+0",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#FCE916",align:"center"};this.bonusCoinsText=this.scene.add.text(0,0,e,t),this.bonusCoinsText.setShadow(0,2,"#AC4717"),this.bonusCoinsText.setOrigin(.5,.5),this.bonusCoinsText.x=this.baseCoinsText.x-3,this.bonusCoinsText.y=this.baseCoinsText.y+38,this.add(this.bonusCoinsText)}updateCoinsNum(e,t){this.baseCoinsText.text=e.toLocaleString(),this.bonusCoinsText.text="+"+t,this.bonusCoinsText.visible=t>0,this.totalCoinsNum=e+t}},oy=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.name="popover",this.addBack(t,s),this.addText(i),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addText(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(300,!0),this.text.scale=Math.min(1,110/this.text.height),this.text.y=this.back.top+83,this.add(this.text)}updateText(e){this.text.setText(e),this.text.scale=Math.min(1,110/this.text.height)}show(){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.hide(1600)}})}hide(e){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}},js;(function(e){e.EXPLODE_COMPLETE="__EXPLODE_COMPLETE"})(js||(js={}));var Po=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="big_gift",this.addBackRays(),this.addGift(),this.addGiftWhite(),this.addIdleParticles(),this.addShrinkParticles(),this.addExplodeParticles(),this.addTapHand(),this.bringToTop(this.gift),this.bringToTop(this.giftWhite),this.bringToTop(this.idleParticles),this.bringToTop(this.tapHand),this.setSize(this.gift.displayWidth,this.gift.displayHeight),this.scene.sys.updateList.add(this)}addBackRays(){let e=1.1,t=-80;this.backRays_1=this.scene.add.image(0,0,"rewards","rewards/reward_rays.png"),this.backRays_1.alpha=.5,this.backRays_1.scale=1.33*e,this.backRays_1.angle=22.5,this.backRays_1.y=t,this.backRays_1.kill(),this.add(this.backRays_1),this.backRays_2=this.scene.add.image(0,0,"rewards","rewards/reward_rays.png"),this.backRays_2.scale=e,this.backRays_2.y=t,this.backRays_2.kill(),this.add(this.backRays_2)}addIdleParticles(){this.idleParticles=this.scene.add.particles("rewards"),this.idleParticles.setPosition(0,-50),this.add(this.idleParticles),this.idleSparks=this.idleParticles.createEmitter({speed:50,frame:"rewards/particles/star_1.png",lifespan:{min:800,max:1400},rotate:{start:0,end:180,random:!0},angle:-90,scale:{start:1.33,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:m.ExpoOut},frequency:250,on:!1}),this.idleSparks.setEmitZone({source:new Phaser.Geom.Circle(0,0,this.gift.displayWidth*.42),type:"random",quantity:360})}addShrinkParticles(){this.shrinkParticles=this.scene.add.particles("rewards"),this.shrinkParticles.setPosition(0,-60),this.add(this.shrinkParticles),this.shrinkGravityWell=this.shrinkParticles.createGravityWell({power:10,epsilon:250,gravity:200}),this.shrinkCircles=this.shrinkParticles.createEmitter({frame:"rewards/particles/gift_circle_fx.png",alpha:{start:0,end:.33,ease:m.ExpoOut},scale:{start:6,end:.45,ease:m.Linear},lifespan:500,frequency:333,on:!1});let e=new Phaser.Geom.Circle(0,0,this.giftWhite.displayWidth);this.shrinkSparks=this.shrinkParticles.createEmitter({frame:"rewards/particles/wheel_reward_spark.png",lifespan:800,alpha:{start:0,end:1,ease:m.ExpoOut},scale:{start:1.33,end:.33},quantity:2,on:!1}).setDeathZone({source:new Phaser.Geom.Circle(0,0,e.radius*.25),type:"onEnter"}).setEmitZone({source:e,type:"random"})}addExplodeParticles(){this.explodeParticles=this.scene.add.particles("rewards"),this.explodeParticles.setPosition(0,-80),this.add(this.explodeParticles),this.explodeCircles=this.explodeParticles.createEmitter({frame:"rewards/particles/gift_circle_fx.png",alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:.45,end:8,ease:m.ExpoOut},lifespan:900,on:!1}),this.explodeSparks=this.explodeParticles.createEmitter({frame:"rewards/particles/wheel_reward_spark.png",lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1}),this.explodeSparks.reserve(100)}addGift(){this.gift=this.scene.add.image(0,0,"rewards","rewards/gift.png"),this.add(this.gift)}addGiftWhite(){this.giftWhite=this.scene.add.image(0,0,"rewards","rewards/gift_white.png"),this.giftWhite.setOrigin(this.gift.originX,this.gift.originY),this.giftWhite.kill(),this.add(this.giftWhite)}addTapHand(){this.tapHand=new ms(this.scene,"rewards","rewards/hand.png"),this.tapHand.kill(),this.tapHand.x=70,this.tapHand.y=70,this.add(this.tapHand)}show(){this.scene.audio.play(u.GIFT_REVEAL),this.showRays(0),this.showIdleSparks(0),this.showHand(400),this.scene.tweens.add({targets:this.gift,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.1,scaleY:.9,yoyo:!0,repeat:-1})}showRays(e){let t=this.backRays_1.alpha;this.backRays_1.revive(),this.backRays_1.alpha=0,this.scene.tweens.add({delay:e,targets:this.backRays_1,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:t});let s=this.backRays_2.alpha;this.backRays_2.revive(),this.backRays_2.alpha=0,this.scene.tweens.add({delay:e,targets:this.backRays_2,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:s})}showIdleSparks(e){this.idleSparks.on=!0}showHand(e){this.tapHand.revive(),this.tapHand.playAnimation(e)}explode(){this.idleSparks.on=!1,this.idleSparks.killAll(),this.idleParticles.kill(),this.shrinkSparks.on=!0,this.shrinkCircles.on=!0,this.hideRays(),this.hideHand(),this.shrinkGift(),this.shakeGift()}hideRays(){let e=[this.backRays_2,this.backRays_1];this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.backRays_1.kill(),this.backRays_2.kill()}})}hideHand(){this.tapHand.stopAnimation(),this.scene.tweens.add({targets:this.tapHand,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0})}shrinkGift(){var e;let t=1333;this.scene.tweens.killTweensOf(this.gift),(e=this.scene.audio.play(u.DOUBLE_SPHERES_CHARGE))==null||e.fade(0,1,t),this.scene.tweens.add({targets:this.gift,duration:100,ease:Phaser.Math.Easing.Linear,scaleX:1,scaleY:1,onComplete:()=>{this.scene.tweens.add({targets:[this.gift,this.giftWhite],duration:t,ease:Phaser.Math.Easing.Linear,scale:this.gift.scale*.6,onComplete:()=>{this.onShrinkComplete()}}),this.giftWhite.revive(),this.giftWhite.scaleX=this.gift.scaleX,this.giftWhite.scaleY=this.gift.scaleY,this.giftWhite.alpha=0,this.scene.tweens.add({targets:this.giftWhite,duration:t,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1})}})}shakeGift(){let e=[this.giftWhite,this.gift],t=33,s=7;this.giftShakeTween=this.scene.tweens.add({targets:e,duration:t,ease:Phaser.Math.Easing.Linear,x:`+=${s}`,onComplete:()=>{this.giftShakeTween=this.scene.tweens.add({targets:e,duration:t,ease:Phaser.Math.Easing.Sine.InOut,x:`-=${s*2}`,repeat:-1,yoyo:!0})}})}onShrinkComplete(){var e;(e=this.giftShakeTween)==null||e.remove(),this.gift.kill(),this.emit(js.EXPLODE_COMPLETE,this),this.scene.audio.play(u.GIFT_EXPLODE),this.shrinkParticles.kill(),this.shrinkSparks.on=!1,this.shrinkCircles.on=!1,this.explodeCircles.emitParticle(1),this.explodeSparks.emitParticle(100),this.scene.tweens.add({targets:[this.gift,this.giftWhite],duration:600,ease:Phaser.Math.Easing.Expo.Out,scale:3,alpha:0,y:"+=100",onComplete:()=>{this.gift.kill(),this.giftWhite.kill()}})}preUpdate(e,t){this.backRays_1.visible&&(this.backRays_2.angle+=t*.01,this.backRays_1.angle+=t*.01)}preDestroy(){super.preDestroy(),this.scene.sys.updateList.remove(this)}},Yi=class extends Phaser.GameObjects.Container{constructor(e){super(e);this._rewardNum=0,this.name="wheel_reward",this.addRays(),this.addItem(),this.addText(),this.setSize(this.item.width,this.item.height),this.scene.sys.updateList.add(this)}get rewardNum(){return this._rewardNum}get rewardType(){return this._rewardType}addRays(){this.backRays_1=this.scene.add.image(0,0,"rewards","rewards/reward_rays.png"),this.backRays_1.alpha=.5,this.backRays_1.scale=1.33,this.backRays_1.angle=22.5,this.add(this.backRays_1),this.backRays_2=this.scene.add.image(0,0,"rewards","rewards/reward_rays.png"),this.add(this.backRays_2)}addItem(){this.item=this.scene.add.image(0,0,"rewards",Yi.getFrameByType(R.BOMB)),this.add(this.item)}addText(){let e="+1",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"55px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.33)",strokeThickness:10};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.y=this.getTextPositionY(),this.add(this.text)}getTextPositionY(){return 114}updateView(e,t){this._rewardType=e,this._rewardNum=t,this.item.setFrame(Yi.getFrameByType(e)),this.text.text=`+${t}`}static getFrameByType(e){return{[R.SUPER_SPHERE]:"rewards/rewards/super_sphere.png",[R.LOLLIPOP]:"rewards/rewards/lollipop.png",[R.COINS]:"rewards/rewards/coin.png",[R.UNDO]:"rewards/rewards/undo.png",[R.GLOVE]:"rewards/rewards/glove.png",[R.STRIPES]:"rewards/rewards/stripes.png",[R.ROLLING_PIN]:"rewards/rewards/rolling_pin.png",[R.BOMB]:"rewards/rewards/bomb.png"}[e]}startFloat(e=0){let t=.06;this.floatTween=this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:this.scaleX+t,scaleY:this.scaleY-t,yoyo:!0,repeat:-1})}stopFloat(){var e;(e=this.floatTween)==null||e.remove(),this.floatTween=null,this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Cubic.Out,scaleX:1,scaleY:1})}hideTextAndRays(){this.scene.tweens.add({targets:[this.text,this.backRays_1,this.backRays_2],duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0})}preUpdate(e,t){this.visible&&(this.backRays_2.angle+=t*.01,this.backRays_1.angle+=t*.01)}showText(e){this.text.alpha=0,this.scene.tweens.add({delay:e,targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.text.scale=3,this.scene.tweens.add({delay:e,targets:this.text,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.4],scale:1})}showTextDoubled(e){this.text.alpha=0,this.scene.tweens.add({delay:e,targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.text.angle=-33,this.scene.tweens.add({delay:e,targets:this.text,duration:400,ease:Phaser.Math.Easing.Back.Out,angle:0}),this.text.scale=4,this.scene.tweens.add({delay:e,targets:this.text,duration:600,ease:Phaser.Math.Easing.Bounce.Out,easeParams:[1.4],scale:1})}setRewardNum(e){this._rewardNum=e,this.text.setText("+"+this._rewardNum)}moveToPoint(e,t){let s=this.createMoveCurve(e),i=666;return this.scene.tweens.add({delay:t,targets:this,duration:i,ease:Phaser.Math.Easing.Back.In,scale:.4}),this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Sine.InOut,angle:33*Phaser.Math.Sign(this.x-e.x),yoyo:!0}),this.scene.tweens.addCurveTween({delay:t,curve:s,duration:i,ease:Phaser.Math.Easing.Quadratic.InOut,target:this})}createMoveCurve(e){let s=Math.abs(e.x-this.x)*.33,i=e.x>this.x?this.x+s:this.x-s,a=[this.x,this.y,i,this.y+250,e.x,e.y];return new Phaser.Curves.Spline(a)}preDestroy(){super.preDestroy(),this.scene.sys.updateList.remove(this)}},hy=Phaser.Curves.Spline,Vi=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="gift_reward_"+t,this.rewardType=t,this.rewardNum=s,this.addItem(),this.addText(),this.addParticles(),this.setSize(this.item.width,this.item.height)}addItem(){let e=Yi.getFrameByType(this.rewardType);this.item=this.scene.add.image(0,0,"rewards",e),this.item.originalY=this.item.y,this.add(this.item)}addText(){let e=`+${this.rewardNum}`,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"48px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.33)",strokeThickness:10};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.y=114,this.text.originalY=this.text.y,this.add(this.text)}addParticles(){this.idleParticles=this.scene.add.particles("rewards"),this.idleParticles.setPosition(0,0),this.add(this.idleParticles);let e=10;this.idleSparks=this.idleParticles.createEmitter({angle:-90,speed:20,delay:{min:0,max:800,steps:e},frame:"rewards/particles/star_1.png",lifespan:500,scale:{start:0,end:1.25,ease:gs.Bell},on:!1}),this.idleSparks.setEmitZone({source:this.getSparksEmitZone(),type:"random",quantity:360})}getSparksEmitZone(){let e=this.item.displayWidth,t=this.item.displayHeight;return new Phaser.Geom.Rectangle(-e/2,-t/2,e,t)}showParticles(){this.idleSparks.explode(10,0,0)}startFloat(e){this.scene.tweens.add({delay:this.scene.tweens.stagger(100,{start:e}),targets:[this.item,this.text],duration:600,ease:Phaser.Math.Easing.Sine.InOut,y:"-=18",yoyo:!0,repeat:-1})}stopFloat(){this.scene.tweens.killTweensOf(this.item),this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:[this.item,this.text],duration:200,ease:Phaser.Math.Easing.Linear,y:e=>e.originalY})}hideText(){this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=10",onComplete:()=>{this.text.kill()}})}moveToPoint(e,t){let s=this.createMoveCurve(e),i=566;return this.scene.tweens.add({delay:t,targets:this,duration:i,ease:Phaser.Math.Easing.Back.In,scale:.4}),this.scene.tweens.add({delay:t,targets:this,duration:i,ease:Phaser.Math.Easing.Expo.In,alpha:0}),this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Sine.InOut,angle:33*Phaser.Math.Sign(this.x-e.x),yoyo:!0}),this.scene.tweens.addCurveTween({delay:t,curve:s,duration:i,ease:Phaser.Math.Easing.Quadratic.InOut,target:this})}createMoveCurve(e){let s=Math.abs(e.x-this.x)*.33,i=e.x>this.x?this.x+s:this.x-s,a=[this.x,this.y,i,this.y+250,e.x,e.y];return new hy(a)}},ly=class extends Wi{constructor(e,t){super(e,t);this.currentStars=0,this.targetStars=0}isGiftReady(){return this.currentStars>=this.targetStars}updateCurrentStars(e){this.currentStars=e,this.onStarsUpdate()}updateStarsNum(e,t){this.currentStars=e,this.targetStars=t,this.onStarsUpdate()}onStarsUpdate(){let e=this.currentStars>=this.targetStars?this.scene.texts.stars_gift.ready:`${this.currentStars}/${this.targetStars}`;this.updateTextContent(e)}},nn=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.parent=e,this.scene=e.scene,this.addBonusRewardButton(t.extraButtonText),this.addClaimRewardButton(t.claimButtonText)}addBonusRewardButton(e){let t=this.getButtonTextStyle();this.extraRewardButton=this.scene.add.complexButton("rewards","rewards/button_double.png",this.parent),this.extraRewardButton.addIcon("rewards","rewards/watch ad.png",135,-60).setScale(.9),this.extraRewardButton.addText(e,t,0,-3),this.extraRewardButton.text.setLineSpacing(-4),this.extraRewardButton.text.setWordWrapWidth(210,!0),this.extraRewardButton.kill(),this.extraRewardButton.originalY=this.extraRewardButton.y,this.parent.add(this.extraRewardButton),this.parent.pin(this.extraRewardButton,.5,.7)}addClaimRewardButton(e){let t=k(P({},this.getButtonTextStyle()),{fontSize:"31px"});this.claimButton=this.scene.add.complexButton("rewards","rewards/button_no.png",this.parent),this.claimButton.addText(e,t,0,-3),this.claimButton.text.setLineSpacing(-4),this.claimButton.text.setWordWrapWidth(160,!0),this.claimButton.kill(),this.claimButton.originalY=this.claimButton.y,this.parent.add(this.claimButton),this.parent.pin(this.claimButton,.5,.7,0,156)}getButtonTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#ffffff",align:"center",padding:{x:0,y:6},shadow:{offsetX:0,offsetY:3,fill:!0,color:"rgba(0,0,0,0.2)",blur:0}}}show(e){[this.extraRewardButton,this.claimButton].forEach((s,i)=>{let a=e+i*100;s.revive(),s.alpha=0,this.scene.tweens.add({delay:a,targets:s,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),s.scale=.75,this.scene.tweens.add({delay:a,targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1});let n=50;s.y=s.originalY+n,this.scene.tweens.add({delay:a,targets:s,duration:500,ease:Phaser.Math.Easing.Back.Out,y:s.originalY})})}hide(){let e=[this.extraRewardButton,this.claimButton];e.forEach(t=>t.disableInput()),this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=30",onComplete:()=>{this.extraRewardButton.kill(),this.claimButton.kill()}})}reset(){this.extraRewardButton.revive(),this.extraRewardButton.enableInput(),this.extraRewardButton.y=this.extraRewardButton.originalY,this.claimButton.revive(),this.claimButton.enableInput(),this.claimButton.y=this.claimButton.originalY}align(){this.parent.pinner.align(this.extraRewardButton,this.parent.screenWidth,this.parent.screenHeight,1),this.parent.pinner.align(this.claimButton,this.parent.screenWidth,this.parent.screenHeight,1)}},cy=class extends Wi{constructor(e,t){super(e,t);this.isFull=!1,this.coinsNum=0,this.coinsNum=this.getPiggyCoinsAmount()}hideCoinsText(){this.text.kill()}showFullText(){this.fullText=this.createCanvasText(this.scene.texts.piggy_bank.full),this.fullText.setOrigin(.5,.5),this.fullText.x=106,this.fullText.originalX=this.fullText.x,this.fullText.scale=Math.min(1,124/this.text.width),this.add(this.fullText)}getPiggyCoinsAmount(){return this.scene.game.store.getNumber(g.PIGGY_BANK_COINS)}syncWithGameStore(e){let t=this.getPiggyCoinsAmount();e?this.updateTextContent(t.toString()):this.updateCoinsNum(t)}updateCoinsNum(e){let t=this.coinsNum;this.coinsNum=e,this.scene.tweens.addCounter({from:t,to:e,onUpdate:s=>{let i=Math.round(s.getValue()).toLocaleString();this.updateTextContent(i)}})}rejectCoins(){this.shakeFullText(),this.animatePiggy()}shakeFullText(){this.fullText.x=this.fullText.originalX,this.scene.tweens.killTweensOf(this.fullText),this.scene.tweens.add({targets:this.fullText,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:"-=10",yoyo:!0,repeat:3})}animatePiggy(){this.scene.tweens.add({angle:-10,targets:this.icon,duration:300,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,yoyo:!0,repeat:0})}},Ki=Phaser.Curves.Spline,dy=Phaser.Math.DegToRad,Xs;(function(e){e.GOTO_NEXT_LEVEL="__GOTO_NEXT_LEVEL"})(Xs||(Xs={}));var uy=class extends ie{constructor(e){super(e,{name:"level_complete_screen",backgroundKey:"gameplay_gui",backgroundFrame:"black_rect",backgroundAlpha:.85});this.starPinY=.42,this.backgroundClicksNum=0,this.isNextLevelScheduled=!1,this.store=this.scene.game.store,this.giftsManager=this.scene.game.gifts,this.addTopLeftLabel(),this.addStarsLabel(),this.addLabelPopover(),this.addTitle(),this.addStarParticles(),this.addStar(),this.addEarnedCoins(),this.addChef(),this.addContinueText(),this.bringToTop(this.topLeftLabel),this.bringToTop(this.starsLabel),this.bringToTop(this.earnedCoinsLabel),this.bringToTop(this.titleText),this.bringToTop(this.continueText),this.bringToTop(this.labelPopover)}addTopLeftLabel(){var e;this.scene.game.piggyBank?this.addPiggyBankLabel():this.addCoinsLabel(),this.topLeftLabel=(e=this.coinsLabel)!=null?e:this.piggyBankLabel}addCoinsLabel(){let e={atlas:"gameplay_gui",backFrame:"level_complete/labels/label_back",iconOffset:{x:0,y:0},iconFrame:"level_complete/labels/Coin_2",text:{type:"bitmap",font:B.LABELS_GAMEPLAY_GUI}},t=this.scene.game.store.getNumber(g.COINS);this.coinsLabel=new fs(this.scene,e),this.coinsLabel.updateCoinsNumInstant(t),this.pin(this.coinsLabel,0,0,70,66),this.add(this.coinsLabel)}addPiggyBankLabel(){let e={atlas:"gameplay_gui",backFrame:"level_complete/labels/label_back",iconOffset:{x:0,y:-2},iconFrame:"level_complete/labels/piggy_icon",text:{type:"bitmap",font:B.LABELS_GAMEPLAY_GUI}};this.piggyBankLabel=new cy(this.scene,e),this.piggyBankLabel.syncWithGameStore(!0),this.pin(this.piggyBankLabel,0,0,70,66),this.add(this.piggyBankLabel),this.scene.game.piggyBank.isFull()&&(this.piggyBankLabel.isFull=!0,this.piggyBankLabel.hideCoinsText(),this.piggyBankLabel.showFullText(),this.piggyBankLabel.setInteractive(),this.piggyBankLabel.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPiggyBankLabelClick,this))}onPiggyBankLabelClick(){let e=this.scene.texts.piggy_bank.warning;this.labelPopover.x=this.piggyBankLabel.x+120,this.labelPopover.y=this.piggyBankLabel.y+18,this.labelPopover.updateText(e),this.labelPopover.show(),this.scene.audio.play(u.TAP)}addStarsLabel(){let e={atlas:"gameplay_gui",backFrame:"level_complete/labels/label_back",iconOffset:{x:0,y:-4},iconFrame:"level_complete/labels/Pink-Gift-Icon",text:{type:"text"}},t=this.giftsManager.getCurrentStars(),s=this.giftsManager.getTargetStars();this.starsLabel=new ly(this.scene,e),this.starsLabel.updateStarsNum(t,s),this.pin(this.starsLabel,1,0,-220,66),this.add(this.starsLabel),this.starsLabel.setInteractive(),this.starsLabel.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onStarsLabelClick,this)}onStarsLabelClick(){let e=this.scene.texts.stars_gift.collect_popover.replace("#",this.starsLabel.targetStars.toString());this.labelPopover.x=this.starsLabel.x,this.labelPopover.y=this.starsLabel.y+24,this.labelPopover.updateText(e),this.labelPopover.show(),this.scene.audio.play(u.TAP)}addLabelPopover(){let e="Popover Content";this.labelPopover=new oy(this.scene,"gameplay_gui","level_complete/popover",e),this.labelPopover.kill(),this.add(this.labelPopover)}addTitle(){let e=this.scene.texts.victory,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"68px",color:"#FCE916",align:"center",padding:{x:0,y:10}};this.titleText=this.scene.add.text(0,0,e,t),this.titleText.setOrigin(.5,.5),this.titleText.setShadow(0,4,"#AC4717",2),this.pin(this.titleText,.5,this.starPinY,0,-200),this.add(this.titleText)}addStarParticles(){this.starParticles=this.scene.add.particles("gameplay_gui"),this.add(this.starParticles),this.starEmitter=this.starParticles.createEmitter({frame:"particles/particle_star_4",frequency:16,alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:2,end:.1,ease:m.ExpoOut},lifespan:2666,speed:30,on:!1})}addStar(){this.star=new ny(this.scene),this.star.originalY=0,this.pin(this.star,.5,this.starPinY),this.add(this.star)}addEarnedCoins(){this.earnedCoinsLabel=new ry(this.scene),this.earnedCoinsLabel.originalY=0,this.pin(this.earnedCoinsLabel,.5,this.starPinY,0,210),this.add(this.earnedCoinsLabel)}addChef(){this.chef=this.scene.add.image(0,0,"gameplay_gui","level_complete/Chef Cherry"),this.pin(this.chef,.28,1,0,6),this.add(this.chef)}addContinueText(){let e=this.scene.texts.tap_to_continue,t=this.getTextStyle();this.continueText=this.scene.add.text(0,0,e,t),this.continueText.setOrigin(.5,.5),this.continueText.setWordWrapWidth(350,!0),this.continueText.setLineSpacing(-5),this.pin(this.continueText,.7,1,0,-80),this.add(this.continueText)}getTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#FFCFB2",align:"center"}}resize(){super.resize()}updateData(e){this.completeData=e,this.earnedCoinsLabel.updateCoinsNum(e.baseCoins,e.bonusCoins)}show(){this.revive();let e=300,t=800+e;this.scene.time.delayedCall(e,()=>{var s;(s=this.scene.audio.play(u.VICTORY))==null||s.fade(0,.66,300)}),this.scene.time.delayedCall(e+400,()=>{this.scene.audio.fadeInMusicLoop(1e3)}),this.showBackground({duration:300}),this.star.show(e),this.showTitle(t+200),this.showEarnedCoins(t+200),this.showTopLabels(t+350),this.showChef(t+350),this.showContinueText(t+550),this.showConfetti(),this.background.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.backgroundClicksNum++==0&&this.applyFastForward()})}applyFastForward(){this.scene.fastForward.start(2)}collectLevelRewards(){this.saveLevelRewards(),this.collectStar(),this.collectCoins(),this.hideTitle(),this.hideChef(),this.hideContinueText()}saveLevelRewards(){this.saveLevelCoins(),this.scene.game.store.changeNumber(g.GIFT_STARS_NUM,1),this.scene.analytics.addResource(ue.COINS,this.getEarnedCoinsNum(),Te.COIN,`Level_${this.scene.levelConfig.levelNumber}.Complete`)}saveLevelCoins(){let e=this.getEarnedCoinsNum();this.scene.game.piggyBank?this.scene.game.piggyBank.changeCoinsNum(e):this.scene.game.store.changeNumber(g.COINS,e)}getEarnedCoinsNum(){return this.completeData.baseCoins+this.completeData.bonusCoins}collectStar(){this.star.onCollect(),this.scene.time.delayedCall(300,()=>{var n;(n=this.scene.audio.play(u.POWERUP_FROM_CHEF))==null||n.fade(0,.75,100)});let e={x:this.star.x,y:this.star.y},t={x:this.starsLabel.x,y:this.starsLabel.y},s=new Ki([e.x,e.y,e.x+150,e.y-70,t.x,t.y]),i=800,a=200;this.scene.tweens.addCurveTween({delay:a,curve:s,target:this.star,duration:i,ease:m.QuadInOut,onUpdate:()=>{let n=16,r=Phaser.Math.RND.between(1,2);for(let o=0;o<r;o++){let l=this.star.x+Phaser.Math.RND.between(-n,n),d=this.star.y+Phaser.Math.RND.between(-n,n);this.starEmitter.emitParticle(r,l,d)}},onComplete:()=>{this.onStarCollectComplete()}}),this.scene.tweens.add({targets:this.star,duration:i+a,ease:Phaser.Math.Easing.Back.In,scale:.2,angle:360}),this.scene.tweens.add({delay:i+a-100,targets:this.star,duration:100,ease:Phaser.Math.Easing.Expo.In,alpha:0})}onStarCollectComplete(){this.scene.audio.play(u.TWINKLE_4,{volume:.25}),this.star.kill();let e=this.starsLabel.currentStars+1;if(this.starsLabel.updateCurrentStars(e),this.starsLabel.playTextTween(),this.starsLabel.playAnimation(),this.starsLabel.isGiftReady()){let s=this.giftsManager.getGiftRewards(3);this.giftsManager.saveRewards(...s),this.giftsManager.onGiftOpen(),this.scene.time.delayedCall(800,()=>{this.hideStarsLabel(),this.showGift(s),this.addRewardButtons(),this.addClaimRewardsText()})}}collectCoins(){this.hideEarnedCoins(),this.doCollectCoins()}hideEarnedCoins(){this.earnedCoinsLabel.alpha=1,this.earnedCoinsLabel.y=this.earnedCoinsLabel.originalY,this.scene.tweens.killTweensOf(this.earnedCoinsLabel),this.scene.tweens.add({delay:200,targets:this.earnedCoinsLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.earnedCoinsLabel.kill()}})}doCollectCoins(){let e=10,t=os(()=>{if(this.piggyBankLabel&&this.piggyBankLabel.isFull){this.piggyBankLabel.rejectCoins();return}this.topLeftLabel.syncWithGameStore(!1),this.topLeftLabel.playTextTween(),this.topLeftLabel.playAnimation()}),s=vt(e,()=>{this.scene.time.delayedCall(800,()=>{this.onLevelRewardsCollected()})}),i=this.piggyBankLabel&&this.piggyBankLabel.isFull?()=>this.collectSingleCoinWithReject(t,s):()=>this.collectSingleCoin(t,s);this.scene.time.addEvent({startAt:66,delay:66,repeat:e-1,callback:i})}collectSingleCoinWithReject(e,t){let s=this.scene.add.image(0,0,"gameplay_gui","level_complete/coin_big");s.x=this.earnedCoinsLabel.x,s.y=this.earnedCoinsLabel.y,s.kill(),this.add(s);let i={x:s.x,y:s.y},a={x:this.piggyBankLabel.x,y:this.piggyBankLabel.y+30},n=new Ki([i.x,i.y,i.x-150,i.y-70,a.x,a.y]),r=800,o=200;this.scene.tweens.addCurveTween({delay:o,curve:n,target:s,duration:r,ease:m.QuadInOut,onStart:()=>{s.revive()},onComplete:()=>{this.rejectCoin(s),e(),t()}}),this.scene.tweens.add({targets:s,duration:r+o,ease:Phaser.Math.Easing.Back.In,scale:.66,angle:360})}rejectCoin(e){let t=Phaser.Math.RND.between(23,100),s=dy(t),i=Phaser.Math.RND.between(70,150),a=Math.cos(s)*i,n=Math.sin(s)*i;this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Cubic.Out,scale:.5,x:e.x+a,y:e.y+n}),this.scene.tweens.add({targets:e,delay:400,duration:300,ease:Phaser.Math.Easing.Cubic.In,alpha:0,onComplete:()=>{e.destroy()}})}collectSingleCoin(e,t){let s=this.scene.add.image(0,0,"gameplay_gui","level_complete/coin_big");s.x=this.earnedCoinsLabel.x,s.y=this.earnedCoinsLabel.y,s.kill(),this.addAt(s,1);let i={x:s.x,y:s.y},a={x:this.topLeftLabel.x,y:this.topLeftLabel.y},n=new Ki([i.x,i.y,i.x-150,i.y-70,a.x,a.y]),r=800,o=200;this.scene.tweens.addCurveTween({delay:o,curve:n,target:s,duration:r,ease:m.QuadInOut,onStart:()=>{s.revive()},onComplete:()=>{s.destroy(),e(),t(),this.scene.gameplay.sounds.coinAdd()}}),this.scene.tweens.add({targets:s,duration:r+o,ease:Phaser.Math.Easing.Back.In,scale:.66,angle:360}),this.scene.tweens.add({delay:r+o-100,targets:s,duration:100,ease:Phaser.Math.Easing.Expo.In,alpha:0})}hideTitle(){this.scene.tweens.add({targets:this.titleText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=20",onComplete:()=>{this.titleText.kill()}})}hideChef(){this.scene.tweens.killTweensOf(this.chef),this.scene.tweens.add({targets:this.chef,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,x:"-=20",onComplete:()=>{this.chef.kill()}})}hideContinueText(){this.scene.tweens.killTweensOf(this.continueText),this.scene.tweens.add({targets:this.continueText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=20",onComplete:()=>{this.continueText.kill()}})}gotoNextLevel(){if(this.isNextLevelScheduled)return;this.isNextLevelScheduled=!0;let e=this.scene.analytics.getRemoteConfigValue(Ot.SKIP_FIRST_INTERSTITIAL)==="true",t=this.scene.levelConfig.levelNumber===1;if(e&&t){this.emit(Xs.GOTO_NEXT_LEVEL,this);return}this.scene.game.ads.showInterstitialAd("Gameplay:LevelCompleteScreen").finally(()=>{this.emit(Xs.GOTO_NEXT_LEVEL,this)})}showTitle(e){this.titleText.alpha=0,this.scene.tweens.add({delay:e,targets:this.titleText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let t=this.titleText.y;this.titleText.y=t-50,this.scene.tweens.add({delay:e,targets:this.titleText,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],y:t})}showEarnedCoins(e){this.earnedCoinsLabel.alpha=0,this.scene.tweens.add({delay:e,targets:this.earnedCoinsLabel,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let t=this.earnedCoinsLabel.y;this.earnedCoinsLabel.y=t+50,this.scene.tweens.add({delay:e,targets:this.earnedCoinsLabel,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],y:t})}showTopLabels(e){[this.topLeftLabel,this.starsLabel].forEach(s=>{s.alpha=0,this.scene.tweens.add({delay:e,targets:s,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let i=s.y;s.y=i-50,this.scene.tweens.add({delay:e,targets:s,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],y:i})})}showChef(e){this.chef.alpha=0,this.scene.tweens.add({delay:e,targets:this.chef,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.chef.scale=.75,this.scene.tweens.add({delay:e,targets:this.chef,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.chef.angle=-1,this.scene.tweens.add({targets:this.chef,duration:600,ease:Phaser.Math.Easing.Sine.InOut,angle:this.chef.angle*-1,yoyo:!0,repeat:-1})}showConfetti(){this.confetti=new ay(this.scene,this,100),this.scene.time.delayedCall(6e3,()=>{this.confetti.hide(600)})}showContinueText(e){this.continueText.alpha=0,this.scene.tweens.add({delay:e,targets:this.continueText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let t=this.continueText.y;this.continueText.y=t+50,this.scene.tweens.add({delay:e,targets:this.continueText,duration:400,ease:Phaser.Math.Easing.Back.Out,y:t,onComplete:()=>{this.onShowAnimationComplete()}}),this.scene.tweens.add({delay:e,targets:this.continueText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}onShowAnimationComplete(){this.scene.fastForward.stop(),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.backgroundClicksNum>=2?this.playCollectAnimations():(this.scene.onceKeyDown("SPACE",()=>{this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.playCollectAnimations()}),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.scene.offKeyDown("SPACE"),this.scene.audio.playClick(),this.playCollectAnimations()}))}playCollectAnimations(){this.starsLabel.disableInteractive(),this.labelPopover.hide(0),this.confetti.hideInstant(),this.completeData.isCompleteFirstTime?(this.collectLevelRewards(),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackgroundClick,this)):this.gotoNextLevel()}onBackgroundClick(){this.isGiftScheduled()||this.scene.game.device.os.iOS?this.applyFastForward():this.gotoNextLevel()}isGiftScheduled(){let{gifts:e}=this.scene.game,t=e.getCurrentStars(),s=e.getTargetStars();return t>=s}onLevelRewardsCollected(){this.starsLabel.isGiftReady()===!1&&this.gotoNextLevel()}hideLabelPopover(){this.scene.tweens.killTweensOf(this.labelPopover),this.scene.tweens.add({targets:this.labelPopover,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,y:"-=10",onComplete:()=>{this.labelPopover.kill()}})}hideTopLeftLabel(){this.scene.tweens.add({targets:this.topLeftLabel,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,y:"-=10",onComplete:()=>{this.topLeftLabel.kill()}})}hideStarsLabel(){this.scene.tweens.add({targets:this.starsLabel,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.starsLabel.kill()}})}showGift(e){this.gift=new Po(this.scene),this.gift.x=this.starsLabel.x,this.gift.y=this.starsLabel.y+22,this.gift.rewards=e,this.add(this.gift),this.gift.alpha=0,this.scene.tweens.add({targets:this.gift,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.gift.scale=.27,this.scene.tweens.add({targets:this.gift,delay:200,duration:600,ease:Phaser.Math.Easing.Linear,scale:1}),this.scene.tweens.add({targets:this.gift,duration:700,ease:Phaser.Math.Easing.Quadratic.InOut,angle:-20,onComplete:()=>{this.scene.tweens.add({targets:this.gift,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],angle:0})}}),this.scene.tweens.addCurveTween({curve:this.createGiftMoveCurve(this.gift),target:this.gift,ease:m.QuadInOut,duration:800,onComplete:()=>{this.onGiftShowComplete(this.gift)}}),this.scene.time.delayedCall(700,()=>{this.scene.audio.play(u.GIFT_DROP,{volume:.5})})}addRewardButtons(){let e={extraButtonText:this.scene.texts.rewards.bonus,claimButtonText:this.scene.texts.rewards.decline};this.rewardButtons=new nn(this,e),this.rewardButtons.align()}addClaimRewardsText(){let e=this.scene.texts.tap_to_continue,t=this.getTextStyle();this.claimRewardsText=this.scene.add.text(0,0,e,t),this.claimRewardsText.setOrigin(.5,.5),this.claimRewardsText.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.8,!0),this.claimRewardsText.setLineSpacing(-12),this.claimRewardsText.kill(),this.claimRewardsText.originalY=0,this.pin(this.claimRewardsText,.5,.87),this.add(this.claimRewardsText),this.pinner.align(this.claimRewardsText,this.screenWidth,this.screenHeight,1)}createGiftMoveCurve(e){let t={x:e.x,y:e.y},s={x:this.screenWidth/2,y:this.screenHeight*.6};return new Ki([t.x,t.y,t.x+100,t.y+150,s.x,s.y])}onGiftShowComplete(e){this.scene.fastForward.stop(),e.show(),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.hideTopLeftLabel(),this.hideLabelPopover(),e.once(js.EXPLODE_COMPLETE,this.showGiftRewards,this),e.explode(),this.scene.audio.play(u.FANCY_TAP),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.applyFastForward,this)})}showGiftRewards(e){this.scene.fastForward.stop(),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.giftRewards=this.addGiftRewards(e),window.game.config.ads.rewarded?(this.rewardButtons.show(400),this.rewardButtons.extraRewardButton.once(_.RELEASE,this.showBonusRewardVideo,this),this.rewardButtons.claimButton.once(_.PRESS,this.claimGiftRewards,this)):(this.showClaimRewardText(0),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.claimGiftRewards,this))}addGiftRewards(e){let t=this.getRewardPositions(e),s=e.rewards.map((i,a)=>{let n=t[a],r=new Vi(this.scene,i.type,i.num);return r.startFloat(a*100),r.alpha=0,this.scene.tweens.add({targets:r,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{r.showParticles()}}),r.scale=.66,this.scene.tweens.add({targets:r,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),r.x=e.x,r.y=e.y-100,this.scene.tweens.add({targets:r,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:n.x,y:n.y}),this.add(r),r});return this.bringToTop(e),s}getRewardPositions(e){let t={x:e.x,y:e.y-260},s=210;return[{x:t.x-s,y:t.y+30},t,{x:t.x+s,y:t.y+30}]}showBonusRewardVideo(){this.scene.game.ads.showRewardedAd("Gameplay:LevelCompleteScreen:GiftBonusButton").then(e=>{!e||(this.rewardButtons.hide(),this.addBonusReward(200),this.showClaimRewardText(500),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.claimGiftRewards,this),this.scene.audio.play(u.WHEEL_REWARD,{volume:.5}))})}addBonusReward(e){let t=this.getBonusRewardType(),s=this.getBonusRewardsNum(t);this.giftsManager.saveReward(t,s);let i=new Vi(this.scene,t,s);i.x=this.screenWidth/2,i.y=this.giftRewards[1].y+270,this.add(i),this.giftRewards.push(i),i.alpha=0,this.scene.tweens.add({delay:e,targets:i,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{i.startFloat(0),i.showParticles()}}),i.scale=.5,this.scene.tweens.add({delay:e,targets:i,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1});let a=i.y;i.y=a+50,this.scene.tweens.add({delay:e,targets:i,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],y:a})}getBonusRewardType(){let e=dt.getAllTypes(),t=this.giftRewards.map(i=>i.rewardType),s=Tt(e,...t);return Phaser.Math.RND.pick(s)}getBonusRewardsNum(e){var t;return(t=window.game.config.video_rewards[e])!=null?t:1}showClaimRewardText(e){this.claimRewardsText.revive(),this.claimRewardsText.alpha=0,this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.claimRewardsText.y=this.claimRewardsText.originalY+30,this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.claimRewardsText.originalY}),this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}claimGiftRewards(){this.rewardButtons.hide(),this.hideClaimRewardsText(),this.collectGiftRewards(),this.scene.game.toasts.dismissAll(),this.scene.audio.play(u.FANCY_TAP),this.scene.time.delayedCall(300,()=>{this.gotoNextLevel()})}hideClaimRewardsText(){this.scene.tweens.killTweensOf(this.claimRewardsText),this.scene.tweens.add({targets:this.claimRewardsText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=30",onComplete:()=>{this.claimRewardsText.kill()}})}collectGiftRewards(){this.scene.tweens.add({targets:this.giftRewards,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=30"})}preUpdate(e,t){var s;(s=this.confetti)==null||s.update(t)}preDestroy(){this.scene.fastForward.stop(),super.preDestroy()}destroy(){var e;(e=this.confetti)==null||e.destroy(),super.destroy()}},$s=class extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,"gameplay_gui",$s.FRAMES_MAP[v.COOKIE_RED])}setItemType(e,t){this.itemType=e,this.setFrame(this.getFrame(this.itemType,t))}getFrame(e,t){return $s.COOKIE_TYPES.includes(e)?this.getCookieFrame(e,t):$s.FRAMES_MAP[e]}getCookieFrame(e,t){let s=$s.FRAMES_MAP[e];switch(t){case T.VERTICAL_STRIPES:return s+"-Stripes-Vertical";case T.HORIZONTAL_STRIPES:return s+"-Stripes-Horizontal";case T.BOMB:return s+"-Bomb";default:return s}}},rn=$s;rn.COOKIE_TYPES=[v.COOKIE_BLUE,v.COOKIE_RED,v.COOKIE_YELLOW,v.COOKIE_PINK,v.COOKIE_ORANGE,v.COOKIE_PURPLE],rn.FRAMES_MAP={[v.LICORICE]:"goal_items/licorice/Cream-Choco",[v.BISCUIT]:"goal_items/biscuits/biscuit",[v.CANDY]:"goal_items/candy_bottle/candy",[v.APPLE]:"goal_items/apples_platter/apple",[v.DONUT]:"goal_items/donut_box/donut",[v.DROP_ITEM]:"goal_items/drop_items/cookie",[v.CHICK]:"goal_items/chick/chick",[v.MARSHMALLOW_BLUE]:"goal_items/marshmallows/marshmallow_blue",[v.MARSHMALLOW_RED]:"goal_items/marshmallows/marshmallow_red",[v.MARSHMALLOW_PURPLE]:"goal_items/marshmallows/marshmallow_purple",[v.MARSHMALLOW_PINK]:"goal_items/marshmallows/marshmallow_pink",[v.MARSHMALLOW_YELLOW]:"goal_items/marshmallows/marshmallow_yellow",[v.MARSHMALLOW_ORANGE]:"goal_items/marshmallows/marshmallow_orange",[v.MARSHMALLOW_COMMON]:"goal_items/marshmallows/marshmallow_common",[v.MARSHMALLOW_DOUBLE]:"goal_items/marshmallows/marshmallow_common",[v.CHOCOLATE_BLUE]:"goal_items/chocolate/chocolate-blue",[v.CHOCOLATE_RED]:"goal_items/chocolate/chocolate-red",[v.CHOCOLATE_PURPLE]:"goal_items/chocolate/chocolate-purple",[v.CHOCOLATE_PINK]:"goal_items/chocolate/chocolate-pink",[v.CHOCOLATE_YELLOW]:"goal_items/chocolate/chocolate-yellow",[v.CHOCOLATE_ORANGE]:"goal_items/chocolate/chocolate-orange",[v.CHOCOLATE_COMMON]:"goal_items/chocolate/chocolate",[v.CHOCOLATE_DOUBLE]:"goal_items/chocolate/chocolate",[v.CHOCOLATE_TRIPLE]:"goal_items/chocolate/chocolate",[v.COOKIE_BLUE]:"goal_items/cookies/Cube-Cookie-Blue",[v.COOKIE_RED]:"goal_items/cookies/Circle-Cookie-Red",[v.COOKIE_YELLOW]:"goal_items/cookies/Heart-Cookie-Yellow",[v.COOKIE_PINK]:"goal_items/cookies/Moon-Cookie-Pink",[v.COOKIE_ORANGE]:"goal_items/cookies/Polygon-Cookie-Orange",[v.COOKIE_PURPLE]:"goal_items/cookies/Donut-Cookie-Purple",[v.GUMMY_VERTICAL]:"goal_items/gummies/gummy_vertical",[v.GUMMY_VERTICAL_LARGE]:"goal_items/gummies/gummy_vertical_large",[v.GUMMY_HORIZONTAL]:"goal_items/gummies/gummy_horizontal",[v.GUMMY_HORIZONTAL_LARGE]:"goal_items/gummies/gummy_horizontal_large"};function te(e){return e.itemSuperType===c.COOKIE}function py(e){return e.itemSuperType===c.BISCUIT}function gy(e){return e.itemSuperType===c.GUMMY}function qs(e){return te(e)&&e.powerup===T.SUPER_SPHERE}function my(e){return e.itemSuperType===c.DROP_ITEM}function fy(e){return e.itemSuperType===c.MARSHMALLOW}var Ie=class{static toString(e){return`${e.itemType} [${e.column}, ${e.row}]`}},Lo=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.gameplay=this.scene.gameplay,this.gameplayCamera=this.gameplay.camera,this.createPool()}createPool(){let e={name:"goal_items",classType:rn,createCallback:t=>{t.setDepth(ee.GOAL_ITEMS),t.kill()}};this.pool=this.scene.add.group(e),this.pool.createItems(20)}create(e,t){let s=Be(Lo.TYPES_MAP,a=>a===e),i=this.pool.getFirstDead(!0);return i.setItemType(s,t),i.angle=0,i.alpha=1,i.scale=1,i.revive(),i}createFrom(e){let t=this.getPosition(e),s=te(e)?e.powerup:void 0,i=this.create(e.itemType,s);return i.x=t.x,i.y=t.y,i.angle=e.angle,i.scale=e.scale*this.gameplayCamera.zoom,i}getPosition(e){return this.gameplayCamera.getWorldPositionXY(e.x,e.y)}},Io=Lo;Io.TYPES_MAP={[v.BISCUIT]:h.BISCUIT,[v.LICORICE]:h.LICORICE_CHOCO,[v.CANDY]:h.CANDY_BOTTLE,[v.APPLE]:h.APPLES_PLATTER,[v.DONUT]:h.DONUT_BOX,[v.DROP_ITEM]:h.DROP_ITEM,[v.CHICK]:h.CHICK,[v.MARSHMALLOW_BLUE]:h.MARSHMALLOW_BLUE,[v.MARSHMALLOW_RED]:h.MARSHMALLOW_RED,[v.MARSHMALLOW_PURPLE]:h.MARSHMALLOW_PURPLE,[v.MARSHMALLOW_PINK]:h.MARSHMALLOW_PINK,[v.MARSHMALLOW_YELLOW]:h.MARSHMALLOW_YELLOW,[v.MARSHMALLOW_ORANGE]:h.MARSHMALLOW_ORANGE,[v.MARSHMALLOW_COMMON]:h.MARSHMALLOW_COMMON,[v.MARSHMALLOW_DOUBLE]:h.MARSHMALLOW_DOUBLE,[v.CHOCOLATE_BLUE]:h.CHOCOLATE_BLUE,[v.CHOCOLATE_RED]:h.CHOCOLATE_RED,[v.CHOCOLATE_PURPLE]:h.CHOCOLATE_PURPLE,[v.CHOCOLATE_PINK]:h.CHOCOLATE_PINK,[v.CHOCOLATE_YELLOW]:h.CHOCOLATE_YELLOW,[v.CHOCOLATE_ORANGE]:h.CHOCOLATE_ORANGE,[v.CHOCOLATE_COMMON]:h.CHOCOLATE_COMMON,[v.CHOCOLATE_DOUBLE]:h.CHOCOLATE_DOUBLE,[v.CHOCOLATE_TRIPLE]:h.CHOCOLATE_TRIPLE,[v.COOKIE_BLUE]:h.COOKIE_BLUE,[v.COOKIE_RED]:h.COOKIE_RED,[v.COOKIE_YELLOW]:h.COOKIE_YELLOW,[v.COOKIE_PINK]:h.COOKIE_PINK,[v.COOKIE_ORANGE]:h.COOKIE_ORANGE,[v.COOKIE_PURPLE]:h.COOKIE_PURPLE,[v.GUMMY_HORIZONTAL]:h.GUMMY_HORIZONTAL,[v.GUMMY_HORIZONTAL_LARGE]:h.GUMMY_HORIZONTAL_LARGE,[v.GUMMY_VERTICAL]:h.GUMMY_VERTICAL,[v.GUMMY_VERTICAL_LARGE]:h.GUMMY_VERTICAL_LARGE};var Ey=Phaser.Curves.Spline,Kt;(function(e){e.GOAL_ITEM_ARRIVED="__GOAL_ITEM_ARRIVED"})(Kt||(Kt={}));var vy=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.activeItems=[],this.factory=new Io(this.scene),this.goalsPanel=this.scene.topPanel.goalsPanel}onItemRelease(e){this.activeItems.push(e)}onItemArrive(e){hs(this.activeItems,e),this.emit(Kt.GOAL_ITEM_ARRIVED,e)}getActiveItemsNum(){return this.activeItems.length}collectItem(e){let t=this.factory.createFrom(e);this.onItemRelease(t),this.moveItemToPanel(t),t.itemType===v.DROP_ITEM&&this.emitParticles(t.x,t.y)}emitParticles(e,t){this.scene.emitters.goalItemSparks.setPosition(e,t),this.scene.emitters.goalItemSparks.explode(8,e,t),this.scene.emitters.goalItemCircles.explode(1,e,t)}collectCandy(e){let t=this.factory.getPosition(e),s=this.factory.create(h.CANDY_BOTTLE);s.x=t.x,s.y=t.y-66*this.scene.gameplay.camera.zoom,this.onItemRelease(s),s.alpha=0,this.scene.tweens.add({targets:s,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),s.scale=0,this.scene.tweens.add({targets:s,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1});let i=s.y-Phaser.Math.RND.between(60,80);this.scene.tweens.add({targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,y:i,onStart:()=>{this.emitParticles(s.x,i)},onComplete:()=>{this.moveItemToPanel(s)}})}collectApple(e,t){let s=this.factory.getPosition(t.getWorldPosition()),i=this.factory.create(h.APPLES_PLATTER);i.x=s.x,i.y=s.y,this.onItemRelease(i),this.scene.tweens.add({targets:i,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1.25}),this.scene.tweens.add({targets:i,duration:400,ease:Phaser.Math.Easing.Back.Out,x:i.x+Phaser.Math.RND.between(0,10)*Phaser.Math.RND.sign(),y:i.y+Phaser.Math.RND.between(25,35),onComplete:()=>{this.moveItemToPanel(i)}})}collectDonut(e){let t=this.factory.getPosition(e.getWorldPosition()),s=this.factory.create(h.DONUT_BOX);s.x=t.x,s.y=t.y,this.onItemRelease(s),this.scene.tweens.add({targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1.25}),this.scene.tweens.add({targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,y:s.y-Phaser.Math.RND.between(25,35),onComplete:()=>{this.moveItemToPanel(s)}})}collectGummy(e){let t=this.factory.getPosition(e.getWorldPosition()),s=this.factory.createFrom(e);s.x=t.x,s.y=t.y,this.onItemRelease(s),e.isHorizontal()&&this.scene.tweens.add({targets:s,duration:400,ease:Phaser.Math.Easing.Quadratic.Out,angle:90}),this.scene.tweens.add({targets:s,duration:500,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:s.scale*1.15,y:"-=24",onComplete:()=>{this.moveItemToPanel(s)}})}moveItemToPanel(e){let t=ut.getGoalType(e.itemType),s=this.goalsPanel.getViewByGoalType(t),i=s.getWorldPosition(),a=this.createMoveCurve(e,i),n=Phaser.Math.Clamp(a.getLength()*1.25,600,900),r=166,o=n-r;this.scene.tweens.add({targets:e,delay:o,duration:r,ease:Phaser.Math.Easing.Linear,alpha:0,scale:.66}),this.scene.tweens.add({targets:e,duration:333,ease:Phaser.Math.Easing.Sine.InOut,angle:e.angle+Phaser.Math.RND.between(-22,22),hold:100,yoyo:!0}),this.scene.tweens.addCurveTween({curve:a,duration:n,target:e,onComplete:()=>{s.decrementNum(),e.kill(),this.onItemArrive(e)}})}createMoveCurve(e,t){let s=[e.x,e.y,e.x+Phaser.Math.RND.between(25,50),e.y-Phaser.Math.RND.between(20,40),t.x,t.y];return new Ey(s)}},Ty=class{constructor(e){this.scene=e,this.manager=this.scene.add.particles("gameplay_gui"),this.manager.setDepth(ee.PARTICLES),this.isCanvasRenderer=this.scene.game.renderer.type===Phaser.CANVAS,this.createEmitters(),this.addGoalItemEmitters(),this.addChargeEmitters()}createEmitters(){this.powerupSparks=this.manager.createEmitter({speed:200,frame:"particles/particle_star_01",lifespan:{min:500,max:800},rotate:{min:0,max:180},scale:{start:1,end:.5},alpha:{start:1,end:0},on:!1}),this.powerupCircles=this.manager.createEmitter({frame:"particles/circle_fx_2",scale:{start:0,end:1.75,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1800,on:!1})}addGoalItemEmitters(){this.goalItemCircles=this.manager.createEmitter({frame:"particles/circle_fx_3",scale:{start:.6,end:1.75,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1800,on:!1}),this.goalItemSparks=this.manager.createEmitter(k(P({},Me.getCircleEdgeEmitZone(35)),{speed:50,frame:"particles/particle_star_01",lifespan:{min:500,max:900},scale:{start:1,end:.5},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1}))}createDummyEmitter(){return this.manager.createEmitter({maxParticles:0,on:!1,active:!1,visible:!1})}addChargeEmitters(){this.chargeEmitter=this.manager.createEmitter({frame:"particles/double_spheres_particle",frequency:16,alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:2,end:.1,ease:m.ExpoOut},lifespan:2666,speed:30,on:!1})}},_y=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="goals_popup",this.addBack(),this.addGoals(t)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/goals_popup/Small Popup Background.png"),this.add(this.back)}addGoals(e){let t=120;this.goals=this.scene.add.container(0,0,this.createGoalViews(e)),this.goals.gridAlign({width:this.goals.length,cellWidth:t,cellHeight:t,position:Phaser.Display.Align.CENTER,x:t/2,y:t/2}),this.goals.setSize(this.goals.length*t,t),this.goals.x=-this.goals.width/2,this.goals.y=-this.goals.height/2-6,this.add(this.goals)}createGoalViews(e){return e.map(t=>new wo(this.scene,t.type,t.targetNum))}},yy=class extends ie{constructor(e,t){super(e,{name:"goals_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.addPopup(t),this.addTitle()}addPopup(e){let t=ut.createGoalsArray(e);this.popup=new _y(this.scene,t),this.pin(this.popup,.5,.52),this.add(this.popup)}addTitle(){let e=this.scene.add.image(0,0,"popups","popups/goals_popup/Headline Flag.png"),t=this.createTitleText();this.title=this.scene.add.container(0,0,[e,t]),this.add(this.title)}createTitleText(){let e=this.scene.texts.collect,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"40px",color:"#ffffff",align:"center",strokeThickness:6,stroke:"#F66986"},s=this.scene.add.text(0,0,e,t);return s.setOrigin(.5,.5),s.scale=Math.min(1,190/s.width),s.y=-4,s}resize(){super.resize(),this.alignTitle()}alignTitle(){this.title.x=this.screenWidth/2,this.title.y=this.popup.y-this.popup.displayHeight/2-130}show(){this.emit(b.SHOW,this),this.revive(),this.showItems(),this.scene.time.delayedCall(170,()=>{this.scene.audio.play(u.WHOOSH_1,{volume:.44})}),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.forceHide,this),this.hideTimerEvent=this.scene.time.delayedCall(2e3,()=>{this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.forceHide,this),this.hide()})}showItems(){[this.title,this.popup].forEach((t,s)=>{let i=s*100;t.alpha=0,this.scene.tweens.add({delay:i,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.scale=.75,this.scene.tweens.add({delay:i,targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1});let a=100;t.y+=a,this.scene.tweens.add({delay:i,targets:t,duration:500,ease:Phaser.Math.Easing.Back.Out,y:t.y-a})})}forceHide(){this.hideTimerEvent.remove(),this.hide()}hide(){let e=[this.title,this.popup];this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Expo.Out,y:"-=30",alpha:0}),this.scene.tweens.add({delay:200,targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.emit(b.HIDE_COMPLETE,this),this.destroy()}})}},Ao=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);s?s.add(this):this.scene.add.existing(this),this.props=t,this.addBack(),this.addArrows(),this.addTitle(),this.addText(),this.addArrowsClickCallbacks(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){let{key:e,frame:t}=this.props.back;this.back=this.scene.add.image(0,0,e,t),this.back.setInteractive(),this.add(this.back)}addArrows(){let e=160,t=2;this.leftArrow=this.scene.add.button(this.props.leftArrow.key,this.props.leftArrow.frame,this),this.leftArrow.x=-e,this.leftArrow.y=t,this.rightArrow=this.scene.add.button(this.props.rightArrow.key,this.props.rightArrow.frame,this),this.rightArrow.x=e,this.rightArrow.y=t}addTitle(){let e={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#ffffff",align:"center",padding:{x:0,y:4}};this.title=this.scene.add.text(0,0,this.props.title,e),this.title.setOrigin(.5,.5),this.title.setStroke("#B52D43",8),this.title.setShadow(0,4,"rgba(0,0,0,0.15)",0,!0,!1),this.title.y=this.back.top+4,this.add(this.title)}addText(){let e=this.scene.game.scaler.quality,t=this.getGraphicsQualityName(e);this.text=this.scene.add.text(0,0,t,this.getTextStyle()),this.text.setOrigin(.5,.5),this.text.x=6,this.text.y=-2,this.add(this.text)}getTextStyle(){return{color:"#FFFFFF",fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"45px",align:"center",padding:{x:2,y:6},shadow:{fill:!0,blur:0,offsetY:3,color:"rgba(0,0,0,0.2)"}}}updateText(e){this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:this.text,duration:66,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.text.setText(e),this.adjustTextSize(),this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}})}adjustTextSize(){let e=this.leftArrow.right,i=(this.rightArrow.left-e)*.9;this.text.scale=Math.min(1,i/this.text.width)}updateTitle(e){this.title.setText(e)}disableArrowButtons(){this.leftArrow.disableInput(),this.rightArrow.disableInput()}enableArrowButtons(){this.leftArrow.enableInput(),this.rightArrow.enableInput()}addArrowsClickCallbacks(){this.leftArrow.on(_.PRESS,this.onArrowClick.bind(this,-1)),this.rightArrow.on(_.PRESS,this.onArrowClick.bind(this,1))}onArrowClick(e){let t=this.scene.game.scaler,s=Bt,i=s.indexOf(t.quality),a=Phaser.Math.Wrap(i+e,0,s.length),n=s[a];this.scene.game.store.saveValue(g.GRAPHICS_QUALITY,n),this.scene.game.store.saveValue(g.GRAPHICS_QUALITY_MANUALLY,!0),this.scene.game.scaler.setQuality(n),this.updateText(this.getGraphicsQualityName(n)),this.disableArrowButtons(),this.scene.time.delayedCall(300,()=>{this.enableArrowButtons()})}getGraphicsQualityName(e){return this.scene.texts.graphics_quality[e]}onLanguageChange(){let e=this.scene.texts.graphics_quality.title,t=this.getGraphicsQualityName(this.scene.game.scaler.quality);this.updateTitle(e),this.updateText(t)}},zi;(function(e){e.ARROW_PRESS="__ARROW_PRESS"})(zi||(zi={}));var Cy=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.disableArrows=!1,this.disableArrowsDuration=0,t?t.add(this):this.scene.add.existing(this)}addBack(e){this.back=this.scene.add.image(0,0,e.key,e.frame),this.add(this.back),e.interactive&&this.back.setInteractive()}addArrows(e){var t,s;typeof e.timeoutMs=="number"&&(this.disableArrows=!0,this.disableArrowsDuration=e.timeoutMs),this.leftArrow=this.scene.add.button(e.leftArrow.key,e.leftArrow.frame,this),this.leftArrow.x=-e.dx,this.leftArrow.y=(t=e.dy)!=null?t:0,this.leftArrow.on(_.PRESS,this.onArrowClick,this),this.rightArrow=this.scene.add.button(e.rightArrow.key,e.rightArrow.frame,this),this.rightArrow.x=e.dx,this.rightArrow.y=(s=e.dy)!=null?s:0,this.rightArrow.on(_.PRESS,this.onArrowClick,this)}onArrowClick(e){let t=e===this.leftArrow?-1:1;this.emit(zi.ARROW_PRESS,this,t),this.disableArrows&&(this.disableArrowButtons(),this.scene.time.delayedCall(this.disableArrowsDuration,()=>{this.enableArrowButtons()}))}addTitle(e){var t,s;this.title=this.scene.add.text(0,0,e.content,e.style),this.title.setOrigin(.5,.5),this.title.x=(t=e.dx)!=null?t:0,this.title.y=this.back.top+((s=e.dy)!=null?s:0),this.add(this.title)}addText(e){var t,s;this.text=this.scene.add.text(0,0,e.content,e.style),this.text.setOrigin(.5,.5),this.text.x=(t=e.dx)!=null?t:0,this.text.y=(s=e.dy)!=null?s:0,this.add(this.text)}updateText(e){this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:this.text,duration:66,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.text.setText(e),this.adjustTextSize(),this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}})}adjustTextSize(){let e=this.leftArrow.right,i=(this.rightArrow.left-e)*.9;this.text.scale=Math.min(1,i/this.text.width)}autoSetSize(){this.setSize(this.back.displayWidth,this.back.displayHeight)}disableArrowButtons(){var e,t;(e=this.leftArrow)==null||e.disableInput(),(t=this.rightArrow)==null||t.disableInput()}enableArrowButtons(){var e,t;(e=this.leftArrow)==null||e.enableInput(),(t=this.rightArrow)==null||t.enableInput()}},Sy=class extends Cy{constructor(e,t){super(e,t);this.addBack({key:"gameplay_gui",frame:"pause_screen/button_graphics_quality",interactive:!0}),this.addArrows({leftArrow:{key:"gameplay_gui",frame:"pause_screen/arrow_left"},rightArrow:{key:"gameplay_gui",frame:"pause_screen/arrow_right"},timeoutMs:200,dx:160,dy:2}),this.addTitle({content:this.scene.game.texts.texts.hint_delay.title,dy:4,style:{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#ffffff",align:"center",padding:{x:0,y:4},strokeThickness:8,stroke:"#9C1A2B",shadow:{color:"rgba(0,0,0,0.15)",blur:0,offsetY:4,fill:!1,stroke:!0}}}),this.addText({content:"2s",style:{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"45px",color:"#FFFFFF",align:"center",padding:{x:2,y:6},shadow:{fill:!0,blur:0,offsetY:3,color:"rgba(0,0,0,0.2)"}}}),this.autoSetSize()}},ji;(function(e){e.CLOSE="__CLOSE"})(ji||(ji={}));var Oy=class extends ie{constructor(e){super(e,{name:"pause_screen",backgroundAlpha:.9,backgroundKey:"gameplay_gui",backgroundFrame:"black_rect"});this.ignoreBackgroundClicks=!1,this.addCentralButtons(),this.addFeebackButton(),this.addWidgetButton(),this.addResumeText()}addCentralButtons(){let e=180,t=180;this.graphicsQualityButton=this.createGraphicsQualityButton(),this.graphicsQualityButton.title.setStroke("#9C1A2B",8),this.graphicsQualityButton.title.y-=2,this.graphicsQualityButton.y=-t,this.hintsButton=new Sy(this.scene,this),this.hintsButton.y=this.graphicsQualityButton.y+t,this.soundButton=this.scene.add.soundButton("gameplay_gui","pause_screen/button_sound_on","pause_screen/button_sound_off"),this.soundButton.x=-e,this.soundButton.y=t,this.musicButton=this.scene.add.musicButton("gameplay_gui","pause_screen/button_music_on","pause_screen/button_music_off"),this.musicButton.y=t,this.quitButton=new fe(this.scene,"gameplay_gui","pause_screen/button_quit"),this.quitButton.addIcon("gameplay_gui","pause_screen/broken_heart_icon",50,-50),this.quitButton.x=e,this.quitButton.y=t,this.buttons=[this.graphicsQualityButton,this.hintsButton,this.soundButton,this.musicButton,this.quitButton],this.buttonsContainer=this.scene.add.container(0,0,this.buttons),this.add(this.buttonsContainer),this.pin(this.buttonsContainer,.5,.5)}createGraphicsQualityButton(){let e={back:{key:"gameplay_gui",frame:"pause_screen/button_graphics_quality"},leftArrow:{key:"gameplay_gui",frame:"pause_screen/arrow_left"},rightArrow:{key:"gameplay_gui",frame:"pause_screen/arrow_right"},title:this.scene.texts.graphics_quality.title};return new Ao(this.scene,e)}addFeebackButton(){window.game.config.feedback_enabled===!1||this.scene.game.store.getCompletedLevelNumbers().length<3||(this.feedbackButton=this.scene.add.button("gameplay_gui","pause_screen/button_feedback",this),this.feedbackButton.on(_.RELEASE,this.onFeedbackButtonClick,this),this.add(this.feedbackButton),this.pin(this.feedbackButton,1,1,-75,-75))}onFeedbackButtonClick(){this.scene.game.feedbackWidget.show()}addWidgetButton(){let e=window.game.config.widget_button.pause_screen;e.enabled!==!1&&(this.widgetButton=this.scene.add.button("gameplay_gui",e.frame,this),this.widgetButton.on(_.RELEASE,this.onWidgetButtonClick,this),this.add(this.widgetButton),this.pin(this.widgetButton,1,1))}onWidgetButtonClick(){}addResumeText(){let e=this.scene.texts.tap_to_continue,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#ffffff",align:"center",padding:{x:30,y:10}};this.resumeText=this.scene.add.text(0,0,e,t),this.resumeText.setOrigin(.5,.5),this.resumeText.setWordWrapWidth(350,!0),this.resumeText.setLineSpacing(-5),this.resumeText.setInteractive(),this.resumeText.input.cursor="pointer",this.resumeText.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onResumeTextClick,this),this.pin(this.resumeText,.5,1,0,-75),this.add(this.resumeText)}onResumeTextClick(){this.scene.audio.playClick()}resize(){super.resize()}show(){this.emit(b.SHOW,this),this.alpha=1,this.revive(),this.showBackground(),this.showCentralButtons(),this.showResumeText(100),this.showFeedbackButton(200),this.showWidgetButton(200),this.resumeText.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.close,this),this.background.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackgroundClick,this)}showCentralButtons(){this.scene.tweens.killTweensOf(this.buttonsContainer),this.buttonsContainer.alpha=0,this.scene.tweens.add({targets:this.buttonsContainer,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.buttonsContainer.scale=.8,this.scene.tweens.add({targets:this.buttonsContainer,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}showResumeText(e){this.resumeText.alpha=0,this.scene.tweens.add({delay:e,targets:this.resumeText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.resumeText.scale=.8,this.scene.tweens.add({delay:e,targets:this.resumeText,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}showFeedbackButton(e){!this.feedbackButton||(this.feedbackButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.feedbackButton,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.feedbackButton.scale=.8,this.scene.tweens.add({delay:e,targets:this.feedbackButton,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}))}showWidgetButton(e){!this.widgetButton||(this.widgetButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.widgetButton,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.widgetButton.scale=.85,this.scene.tweens.add({delay:e,targets:this.widgetButton,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}))}close(){this.emit(ji.CLOSE,this),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.close,this),this.resumeText.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.close,this)}hide(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emitHideCompleteEvent()}})}onBackgroundClick(){this.ignoreBackgroundClicks||(this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackgroundClick,this),this.close())}activate(){var e,t;this.buttonsContainer.revive(),this.resumeText.revive(),(e=this.feedbackButton)==null||e.revive(),(t=this.widgetButton)==null||t.revive()}deactivate(){var e,t;this.buttonsContainer.kill(),this.resumeText.kill(),(e=this.feedbackButton)==null||e.kill(),(t=this.widgetButton)==null||t.kill()}},by=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.coinsNum=0,this.name="popover",this.addBack(t,s),this.addCoin(),this.addText(),this.addParticles(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addCoin(){this.coin=this.scene.add.image(0,0,"gameplay_gui","top_panel/bonus_coin"),this.coin.x=-30,this.coin.y=this.back.top+56,this.add(this.coin)}addText(){let e="0",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#B35F44",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(1,.5),this.text.y=this.coin.y,this.add(this.text)}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.add(this.particles),this.circles=this.particles.createEmitter({frame:"particles/circle_fx_3",scale:{start:.6,end:1.33,ease:m.ExpoOut},alpha:{start:.66,end:0,ease:m.ExpoOut},lifespan:1500,on:!1})}alignContent(e){let t=this.text.text;this.text.text=e.toString();let s=13,i=this.coin.width+this.text.width+s,a=(this.back.displayWidth-i)/2;this.coin.x=this.back.left+a+this.coin.displayWidth/2,this.text.x=this.back.right-a,this.text.originalX=this.text.x,this.text.text=t}onCoinArrive(e){this.coinsNum+=e,this.text.text=this.coinsNum.toFixed(0),this.scene.gameplay.sounds.coinAdd(),this.circles.emitParticle(1,this.coin.x,this.coin.y)}playBulgeAnimation(e){this.scene.tweens.add({delay:e,targets:this,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,yoyo:!0}),this.scene.tweens.add({delay:e+100,targets:this.coin,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.15,yoyo:!0}),this.scene.tweens.add({delay:e+100,targets:this.text,duration:233,ease:Phaser.Math.Easing.Sine.InOut,x:this.text.originalX+8,yoyo:!0})}},wy=Phaser.Curves.Spline,Qs;(function(e){e.COMPLETE="__COMPLETE"})(Qs||(Qs={}));var Py=class extends Phaser.Events.EventEmitter{constructor(e,t,s){super();this.coinsNum=0,this.coinValue=0,this.isHidden=!1,this.scene=e,this.screen=t,this.bonusCoinsPopover=s,this.addParticles(),this.coins=[]}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.screen.add(this.particles),this.circlesEmitter=this.particles.createEmitter({frame:"particles/circle_fx_3",scale:{start:.6,end:1.75,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1600,on:!1})}collect(e){let t=this.scene.gameplay.items.mainItems.filter(i=>te(i)&&i.hasPowerup());if(t.length===0){this.onAllCoinsCollected();return}this.coinsNum=t.length,this.coinValue=e/this.coinsNum;let s=vt(t.length,()=>{this.onAllCoinsCollected()});t.forEach((i,a)=>{let n=a*66;this.scene.time.delayedCall(n,()=>{this.convertPowerupToCoin(i,s)})})}convertPowerupToCoin(e,t){this.isHidden||this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Back.In,alpha:0,scale:0,onComplete:()=>{if(this.isHidden)return;e.kill();let{column:s,row:i,itemType:a}=e,r=this.scene.gameplay.itemsFactory.cookiesPool.getCookie(null);r.setItemType(a),r.column=s,r.row=i,r.alignToGrid(),r.revive(),r.alpha=0,this.scene.tweens.add({targets:r,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),r.scale=.66,this.scene.tweens.add({targets:r,duration:300,ease:Phaser.Math.Easing.Back.Out,scale:1});let o=this.scene.gameplay.camera.getWorldPositionXY(e.x,e.y),l=this.screen.pointToContainer(o),d=this.scene.add.image(0,0,"gameplay_gui","top_panel/bonus_coin_big");d.x=l.x,d.y=l.y,this.coins.push(d),this.screen.add(d),this.circlesEmitter.emitParticle(2,d.x,d.y),d.alpha=0,this.scene.tweens.add({targets:d,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),d.scale=.66,this.scene.tweens.add({targets:d,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.scene.tweens.add({targets:d,duration:400,ease:Phaser.Math.Easing.Back.Out,y:"-=60",onComplete:()=>{this.moveCoinToPopover(d,t)}}),this.scene.audio.play(u.TWINKLE_1,{volume:.4})}})}moveCoinToPopover(e,t){let s=this.createPowerupCoinCurve(e,this.bonusCoinsPopover),i=Math.max(600,s.getLength()*1.1);this.scene.tweens.add({targets:e,duration:i,ease:Phaser.Math.Easing.Cubic.In,scale:.71}),this.scene.tweens.addCurveTween({curve:s,duration:i,target:e,onComplete:()=>{this.bonusCoinsPopover.onCoinArrive(this.coinValue),hs(this.coins,e),e.destroy(),t()}})}createPowerupCoinCurve(e,t){let s={x:e.x,y:e.y},i={x:t.x+t.coin.x,y:t.y+t.coin.y},a=Math.abs(i.x-s.x),n=s.x+a*.5;return new wy([s.x,s.y,n,s.y+50,i.x,i.y])}onAllCoinsCollected(){this.coinsNum===0?this.emitCompleteEvent({delay:300}):(this.bonusCoinsPopover.playBulgeAnimation(0),this.emitCompleteEvent({delay:850}))}emitCompleteEvent(e){this.scene.time.delayedCall(e.delay,()=>{this.emit(Qs.COMPLETE,this)})}hide(){this.isHidden=!0,this.circlesEmitter.killAll(),this.coins.forEach(e=>{this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{e.destroy()}})})}},Zs;(function(e){e.COMPLETE="__COMPLETE"})(Zs||(Zs={}));var Ly=class extends Phaser.Events.EventEmitter{constructor(e,t,s){super();this.coinsNum=0,this.coinValue=0,this.scene=e,this.screen=t,this.bonusCoinsPopover=s,this.addParticles()}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.screen.add(this.particles),this.coinsEmitter=this.particles.createEmitter({moveToX:1,moveToY:1,frame:"top_panel/bonus_coin",lifespan:300,alpha:{start:0,end:1,ease:m.ExpoOut},scale:{start:0,end:1,ease:m.CubicOut},on:!1})}collect(e){this.coinsNum=Math.round(e/10),this.coinValue=e/this.coinsNum,this.emitCoinParticles(this.coinsNum)}emitCoinParticles(e){let{x:t,y:s}=this.getCollectPosition(),i=vt(e,this.onAllCoinsCollected.bind(this));this.coinsEmitter.moveToX.propertyValue=t,this.coinsEmitter.moveToY.propertyValue=s,this.coinsEmitter.onParticleDeath(()=>{this.bonusCoinsPopover.onCoinArrive(this.coinValue),i()}),this.timerEvent=this.scene.time.addEvent({delay:66,startAt:66,repeat:e-1,callback:()=>{this.coinsEmitter.emitParticle(1,this.bonusCoinsPopover.x,s-90)}})}getCollectPosition(){let{x:e,y:t}=this.bonusCoinsPopover;return e+=this.bonusCoinsPopover.coin.x,t+=this.bonusCoinsPopover.coin.y,{x:e,y:t}}onAllCoinsCollected(){this.coinsNum===0?this.emitCompleteEvent({delay:300}):(this.bonusCoinsPopover.playBulgeAnimation(0),this.emitCompleteEvent({delay:500}))}emitCompleteEvent(e){this.scene.time.delayedCall(e.delay,()=>{this.emit(Zs.COMPLETE,this)})}hide(){var e;this.coinsEmitter.killAll(),(e=this.timerEvent)==null||e.remove()}},Iy=class extends ie{constructor(e){super(e,{name:"precomplete_screen",backgroundKey:"gameplay_gui",backgroundFrame:"black_rect",backgroundAlpha:.001});this.forceHide=!1,this.addParticles(),this.addCompleteText(),this.addContinueText(),this.addBonusCoinsPopover(),this.moveCoinsCollector=new Ly(this.scene,this,this.coinsPopover),this.powerupCoinsCollector=new Py(this.scene,this,this.coinsPopover)}addParticles(){this.particles=this.scene.add.particles("gameplay_gui"),this.pin(this.particles,.5,.5),this.add(this.particles),this.circlesEmitter=this.particles.createEmitter({frame:"particles/circle_fx_2",scale:{start:.4,end:3,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:2e3,on:!1}),this.sparksEmitter=this.particles.createEmitter({frame:"particles/double_spheres_particle",lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1})}addCompleteText(){let e=this.scene.texts.level_complete.toUpperCase(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"74px",color:"#FFDFAD",align:"center",stroke:"#8C463B",strokeThickness:14};this.completeText=this.scene.add.text(0,0,e,t),this.completeText.setOrigin(.5,.5),this.completeText.setShadow(0,6,"rgba(0,0,0,0.25)",0,!0,!1),this.completeText.setWordWrapWidth(400),this.completeText.setLineSpacing(-12),this.add(this.completeText),this.pin(this.completeText,.5,.5)}addContinueText(){let e=this.scene.texts.tap_to_skip,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#FFDFAD",align:"center",stroke:"#8C463B",strokeThickness:5,padding:{x:4,y:10}};this.continueText=this.scene.add.text(0,0,e,t),this.continueText.setOrigin(.5,.5),this.continueText.setShadow(0,2,"#703A35",0,!0,!1),this.continueText.originalY=0,this.continueText.kill(),this.add(this.continueText),this.pin(this.continueText,.5,.9)}addBonusCoinsPopover(){this.coinsPopover=new by(this.scene,"gameplay_gui","top_panel/bonus_coins_popover"),this.add(this.coinsPopover)}resize(){super.resize(),this.alignBonusCoinsPopover()}alignBonusCoinsPopover(){let s=this.scene.topPanel.movesLabel.getWorldPosition(),i=this.pointToContainer(s);this.coinsPopover.x=i.x,this.coinsPopover.y=124}updateData(e){this._data=e}show(){var e,t;(e=this.scene.audio.play(u.LEVEL_PRE_COMPLETE))==null||e.fade(0,1,500),(t=this.scene.audio.play(u.LEVEL_PRE_COMPLETE_MUSIC))==null||t.fade(0,1,1200),this.scene.audio.fadeOutMusicLoop(100),this.revive(),this.showCompleteText(100),this.showParticles(100),this.coinsPopover.kill(),this.hideTimerEvent=this.scene.time.delayedCall(1400,()=>{this.hideCompleteText(()=>{this.onCompleteTextHideComplete()})}),this.scene.time.delayedCall(600,()=>{this.showContinueText(),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{var s;(s=this.hideTimerEvent)==null||s.remove(),this.forceHide=!0,this.hide()})})}showCompleteText(e){this.completeText.alpha=0,this.scene.tweens.add({delay:e,targets:this.completeText,duration:350,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.completeText.scale=.66,this.scene.tweens.add({delay:e,targets:this.completeText,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.6],scale:1}),this.scene.tweens.add({delay:e,targets:this.completeText,duration:800,ease:Phaser.Math.Easing.Sine.InOut,y:"-=10",yoyo:!0,repeat:-1})}showParticles(e){this.scene.time.delayedCall(e,()=>{this.circlesEmitter.explode(1,0,0),this.sparksEmitter.explode(100,0,0)})}showContinueText(){this.continueText.revive(),this.continueText.alpha=0,this.continueText.y=this.continueText.originalY+10,this.scene.tweens.add({targets:this.continueText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:this.continueText.originalY}),this.scene.tweens.add({targets:this.continueText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}hideCompleteText(e){this.scene.tweens.killTweensOf(this.completeText),this.scene.tweens.add({targets:this.completeText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=30",onComplete:()=>{this.completeText.kill(),e&&e()}})}onCompleteTextHideComplete(){if(!this.forceHide){if(this._data.powerupCoins===0&&this._data.moveCoins===0){this.hide();return}this.showCoinsPopover(0)}}showCoinsPopover(e){this.coinsPopover.revive(),this.coinsPopover.alignContent(this._data.moveCoins+this._data.powerupCoins),this.coinsPopover.alpha=0,this.scene.tweens.add({delay:e,targets:this.coinsPopover,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.coinsPopover.scale=.66,this.scene.tweens.add({delay:e,targets:this.coinsPopover,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1}),this._data.moveCoins>0?this.collectMoveCoins(e+100):this.collectPowerupCoins(e+100)}collectMoveCoins(e){this.scene.time.delayedCall(e,()=>{this.moveCoinsCollector.once(Zs.COMPLETE,this.collectPowerupCoins.bind(this,0)),this.moveCoinsCollector.collect(this._data.moveCoins)})}collectPowerupCoins(e){this.scene.time.delayedCall(e,()=>{this.powerupCoinsCollector.once(Qs.COMPLETE,this.onPowerupCoinsCollected,this),this.powerupCoinsCollector.collect(this._data.powerupCoins)})}onPowerupCoinsCollected(){this.hide()}hide(){var e;this.emitHideStartEvent(),(e=this.scene.audio.get(u.LEVEL_PRE_COMPLETE_MUSIC))==null||e.fade(1,0,1e3),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.moveCoinsCollector.off(Zs.COMPLETE),this.moveCoinsCollector.hide(),this.powerupCoinsCollector.off(Qs.COMPLETE),this.powerupCoinsCollector.hide(),this.completeText.visible&&this.hideCompleteText(),this.hideContinueText(),this.hideBonusCoinsPopover(),this.scene.time.delayedCall(300,()=>{this.kill(),this.emitHideCompleteEvent()})}hideContinueText(){this.scene.tweens.killTweensOf(this.continueText),this.scene.tweens.add({targets:this.continueText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=30",onComplete:()=>{this.continueText.kill()}})}hideBonusCoinsPopover(){this.scene.tweens.killTweensOf(this.coinsPopover),this.scene.tweens.add({targets:this.coinsPopover,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=30",onComplete:()=>{this.coinsPopover.kill()}})}preDestroy(){this.scene.audio.stop(u.LEVEL_PRE_COMPLETE_MUSIC),super.preDestroy()}},Ay=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.movesNum=5,this.showTimestamp=0,this.name="moves_warning",this.addMovesNumText(),this.addSubtitle(),this.setSize(this.movesNumText.width,this.movesNumText.height)}addMovesNumText(){let e=this.movesNum.toString(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"130px",color:"#FFDFAD",align:"center",stroke:"#8C463B",strokeThickness:14};this.movesNumText=this.scene.add.text(0,0,e,t),this.movesNumText.setOrigin(.5,.5),this.movesNumText.setShadow(0,6,"rgba(0,0,0,0.25)",0,!0,!1),this.movesNumText.originalY=this.movesNumText.y,this.add(this.movesNumText)}addSubtitle(){let e=this.scene.texts.moves,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"60px",color:"#FFDFAD",align:"center",stroke:"#8C463B",strokeThickness:14};this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.setShadow(0,6,"rgba(0,0,0,0.25)",0,!0,!1),this.subtitle.y=this.movesNumText.y+90,this.subtitle.originalY=this.subtitle.y,this.add(this.subtitle)}show(){this.revive(),this.showItems(),this.showTimestamp=Date.now(),this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.hide,this),this.hideTimerEvent=this.scene.time.delayedCall(2e3,()=>{this.hide()})}showItems(){[this.movesNumText,this.subtitle].forEach((t,s)=>{let i=s*100;t.alpha=0,this.scene.tweens.add({delay:i,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let a=30;t.y=t.originalY+a,this.scene.tweens.add({delay:i,targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,y:t.originalY})})}hide(){var e;Date.now()-this.showTimestamp<500||((e=this.hideTimerEvent)==null||e.remove(),this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.hide,this),this.scene.tweens.add({targets:this,duration:233,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,y:"-=20",onComplete:()=>{this.kill()}}))}preDestroy(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.hide,this),super.preDestroy()}},L;(function(e){e.MATCH="MATCH",e.GOALS="GOALS",e.MOVES="MOVES",e.CHEF="CHEF",e.UNDO="UNDO",e.BOOSTER="BOOSTER"})(L||(L={}));var xy=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="tutorial_text",this.addTip(),this.addBack(),this.addText(t),this.adjustBackSize(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addTip(){this.backTip=this.scene.add.image(0,0,"gameplay_gui","tutorial/tutorial_text_tip"),this.add(this.backTip)}addBack(){this.back=this.scene.add.image(0,0,"gameplay_gui","tutorial/tutorial_text_back"),this.back.setOrigin(0,.5),this.back.x=this.backTip.right-4,this.add(this.back)}addText(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setLineSpacing(-3),this.text.setWordWrapWidth(this.back.width*.9,!0),this.text.x=this.back.x+this.back.displayWidth/2+2,this.text.y=this.back.y-2,this.add(this.text)}adjustBackSize(){this.back.displayHeight=this.text.height+30}},By=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="chef",this.addBack(),this.addBorder(),this.addChef(),this.addBottomBorder(),this.setSize(this.border.displayWidth,this.border.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"gameplay_gui","tutorial/tutorial_chef_fill"),this.add(this.back)}addBorder(){this.border=this.scene.add.image(0,0,"gameplay_gui","tutorial/tutorial_chef_border"),this.add(this.border)}addChef(){this.chef=this.scene.add.image(0,0,"gameplay_gui","tutorial/chef"),this.chef.x=5,this.chef.y=this.back.bottom-10,this.add(this.chef)}addBottomBorder(){this.bottomBorder=this.scene.add.image(0,0,"gameplay_gui","tutorial/tutorial_chef_border_bottom"),this.bottomBorder.setOrigin(.5,1),this.bottomBorder.y=this.border.bottom,this.add(this.bottomBorder)}onShow(){this.chefTween=this.scene.tweens.add({targets:this.chef,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:.97,scaleY:1.05,yoyo:!0,repeat:-1})}preDestroy(){var e;(e=this.chefTween)==null||e.remove(),this.chefTween=null}},Xi=class extends ie{constructor(e,t){super(e,{name:"tutorial_screen",backgroundKey:"gameplay_gui",backgroundFrame:"black_rect",backgroundAlpha:.85,backgroundInteractive:!1});this.step=t,this.tutorialType=this.step.type,this.addMask(),this.addChef(),this.addText(),this.isCanvasRenderer=this.scene.game.rendererType===yt.CANVAS,this.isCanvasRenderer?(this.background.kill(),this.initRenderTextureSource(),this.addRenderTexture()):(this.background.mask=this.maskGraphics.createGeometryMask(),this.background.mask.invertAlpha=!0)}initRenderTextureSource(){var e;let t=this.scene.scene.get(M.GLOBAL);this.renderTextureSource=(e=t.blackRect)!=null?e:t.addBlackRect()}addRenderTexture(){this.renderTexture=this.scene.add.renderTexture(0,0,this.renderTextureSource.width,this.renderTextureSource.height),this.addAt(this.renderTexture,0)}addMask(){this.maskGraphics=this.createMaskGraphics()}createMaskGraphics(){switch(this.step.type){case L.MATCH:return this.createCellsMask(this.step.cells);case L.GOALS:return this.createBasicMask(L.GOALS,200,144,30);case L.MOVES:return this.createBasicMask(L.MOVES,154,82,30);case L.CHEF:return this.createCircleMask(L.CHEF,106);case L.UNDO:return this.createCircleMask(L.UNDO,95);case L.BOOSTER:return this.createBasicMask(L.BOOSTER,160,200,30)}}createCellsMask(e){let t=V_(e),s=t.width*y,i=t.height*y,a=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}});return a.fillRoundedRect(-y/2,-y/2,s,i,20),a.column=t.left,a.row=t.top,a.width=s,a.height=i,a.maskType=L.MATCH,a}createBasicMask(e,t,s,i=20){let a=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}});return a.fillRoundedRect(-t/2,-s/2,t,s,i),a.width=t,a.height=s,a.maskType=e,a}createCircleMask(e,t){let s=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}});return s.fillCircle(0,0,t),s.width=t*2,s.height=t*2,s.maskType=e,s}addChef(){this.chef=new By(this.scene),this.pin(this.chef,.25,this.getChefPositionY(this.maskGraphics.maskType)),this.add(this.chef)}getChefPositionY(e){switch(e){case L.MATCH:return .75;case L.BOOSTER:case L.UNDO:return .66;default:return .33}}addText(){let e=this.scene.texts.tutorial[this.step.textKey];this.text=new xy(this.scene,e),this.add(this.text)}resize(){super.resize(),this.updateRenderTexture(),this.alignMask(),this.eraseMask(),this.alignText()}updateRenderTexture(){!this.renderTexture||(this.renderTexture.envelop(this.screenWidth,this.screenHeight),this.renderTexture.x=this.screenCenter.x-this.renderTexture.displayWidth/2,this.renderTexture.y=this.screenCenter.y-this.renderTexture.displayHeight/2,this.renderTexture.clear(),this.renderTexture.draw(this.renderTextureSource,this.renderTexture.width/2,this.renderTexture.height/2))}alignMask(){switch(this.maskGraphics.maskType){case L.MATCH:this.alignCellsMask();break;case L.GOALS:this.alignGoalsMask();break;case L.MOVES:this.alignMovesMask();break;case L.CHEF:this.alignChefMask();break;case L.UNDO:this.alignUndoMask();break;case L.BOOSTER:this.alignBoosterMask();break;default:break}}alignCellsMask(){let{column:e,row:t}=this.maskGraphics,{x:s,y:i}=j(e,t),a=this.scene.gameplay.camera.getWorldPositionXY(s,i);this.maskGraphics.x=a.x,this.maskGraphics.y=a.y,this.maskGraphics.scale=this.scene.gameplay.camera.zoom}alignGoalsMask(){let e=this.scene.topPanel.goalsPanel,t=e.displayWidth/2+2,s=e.displayHeight/2+11;this.doAlignMask(e,t,s)}alignMovesMask(){let e=this.scene.topPanel.movesLabel,t=e.displayWidth/2-14,s=e.displayHeight/2-6;this.doAlignMask(e,t,s)}alignChefMask(){let e=this.scene.topPanel.chef;this.doAlignMask(e)}alignUndoMask(){let e=this.scene.undoButton;this.doAlignMask(e)}alignBoosterMask(){let e=this.step.boosterType,t=this.scene.boostersPanel.getIconByType(e);this.doAlignMask(t,0,20)}doAlignMask(e,t=0,s=0){let i=e.getWorldPosition(),a=this.scale;this.maskGraphics.x=i.x+t*a,this.maskGraphics.y=i.y+s*a,this.maskGraphics.scale=a}eraseMask(){if(!this.renderTexture)return;let e={x:this.maskGraphics.x,y:this.maskGraphics.y},t=this.pointToContainer(e),s=this.renderTexture.scale,i=(t.x-this.renderTexture.x)/s,a=(t.y-this.renderTexture.y)/s,n=this.maskGraphics.scale;this.maskGraphics.scale=this.getMaskEraseScale(s),this.renderTexture.erase(this.maskGraphics,i,a),this.maskGraphics.scale=n}getMaskEraseScale(e){return this.maskGraphics.maskType===L.MATCH?this.scene.gameplay.camera.zoom/this.scale/e:1/e}alignText(){this.text.x=this.chef.x+90,this.text.y=this.chef.y}show(){let e=this.step.showDelay;e===0?this.doShow():this.scene.time.delayedCall(e,()=>this.doShow())}doShow(){this.emitShowEvent(),this.revive(),this.showBackground(),this.showChef(),this.showText(100)}showChef(){this.chef.alpha=0,this.scene.tweens.add({targets:this.chef,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.chef.scale=.66,this.scene.tweens.add({targets:this.chef,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.chef.onShow()}showText(e){this.text.alpha=0,this.scene.tweens.add({delay:e,targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.text.scale=.66,this.scene.tweens.add({delay:e,targets:this.text,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onStart:()=>{this.scene.audio.play(u.WHOOSH_2,{volume:.25})}})}hide(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emitHideCompleteEvent()}})}preDestroy(){this.maskGraphics.destroy(),super.preDestroy()}},ky=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="hand",this.start=t,this.end=s,this.addHand()}addHand(){this.hand=this.scene.add.image(0,0,"gameplay_gui","tutorial/hand"),this.add(this.hand)}playAnimation(){var e,t,s;this.hand.alpha=0,(e=this.scene)==null||e.tweens.add({targets:this.hand,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.hand.scale=1.5,(t=this.scene)==null||t.tweens.add({targets:this.hand,duration:400,ease:Phaser.Math.Easing.Cubic.Out,scale:1}),this.hand.angle=30,(s=this.scene)==null||s.tweens.add({targets:this.hand,duration:400,ease:Phaser.Math.Easing.Cubic.Out,angle:0,completeDelay:200,onComplete:()=>{this.moveToEnd()}})}moveToEnd(){var e;let t=(this.end.x-this.start.x)*.85,s=(this.end.y-this.start.y)*.85;(e=this.scene)==null||e.tweens.add({targets:this.hand,duration:500,ease:Phaser.Math.Easing.Quadratic.InOut,x:t,y:s,completeDelay:200,onComplete:()=>{var i;(i=this.scene)==null||i.tweens.add({targets:this.hand,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,completeDelay:800,onComplete:()=>{this.hand.x=0,this.hand.y=0,this.playAnimation()}})}})}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}},My=class extends Xi{constructor(e,t){super(e,t);this.addHand()}addHand(){let{swapCell_1:e,swapCell_2:t}=this.step,s=j(e.x,e.y),i=j(t.x,t.y);this.hand=new ky(this.scene,s,i),this.hand.kill(),this.add(this.hand)}resize(){super.resize(),this.alignHand(),this.alignChef(),this.alignText()}alignHand(){let e=this.scene.gameplay.camera.getWorldPosition(this.hand.start),t=this.pointToContainer(e);this.hand.x=t.x+70,this.hand.y=t.y+80}alignChef(){let e=this.pointToContainer({x:this.maskGraphics.x,y:this.maskGraphics.y});this.chef.x=this.screenWidth*.25,this.chef.y=e.y-this.text.height/2-80}doShow(){super.doShow(),this.scene.time.delayedCall(300,()=>{this.hand.revive(),this.hand.playAnimation()})}},Ry=class extends Xi{constructor(e,t){super(e,t);this.addInteractiveZone(),this.addHand()}addInteractiveZone(){this.interactiveZone=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.interactiveZone.setInteractive(),this.interactiveZone.input.cursor="pointer",this.interactiveZone.alpha=.001,this.add(this.interactiveZone)}addHand(){this.hand=new ms(this.scene,"gameplay_gui","tutorial/hand"),this.hand.kill(),this.add(this.hand)}resize(){super.resize(),this.alignHitArea(),this.alignChef(),this.alignText(),this.alignHand()}alignHitArea(){let e=this.getBoosterIcon(),t=e.getWorldPosition(),s=this.pointToContainer(t);this.interactiveZone.displayWidth=e.displayWidth,this.interactiveZone.displayHeight=e.displayHeight,this.interactiveZone.x=s.x,this.interactiveZone.y=s.y}alignChef(){let e=this.pointToContainer({x:this.maskGraphics.x,y:this.maskGraphics.y});this.chef.x=this.screenWidth*.25,this.chef.y=e.y-this.text.height/2-140}alignHand(){let t=this.getBoosterIcon().getWorldPosition(),s=this.pointToContainer(t);this.hand.x=s.x+70,this.hand.y=s.y+80}getBoosterIcon(){let e=this.step.boosterType;return this.scene.boostersPanel.getIconByType(e)}doShow(){super.doShow(),this.scene.time.delayedCall(300,()=>{this.hand.revive(),this.hand.playAnimation()})}},Ny=class extends Xi{constructor(e,t){super(e,t);this.addInteractiveZone(),this.addHand()}addInteractiveZone(){this.interactiveZone=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.interactiveZone.setInteractive(),this.interactiveZone.input.cursor="pointer",this.interactiveZone.alpha=.001,this.add(this.interactiveZone)}addHand(){this.hand=new ms(this.scene,"gameplay_gui","tutorial/hand"),this.hand.kill(),this.add(this.hand)}resize(){super.resize(),this.alignHitArea(),this.alignChef(),this.alignText(),this.alignHand()}alignHitArea(){let e=this.scene.undoButton,t=e.getWorldPosition(),s=this.pointToContainer(t);this.interactiveZone.displayWidth=e.displayWidth,this.interactiveZone.displayHeight=e.displayHeight,this.interactiveZone.x=s.x,this.interactiveZone.y=s.y}alignChef(){let e=this.pointToContainer({x:this.maskGraphics.x,y:this.maskGraphics.y});this.chef.x=this.screenWidth*.25,this.chef.y=e.y-this.text.height/2-140}alignHand(){let t=this.scene.undoButton.getWorldPosition(),s=this.pointToContainer(t);this.hand.x=s.x+70,this.hand.y=s.y+80}doShow(){super.doShow(),this.scene.time.delayedCall(300,()=>{this.hand.revive(),this.hand.playAnimation()})}},Ae;(function(e){e.UP_LEFT="UP_LEFT",e.UP="UP",e.UP_RIGHT="UP_RIGHT",e.RIGHT="RIGHT",e.DOWN_RIGHT="DOWN_RIGHT",e.DOWN="DOWN",e.DOWN_LEFT="DOWNM_LEFT",e.LEFT="LEFT"})(Ae||(Ae={}));function xo(e){return e>-135&&e<=-45?Ae.UP:e>-45&&e<=45?Ae.RIGHT:e>45&&e<=135?Ae.DOWN:Ae.LEFT}var De=class{constructor(e,t){this.rows=e,this.columns=t,this.items=[];for(let s=0;s<e;s++)this.items[s]=new Array(t)}addRow(){this.items.push(new Array(this.columns)),this.rows++}removeRow(e){this.rows--,this.items.splice(e,1),this.items.forEach(t=>{t.forEach(s=>{s.row>e&&s.row--})})}addColumn(){this.items.forEach(e=>e.length++),this.columns++}removeColumn(e){this.columns--,this.items.forEach(t=>{t.splice(e,1),t.forEach(s=>{s.column>e&&s.column--})})}checkAt(e,t){return!!this.getAt(e,t)}getAt(e,t){var s;return(s=this.items[t])==null?void 0:s[e]}removeAt(e,t){var s;(s=this.items[t])==null||delete s[e]}removeAll(){this.items.forEach(e=>{for(let t=0;t<e.length;t++)delete e[t]})}add(e){return this.addAt(e.column,e.row,e)}addMultiple(...e){return e.map(t=>this.addAt(t.column,t.row,t))}addAt(e,t,s){return this.checkAt(e,t)?(""+e+t,!1):(this.items[t][e]=s,!0)}remove(e){this.removeAt(e.column,e.row)}toArray(){return this.items.flat()}toArrayUniq(){return ot(this.items.flat())}getNeighborAtDirection(e,t,s){switch(s){case Ae.UP_LEFT:return this.getAt(e-1,t-1);case Ae.UP:return this.getAt(e,t-1);case Ae.UP_RIGHT:return this.getAt(e+1,t-1);case Ae.RIGHT:return this.getAt(e+1,t);case Ae.DOWN_RIGHT:return this.getAt(e+1,t+1);case Ae.DOWN:return this.getAt(e,t+1);case Ae.DOWN_LEFT:return this.getAt(e-1,t+1);case Ae.LEFT:return this.getAt(e-1,t);default:return null}}getNeighborsAt(e,t){return{topLeft:this.getAt(e-1,t-1),top:this.getAt(e,t-1),topRight:this.getAt(e+1,t-1),right:this.getAt(e+1,t),bottomRight:this.getAt(e+1,t+1),bottom:this.getAt(e,t+1),bottomLeft:this.getAt(e-1,t+1),left:this.getAt(e-1,t)}}getOrthoNeighborsAt(e,t){return{top:this.getAt(e,t-1),right:this.getAt(e+1,t),bottom:this.getAt(e,t+1),left:this.getAt(e-1,t)}}getNeighborsArrayAt(e,t){return Object.values(this.getNeighborsAt(e,t))}getOrthoNeighborsArrayAt(e,t){return[this.getAt(e,t-1),this.getAt(e+1,t),this.getAt(e,t+1),this.getAt(e-1,t)]}forEach(e,t){this.items.forEach(s=>{s.forEach(e,t)})}filter(e,t){return this.items.flatMap(s=>s.filter(e,t))}map(e,t){return this.items.flatMap(s=>s.map(e,t))}find(e){let t;return this.items.some(s=>s.some(i=>{if(e(i))return t=i,!0})),t}getItemsByColumn(e){let t=[];for(let s=0;s<this.rows;s++){let i=this.getAt(e,s);i&&t.includes(i)===!1&&t.push(i)}return t}getItemsByRow(e){let t=[];for(let s=0;s<this.columns;s++){let i=this.getAt(s,e);i&&t.includes(i)===!1&&t.push(i)}return t}},Dy=[h.APPLES_PLATTER,h.COLOR_CAKE,h.GUMMY_HORIZONTAL,h.GUMMY_HORIZONTAL_LARGE,h.GUMMY_VERTICAL,h.GUMMY_VERTICAL_LARGE],Hy={[h.APPLES_PLATTER]:{width:2,height:2},[h.COLOR_CAKE]:{width:2,height:2},[h.GUMMY_HORIZONTAL]:{width:2,height:1},[h.GUMMY_HORIZONTAL_LARGE]:{width:3,height:2},[h.GUMMY_VERTICAL]:{width:1,height:2},[h.GUMMY_VERTICAL_LARGE]:{width:2,height:3}},ae=class{static addToArray(e,t){this.getPositions(t.column,t.row,{width:t.itemWidth,height:t.itemHeight}).forEach(s=>{e.addAt(s.column,s.row,t)})}static removeFromArray(e,t){this.getPositions(t.column,t.row,{width:t.itemWidth,height:t.itemHeight}).forEach(s=>{e.removeAt(s.column,s.row)})}static isMulticell(e){return Dy.includes(e)}static getSize(e){return Hy[e]}static getItemPositions(e){return this.getPositions(e.column,e.row,{width:e.itemWidth,height:e.itemHeight})}static getPositions(e,t,s){let i=[];for(let a=t;a<t+s.height;a++)for(let n=e;n<e+s.width;n++)i.push({column:n,row:a});return i}static getPositionsUnderItem(e){let t=e.column,s=e.row+e.itemHeight,i=[];for(let a=t;a<t+e.itemWidth;a++)i.push({column:a,row:s});return i}static getOrthoNeighborPositions(e){let t=e.column-1,s=e.column+e.itemWidth,i=e.row-1,a=e.row+e.itemHeight,n=[];for(let r=t+1;r<s;r++)n.push({column:r,row:i});for(let r=i+1;r<a;r++)n.push({column:s,row:r});for(let r=s-1;r>t;r--)n.push({column:r,row:a});for(let r=a-1;r>i;r--)n.push({column:t,row:r});return n}},Bo=class{constructor(e,t){this.bottomItems=new De(t,e),this.mainItems=new De(t,e),this.topItems=new De(t,e),this.generators=new De(t,e)}addItemsFromConfig(e,t){t.forEach(s=>{e.create(s)})}add(e){let t=this.getArrayByItemSuperType(e.itemSuperType);e.isMultiCell?ae.addToArray(t,e):t.add(e)}remove(e){let t=this.getArrayByItemSuperType(e.itemSuperType);e.isMultiCell?ae.removeFromArray(t,e):t.remove(e)}getArrayByItemSuperType(e){switch(e){case c.BISCUIT:return this.bottomItems;case c.LICORICE:case c.GUMMY_BLOCKER:return this.topItems;case c.GENERATOR:return this.generators;default:return this.mainItems}}swapItems(e,t){let{column:s,row:i}=e,{column:a,row:n}=t;e.column=a,e.row=n,this.mainItems.removeAt(a,n),this.mainItems.add(e),t.column=s,t.row=i,this.mainItems.removeAt(s,i),this.mainItems.add(t)}getItemsToDrop(){let e=t=>this.topItems.checkAt(t.column,t.row);return this.mainItems.filter(t=>t.isDroppable&&e(t)===!1)}save(){let e=this.bottomItems.toArray().map(a=>a.createSave()),t=this.mainItems.toArrayUniq().map(a=>a.createSave()),s=this.topItems.toArray().map(a=>a.createSave()),i=this.generators.toArray().map(a=>a.createSave());return[...e,...t,...s,...i]}restore(e,t){this.clear(),this.doRestore(e,t)}clear(){[this.bottomItems,this.mainItems,this.topItems,this.generators].forEach(t=>{t.forEach(s=>{te(s)?s.kill():s.destroy()}),t.removeAll()})}doRestore(e,t){t.forEach(s=>{let{column:i,row:a,itemType:n}=s;switch(s.itemSuperType){case c.BISCUIT:e.createBiscuit(i,a);break;case c.COOKIE:e.createCookie(i,a,n,s.powerup);break;case c.DROP_ITEM:e.createDropItem(i,a,n);break;case c.MARSHMALLOW:e.createMarshmallow(i,a,n,s.health);break;case c.CHOCOLATE:e.createChocolate(i,a,n,s.health);break;case c.DONUT_BOX:let r=e.createDonutBox(i,a,s.donutBoxState);r.wasJustOpened=s.wasJustOpened;break;case c.CANDY_BOTTLE:e.createCandyBottle(i,a);break;case c.APPLE_PLATTER:e.createApplePlatter(i,a,s.apples);break;case c.COLOR_CAKE:e.createColorCake(i,a,s.colorCakeContent);break;case c.LICORICE:e.createLicorice(i,a,n);break;case c.MYSTERY_BOX:e.createMysteryBox(i,a,n,s.content);break;case c.GENERATOR:e.createGenerator(i,a,s.options);break;case c.CHICK:e.createChick(i,a,n);break;case c.GUMMY:e.createGummy(i,a,n);break;case c.GUMMY_BLOCKER:e.createGummyBlocker(i,a,n);break;default:break}})}hasLicoriceOver(e){return this.hasLicoriceAt(e.column,e.row)}hasLicoriceAt(e,t){return this.topItems.checkAt(e,t)}getApplePlatters(){return ot(this.mainItems.filter(e=>e.itemSuperType===c.APPLE_PLATTER))}getColorCakes(){return ot(this.mainItems.filter(e=>e.itemSuperType===c.COLOR_CAKE))}getDonutBoxes(){return this.mainItems.filter(e=>e.itemSuperType===c.DONUT_BOX)}getGummies(){return ot(this.mainItems.filter(e=>e.itemSuperType===c.GUMMY))}getCookiesWithoutPowerups(){return this.mainItems.filter(e=>te(e)&&!e.powerup)}getCookiesWithPowerups(){return this.mainItems.filter(e=>te(e)&&!!e.powerup)}getRandomExistingCookieType(){let e=this.mainItems.filter(s=>te(s)&&s.powerup!==T.SUPER_SPHERE),t=ot(e.map(s=>s.itemType));return Phaser.Math.RND.pick(t)}getMostPopularExistingCookieType(){let e=this.mainItems.filter(a=>te(a)&&a.powerup!==T.SUPER_SPHERE),t=$r(e,"itemType"),s=Math.max(...Object.values(t));return Be(t,a=>a===s)}getLeastPopularExistingCookieType(){let e=this.mainItems.filter(a=>te(a)&&a.powerup!==T.SUPER_SPHERE),t=$r(e,"itemType"),s=Math.min(...Object.values(t));return Be(t,a=>a===s)}},zt;(function(e){e.VERTICAL_LINE="VERTICAL_LINE",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.NON_LINE="NON_LINE"})(zt||(zt={}));var He;(function(e){e[e.STRIPES=3]="STRIPES",e[e.BOMB=4]="BOMB",e[e.SUPER_SPHERE=5]="SUPER_SPHERE"})(He||(He={}));var ko=class{static createMatch(e,...t){let s=t.length;return{type:e,items:t,size:s,itemsType:t[0].itemType,result:this.getMatchResult(e,s),id:ko.MATCH_ID_COUNTER++}}static getMatchResult(e,t){return e===zt.NON_LINE?t===5||t===6?He.BOMB:He.SUPER_SPHERE:t===4?He.STRIPES:t>4?He.SUPER_SPHERE:null}static getDimensions(e){let t=Number.MAX_VALUE,s=Number.MIN_VALUE,i=Number.MAX_VALUE,a=Number.MIN_VALUE;return e.items.forEach(n=>{n.column>s&&(s=n.column),n.column<t&&(t=n.column),n.row<i&&(i=n.row),n.row>a&&(a=n.row)}),{width:s-t+1,height:a-i+1}}static sortMatchesBySize(e,t){if(e.size===t.size){let s=e.items[0],i=t.items[0];return s.row===i.row?s.column-i.column:s.row-i.row}return t.size-e.size}static sortMatchesByResult(e,t){return e.result-t.result}static getCollectPosition(e,t){let s;return e.items.sort(Ui),e.size===3?s=e.items[1]:e.size===4?s=t.bool()?e.items[1]:e.items[2]:e.type===zt.NON_LINE?s=this.getCentralItem(e):s=e.items[Math.floor(e.size/2)],{column:s.column,row:s.row}}static getCentralItem(e){let{items:t}=e,{column:s,row:i}=K_(t),a,n=Number.MAX_VALUE;for(let r=0;r<t.length;r++){let o=t[r],l=Phaser.Math.Distance.Squared(o.column,o.row,s,i);l<n&&(a=o,n=l)}return a}static toString(e){return`[${e.type}, size = ${e.size}, ${e.itemsType}, origin: {${e.items[0].column}, ${e.items[0].row}} ]`}},Es=ko;Es.MATCH_ID_COUNTER=0;var Ee=class{static findBestMatchOf(e,t){let{column:s,row:i,itemType:a}=t,n=e.filter(o=>o.itemType===a&&o.column>=s-4&&o.column<=s&&o.row>=i-4&&o.row<=i),r=this.findAll(e,n).filter(o=>o.items.includes(t)).sort(Es.sortMatchesByResult);return r[r.length-1]}static hasAny(e){return e.some(t=>{let{column:s,row:i,itemType:a}=t,n=this.getItemAt(e,s+1,i,a),r=n&&this.getItemAt(e,s+2,i,a);if(n&&r)return!0;let o=this.getItemAt(e,s,i-1,a),l=o&&this.getItemAt(e,s,i-2,a);if(o&&l)return!0})}static getItemAt(e,t,s,i){return e.find(a=>a.column===t&&a.row===s&&a.itemType===i)}static findAll(e,t){let s=[];return t=t!=null?t:e,t.forEach(i=>{let{column:a,row:n,itemType:r}=i,o=this.getItemAt(e,a+1,n,r),l=o&&this.getItemAt(e,a+2,n,r);o&&l&&s.push(Es.createMatch(zt.HORIZONTAL_LINE,i,o,l));let d=this.getItemAt(e,a,n+1,r),f=d&&this.getItemAt(e,a,n+2,r);d&&f&&s.push(Es.createMatch(zt.VERTICAL_LINE,i,d,f))}),this.combineOverlappingMatches(s),s}static combineOverlappingMatches(e){let t=!1;for(let s=e.length-1;s>=0;s--){let i=e[s],a=e.find(n=>n!==i&&n.itemsType===i.itemsType&&this.hasCommonItems(n,i));a&&(t=!0,e.splice(s,1),this.combineMatches(a,i))}t&&this.combineOverlappingMatches(e)}static hasCommonItems(e,t){return e.items.some(s=>t.items.includes(s))}static combineMatches(e,t){Phaser.Utils.Array.Add(e.items,t.items),e.size=e.items.length,e.type=e.type===t.type?e.type:zt.NON_LINE,e.result=Es.getMatchResult(e.type,e.size)}},ne;(function(e){e.SUPER_SPHERE_x2="SUPER_SPHERE_x2",e.SUPER_SPHERE_BOMB="SUPER_SPHERE_BOMB",e.SUPER_SPHERE_STRIPED="SUPER_SPHERE_STRIPED",e.SUPER_SPHERE="SUPER_SPHERE",e.BOMB_x2="BOMB_x2",e.BOMB_STRIPED="BOMB_STRIPED",e.STRIPED_x2="STRIPED_x2"})(ne||(ne={}));var Gy={[ne.SUPER_SPHERE_x2]:["SUPER_SPHERE","SUPER_SPHERE"],[ne.SUPER_SPHERE_BOMB]:["SUPER_SPHERE","BOMB"],[ne.SUPER_SPHERE_STRIPED]:["SUPER_SPHERE","STRIPES"],[ne.SUPER_SPHERE]:["SUPER_SPHERE","NONE"],[ne.BOMB_x2]:["BOMB","BOMB"],[ne.BOMB_STRIPED]:["BOMB","STRIPES"],[ne.STRIPED_x2]:["STRIPES","STRIPES"]};function Mo(e,t){if(!te(e)||!te(t))return;let s=Ro(e.powerup),i=Ro(t.powerup);return Be(Gy,n=>n[0]===s&&n[1]===i||n[0]===i&&n[1]===s)}function Ro(e){return e===T.VERTICAL_STRIPES||e===T.HORIZONTAL_STRIPES?"STRIPES":e===T.BOMB?"BOMB":e===T.SUPER_SPHERE?"SUPER_SPHERE":"NONE"}var jt=class{static findBestMove(e,t){let s=this.getSwappableItems(e);if(t&&t.length>0){let i=this.getAllMatchMoves(s,e).filter(n=>t.includes(n.match.itemsType)),a=this.getBestMatchMove(i);if(a)return a}return this.findBestComboMove(s,e)||this.findBestMatchMove(s,e)}static getSwappableItems(e){return e.mainItems.filter(t=>t.isSwappable&&e.topItems.checkAt(t.column,t.row)===!1)}static findBestMatchMove(e,t){let s=this.getAllMatchMoves(e,t),i=this.getBestMatchMove(s);return i!=null?i:null}static getAllMatchMoves(e,t){let s=this.getPossibleMatchSwaps(e,t),i=t.mainItems.filter(n=>n.isMatchable),a=[];return s.forEach(n=>{t.swapItems(n.item_1,n.item_2);let r=Ee.findBestMatchOf(i,n.item_1);r&&a.push({swap:n,match:r,type:"match"});let o=Ee.findBestMatchOf(i,n.item_2);o&&a.push({swap:n,match:o,type:"match"}),t.swapItems(n.item_1,n.item_2)}),a}static getPossibleMatchSwaps(e,t){let s=[];return e.forEach(i=>{let{column:a,row:n,itemType:r}=i,o=t.mainItems.getAt(a,n+1);o&&e.includes(o)&&o.itemType!==r&&s.push({item_1:i,item_2:o});let l=t.mainItems.getAt(a+1,n);l&&e.includes(l)&&l.itemType!==r&&s.push({item_1:i,item_2:l})}),s}static getBestMatchMove(e){return ze(e,t=>this.getMatchScore(t.match))}static getMatchScore(e){let t=0;e.result===He.STRIPES?t=1:e.result===He.BOMB?t=2:e.result===He.SUPER_SPHERE&&(t=3);let i=e.items.reduce((a,n)=>(n.powerup===T.HORIZONTAL_STRIPES||n.powerup===T.VERTICAL_STRIPES?a+=1.5:n.powerup===T.BOMB&&(a+=2),a),0);return t+i}static findBestComboMove(e,t){let s=e.filter(r=>te(r)&&r.hasPowerup()).sort(Ui),i=this.convertToGridArray(e,t.mainItems.rows,t.mainItems.columns),a=this.findPossibleComboMoves(s,i),n=this.pickBestCombo(a);return n!=null?n:null}static convertToGridArray(e,t,s){let i=new De(t,s);return i.addMultiple(...e),i}static findPossibleComboMoves(e,t){let s=[];return e.forEach(i=>{let{column:a,row:n}=i,r=t.getAt(a,n+1);r&&te(r)&&(r.hasPowerup()||i.powerup===T.SUPER_SPHERE)&&s.push({item_1:i,item_2:r,type:"combo"});let o=t.getAt(a+1,n);o&&te(o)&&o.hasPowerup()&&(o.hasPowerup()||i.powerup===T.SUPER_SPHERE)&&s.push({item_1:i,item_2:o,type:"combo"})}),s}static pickBestCombo(e){return ze(e,t=>{let s=Mo(t.item_1,t.item_2);return this.COOKIES_SPECIAL_COMBO_SCORE_MAP[s]})}static isDeadlock(e){return this.hasAnySwap(e)===!1}static hasAnySwap(e){let t=this.getSwappableItems(e);return this.hasAnyMatchMove(t,e)||this.hasAnySpecialComboMove(t,e.mainItems)}static hasAnyMatchMove(e,t){let s=t.mainItems.filter(i=>i.isMatchable);for(let i=0;i<e.length;i++){let a=e[i],{column:n,row:r,itemType:o}=a,l=t.mainItems.getAt(n,r+1);if(l&&e.includes(l)&&l.itemType!==o&&this.willSwapHaveMatches(t,a,l,s))return!0;let d=t.mainItems.getAt(n+1,r);if(d&&e.includes(d)&&d.itemType!==o&&this.willSwapHaveMatches(t,a,d,s))return!0}return!1}static willSwapHaveMatches(e,t,s,i){e.swapItems(t,s);let a=Ee.hasAny(i);return e.swapItems(t,s),a}static hasAnySpecialComboMove(e,t){return e.filter(i=>te(i)&&i.hasPowerup()).some(i=>{let{column:a,row:n}=i,r=t.getAt(a,n+1);if(r&&te(r)&&(r.hasPowerup()||i.powerup===T.SUPER_SPHERE))return!0;let o=t.getAt(a+1,n);if(o&&te(o)&&(o.hasPowerup()||i.powerup===T.SUPER_SPHERE))return!0})}};jt.COOKIES_SPECIAL_COMBO_SCORE_MAP={[ne.SUPER_SPHERE_x2]:7,[ne.SUPER_SPHERE_BOMB]:6,[ne.SUPER_SPHERE_STRIPED]:5,[ne.BOMB_x2]:4,[ne.BOMB_STRIPED]:3,[ne.STRIPED_x2]:2,[ne.SUPER_SPHERE]:1};var Js;(function(e){e.COMPLETE="__COMPLETE"})(Js||(Js={}));var Fy=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.scene.input.enabled=!1,this.gameplay=this.scene.gameplay,this.config=t,this.addScreens()}addScreens(){this.screens=this.config.steps.map(e=>{let t=this.createScreen(e);return t.setDepth(ee.TUTORIAL),t.kill(),this.scene.add.existing(t),t})}createScreen(e){switch(e.type){case L.MATCH:return new My(this.scene,e);case L.UNDO:return new Ny(this.scene,e);case L.BOOSTER:return new Ry(this.scene,e);default:return new Xi(this.scene,e)}}resize(){var e;(e=this.currentScreen)==null||e.resize()}showNextScreen(){if(this.screens.length>0===!1){this.onTutorialsComplete();return}let t=this.screens[0];if(t.tutorialType===L.MATCH&&this.checkMatchForTutorial(t.step)===!1){this.scene.analytics.sendDesignEvent(`Tutorial:${this.gameplay.levelNumber}:NoMatches`),this.screens.shift().destroy(),this.showNextScreen();return}this.currentScreen=this.screens.shift(),this.currentScreen.resize(),this.currentScreen.once(b.SHOW,this.onScreenShow,this),this.currentScreen.show()}onTutorialsComplete(){this.scene.input.enabled=!0,this.emit(Js.COMPLETE,this)}checkMatchForTutorial(e){let{columns:t,rows:s}=this.gameplay.levelConfig.grid,i=new Bo(t,s);return e.cells.forEach(a=>{let n=this.gameplay.items.mainItems.getAt(a.column,a.row);n&&i.add(n)}),!!jt.findBestMove(i)}onScreenShow(e){switch(e.step.type){case L.MATCH:this.onMatchTutorialShow(e);break;case L.BOOSTER:this.onBoosterTutorialShow(e);break;case L.UNDO:this.onUndoTutorialShow(e);break;case L.GOALS:case L.MOVES:case L.CHEF:this.gameplay.input.once(Phaser.Input.Events.POINTER_DOWN,this.hideCurrentScreenAndShowNext,this);break;default:break}}hideCurrentScreenAndShowNext(){this.hideCurrentScreen({showNextScreen:!0})}onMatchTutorialShow(e){let{swapCell_1:t,swapCell_2:s}=e.step,i=[{column:t.x,row:t.y},{column:s.x,row:s.y}];this.restrictSwaps(i),this.gameplay.isLocked=!1,e.step.showHint&&this.gameplay.hint.start(),this.gameplay.events.once(me.SWAP_COMPLETE,()=>{this.restoreSwaps(),this.hideCurrentScreen({showNextScreen:!1})}),this.gameplay.events.once(me.TURN_COMPLETE,()=>{this.showNextScreen()})}onBoosterTutorialShow(e){let t=e,s=e.step;this.scene.input.enabled=!0,this.scene.pauseButton.disableInput(),this.gameplay.gui.boostersPanel.killIconsExcept(s.boosterType);let i=this.gameplay.boosters.getBooster(s.boosterType);i.num<2&&(i.num=2),t.interactiveZone.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{let a={column:s.boosterCell.x,row:s.boosterCell.y};this.gameplay.boosters.setTutorialMode(s.boosterType,a),this.gameplay.gui.boostersPanel.reviveAllIcons(),this.hideCurrentScreen({showNextScreen:!0}),this.scene.pauseButton.enableInput(),this.scene.audio.playClick()})}onUndoTutorialShow(e){this.scene.input.enabled=!0,this.scene.pauseButton.disableInput();let t=this.scene.game.boosters.getByType(I.UNDO);t.num<2&&(t.num=2),e.interactiveZone.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.gameplay.applyUndo(),this.hideCurrentScreen({showNextScreen:!0}),this.scene.pauseButton.enableInput(),this.scene.audio.playClick()})}hideCurrentScreen(e){this.currentScreen.once(b.HIDE_COMPLETE,()=>{this.currentScreen.destroy(),this.currentScreen=null,e.showNextScreen&&this.showNextScreen()}),this.currentScreen.hide()}restrictSwaps(e){this.gameplay.items.mainItems.forEach(t=>{let s=e.some(i=>i.row===t.row&&i.column===t.column);t.setData("wasSwappable",t.isSwappable),t.isSwappable=s})}restoreSwaps(){this.gameplay.items.mainItems.forEach(e=>{e.isSwappable=e.getData("wasSwappable")})}skip(){var e;this.cancelTutorialChanges(),(e=this.currentScreen)==null||e.destroy(),this.screens.forEach(t=>t.destroy()),this.screens=null,this.onTutorialsComplete()}cancelTutorialChanges(){switch(this.currentScreen.step.type){case L.MATCH:this.restoreSwaps(),this.gameplay.isLocked=!0,this.gameplay.hint.cancelSmooth();break;case L.BOOSTER:this.scene.pauseButton.enableInput(),this.gameplay.gui.boostersPanel.reviveAllIcons(),this.gameplay.boosters.cancelTutorialMode(),this.gameplay.onTutorialSkip();break;case L.UNDO:this.scene.pauseButton.enableInput();break;case L.CHEF:case L.GOALS:case L.MOVES:this.gameplay.input.off(Phaser.Input.Events.POINTER_DOWN,this.hideCurrentScreenAndShowNext,this);break;default:break}}hasMatchTutorial(){return this.config.steps.some(e=>e.type===L.MATCH)}getCurrentTutorialType(){var e;return(e=this.currentScreen)==null?void 0:e.tutorialType}destroy(){this.gameplay.events.off(me.SWAP_COMPLETE),this.gameplay.events.off(me.TURN_COMPLETE),this.gameplay.input.off(Phaser.Input.Events.POINTER_DOWN,this.hideCurrentScreenAndShowNext,this),this.currentScreen&&(this.currentScreen.off(b.HIDE_COMPLETE),this.currentScreen.off(b.SHOW,this.onScreenShow,this))}},Uy=class extends Phaser.GameObjects.Text{constructor(e,t,s){super(e,0,0,t,s)}show(){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.fadeOut({delay:700})}}),this.scale=.66,this.scene.tweens.add({targets:this,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1}),this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.y-this.height*.5})}fadeOut(e){this.scene.tweens.add({delay:e.delay,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=10",onComplete:()=>{this.kill()}})}},Wy=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="goal",this.addBack(),this.addIcon(),this.addNumLabel(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/start_level/Cookie Background Box.png"),this.add(this.back)}addIcon(){this.icon=this.scene.add.image(0,0,"popups","popups/start_level/goals/apple.png"),this.add(this.icon)}addNumLabel(){let e="0";this.numLabel=this.scene.add.bitmapText(0,0,B.POPUP_GOAL_LABELS,e,29),this.numLabel.setOrigin(.5,.5),this.numLabel.x=32,this.numLabel.y=this.back.bottom-3,this.add(this.numLabel)}updateData(e,t){this.icon.setFrame(`popups/start_level/goals/${e.toLowerCase()}.png`),this.numLabel.text=t.toString()}setEmpty(){this.icon.kill(),this.numLabel.kill(),this.back.alpha=.4}resetEmpty(){this.icon.revive(),this.numLabel.revive(),this.back.alpha=1}},Yy=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="goals_panel",this.addBack(),this.addTitle(),this.addSubtitle(),this.addGoalViews(),this.addChef(),this.alignSubtitle(),this.bringToTop(this.title),this.bringToTop(this.subtitle),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/start_level/goal_panel_back.png"),this.add(this.back)}addTitle(){let e=this.scene.texts.start_level_popup.goal,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#5F3331",align:"center"};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.x=85,this.title.y=-70,this.add(this.title)}addSubtitle(){let e=this.scene.texts.start_level_popup.collect,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#A23D2C",align:"center"};this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.x=this.title.x,this.subtitle.y=this.title.y+36,this.add(this.subtitle),this.adjustSubtitleSize()}adjustSubtitleSize(){let e=286;this.subtitle.scale=Math.min(1,e/this.subtitle.width)}addGoalViews(){let e=this.back.right-80,t=100;this.goalViews=ke(3,s=>{let i=new Wy(this.scene);return i.x=e-t*s,i.y=40,i.setEmpty(),this.add(i),i})}addChef(){this.chef=this.scene.add.image(0,0,"popups","popups/Chef Cherry.png"),this.chef.x=-146,this.chef.y=this.back.bottom-7,this.add(this.chef)}updateGoals(e){this.goalViews.forEach((t,s)=>{let i=e[s];i?(t.resetEmpty(),t.updateData(i.type,i.targetNum)):t.setEmpty()})}onLanguageChange(){this.title.text=this.scene.texts.start_level_popup.goal,this.subtitle.text=this.scene.texts.start_level_popup.collect,this.adjustSubtitleSize(),this.alignSubtitle()}alignSubtitle(){let e=this.title.bottom,s=this.goalViews[0].top-e;this.subtitle.y=e+s/2-4}},Vy=class extends Phaser.GameObjects.Container{constructor(e){super(e,0,0);this.addBack(),this.addText()}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/start_level/boosters/booster_hint_popover.png"),this.add(this.back)}addText(){let e=this.scene.texts.start_level_popup.booster_hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"22px",color:"#ffffff",align:"center",padding:{x:0,y:3}};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setShadow(0,2,"rgba(0,0,0,0.2)"),this.text.y=-1,this.add(this.text),this.updateText(e)}updateText(e){this.text.text=e,this.text.scale=Math.min(1,this.back.width*.85/this.text.width)}},_e;(function(e){e.SELECTED="SELECTED",e.UNSELECTED="UNSELECTED",e.EMPTY="EMPTY"})(_e||(_e={}));var Ky=class extends fe{constructor(e,t){super(e,"popups","popups/start_level/boosters/booster_bubble.png");this.isLocked=!1,this.scene.sys.updateList.add(this),this.name=`pregame_booster_${t.type}`,this.booster=t,this.booster.on(ps.NUM_CHANGED,this.onBoosterNumChange,this),this.addIcon("popups",this.getIconFrameName(t.type),0,-3),this.moveDown(this.icon),this.addSparks(),this.addNumLabel(),this.addPlusButton(),this.addCheck(),this.addHint(),this.addRewardText(),this.setInitialState()}onBoosterNumChange(){let e=this.booster.num;e>0?this.setIconState(_e.UNSELECTED):this.setIconState(_e.EMPTY),this.numLabel.text=e.toString()}getIconFrameName(e){return{[W.STRIPES]:"popups/start_level/boosters/stripes.png",[W.BOMB]:"popups/start_level/boosters/bomb.png",[W.SUPER_SPHERE]:"popups/start_level/boosters/super_sphere.png"}[e]}addSparks(){this.sparks=this.scene.add.image(0,0,"popups","popups/start_level/boosters/bubble_sparks.png"),this.add(this.sparks)}addNumLabel(){let e=this.booster.num.toString();this.numLabel=this.scene.add.bitmapText(0,0,B.PREGAME_BOOSTERS_LABELS,e,40),this.numLabel.setOrigin(.5,.5),this.numLabel.x=50,this.numLabel.y=48,this.numLabel.originalX=this.numLabel.x,this.add(this.numLabel)}addRewardText(){let e="+1";this.rewardText=this.scene.add.bitmapText(0,0,B.PREGAME_BOOSTERS_LABELS,e,38),this.rewardText.setOrigin(.5),this.rewardText.kill(),this.rewardText.x=-5,this.add(this.rewardText)}addPlusButton(){this.plus=this.scene.add.image(0,0,"popups","popups/start_level/boosters/plus_button.png"),this.plus.x=54,this.plus.y=46,this.add(this.plus)}addCheck(){this.check=this.scene.add.image(0,0,"popups","popups/start_level/boosters/check_button.png"),this.check.x=this.plus.x,this.check.y=this.plus.y,this.add(this.check)}addHint(){this.hint=new Vy(this.scene),this.hint.y=-70,this.hint.originalY=this.hint.y,this.hint.kill(),this.add(this.hint)}setLocked(e){this.isLocked=e,e?(this.plus.kill(),this.numLabel.kill(),this.icon.setFrame("popups/start_level/boosters/locked.png")):(this.icon.setFrame(this.getIconFrameName(this.booster.type)),this.setInitialState())}setInitialState(){this.booster.num===0?this.setIconState(_e.EMPTY):this.setIconState(_e.UNSELECTED)}setIconState(e){switch(this.state=e,this.state){case _e.EMPTY:this.setEmptyState();break;case _e.SELECTED:this.numLabel.visible=!1,this.showItem(this.check),this.sparks.revive(),this.plus.visible=!1;break;case _e.UNSELECTED:this.check.visible=!1,this.showItem(this.numLabel),this.sparks.kill(),this.plus.visible=!1;break;default:break}}setEmptyState(){this.plus.visible=!0,this.check.visible=!1,this.sparks.kill()}showItem(e){e.visible=!0,e.alpha=0,e.scale=.66,this.scene.tweens.add({targets:e,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:150},scale:{value:1,ease:Phaser.Math.Easing.Back.Out,duration:400}})}onRewardArrive(e){this.setIconState(_e.SELECTED),this.scene.time.delayedCall(300,()=>{this.scene.audio.play(u.TWINKLE_3,{volume:.45}),this.showRewardText(e)})}showRewardText(e){this.rewardText.text=`+${e}`,this.rewardText.y=-20,this.rewardText.revive(),this.scene.tweens.killTweensOf(this.rewardText),this.rewardText.alpha=0,this.scene.tweens.add({targets:this.rewardText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({delay:1200,targets:this.rewardText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.rewardText.kill()}})}}),this.rewardText.scale=.5,this.scene.tweens.add({targets:this.rewardText,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1}),this.scene.tweens.add({targets:this.rewardText,duration:1500,ease:Phaser.Math.Easing.Linear,y:"-=40"})}preUpdate(e,t){this.sparks.visible&&(this.sparks.angle+=.24*t)}shakeNumLabel(){this.numLabel.x=this.numLabel.originalX,this.scene.tweens.killTweensByProperty(this.numLabel,"x"),this.scene.tweens.add({targets:this.numLabel,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:"+=7",repeat:3,yoyo:!0})}onLanguageChange(){this.hint.updateText(this.scene.texts.start_level_popup.booster_hint)}preDestroy(){this.scene.sys.updateList.remove(this),this.booster.off(ps.NUM_CHANGED,this.onBoosterNumChange,this),super.preDestroy()}},st;(function(e){e.LOCKED_BOOSTER_CLICK="__LOCKED_BOOSTER_CLICK",e.ADD_BOOSTER_CLICK="__ADD_BOOSTER_CLICK",e.BOOSTER_SELECTED="__BOOSTER_SELECTED"})(st||(st={}));var zy=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.slotSize=160,this.name="pregame_boosters",this.addIcons(),this.alignIcons(),this.setSize(this.icons.length*this.slotSize,this.slotSize)}addIcons(){this.icons=this.scene.game.pregameBoosters.items.map(e=>{let t=new Ky(this.scene,e);return t.on(_.RELEASE,this.onIconClick,this),this.add(t),t})}onIconClick(e){if(e.isLocked){this.emit(st.LOCKED_BOOSTER_CLICK,e);return}e.state===_e.EMPTY?this.emit(st.ADD_BOOSTER_CLICK,e.booster):e.state===_e.UNSELECTED?(e.setIconState(_e.SELECTED),this.emit(st.BOOSTER_SELECTED,e)):e.setIconState(_e.UNSELECTED)}alignIcons(){this.gridAlign({cellWidth:this.slotSize,position:Phaser.Display.Align.CENTER,x:this.slotSize/2,y:this.slotSize/2})}getSelectedBoosters(){return this.icons.filter(e=>e.state===_e.SELECTED).map(e=>e.booster.type)}getByType(e){return this.icons.find(t=>t.booster.type===e)}updateData(e,t){Object.keys(e).forEach(s=>{let i=!e[s],a=this.getByType(s);a.setLocked(i),t.show&&t[s]?a.hint.revive():a.hint.kill()})}unselectAll(){this.icons.forEach(e=>{e.state===_e.SELECTED&&e.setIconState(_e.UNSELECTED)})}onLanguageChange(){this.icons.forEach(e=>e.onLanguageChange())}playHintsAnimation(){this.getActiveHints().forEach(e=>{e.angle=-3,e.scale=1,this.scene.tweens.add({targets:e,duration:600,ease:Phaser.Math.Easing.Sine.InOut,angle:e.angle*-1,scale:1.03,yoyo:!0,repeat:-1})})}stopHintsAnimation(){this.getActiveHints().forEach(e=>{this.scene.tweens.killTweensOf(e)})}getActiveHints(){return this.icons.filter(e=>e.hint.visible).map(e=>e.hint)}},jy=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.name="booster_locked_popover",this.addBack(t,s),this.addText(i),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addText(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(300,!0),this.text.scale=Math.min(1,110/this.text.height),this.text.y=this.back.top+66,this.add(this.text)}show(e){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.hide(e.duration)}})}hide(e){this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}forceHide(){this.scene.tweens.killTweensOf(this),this.kill()}updateContent(e){this.text.text=e}},Xy=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="start_level_popup",this.addBack(),this.addTitleBack(),this.addLevelTypeText(),this.addLevelNumberText(),this.addCloseButton(),this.addGoalsPanel(),this.addPregameBoosters(),this.addBoosterLockedPopover(),this.addPlayButton(),this.addSkull(),this.addTutorialHand(),this.alignItems(),this.bringToTop(this.goalsPanel),this.bringToTop(this.levelNumberText),this.bringToTop(this.boosterLockedPopover),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/popup_back.png"),this.add(this.back)}addTitleBack(){this.titleBack=this.scene.add.image(0,0,"popups","popups/headline_flag_pink.png"),this.titleBack.y=this.back.top+30,this.add(this.titleBack)}addLevelTypeText(){let e=this.scene.texts.start_level_popup.classic_level,t=this.getTitleTextStyle();this.levelTypeText=this.scene.add.text(0,0,e,t),this.levelTypeText.setOrigin(.5,.5),this.levelTypeText.scale=Math.min(1,210/this.levelTypeText.width),this.levelTypeText.x=this.titleBack.x,this.levelTypeText.y=this.titleBack.y-20,this.add(this.levelTypeText)}addLevelNumberText(){let e="1",t=k(P({},this.getTitleTextStyle()),{fontSize:"38px"});this.levelNumberText=this.scene.add.text(0,0,e,t),this.levelNumberText.setOrigin(.5,.5),this.levelNumberText.x=this.titleBack.x,this.levelNumberText.y=this.levelTypeText.y+32,this.add(this.levelNumberText)}getTitleTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#ffffff",align:"center",strokeThickness:6,stroke:"#F66986"}}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46}addGoalsPanel(){this.goalsPanel=new Yy(this.scene),this.goalsPanel.y=-120,this.add(this.goalsPanel)}addPregameBoosters(){this.pregameBoosters=new zy(this.scene),this.pregameBoosters.x=-this.pregameBoosters.width/2,this.pregameBoosters.y=5,this.pregameBoosters.on(st.LOCKED_BOOSTER_CLICK,this.onLockedBoosterIconClick,this),this.add(this.pregameBoosters)}onLockedBoosterIconClick(e){this.boosterLockedPopover.x=this.pregameBoosters.x+e.x,this.boosterLockedPopover.updateContent(this.getPopoverContent(e.booster.type)),this.boosterLockedPopover.show({duration:1500})}addBoosterLockedPopover(){let e=this.getPopoverContent();this.boosterLockedPopover=new jy(this.scene,"popups","popups/start_level/boosters/booster_locked_popover.png",e),this.boosterLockedPopover.x=this.pregameBoosters.x+this.pregameBoosters.displayWidth/2,this.boosterLockedPopover.y=this.pregameBoosters.y+14,this.boosterLockedPopover.kill(),this.add(this.boosterLockedPopover)}getPopoverContent(e=W.STRIPES){let t=window.game.config.pregame_boosters_unlock[e];return this.scene.texts.booster_lock.replace("#",t.toString())}addPlayButton(){this.playButton=this.scene.add.complexButton("popups","popups/Pink-Button-Long.png",this),this.playButton.back.scale=.9,this.playButton.addIcon("popups","popups/play_icon.png"),this.playButton.y=234}addSkull(){this.skull=this.scene.add.image(0,0,"popups","popups/start_level/skull_button.png"),this.skull.x=this.playButton.x+106,this.skull.y=this.playButton.y-40,this.skull.kill(),this.add(this.skull)}addTutorialHand(){this.tutorialHand=new ms(this.scene,"popups","popups/start_level/hand.png"),this.tutorialHand.kill(),this.add(this.tutorialHand)}alignItems(){this.alignPregameBoosters()}alignPregameBoosters(){let e=this.goalsPanel.y+this.goalsPanel.height/2,s=this.playButton.top-e;this.pregameBoosters.y=e+(s-this.pregameBoosters.height)/2+4}updateData(e){this.levelTypeText.text=e.isHard?this.scene.texts.start_level_popup.hard_level:this.scene.texts.start_level_popup.classic_level,this.levelNumberText.text=e.levelNumber.toString(),this.goalsPanel.updateGoals(e.goals),this.pregameBoosters.updateData(e.pregameBoosters,e.pregameBoostersHints),this.updateHardData(e),this.updateTutorialData(e)}updateHardData(e){e.isHard?(this.levelTypeText.text=this.scene.texts.start_level_popup.hard_level,this.skull.revive()):(this.levelTypeText.text=this.scene.texts.start_level_popup.classic_level,this.skull.kill())}updateTutorialData(e){if(e.levelNumber===1&&e.levelComplete===!1)this.tutorialHand.revive(),this.tutorialHand.x=this.playButton.x+76,this.tutorialHand.y=this.playButton.y+80;else if(e.levelNumber===window.game.config.pregame_boosters_unlock.stripes){let t=this.scene.game.pregameBoosters.getByType(W.STRIPES).num>0;if(e.levelComplete||t===!1){this.tutorialHand.kill();return}this.tutorialHand.revive(),this.tutorialHand.x=this.pregameBoosters.x+150,this.tutorialHand.y=this.pregameBoosters.y+160,this.pregameBoosters.once(st.BOOSTER_SELECTED,()=>{this.tutorialHand.stopAnimation(),this.scene.tweens.add({targets:this.tutorialHand,duration:200,ease:Phaser.Math.Easing.Sine.InOut,alpha:0,yoyo:!0,onYoyo:()=>{this.tutorialHand.x=this.playButton.x+76,this.tutorialHand.y=this.playButton.y+80,this.tutorialHand.playAnimation()}})})}else this.tutorialHand.kill()}onShow(){this.showChef(200),this.showPregameBoosters(150),this.showPlayButton(100),this.showSkull(200),this.showTutorialHand(500)}onHide(){this.scene.tweens.killTweensOf(this.goalsPanel.chef),this.pregameBoosters.off(st.BOOSTER_SELECTED),this.pregameBoosters.unselectAll(),this.pregameBoosters.stopHintsAnimation(),this.boosterLockedPopover.forceHide(),this.tutorialHand.stopAnimation(),this.tutorialHand.kill()}showChef(e){let t=this.goalsPanel.chef;t.alpha=0,this.scene.tweens.add({delay:e,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.scale=.75,this.scene.tweens.add({delay:e,targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.scene.tweens.add({targets:t,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.03,scaleY:.97,yoyo:!0,repeat:-1})}})}showPregameBoosters(e){this.pregameBoosters.icons.forEach(t=>{let s=e;t.alpha=0,this.scene.tweens.add({delay:s,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.scale=.75,this.scene.tweens.add({delay:s,targets:t,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}),this.pregameBoosters.playHintsAnimation()}showPlayButton(e){this.playButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.playButton,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.playButton.scale=.66,this.scene.tweens.add({delay:e,targets:this.playButton,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}showSkull(e){this.skull.visible!==!1&&(this.skull.alpha=0,this.scene.tweens.add({delay:e,targets:this.skull,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.skull.scale=.66,this.scene.tweens.add({delay:e,targets:this.skull,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}))}showTutorialHand(e){this.tutorialHand.visible!==!1&&this.tutorialHand.playAnimation(e)}onLanguageChange(){this.goalsPanel.onLanguageChange(),this.pregameBoosters.onLanguageChange(),this.boosterLockedPopover.updateContent(this.getPopoverContent())}},$y=class extends fe{constructor(e,t,s,i){super(e,t,s,i);this.input.hitArea.y-=this.back.displayHeight*Math.abs(this.back.originY-.5),this.addPopover(),this.addParticles()}addPopover(){let e=this.scene.add.image(0,0,"popups","popups/start_level/piggy_bank/piggy_bank_popover.png"),t=this.createPopoverText(e.width*.8);t.y=-32,this.popover=this.scene.add.container(0,0,[e,t]),this.popover.text=t,this.popover.x=-26,this.popover.y=-124,this.popover.originalY=this.popover.y,this.add(this.popover)}createPopoverText(e){let t=this.scene.texts.piggy_bank.full,s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center",padding:{x:0,y:2}},i=this.scene.add.text(0,0,t,s);return i.setOrigin(.5,.5),i.setShadow(0,2,"rgba(0,0,0,0.2)"),i.scale=Math.min(1,e/i.width),i}addParticles(){this.circlesManager=this.scene.add.particles("popups"),this.circlesManager.setPosition(0,-50),this.addAt(this.circlesManager,0),this.circles=this.circlesManager.createEmitter({frame:"popups/particles/circle_fx_2.png",scale:{start:.4,end:2,ease:m.ExpoOut},alpha:{start:.2,end:0,ease:m.CubicOut},lifespan:1600,on:!1}),this.sparksManager=this.scene.add.particles("popups"),this.add(this.sparksManager),this.sparks=this.sparksManager.createEmitter({speed:30,frame:"popups/particles/star_1.png",lifespan:{min:800,max:1400},rotate:{start:0,end:180,random:!0},angle:-90,scale:{start:.8,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:m.ExpoOut},frequency:300,on:!1}),this.sparks.setEmitZone({source:new Phaser.Geom.Circle(0,-50,this.back.displayWidth*.4),type:"random",quantity:360})}startPopoverAnimation(){let e=5;this.popover.angle=-e,this.scene.tweens.killTweensOf(this.popover),this.scene.tweens.add({targets:this.popover,duration:900,ease:Phaser.Math.Easing.Sine.InOut,angle:e,yoyo:!0,repeat:-1})}stopPopoverAnimation(){this.scene.tweens.killTweensOf(this.popover)}showFullPopover(e){this.popover.alpha=0,this.popover.y=this.popover.originalY-50,this.scene.tweens.add({delay:e,targets:this.popover,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1,y:this.popover.originalY}),this.popover.scale=.75,this.scene.tweens.add({delay:e,targets:this.popover,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})}hideFullPopover(){this.popover.visible!==!1&&(this.scene.tweens.killTweensOf(this.popover),this.scene.tweens.add({targets:this.popover,y:"-=10",duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.popover.kill()}}))}onLanguageChange(){this.popover.text.text=this.scene.texts.piggy_bank.full}onShow(){this.sparks.on=!0,this.startPopoverAnimation(),this.back.scaleX=1,this.back.scaleY=1,this.scene.tweens.add({targets:this.back,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.05,scaleY:.95,yoyo:!0,repeat:-1,onRepeat:()=>{}})}onHide(){this.sparks.on=!1,this.stopPopoverAnimation(),this.scene.tweens.killTweensOf(this.back)}showCircleFx(){this.circles.explode(1,0,0)}updatePopoverContent(e){this.popover.text.setText(e)}},ei;(function(e){e.SHOW_PIGGY_BANK_SCREEN="__SHOW_PIGGY_BANK_SCREEN"})(ei||(ei={}));var No=class extends ie{constructor(e){super(e,{name:"start_level_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.isDeactivated=!1,this.addParticles(),this.addWidgetButton(),this.addPopup(),this.addPiggyBankButton()}onSpacebarPressed(){var e;this.isDeactivated||((e=this.popup.playButton.input)==null?void 0:e.enabled)!==!1&&this.popup.playButton.emulateReleaseEvent()}addParticles(){this.particles=this.scene.add.particles("popups"),this.add(this.particles),this.skulls=this.particles.createEmitter({frame:"popups/start_level/skull_icon.png",angle:-90,speed:50,lifespan:{min:2e3,max:2500},alpha:{start:0,end:.5,ease:gs.BellCubic},scale:{start:.25,end:1},rotate:{min:-20,max:20},frequency:300,on:!1})}addWidgetButton(){let e=window.game.config.widget_button.start_level_screen;e.enabled!==!1&&(this.widgetButton=this.scene.add.button("popups",e.frame,this),this.widgetButton.on(_.RELEASE,this.onWidgetButtonClick,this),this.add(this.widgetButton),this.pin(this.widgetButton,.5,1))}onWidgetButtonClick(){}addPopup(){this.popup=new Xy(this.scene),this.popup.closeButton.on(_.PRESS,this.hide,this),this.popup.originalScale=1,this.pin(this.popup,.5,.51),this.add(this.popup)}addPiggyBankButton(){!this.scene.game.piggyBank||(this.piggyBankButton=new $y(this.scene,"popups","popups/start_level/piggy_bank/button_piggy_2.png"),this.piggyBankButton.on(_.PRESS,this.onPiggyBankClick,this),this.add(this.piggyBankButton),this.pin(this.piggyBankButton,1,1,-85,-30))}onPiggyBankClick(){this.emit(ei.SHOW_PIGGY_BANK_SCREEN,this)}resize(){super.resize(),this.resizePopup(),this.resizeSkullsEmitZone(),this.piggyBankButton&&(this.piggyBankButton.originalY=this.piggyBankButton.y)}resizePopup(){let e=this.screenHeight*.8;this.popup.scale=Math.min(1,e/this.popup.height),this.popup.originalScale=this.popup.scale,this.popup.originalY=this.popup.y}resizeSkullsEmitZone(){let e=500,t=this.screenCenter.x-e/2;this.skulls.setEmitZone({source:new Phaser.Geom.Rectangle(t,this.popup.y-this.popup.height/2,e,80),type:"random"})}updateData(e){this.levelNumber=e;let t=this.getScreenData(e);t?this.doUpdateData(t):""+e,this.updatePiggyBankButton()}getScreenData(e){let t=this.scene.game.levelConfigs.get(e);if(!t)return null;let s={levelNumber:e,isHard:t.hard,levelComplete:!1,goals:ut.createGoalsArray(t.goals),pregameBoosters:t.preGameBoosters,pregameBoostersHints:P({show:!1},t.preGameBoostersHints)},i=this.scene.game.store.getLevelResult(e);return i&&(s.levelComplete=!0,s.pregameBoostersHints.show=i.timesFailedNum>0),s}doUpdateData(e){this.popup.updateData(e),e.isHard?this.particles.revive():this.particles.kill()}updatePiggyBankButton(){if(!this.piggyBankButton||!this.scene.game.piggyBank)return;this.shouldDisplayPiggyBank()?(this.piggyBankButton.revive(),this.piggyBankButton.updatePopoverContent(this.getPiggyBankPopoverContent())):this.piggyBankButton.kill()}shouldDisplayPiggyBank(){let e=this.scene.game.piggyBank;return e.isFull()||e.isAlmostFull()}getPiggyBankPopoverContent(){let e=this.scene.game.piggyBank;return e.isFull()?this.scene.texts.piggy_bank.full:Math.floor(e.getFullnessPercent()*100)+"%"}show(e){this.emitShowEvent(),this.alpha=1,this.revive(),e.fadeInBackground&&this.showBackground(),this.showPopup(),this.showPiggyBankButton(200),this.showWidgetButton(300),this.scene.onceKeyDown("SPACE",this.onSpacebarPressed,this),this.particles.visible&&(this.skulls.on=!0)}showPopup(){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.scale=this.popup.originalScale*.85,this.scene.tweens.add({delay:0,targets:this.popup,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:this.popup.originalScale}),this.popup.y=this.popup.originalY+100,this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.popup.originalY}),this.popup.onShow()}showPiggyBankButton(e){!this.piggyBankButton||this.piggyBankButton.visible===!1||(this.piggyBankButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.piggyBankButton,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.piggyBankButton.showCircleFx(),this.scene.audio.play(u.COIN_SPEND,{volume:.33})}}),this.piggyBankButton.scale=.75,this.scene.tweens.add({delay:e,targets:this.piggyBankButton,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.piggyBankButton.y=this.piggyBankButton.originalY+100,this.scene.tweens.add({targets:this.piggyBankButton,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.piggyBankButton.originalY}),this.piggyBankButton.onShow(),this.piggyBankButton.showFullPopover(e+100))}showWidgetButton(e){!this.widgetButton||(this.widgetButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.widgetButton,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.widgetButton.scale=.85,this.scene.tweens.add({delay:e,targets:this.widgetButton,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}))}hide(){var e;this.scene.offKeyDown("SPACE",this.onSpacebarPressed,this),this.skulls.on=!1,this.skulls.killAll(),this.popup.onHide(),(e=this.piggyBankButton)==null||e.onHide(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emit(b.HIDE_COMPLETE,this)}})}activate(){this.isDeactivated!==!1&&(this.isDeactivated=!1,this.particles.revive(),this.activatePopup(),this.activatePiggyBackButton(),this.activateWidgetButton(),this.scene.onceKeyDown("SPACE",this.onSpacebarPressed,this))}activatePopup(){this.popup.revive(),this.popup.alpha=0,this.scene.tweens.add({targets:this.popup,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.popup.y=this.popup.originalY+50,this.scene.tweens.add({targets:this.popup,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.popup.originalY})}activatePiggyBackButton(){if(!(!this.piggyBankButton||!this.scene.game.piggyBank)){if(this.shouldDisplayPiggyBank()===!1){this.piggyBankButton.kill();return}this.piggyBankButton.revive(),this.piggyBankButton.alpha=0,this.scene.tweens.add({targets:this.piggyBankButton,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.piggyBankButton.y=this.piggyBankButton.originalY-50,this.scene.tweens.add({targets:this.piggyBankButton,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.piggyBankButton.originalY})}}activateWidgetButton(){!this.widgetButton||(this.widgetButton.revive(),this.widgetButton.alpha=0,this.scene.tweens.add({targets:this.widgetButton,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.widgetButton.scale=.85,this.scene.tweens.add({targets:this.widgetButton,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}))}deactivate(){var e,t;this.isDeactivated||(this.isDeactivated=!0,this.popup.kill(),this.particles.kill(),this.skulls.killAll(),(e=this.piggyBankButton)==null||e.kill(),(t=this.widgetButton)==null||t.kill(),this.scene.offKeyDown("SPACE",this.onSpacebarPressed,this))}onLanguageChange(){this.popup.onLanguageChange(),this.piggyBankButton.onLanguageChange()}},qy=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.options=t,this.name=this.options.offerId,this.addBack(),this.addLifeIcon(),this.addLivesText(),this.addButton(),this.addSeparator(),this.bringToTop(this.button),this.bringToTop(this.livesText)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/black_rect.png"),this.back.alpha=.1,this.back.displayWidth=470,this.back.displayHeight=154,this.add(this.back),this.back.kill()}addLifeIcon(){let e=this.back.x-this.back.displayWidth/2;this.lifeIcon=this.scene.add.image(0,0,"popups","popups/lives/life_icon.png"),this.lifeIcon.x=e+115,this.lifeIcon.y=-4,this.add(this.lifeIcon)}addLivesText(){let e="+"+this.options.lives.toString(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#ffffff",align:"center",stroke:"#E63C7B",strokeThickness:6};this.livesText=this.scene.add.text(0,0,e,t),this.livesText.setOrigin(.5,.5),this.livesText.x=this.lifeIcon.x-2,this.livesText.y=this.lifeIcon.y-3,this.add(this.livesText)}addButton(){let e=this.back.x+this.back.displayWidth/2;if(this.button=this.scene.add.complexButton("popups","popups/lives/button_pink.png",this),this.button.name=`button_get_lives__${this.options.offerId}`,this.button.x=e-138,this.button.y=this.lifeIcon.y,this.button.inflateHitArea(15,15),this.options.type==="video")this.button.addIcon("popups","popups/lives/watch ad.png",0,-16),this.button.icon.scale=.65;else{let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#ffffff",align:"center",stroke:"#F06B5C",strokeThickness:6};this.button.addIcon("popups","popups/lives/coin.png",-42,0),this.button.icon.scale=.75,this.button.addText(this.options.priceInCoins.toString(),t),this.button.text.setOrigin(1,.5),this.button.text.x=64,this.button.text.y=-4}}addSeparator(){!this.options.useSeparator||(this.separator=this.scene.add.image(0,0,"popups","popups/lives/separator.png"),this.separator.y=this.back.bottom,this.add(this.separator))}hideSeparator(){var e;(e=this.separator)==null||e.kill()}onLanguageChange(){}},Qy=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="lives_icon",this.addIcon(),this.addText(),this.setSize(this.icon.width,this.icon.height)}addIcon(){this.icon=this.scene.add.image(0,0,"popups","popups/lives/life_icon_big.png"),this.add(this.icon)}addText(){let e="0",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"56px",color:"#ffffff",align:"center",stroke:"#E63C7B",strokeThickness:8};this.textDefaultStyle=t,this.text=this.scene.add.text(0,0,e,this.textDefaultStyle),this.text.setOrigin(.5,.5),this.text.y=-4,this.add(this.text)}setLivesNum(e){e===Infinity?(this.text.setFontFamily("Arial"),this.text.setFontSize(96),this.text.setFontStyle(Wt.BOLD),this.text.text=lo):(this.text.setStyle(this.textDefaultStyle),this.text.text=e.toString())}syncLivesNum(){let e=this.scene.game.lives.getLivesNum();this.setLivesNum(e)}onLifeRefilled(){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.15,yoyo:!0})}onLifeRewarded(e){this.scene.tweens.killTweensOf(this);let t=this.scene.tweens.stagger(100,{start:e});this.icon.alpha=0,this.text.alpha=0,this.scene.tweens.add({delay:t,targets:this.list,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.icon.scale=.5,this.text.scale=.5,this.scene.tweens.add({delay:t,targets:this.list,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}},$i;(function(e){e.GET_LIVES_BUTTON_CLICK="__GET_LIVES_BUTTON_CLICK"})($i||($i={}));var Zy=class extends Phaser.GameObjects.Container{constructor(e){super(e);if(this.autoCloseAfterAd=!1,this.lives=e.game.lives,this.lives.on(N.REFILL_TIMER_START,this.onRefillTimerStart,this),this.lives.on(N.REFILL_TIMER_COMPLETE,this.onRefillTimerComplete,this),this.lives.on(N.UNLIMITED_TIMER_START,this.onUnlimitedTimerStart,this),this.lives.on(N.UNLIMITED_TIMER_COMPLETE,this.onUnlimitedTimerComplete,this),this.lives.on(N.LIVES_ADDED,this.onLivesAdded,this),this.lives.on(N.PAGE_VISIBLE,this.onPageVisible,this),this.scene.sys.updateList.add(this),this.name="lives_popup",this.addBack(),this.addCloseButton(),this.addTitle(),this.addPanelBack(),this.addParticles(),this.addLivesIcon(),this.addTimerTitleText(),this.addTimerText(),this.addFullText(),this.addOffers(),this.bringToTop(this.livesIcon),this.bringToTop(this.fullText),this.bringToTop(this.timerTitleText),this.bringToTop(this.timerText),this.bringToTop(this.title),this.setSize(this.back.width,this.back.height),this.lives.isUnlimited()){this.onUnlimitedTimerStart();return}this.lives.isFull()&&(this.timerTitleText.kill(),this.timerText.kill(),this.fullText.revive())}onRefillTimerStart(){this.livesIcon.syncLivesNum(),this.fullText.kill(),this.timerTitleText.setText(this.scene.texts.lives.next_life),this.timerTitleText.revive(),this.timerText.revive(),this.updateTimerText()}onRefillTimerComplete(){this.livesIcon.syncLivesNum(),this.livesIcon.onLifeRefilled(),this.lives.isFull()&&(this.showFullText(),this.timerTitleText.kill(),this.timerText.kill())}onUnlimitedTimerStart(){this.livesIcon.setLivesNum(Infinity),this.fullText.kill(),this.timerTitleText.setText(this.scene.texts.lives.unlimited),this.timerTitleText.revive(),this.timerText.revive(),this.updateTimerText()}onUnlimitedTimerComplete(){this.livesIcon.syncLivesNum(),this.lives.isFull()&&(this.showFullText(),this.timerTitleText.kill(),this.timerText.kill())}onLivesAdded(){this.livesIcon.syncLivesNum(),this.livesIcon.onLifeRewarded(0),this.circlesEmitter.emitParticle(1),this.sparksEmitter.emitParticle(30)}onPageVisible(e,t){t<=0||(this.livesIcon.syncLivesNum(),this.livesIcon.onLifeRewarded(0),this.lives.isFull()&&(this.showFullText(),this.timerTitleText.kill(),this.timerText.kill()))}showFullText(){this.fullText.revive(),this.fullText.alpha=0,this.scene.tweens.add({targets:this.fullText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.fullText.scale=.75,this.scene.tweens.add({targets:this.fullText,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/lives/popup.png"),this.add(this.back)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46,this.closeButton.inflateHitArea(15,15),this.closeButton.on(_.PRESS,this.onCloseButtonClick,this)}onCloseButtonClick(){var e;(e=this.autoCloseTimerEvent)==null||e.remove()}addTitle(){let e=this.scene.texts.lives.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"46px",color:"#FFE0AD",align:"center",stroke:"#522923",strokeThickness:12};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.y=this.back.top+56,this.add(this.title)}addPanelBack(){this.panelBack=this.scene.add.image(0,0,"popups","popups/lives/panel_back.png"),this.panelBack.x=2,this.panelBack.y=-175,this.add(this.panelBack)}addParticles(){this.particles=this.scene.add.particles("popups"),this.add(this.particles),this.circlesEmitter=this.particles.createEmitter({frame:"popups/particles/circle_fx_2.png",scale:{start:.4,end:2,ease:m.ExpoOut},alpha:{start:.8,end:0,ease:m.CubicOut},lifespan:2e3,on:!1}),this.sparksEmitter=this.particles.createEmitter({frame:"popups/particles/circle_white_1.png",lifespan:3e3,speed:{min:10,max:600},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1})}addLivesIcon(){let e=this.scene.game.lives.getLivesNum();this.livesIcon=new Qy(this.scene),this.livesIcon.setLivesNum(e),this.livesIcon.x=-120,this.livesIcon.y=this.panelBack.y+4,this.add(this.livesIcon),this.particles.setPosition(this.livesIcon.x,this.livesIcon.y)}addTimerTitleText(){let e=this.scene.texts.lives.next_life,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"27px",color:"#A23E2C",align:"center"};this.timerTitleText=this.scene.add.text(0,0,e,t),this.timerTitleText.setOrigin(.5,.5),this.timerTitleText.x=96,this.timerTitleText.y=this.panelBack.y-18,this.timerTitleText.originalX=this.timerTitleText.x,this.add(this.timerTitleText)}addTimerText(){let e="00:00",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"42px",color:"#804442",align:"center"};this.timerText=this.scene.add.text(0,0,e,t),this.timerText.setOrigin(.5,.5),this.timerText.x=this.timerTitleText.x,this.timerText.y=this.timerTitleText.y+34,this.timerText.originalX=this.timerText.x,this.add(this.timerText)}addFullText(){let e=this.scene.texts.lives.full,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"50px",color:"#804442",align:"center"};this.fullText=this.scene.add.text(0,0,e,t),this.fullText.setOrigin(.5,.5),this.fullText.x=this.timerTitleText.x,this.fullText.y=this.panelBack.y,this.fullText.originalX=this.fullText.x,this.fullText.kill(),this.add(this.fullText)}addOffers(){let e=window.game.config.lives.refillPrices,t=window.game.config.ads.rewarded?{lives:1,type:"video",offerId:"lives_video_x1"}:{lives:5,type:"coins",offerId:"lives_x5",priceInCoins:e.lives_x5},s=[{offerId:"lives_x1",lives:1,type:"coins",useSeparator:!0,priceInCoins:e.lives_x1},{offerId:"lives_x3",lives:3,type:"coins",useSeparator:!0,priceInCoins:e.lives_x3},t];this.offers=s.map(i=>new qy(this.scene,i)),this.offers.forEach((i,a)=>{let{type:n,lives:r,priceInCoins:o}=i.options;i.button.on(_.RELEASE,this.onGetLivesButtonClick.bind(this,i.button,n,r,o)),i.y=5+a*140,this.add(i)})}onGetLivesButtonClick(e,t,s,i){var a;if((a=this.autoCloseTimerEvent)==null||a.remove(),this.lives.isFull()||this.lives.isUnlimited()){this.fullText.visible&&this.shakeText(this.fullText),this.timerTitleText.visible&&(this.shakeText(this.timerTitleText),this.shakeText(this.timerText)),this.scene.audio.play(u.BOOSTER_CANT_USE);return}this.emit($i.GET_LIVES_BUTTON_CLICK,t,s,i)}shakeText(e){e.x=e.originalX,this.scene.tweens.killTweensByProperty(e,"x"),this.scene.tweens.add({targets:e,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:e.originalX+12,repeat:3,yoyo:!0})}onLivesPurchaseComplete(){this.scene.time.delayedCall(300,()=>{this.scene.audio.play(u.LIFE_GRANTED,{volume:.5})}),this.autoCloseAfterAd&&(this.autoCloseTimerEvent=this.scene.time.delayedCall(1300,()=>{this.closeButton.emulatePressEvent()}))}onShow(e){this.autoCloseAfterAd=e}showOffers(){this.offers.forEach((e,t)=>{let s=e,i=t*66;s.alpha=0,this.scene.tweens.add({delay:i,targets:s,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),s.scale=.8,this.scene.tweens.add({delay:i,targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})})}onHide(){}preUpdate(e,t){this.updateTimerText()}updateTimerText(){var e,t;if(this.timerText.visible!==!1){if((e=this.lives.unlimitedTimer)==null?void 0:e.isRunning){this.timerText.text=this.lives.unlimitedTimer.getFormattedTime();return}((t=this.lives.refillTimer)==null?void 0:t.isRunning)&&(this.timerText.text=this.lives.refillTimer.getFormattedTime())}}onLanguageChange(){this.title.text=this.scene.texts.lives.title,this.timerTitleText.text=this.scene.texts.lives.next_life,this.fullText.text=this.scene.texts.lives.full,this.offers.forEach(e=>e.onLanguageChange())}preDestroy(){super.preDestroy(),this.scene.sys.updateList.remove(this),this.lives.off(N.REFILL_TIMER_START,this.onRefillTimerStart,this),this.lives.off(N.REFILL_TIMER_COMPLETE,this.onRefillTimerComplete,this),this.lives.off(N.UNLIMITED_TIMER_START,this.onUnlimitedTimerStart,this),this.lives.off(N.UNLIMITED_TIMER_COMPLETE,this.onUnlimitedTimerComplete,this),this.lives.off(N.LIVES_ADDED,this.onLivesAdded,this),this.lives.off(N.PAGE_VISIBLE,this.onPageVisible,this)}},vs;(function(e){e.LIVES_PURCHASE_COMPLETE="__LIVES_PURCHASE_COMPLETE",e.SHOW_COINS_SHOP="__SHOW_COINS_SHOP"})(vs||(vs={}));var Do=class extends ie{constructor(e){super(e,{name:"lives_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.isDeactivated=!1,this.addCoinsLabel(),this.addPopup(),this.addHintText()}addCoinsLabel(){let e={atlas:"popups",backFrame:"popups/labels/label_back.png",iconFrame:"popups/labels/Coin_2.png",iconOffset:{x:0,y:0},text:{type:"bitmap",font:B.LABELS_POPUPS}},t=this.scene.game.store.getNumber(g.COINS);this.coinsLabel=new fs(this.scene,e),this.coinsLabel.updateCoinsNumInstant(t),this.coinsLabel.circlesEmitter.setFrame("popups/particles/circle_fx_3.png"),this.coinsLabel.sparksEmitter.setFrame("popups/particles/star_particle.png"),this.pin(this.coinsLabel,0,0,70,66),this.add(this.coinsLabel)}addPopup(){this.popup=new Zy(this.scene),this.popup.closeButton.on(_.PRESS,this.hide,this),this.popup.on($i.GET_LIVES_BUTTON_CLICK,this.onGetLivesButtonClick,this),this.add(this.popup),this.pin(this.popup,.5,.5)}onGetLivesButtonClick(e,t,s){e==="video"?this.getLivesForVideo(t):this.getLivesForCoins(t,s)}getLivesForVideo(e){this.scene.game.ads.showRewardedAd("LivesPopup").then(t=>{t&&this.onLivesPurchaseComplete(e)})}getLivesForCoins(e,t){let s=this.scene.game.store.getNumber(g.COINS);if(s<t){this.onNotEnoughCoins();return}this.scene.game.store.changeNumber(g.COINS,-t,0),this.coinsLabel.updateCoinsNum(s-t),this.onLivesPurchaseComplete(e)}onNotEnoughCoins(){if(this.scene.game.purchases){this.emit(vs.SHOW_COINS_SHOP,this);return}this.coinsLabel.shakeText(),this.scene.audio.play(u.BOOSTER_CANT_USE)}onLivesPurchaseComplete(e){this.scene.game.lives.addLives(e),this.popup.onLivesPurchaseComplete(),this.hideHintText(200),this.emit(vs.LIVES_PURCHASE_COMPLETE,this)}addHintText(){let e=this.scene.texts.lives.hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#FFE0AD",align:"center"};this.hintText=this.scene.add.text(0,0,e,t),this.hintText.setOrigin(.5,.5),this.hintText.setWordWrapWidth(this.popup.width*.85),this.hintText.setLineSpacing(-2),this.hintText.alpha=.85,this.hintText.originalAlpha=this.hintText.alpha,this.hintText.originalScale=1,this.add(this.hintText)}hideHintText(e){this.hintText.visible!==!1&&this.scene.tweens.add({targets:this.hintText,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.hintText.kill()}})}resize(){super.resize(),this.coinsLabel.originalY=this.coinsLabel.y,this.resizePopup(),this.alignHintText()}resizePopup(){let e=this.screenHeight*.8;this.popup.scale=Math.min(1,e/this.popup.height),this.popup.originalScale=this.popup.scale,this.popup.originalY=this.popup.y}alignHintText(){let e=this.popup.y+this.popup.displayHeight/2-40,s=this.screenHeight-e;this.hintText.x=this.screenWidth/2,this.hintText.y=e+s/2,this.hintText.originalY=this.hintText.y}show(e={}){e=P({autoCloseAfterAd:!1},e),this.updateData(),this.alpha=1,this.popup.closeButton.enableInput(),this.revive(),this.showBackground({targetAlpha:e.backgroundAlpha}),this.showCoinsLabel(),this.showPopup(e.autoCloseAfterAd),this.showHintText(66),this.emitShowEvent()}updateData(){this.scene.game.lives.getLivesNum()===0?this.hintText.revive():this.hintText.kill()}showCoinsLabel(){this.scene.tweens.add({targets:this.coinsLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.coinsLabel.y=this.coinsLabel.originalY-60,this.scene.tweens.add({targets:this.coinsLabel,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:this.coinsLabel.originalY})}showPopup(e){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.y+=60,this.scene.tweens.add({targets:this.popup,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"}),this.popup.onShow(e)}showHintText(e){this.hintText.alpha=0,this.scene.tweens.add({delay:e,targets:this.hintText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.hintText.originalAlpha}),this.hintText.y+=60,this.scene.tweens.add({delay:e,targets:this.hintText,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"})}hide(){this.emit(b.HIDE_START,this),this.popup.closeButton.disableInput(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.popup.onHide(),this.kill(),this.emit(b.HIDE_COMPLETE,this)}})}hideBackground(){this.scene.tweens.killTweensOf(this.background),this.background.alpha=.001}onLanguageChange(){this.hintText.setText(this.scene.texts.lives.hint),this.popup.onLanguageChange()}activate(){this.isDeactivated!==!1&&(this.isDeactivated=!1,this.coinsLabel.revive(),this.popup.revive(),this.hintText.revive())}deactivate(){this.isDeactivated||(this.isDeactivated=!0,this.coinsLabel.kill(),this.popup.kill(),this.hintText.kill())}},Ho=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="confirm_popup",this.addBack(),this.addTitle(),this.addText(),this.addButtons(),this.addCloseButton(),this.bringToTop(this.noButton),this.bringToTop(this.yesButton),this.bringToTop(this.title),this.bringToTop(this.text),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/popup_small_back.png"),this.add(this.back)}addTitle(){let e="Title",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"46px",color:"#FFE0AD",align:"center",stroke:"#522923",strokeThickness:12};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.y=-214,this.add(this.title),this.adjustTitleTextSize()}adjustTitleTextSize(){let e=350;this.title.scale=Math.min(1,e/this.title.width)}addText(){let e="Are you sure?",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"44px",color:"#5F3331",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(this.back.width*.75,!0),this.text.setLineSpacing(-6),this.text.y=-45,this.add(this.text)}addButtons(){let e=120,t=100,s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#ffffff",align:"center",padding:{x:0,y:4},shadow:{color:"rgba(0,0,0,0.2)",offsetY:3,fill:!0}},i=this.scene.texts.confirm_popup.decline;this.noButton=new fe(this.scene,"popups","popups/quit/Green-Button-Long.png",this),this.noButton.addText(i,s,0,-2),this.noButton.x=-e,this.noButton.y=t;let a=this.scene.texts.confirm_popup.accept;this.yesButton=new fe(this.scene,"popups","popups/quit/Pink-Button-Long.png",this),this.yesButton.addText(a,s,0,-2),this.yesButton.x=e,this.yesButton.y=t}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-54,this.closeButton.y=this.back.top+46}updateData(e){this.title.text=e.title,this.adjustTitleTextSize(),this.text.text=e.text}onShow(){}onHide(){}onLanguageChange(){this.noButton.text.text=this.scene.texts.confirm_popup.decline,this.yesButton.text.text=this.scene.texts.confirm_popup.accept}},Jy=class extends Ho{constructor(e){super(e);this.text.y-=20,this.addSubtitle(),this.addBrokenHeartPopover()}addSubtitle(){let e=this.scene.texts.quit_subtitle,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#875A51",align:"center"};this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.y=this.text.y+50,this.add(this.subtitle)}addBrokenHeartPopover(){this.popover=this.scene.add.image(0,0,"popups","popups/quit/broken_heart_popover.png"),this.popover.x=this.yesButton.x+70,this.popover.y=this.yesButton.y-10,this.add(this.popover)}onShow(){super.onShow(),this.showPopover(250)}showPopover(e){this.popover.alpha=0,this.scene.tweens.add({delay:e,targets:this.popover,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.popover.scale=.66,this.scene.tweens.add({delay:e,targets:this.popover,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.popover.angle=-6,this.scene.tweens.add({targets:this.popover,duration:800,ease:Phaser.Math.Easing.Sine.InOut,angle:this.popover.angle*-1,yoyo:!0,repeat:-1})}onHide(){super.onHide(),this.scene.tweens.killTweensOf(this.popover)}},eC=class extends Wi{constructor(e,t){super(e,t);this.livesNum=0,this.livesManager=this.scene.game.lives,this.livesManager.on(N.REFILL_TIMER_COMPLETE,this.onLifeAdded,this),this.livesManager.on(N.PAGE_VISIBLE,this.onPageVisible,this)}onLifeAdded(){this.updateLivesNum(this.livesManager.getLivesNum())}onPageVisible(e,t){this.updateLivesNumInstant(e.getLivesNum())}updateLivesNumInstant(e){this.livesNum=e,this.text.text=this.livesNum.toString()}updateLivesNum(e){this.livesNum=e,this.text.text=this.livesNum.toString(),this.text.alpha=0,this.scene.tweens.add({targets:this.text,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.text.scale=3,this.scene.tweens.add({targets:this.text,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})}showBrokenHeart(){let e=this.scene.add.image(0,0,this.icon.texture.key,this.icon.frame.name);e.x=this.icon.x,e.y=this.icon.y,this.add(e),this.scene.tweens.add({targets:e,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{e.kill()}}),this.scene.tweens.add({targets:e,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,scale:2.5})}preDestroy(){this.livesManager.off(N.REFILL_TIMER_COMPLETE,this.onLifeAdded,this),this.livesManager.off(N.PAGE_VISIBLE,this.onPageVisible,this),super.preDestroy()}},tC=class extends ie{constructor(e){super(e,{name:"quit_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.001,backgroundInteractive:!1});this.addLivesLabel(),this.addPopup()}addLivesLabel(){let e={atlas:"gameplay_gui",backFrame:"level_complete/labels/label_back",iconOffset:{x:-2,y:-2},iconFrame:"level_complete/labels/life_icon",text:{type:"bitmap",font:B.LABELS_GAMEPLAY_GUI}};this.livesLabel=new eC(this.scene,e),this.livesLabel.updateLivesNumInstant(this.scene.game.lives.getLivesNum()),this.add(this.livesLabel),this.pin(this.livesLabel,0,0,70,66)}addPopup(){let e=this.scene.texts.quit,t=this.scene.texts.confirm_popup.question,s={title:e,text:t};this.popup=new Jy(this.scene),this.popup.updateData(s),this.popup.closeButton.on(_.PRESS,this.hide,this),this.popup.noButton.on(_.PRESS,this.hide,this),this.add(this.popup),this.pin(this.popup,.5,.5)}resize(){super.resize(),this.livesLabel.originalY=this.livesLabel.y}show(){this.alpha=1,this.emitShowEvent(),this.revive(),this.showPopup(),this.showLivesLabel()}showPopup(){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.scale=.85,this.scene.tweens.add({delay:0,targets:this.popup,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.popup.y+=100,this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.Out,y:"-=100"}),this.popup.closeButton.enableInput(),this.popup.noButton.enableInput(),this.popup.yesButton.enableInput(),this.popup.onShow()}showLivesLabel(){this.scene.tweens.add({targets:this.livesLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.livesLabel.y=this.livesLabel.originalY-100,this.scene.tweens.add({targets:this.livesLabel,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.livesLabel.originalY})}hide(){this.emitHideStartEvent(),this.popup.closeButton.disableInput(),this.popup.noButton.disableInput(),this.popup.yesButton.disableInput(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.popup.onHide(),this.kill(),this.emitHideCompleteEvent()}})}},Go=Phaser.Curves.Spline,ti;(function(e){e.CHARGE_ARRIVED="__CHARGE_ARRIVED",e.ALL_CHARGES_ARRIVED="__ALL_CHARGES_ARRIVED"})(ti||(ti={}));var sC=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.gameplay=this.scene.gameplay,this.isEnabled=this.scene.levelConfig.chefPowerups.isEnabled,this.chef=t,this.charges=[]}getChargesInMotionNum(){return this.charges.length}createCharge(){let e=this.scene.add.image(0,0,"gameplay_gui","powerup_chef/charge_fx");return e.once(Phaser.GameObjects.Events.DESTROY,this.onChargeDestroy,this),e.setDepth(ee.PARTICLES),this.charges.push(e),e}onChargeDestroy(e){this.emit(ti.CHARGE_ARRIVED,this);let t=this.charges.indexOf(e);t>-1&&(this.charges.splice(t,1),this.charges.length===0&&this.emit(ti.ALL_CHARGES_ARRIVED,this))}sendChargeToChef(e){if(this.isEnabled===!1)return;let t=this.gameplay.camera.getWorldPositionXY(e.x,e.y),s=this.createCharge();s.x=t.x,s.y=t.y;let i=this.createCurveToChef(s),a=Math.max(700,i.getLength()*1.33);this.gameplay.sounds.powerupToChef(),s.alpha=0,this.scene.tweens.add({targets:s,duration:a/2,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({targets:s,duration:a/2,ease:Phaser.Math.Easing.Expo.In,alpha:0})}}),s.scale=0,this.scene.tweens.add({targets:s,duration:a/2,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.scene.tweens.add({targets:s,duration:a/2,ease:Phaser.Math.Easing.Expo.In,scale:0})}}),this.scene.tweens.addCurveTween({curve:i,duration:a,target:s,onUpdate:()=>{this.scene.emitters.chargeEmitter.emitParticle(1,s.x,s.y)},onComplete:()=>{this.scene.emitters.powerupSparks.explode(6,s.x,s.y),this.chef.incrementCurrent(),s.destroy()}})}createCurveToChef(e){let t={x:e.x,y:e.y},s=this.chef.label.getWorldPosition(),a=Math.abs(s.x-t.x)<y?t.x+y*Phaser.Math.RND.sign():t.x+(s.x-t.x)*Phaser.Math.RND.realInRange(.5,1);return new Go([t.x,t.y,a,t.y+50,s.x,s.y])}sendChargeFromChef(e){let t=this.chef.emitPowerup(),s=this.chef.getWorldPosition(),i=this.createCharge();i.x=s.x,i.y=s.y+40*this.scene.topPanel.scaleY;let a=this.createCurveFromChef(i,e),n=33,r=Math.max(600,a.getLength()*1.25);return this.scene.audio.play(u.POWERUP_FROM_CHEF,{volume:.66}),i.alpha=0,this.scene.tweens.add({delay:n,targets:i,duration:r/2,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({targets:i,duration:r/2,ease:Phaser.Math.Easing.Expo.In,alpha:0})}}),i.scale=0,this.scene.tweens.add({delay:n,targets:i,duration:r/2,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.scene.tweens.add({targets:i,duration:r/2,ease:Phaser.Math.Easing.Expo.In,scale:0})}}),new Promise(o=>{this.scene.tweens.addCurveTween({delay:n,curve:a,duration:r,target:i,onUpdate:()=>{this.scene.emitters.chargeEmitter.emitParticle(2,i.x,i.y)},onComplete:()=>{this.scene.audio.play(u.TWINKLE_1,{volume:.5}),this.scene.emitters.powerupCircles.explode(1,i.x,i.y),this.applyPowerupToCookie(e,t),this.gameplay.sys.queueDepthSort(),i.destroy(),o()}})})}createCurveFromChef(e,t){let s={x:e.x,y:e.y},i=this.gameplay.camera.getWorldPositionXY(t.x,t.y);return new Go([s.x,s.y,s.x+(i.x-s.x)/2,s.y+200,i.x,i.y])}applyPowerupToCookie(e,t){let s=this.gameplay.applyPowerupToCookie(e,t);this.scene.tweens.add({targets:s,duration:200,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,yoyo:!0})}isPowerupReady(){return this.chef.isPowerupReady()}reset(){this.chef.resetProgress()}save(){return{current:this.chef.current,total:this.chef.total,generator:this.chef.powerupTypesGenerator.getState()}}restore(e){this.chef.current=e.current,this.chef.total=e.total,this.chef.powerupTypesGenerator.setState(e.generator),this.chef.updateProgress()}},iC=class extends bo{constructor(e){super(e);this.playButton.kill(),this.addCoinsButton(),this.addVideoButton()}addCoinsButton(){let e="0",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"35px",color:"#ffffff",align:"center"};this.coinsButton=new fe(this.scene,"popups","popups/second_chance/button_coins.png",this),this.coinsButton.addIcon("popups","popups/second_chance/coin.png",-44,-7),this.coinsButton.addText(e,t,36,this.coinsButton.icon.y-6),this.coinsButton.text.setShadow(0,3,"rgba(0,0,0,0.2)",0),this.coinsButton.x=-126,this.coinsButton.y=this.playButton.y+4,this.coinsButton.originalY=this.coinsButton.y}addVideoButton(){this.videoButton=new fe(this.scene,"popups","popups/second_chance/button_video.png",this),this.videoButton.addIcon("popups","popups/reward/watch ad.png",0,-26).setScale(.85),this.videoButton.x=126,this.videoButton.y=this.playButton.y+4,this.videoButton.originalY=this.videoButton.y}enableButtons(){this.videoButton.enableInput(),this.coinsButton.enableInput()}disableButtons(){this.videoButton.disableInput(),this.coinsButton.disableInput()}onShow(){this.showButtons({delay:100})}showButtons(e){[this.coinsButton,this.videoButton].forEach(t=>{t.alpha=0,this.scene.tweens.add({delay:e.delay,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let s=t.scale;t.scale=s*.75,this.scene.tweens.add({delay:e.delay,targets:t,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:s})})}onHide(){}updateData(e){super.updateData(e),this.coinsButton.text.text=e.boosterPriceInCoins.toString(),e.disableVideoButton?(this.videoButton.kill(),this.coinsButton.x=0):(this.videoButton.revive(),this.videoButton.x=this.getButtonsCenterOffsetX(),this.coinsButton.x=-this.getButtonsCenterOffsetX())}getButtonsCenterOffsetX(){return 126}},Xe;(function(e){e.BOOSTER_BUY_COMPLETE="__BOOSTER_BUY_COMPLETE",e.SHOW_SHOP="__SHOW_SHOP"})(Xe||(Xe={}));var on=class extends ie{constructor(e){super(e,{name:"get_booster_screen",backgroundAlpha:.85,backgroundKey:"popups",backgroundFrame:"popups/black_rect.png"});this.isDeactivated=!1,this.addCoinsLabel(),this.addPopup()}addCoinsLabel(){let e={atlas:"popups",backFrame:"popups/labels/label_back.png",iconFrame:"popups/labels/Coin_2.png",iconOffset:{x:0,y:0},text:{type:"bitmap",font:B.LABELS_POPUPS}};this.coinsLabel=new fs(this.scene,e),this.coinsLabel.syncWithGameStore(!0),this.pin(this.coinsLabel,0,0,70,66),this.add(this.coinsLabel),this.scene.game.purchases&&(this.coinsLabel.setInteractive(),this.coinsLabel.input.cursor="pointer",this.coinsLabel.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onCoinsLabelClick,this))}onCoinsLabelClick(){this.emit(Xe.SHOW_SHOP,this)}addPopup(){this.popup=new iC(this.scene),this.popup.closeButton.on(_.PRESS,this.onCloseButtonClick,this),this.popup.coinsButton.on(_.PRESS,this.onCoinsButtonClick,this),this.popup.videoButton.on(_.RELEASE,this.onVideoButtonClick,this),this.add(this.popup),this.pin(this.popup,.5,.55)}onCloseButtonClick(){this.hide()}onCoinsButtonClick(e){let t=this.scene.game.store.getNumber(g.COINS),s=this.screenData.boosterPriceInCoins;if(s>t){this.onNotEnoughCoins();return}let i=this.scene.game.store.changeNumber(g.COINS,-s);this.coinsLabel.updateCoinsNum(i),this.scene.analytics.subtractResource(ue.COINS,s,Te.COIN,`Booster_${this.screenData.rewardType}`),this.giveBooster("coins")}onNotEnoughCoins(){if(this.scene.game.purchases){this.emit(Xe.SHOW_SHOP,this);return}this.scene.audio.play(u.BOOSTER_CANT_USE),this.coinsLabel.shakeText()}onVideoButtonClick(){var e;this.scene.game.ads.showRewardedAd(`Gameplay:BoosterBuyScreen:${(e=this.screenData)==null?void 0:e.rewardType}`).then(t=>{t&&this.giveBooster("video")})}giveBooster(e){this.emit(Xe.BOOSTER_BUY_COMPLETE,this.screenData,e)}resize(){super.resize(),this.coinsLabel.originalY=this.coinsLabel.y,this.popup.originalY=this.popup.y,this.resizePopup()}resizePopup(){let e=this.screenHeight*.75;this.popup.scale=Math.min(1,e/this.popup.height),this.popup.originalScale=this.popup.scale}updateData(e){this.screenData=e,this.popup.updateData(e),this.coinsLabel.updateCoinsNumInstant(e.coinsTotal)}show(e){this.emitShowEvent(),this.revive(),this.alpha=1,this.showCoinsLabel(),this.showPopup(),e.showBackground?(this.background.revive(),this.showBackground()):this.background.kill()}showCoinsLabel(){this.coinsLabel.alpha=0,this.scene.tweens.add({targets:this.coinsLabel,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.coinsLabel.y=this.coinsLabel.originalY-50,this.scene.tweens.add({targets:this.coinsLabel,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.coinsLabel.originalY})}showPopup(e=0){this.popup.alpha=0,this.scene.tweens.add({delay:e,targets:this.popup,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.popup.y=this.popup.originalY+50,this.scene.tweens.add({delay:e,targets:this.popup,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.popup.originalY}),this.popup.onShow(),this.popup.enableButtons()}hide(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.popup.onHide(),this.kill(),this.emitHideCompleteEvent()}})}hideInstant(){this.emitHideStartEvent(),this.popup.onHide(),this.kill(),this.emitHideCompleteEvent()}activate(){this.isDeactivated!==!1&&(this.isDeactivated=!1,this.coinsLabel.revive(),this.popup.revive())}deactivate(){this.isDeactivated||(this.isDeactivated=!0,this.coinsLabel.kill(),this.popup.kill())}};function Fo(e){const t=e>0?Math.floor:Math.ceil;return{days:t(e/864e5),hours:t(e/36e5)%24,minutes:t(e/6e4)%60,seconds:t(e/1e3)%60,milliseconds:t(e)%1e3,microseconds:t(e*1e3)%1e3,nanoseconds:t(e*1e6)%1e3}}var hn=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.addHeart(),this.addText(),this.setSize(this.heart.width,this.heart.height)}addHeart(){this.heart=this.scene.add.image(0,0,"popups","popups/shop/heart.png"),this.add(this.heart)}addText(){let e="1h",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"25px",color:"#ffffff",align:"center",stroke:"#A72830",strokeThickness:6};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.y=this.heart.bottom-10,this.add(this.text)}updateTime(e){let t=this.formatDuration(e);this.text.setText(t)}formatDuration(e){let t=this.scene.texts.greetings,s=Fo(e),i=s.hours>0?t.hours.replace("#",s.hours.toString()):"",a=s.minutes>0?t.minutes.replace("#",s.minutes.toString()):"";return[i,a].filter(Boolean).join(" ")}updateTextContent(e){this.text.setText(e)}},aC=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.options=t,this.addPlusText(),this.addCoinsText(),this.addLifeIcon(),this.bringToTop(this.coinsText),this.bringToTop(this.plusText)}addPlusText(){let e="+",t=this.options.textStyle;this.plusText=this.scene.add.text(0,0,e,t),this.plusText.setOrigin(.5,.5),this.add(this.plusText)}addCoinsText(){let e="0",t=this.options.textStyle;this.coinsText=this.scene.add.text(0,0,e,t),this.coinsText.setOrigin(1,.5),this.coinsText.x=this.plusText.x-this.options.plusMargin,this.add(this.coinsText)}addLifeIcon(){this.lifeIcon=new hn(this.scene),this.lifeIcon.scale=.75,this.lifeIcon.x=this.plusText.x+this.lifeIcon.displayWidth/2+this.options.plusMargin,this.add(this.lifeIcon)}doSetSize(){let e=this.coinsText.left,s=this.lifeIcon.x+this.lifeIcon.displayWidth/2-e,i=Math.max(this.coinsText.displayHeight,this.lifeIcon.displayHeight);this.setSize(s,i)}updateContent(e,t){this.coinsText.setText(e.toLocaleString()),this.lifeIcon.updateTime(t)}},ln=class extends fe{constructor(e,t){super(e,"popups",t.type==="common"?"popups/shop/button_pink.png":"popups/shop/button_purple.png");this.options=t,this.name=`offer_button__${this.options.offerId}`,this.doAddText(),this.inflateHitArea(20,20)}doAddText(){let e=this.getTextContent(this.options.price),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center",stroke:this.options.type==="common"?"#F06B5C":"#8E5481",strokeThickness:5};this.addText(e,t),this.text.y-=4,this.text.setWordWrapWidth(this.width*.55),this.text.setLineSpacing(-12)}getTextContent(e){var t;if(typeof e=="string")return e;let s=window.game.config.purchases.currency.template;return((t=s[this.scene.game.texts.language])!=null?t:s.en).replace("#",e.toString())}onLanguageChange(){this.text.setText(this.getTextContent(this.options.price))}},Uo=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.options=t,this.name=`offer_${this.options.offerId}`,this.addBack(),this.addChest(),this.addTitle(),this.addSubtitle(),this.addButton(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/shop/special_offer_bg.png"),this.add(this.back)}addChest(){this.chest=this.scene.add.image(0,0,"popups","popups/shop/coins_chest.png"),this.chest.x=this.back.left+85,this.chest.y=this.back.bottom-30,this.add(this.chest)}addTitle(){let e=this.scene.texts.shop.special_offer,t=this.getTitleTextStyle();this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.x=90,this.title.y=this.back.top+35,this.add(this.title)}getTitleTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"34px",color:"#ffffff",align:"center",stroke:"#E98A49",strokeThickness:8}}addSubtitle(){let e={textStyle:this.getTitleTextStyle(),plusMargin:20};this.subtitle=new aC(this.scene,e),this.subtitle.x=this.title.x+30,this.subtitle.y=this.title.y+48,this.subtitle.updateContent(this.options.coinsNum,this.options.livesNum),this.add(this.subtitle)}addButton(){let e={type:"special",offerId:this.options.offerId,price:this.options.price};this.button=new ln(this.scene,e),this.button.x=this.title.x,this.button.y=50,this.add(this.button)}onLanguageChange(){this.title.setText(this.scene.texts.shop.special_offer),this.subtitle.updateContent(this.options.coinsNum,this.options.livesNum),this.button.onLanguageChange()}},qi;(function(e){e.BEST_VALUE="BEST_VALUE",e.MOST_POPULAR="MOST_POPULAR"})(qi||(qi={}));var nC=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.popoverType=t,this.addBack(),this.addText()}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/shop/popover.png"),this.add(this.back)}addText(){let e=this.getContentByType(this.popoverType),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"18px",color:"#ffffff",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.y=-22,this.text.setShadow(0,2,"rgba(0,0,0,0.2)",0),this.add(this.text),this.adjustTextSize()}getContentByType(e){switch(e){case qi.BEST_VALUE:return this.scene.texts.shop.best_value;case qi.MOST_POPULAR:return this.scene.texts.shop.most_popular;default:let t=e;break}}adjustTextSize(){let e=this.back.width*.8;this.text.scale=Math.min(1,e/this.text.width)}onLanguageChange(){this.text.setText(this.getContentByType(this.popoverType)),this.adjustTextSize()}},rC=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.plusSignMargin=75,this.options=t,this.name=`offer_${this.options.offerId}`,this.addBack(),this.addIcon(),this.addCoinsText(),this.addPopover(),this.addPlus(),this.addLifeIcon(),this.addButton(),this.addSeparator(),this.bringToTop(this.button),this.setSize(this.back.width,this.back.height),this.options.livesNum===0&&(this.plusSign.kill(),this.lifeIcon.kill(),this.coinsIcon.x+=70,this.coinsText.x=this.coinsIcon.x)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/black_rect.png"),this.back.alpha=.1,this.back.displayWidth=470,this.back.displayHeight=this.options.height,this.add(this.back),this.back.kill()}addIcon(){let e=this.back.x-this.back.displayWidth/2;this.coinsIcon=this.scene.add.image(0,0,"popups",this.options.iconFrame),this.coinsIcon.x=e+67,this.coinsIcon.y=0,this.add(this.coinsIcon)}addCoinsText(){let e=this.options.coinsNum.toLocaleString();this.coinsText=this.scene.add.bitmapText(0,0,B.SHOP_COINS,e,28),this.coinsText.setLetterSpacing(1.5),this.coinsText.setOrigin(.5,.5),this.coinsText.x=this.coinsIcon.x,this.coinsText.y=this.coinsIcon.y+44,this.add(this.coinsText)}addPopover(){this.options.popoverType!==void 0&&(this.popover=new nC(this.scene,this.options.popoverType),this.popover.x=this.coinsIcon.x,this.popover.y=this.coinsIcon.y-30,this.add(this.popover))}addPlus(){this.plusSign=this.scene.add.image(0,0,"popups","popups/shop/plus.png"),this.plusSign.x=this.coinsIcon.x+this.plusSignMargin,this.add(this.plusSign)}addLifeIcon(){this.lifeIcon=new hn(this.scene),this.lifeIcon.x=this.plusSign.x+this.plusSignMargin-12,this.lifeIcon.updateTime(Gi({hours:this.options.livesNum})),this.add(this.lifeIcon)}addButton(){let e={type:"common",offerId:this.options.offerId,price:this.options.price},t=this.back.x+this.back.displayWidth/2;this.button=new ln(this.scene,e),this.button.x=t-this.button.displayWidth/2-15,this.button.y=10,this.add(this.button)}onLanguageChange(){var e;(e=this.popover)==null||e.onLanguageChange(),this.button.onLanguageChange(),this.lifeIcon.updateTime(Gi({hours:this.options.livesNum}))}addSeparator(){this.options.useSeparator!==!1&&(this.separator=this.scene.add.image(0,0,"popups","popups/shop/separator.png"),this.separator.y=this.back.y+this.back.displayHeight/2,this.add(this.separator))}},Wo=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.contentType="common",this.offers=[]}createShopOfferData(e){let t=this.scene.game.purchases.getOfferById(e);if(t===void 0){""+e;return}return{offerId:t.id,price:t.price,coinsNum:t.content.coins,livesNum:t.content.lives,isSpecial:t.isSpecial}}createShopOfferOptions(e){let t=this.createShopOfferData(e.offerId);if(t!==void 0)return P(P({},t),e)}createOffer(e){let t=this.createShopOfferData(e.offerId);if(t===void 0)return;let s=P(P({},t),e);return s.isSpecial?this.createSpecialOffer(s):this.createCommonOffer(s)}createCommonOffer(e){let t=new rC(this.scene,e);return this.offers.push(t),this.addButtonReleaseListener(t),t}createSpecialOffer(e){let t=new Uo(this.scene,e);return this.offers.push(t),this.addButtonReleaseListener(t),t}addButtonReleaseListener(e){e.button.on(_.RELEASE,this.onButtonClick.bind(this,e.options.offerId))}onButtonClick(e,t){this.emit(Ts.PURCHASE_CLICK,t,e)}animateOnSwitch(){}onLanguageChange(){this.offers.forEach(e=>e.onLanguageChange())}onShow(){}onHide(){}},oC=class extends Wo{constructor(e){super(e);this.contentType="special",this.addSpecialOffer(),this.addCommonOffers()}addSpecialOffer(){let e={offerId:"special_30000",iconFrame:"popups/shop/coins_chest.png",useSeparator:!1,height:0};this.specialOffer=this.createOffer(e),this.specialOffer&&this.add(this.specialOffer)}addCommonOffers(){let e=146,t=[{offerId:"coins_20000",iconFrame:"popups/shop/coins_2.png",useSeparator:!0,height:e},{offerId:"coins_50000",iconFrame:"popups/shop/coins_3.png",useSeparator:!0,height:e},{offerId:"coins_100000",iconFrame:"popups/shop/coins_4.png",useSeparator:!1,height:e}];this.commonOffers=t.map(s=>this.createOffer(s)).filter(Boolean),this.commonOffers.forEach((s,i)=>{s.y=164+i*e,this.add(s)})}onShow(){super.onShow(),this.startSpecialOfferAnimation()}startSpecialOfferAnimation(){!this.specialOffer||(this.killSpecialOfferTweens(),this.specialOfferTimerEvent=this.scene.time.addEvent({loop:!0,delay:4e3,startAt:3e3,callback:()=>{this.scene.tweens.add({targets:this.specialOffer,duration:333,ease:Phaser.Math.Easing.Sine.InOut,scale:1.03,yoyo:!0,repeat:2})}}))}killSpecialOfferTweens(){this.specialOffer&&(this.specialOffer.scale=1,this.scene.tweens.killTweensOf(this.specialOffer))}onHide(){var e;super.onHide(),(e=this.specialOfferTimerEvent)==null||e.remove(),this.specialOfferTimerEvent=null}preDestroy(){var e;(e=this.specialOfferTimerEvent)==null||e.remove(),this.specialOfferTimerEvent=null,this.killSpecialOfferTweens(),super.preDestroy()}},hC=class extends Wo{constructor(e){super(e);this.contentType="common",this.addOffers()}addOffers(){let e=-50,t=160,s=[{offerId:"coins_3000",iconFrame:"popups/shop/coins_2.png",useSeparator:!0,height:t},{offerId:"coins_5000",iconFrame:"popups/shop/coins_3.png",useSeparator:!0,height:t},{offerId:"coins_10000",iconFrame:"popups/shop/coins_4.png",useSeparator:!0,height:t},{offerId:"coins_20000",iconFrame:"popups/shop/coins_5.png",useSeparator:!1,height:t}];this.offers=s.map(i=>this.createOffer(i)).filter(Boolean),this.offers.forEach((i,a)=>{i.y=e+a*t,this.add(i)})}animateOnSwitch(){this.offers.forEach((e,t)=>{let s=20;e.alpha=0,e.y+=s,this.scene.tweens.add({delay:t*80,targets:e,duration:250,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1,y:e.y-s})})}},Ts;(function(e){e.PURCHASE_CLICK="__PURCHASE_CLICK"})(Ts||(Ts={}));var lC=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.addBack(),this.addCloseButton(),this.addTitle(),this.addContent(t),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/shop/popup.png"),this.add(this.back)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46}addTitle(){let e=this.scene.texts.shop.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"46px",color:"#FFE0AD",align:"center",stroke:"#522923",strokeThickness:12};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.y=this.back.top+56,this.add(this.title)}addContent(e){return this.content=e==="special"?new oC(this.scene):new hC(this.scene),this.content.y=-175,this.content.on(Ts.PURCHASE_CLICK,this.onBuyButtonClick,this),this.add(this.content),this.content}onBuyButtonClick(e,t){this.emit(Ts.PURCHASE_CLICK,t)}onSpecialOfferBought(){this.content.contentType==="special"!==!1&&this.switchToCommonContent()}switchToCommonContent(){this.scene.tweens.add({targets:this.content,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.content.destroy(),this.content=this.addContent("common"),this.content.animateOnSwitch()}})}onShow(){this.content.onShow()}onHide(){this.content.onHide()}onLanguageChange(){this.title.text=this.scene.texts.shop.title,this.content.onLanguageChange()}},_s;(function(e){e.PURCHASE_COMPLETE="__PURCHASE_COMPLETE"})(_s||(_s={}));var Yo=class extends ie{constructor(e){super(e,{name:"shop_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.purchases=this.scene.game.purchases,this.addCoinsLabel(),this.addPopup(),this.addAdsText()}addCoinsLabel(){let e={atlas:"popups",backFrame:"popups/labels/label_back.png",iconFrame:"popups/labels/Coin_2.png",iconOffset:{x:0,y:0},text:{type:"bitmap",font:B.LABELS_POPUPS}},t=this.scene.game.store.getNumber(g.COINS);this.coinsLabel=new fs(this.scene,e),this.coinsLabel.updateCoinsNumInstant(t),this.coinsLabel.circlesEmitter.setFrame("popups/particles/circle_fx_3.png"),this.coinsLabel.sparksEmitter.setFrame("popups/particles/star_particle.png"),this.pin(this.coinsLabel,0,0,70,66),this.add(this.coinsLabel)}addPopup(){let e=this.scene.game.store.getBoolean(g.SHOP_SPECIAL_OFFER_BOUGHT),t="common";this.popup=new lC(this.scene,t),this.popup.on(Ts.PURCHASE_CLICK,this.onBuyButtonClick,this),this.popup.closeButton.on(_.PRESS,this.hide,this),this.add(this.popup),this.pin(this.popup,.5,.5)}onBuyButtonClick(e){this.purchases.make(e,this.referrer).then(()=>{this.onPurchaseComplete(e)})}onPurchaseComplete(e){this.scene.audio.play(u.COIN_SPEND,{volume:.5}),this.purchases.savePurchase(e),this.coinsLabel.playAnimation(),this.coinsLabel.updateCoinsNum(this.scene.game.store.getNumber(g.COINS)),this.purchases.isSpecialOffer(e)&&this.popup.onSpecialOfferBought(),this.emit(_s.PURCHASE_COMPLETE,this,e)}addAdsText(){let e=this.scene.texts.shop.ads_hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#FFE0AD",align:"center",stroke:"#41211F",strokeThickness:6};this.adsText=this.scene.add.text(0,0,e,t),this.adsText.setOrigin(.5,.5),this.adsText.setWordWrapWidth(this.popup.width*.85),this.adsText.setLineSpacing(-6),this.adsText.alpha=.85,this.adsText.originalAlpha=this.adsText.alpha,this.adsText.originalScale=1,this.add(this.adsText)}resize(){super.resize(),this.resizePopup(),this.alignAdsText(),this.coinsLabel.originalY=this.coinsLabel.y}resizePopup(){let e=this.screenHeight*.8;this.popup.scale=Math.min(1,e/this.popup.height),this.popup.originalScale=this.popup.scale,this.popup.originalY=this.popup.y}alignAdsText(){let e=this.popup.y+this.popup.displayHeight/2-40,s=this.screenHeight-e;this.adsText.x=this.screenWidth/2,this.adsText.y=e+s/2,this.adsText.originalY=this.adsText.y}show(e){this.alpha=1,this.emitShowEvent(),this.revive(),this.showPopup(),this.showAdsText(66),this.showCoinsLabel(),e.showBackground?(this.background.revive(),this.showBackground({duration:200,ease:Phaser.Math.Easing.Quadratic.Out})):this.background.kill(),this.scene.audio.play(u.SHOP_OPEN,{volume:.25,seek:.3})}showPopup(){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.y+=60,this.scene.tweens.add({targets:this.popup,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"}),this.popup.onShow()}showAdsText(e){this.adsText.alpha=0,this.scene.tweens.add({delay:e,targets:this.adsText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.adsText.originalAlpha}),this.adsText.y+=60,this.scene.tweens.add({delay:e,targets:this.adsText,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"})}showCoinsLabel(){this.scene.tweens.add({targets:this.coinsLabel,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.coinsLabel.y=this.coinsLabel.originalY-60,this.scene.tweens.add({targets:this.coinsLabel,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:this.coinsLabel.originalY})}hide(){this.emitHideStartEvent(),this.scene.audio.stop(u.SHOP_OPEN),this.popup.onHide(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.kill(),this.emitHideCompleteEvent()}})}onLanguageChange(){this.adsText.text=this.scene.texts.shop.ads_hint,this.popup.onLanguageChange()}preDestroy(){this.scene.audio.stop(u.SHOP_OPEN),super.preDestroy()}},Qi;(function(e){e.EXPLODE_COMPLETE="__EXPLODE_COMPLETE"})(Qi||(Qi={}));var cC=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="piggy_bank_large",this.addPiggy(),this.addPiggyWhite(),this.addShrinkParticles(),this.addExplodeParticles(),this.bringToTop(this.piggyBank),this.bringToTop(this.piggyBankWhite),this.setSize(this.piggyBank.displayWidth,this.piggyBank.displayHeight)}addShrinkParticles(){this.shrinkParticles=this.scene.add.particles("rewards"),this.shrinkParticles.setPosition(-10,-100),this.add(this.shrinkParticles),this.shrinkGravityWell=this.shrinkParticles.createGravityWell({power:10,epsilon:250,gravity:200}),this.shrinkCircles=this.shrinkParticles.createEmitter({frame:"rewards/particles/gift_circle_fx.png",alpha:{start:0,end:.33,ease:m.ExpoOut},scale:{start:6,end:.45,ease:m.Linear},lifespan:500,frequency:333,on:!1});let e=new Phaser.Geom.Circle(0,0,this.piggyBankWhite.displayWidth);this.shrinkSparks=this.shrinkParticles.createEmitter({frame:"rewards/particles/wheel_reward_spark.png",lifespan:800,alpha:{start:0,end:1,ease:m.ExpoOut},scale:{start:1.33,end:.33},quantity:2,on:!1}).setDeathZone({source:new Phaser.Geom.Circle(0,0,e.radius*.25),type:"onEnter"}).setEmitZone({source:e,type:"random"})}addExplodeParticles(){this.explodeParticles=this.scene.add.particles("rewards"),this.explodeParticles.setPosition(0,-80),this.add(this.explodeParticles),this.explodeCircles=this.explodeParticles.createEmitter({frame:"rewards/particles/gift_circle_fx.png",alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:.45,end:8,ease:m.ExpoOut},lifespan:900,on:!1}),this.explodeSparks=this.explodeParticles.createEmitter({frame:"rewards/particles/wheel_reward_spark.png",lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1}),this.explodeSparks.reserve(100)}addPiggy(){this.piggyBank=this.scene.add.image(0,0,"popups","popups/piggy_bank/piggy_bank_large.png"),this.add(this.piggyBank)}addPiggyWhite(){this.piggyBankWhite=this.scene.add.image(0,0,"popups","popups/piggy_bank/piggy_bank_large.png"),this.piggyBankWhite.setOrigin(this.piggyBank.originX,this.piggyBank.originY),this.piggyBankWhite.kill(),this.add(this.piggyBankWhite)}explode(){this.shrinkSparks.on=!0,this.shrinkCircles.on=!0,this.stopIdleTween(),this.shrinkPiggy(),this.shakePiggy()}shrinkPiggy(){var e;let t=1333;this.scene.tweens.killTweensOf(this.piggyBank),(e=this.scene.audio.play(u.DOUBLE_SPHERES_CHARGE))==null||e.fade(0,1,t),this.scene.tweens.add({targets:this.piggyBank,duration:100,ease:Phaser.Math.Easing.Linear,scaleX:1,scaleY:1,onComplete:()=>{this.scene.tweens.add({targets:[this.piggyBank,this.piggyBankWhite],duration:t,ease:Phaser.Math.Easing.Linear,scale:this.piggyBank.scale*.6,onComplete:()=>{this.onShrinkComplete()}}),this.piggyBankWhite.scaleX=this.piggyBank.scaleX,this.piggyBankWhite.scaleY=this.piggyBank.scaleY,this.piggyBankWhite.alpha=0,this.scene.tweens.add({targets:this.piggyBankWhite,duration:t,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1})}})}shakePiggy(){let e=[this.piggyBankWhite,this.piggyBank],t=33,s=7;this.shakeTween=this.scene.tweens.add({targets:e,duration:t,ease:Phaser.Math.Easing.Linear,x:`+=${s}`,onComplete:()=>{this.shakeTween=this.scene.tweens.add({targets:e,duration:t,ease:Phaser.Math.Easing.Sine.InOut,x:`-=${s*2}`,repeat:-1,yoyo:!0})}})}onShrinkComplete(){var e;(e=this.shakeTween)==null||e.remove(),this.piggyBank.kill(),this.emit(Qi.EXPLODE_COMPLETE,this),this.scene.audio.play(u.GIFT_EXPLODE),this.shrinkParticles.kill(),this.shrinkSparks.on=!1,this.shrinkCircles.on=!1,this.explodeCircles.emitParticle(1),this.explodeSparks.emitParticle(100),this.scene.tweens.add({targets:[this.piggyBank,this.piggyBankWhite],duration:600,ease:Phaser.Math.Easing.Expo.Out,scale:3,alpha:0,y:"+=100",onComplete:()=>{this.piggyBank.kill(),this.piggyBankWhite.kill()}})}playIdleTween(){var e;(e=this.idleTween)==null||e.remove(),this.idleTween=this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.04,scaleY:.97,yoyo:!0,repeat:-1})}stopIdleTween(){var e;(e=this.idleTween)==null||e.remove(),this.idleTween=null}reset(){this.piggyBank.scale=1,this.piggyBank.alpha=1,this.piggyBank.x=0,this.piggyBank.y=0,this.piggyBank.revive()}},si;(function(e){e.BREAK="__BREAK"})(si||(si={}));var Vo=class extends ie{constructor(e){super(e,{name:"PiggyBankScreen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.piggyBankPinY=.6,this.piggyBankService=this.scene.game.piggyBank,this.createAddCoinThrottledSound(),this.addTopLeftCoinsLabel(),this.addCloseButton(),this.addTitle(),this.addHint(),this.addPiggyBank(),this.addCoinsLabel(),this.addBreakButton(),this.bringToTop(this.breakButton),this.bringToTop(this.title),this.bringToTop(this.hint)}createAddCoinThrottledSound(){this.addCoinSound=Ft(()=>{this.scene.audio.play(u.COIN_ADD,{volume:.5})},50,{trailing:!1})}addTopLeftCoinsLabel(){let e={atlas:"popups",backFrame:"popups/labels/label_back.png",iconFrame:"popups/labels/Coin_2.png",iconOffset:{x:0,y:0},text:{type:"bitmap",font:B.LABELS_POPUPS}};this.topLeftCoinsLabel=new fs(this.scene,e),this.topLeftCoinsLabel.syncWithGameStore(!0),this.topLeftCoinsLabel.circlesEmitter.setFrame("popups/particles/circle_fx_3.png"),this.topLeftCoinsLabel.sparksEmitter.setFrame("popups/particles/star_particle.png"),this.topLeftCoinsLabel.kill(),this.pin(this.topLeftCoinsLabel,0,0,70,66),this.add(this.topLeftCoinsLabel)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/piggy_bank/button_close_2.png",this),this.closeButton.on(_.PRESS,this.onCloseButtonClick,this),this.closeButton.inflateHitArea(15,15),this.pin(this.closeButton,1,0,-80,80)}addTitle(){let e=this.scene.texts.piggy_bank.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"68px",color:"#FFA48E",align:"center",padding:{x:0,y:10}};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.setShadow(0,4,"#AC4717",2),this.add(this.title),this.pin(this.title,.5,this.piggyBankPinY,0,-450)}addHint(){let e=this.scene.texts.piggy_bank.warning,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"28px",color:"#FE8C82",align:"center",padding:{x:0,y:2}};this.hint=this.scene.add.text(0,0,e,t),this.hint.setOrigin(.5,.5),this.hint.setShadow(0,3,"rgba(0,0,0,0.2)"),this.hint.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.7),this.add(this.hint),this.pin(this.hint,.5,this.piggyBankPinY,0,-350)}addPiggyBank(){this.piggyBank=new cC(this.scene),this.pin(this.piggyBank,.5,this.piggyBankPinY,12),this.add(this.piggyBank)}addCoinsLabel(){let e=this.scene.add.image(-5,0,"popups","popups/piggy_bank/coins_label.png");this.coinsLabelText=this.createCoinsText(),this.coinsLabelText.x=17,this.coinsLabelText.y=-2,this.coinsLabelText.originalX=this.coinsLabelText.x,this.coinsLabel=this.scene.add.container(0,0,[e,this.coinsLabelText]),this.pin(this.coinsLabel,.5,this.piggyBankPinY,4,50),this.add(this.coinsLabel)}createCoinsText(){let e="0 / 0",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center",padding:{x:0,y:2}},s=this.scene.add.text(0,0,e,t);return s.setOrigin(.5,.5),s.setShadow(0,2,"rgba(0,0,0,0.2)",0),s}addBreakButton(){var e;this.scene.game.piggyBank.getBreakMethod()==="purchase"?this.addPurchaseButton():this.addVideoButton(),this.breakButton=(e=this.videoButton)!=null?e:this.purchaseButton,this.breakButton.name="break_button"}addVideoButton(){let e=this.scene.texts.piggy_bank.break_it,t=this.getBreakButtonTextStyle();this.videoButton=this.scene.add.complexButton("popups","popups/piggy_bank/button_double.png"),this.videoButton.addIcon("popups","popups/piggy_bank/watch ad.png",135,-60).setScale(.9),this.videoButton.addText(e,t,0,-3),this.videoButton.text.setLineSpacing(-4),this.videoButton.text.setWordWrapWidth(210,!0),this.videoButton.on(_.RELEASE,this.onVideoButtonClick,this),this.add(this.videoButton),this.pin(this.videoButton,.5,.7)}onVideoButtonClick(e){if(this.canBreak()===!1){this.showCantBreakWarning();return}this.scene.game.ads.showRewardedAd("LevelMap:PiggyBank").then(s=>{s&&(e.disableInput(),this.onPiggyBankBreak())})}addPurchaseButton(){let e=this.scene.texts.piggy_bank.break_it,t=k(P({},this.getBreakButtonTextStyle()),{fontSize:"34px"});this.purchaseButton=this.scene.add.complexButton("popups","popups/piggy_bank/button_double.png"),this.purchaseButton.addText(e,t,0,-16),this.purchaseButton.text.setLineSpacing(-4),this.purchaseButton.text.setWordWrapWidth(210,!0),this.purchaseButton.on(_.RELEASE,this.onPurchaseButtonClick,this),this.add(this.purchaseButton),this.pin(this.purchaseButton,.5,.7),this.addPriceText()}addPriceText(){let t=`${this.scene.game.purchases.getOfferById("piggy_bank").price} \u0433\u043E\u043B\u043E\u0441\u043E\u0432`,s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center"},i=this.scene.add.text(0,0,t,s);i.setShadow(0,3,"rgba(0,0,0,0.2)",0),i.setOrigin(.5,.5),i.y=16,this.purchaseButton.add(i)}onPurchaseButtonClick(){if(this.canBreak()===!1){this.showCantBreakWarning();return}this.scene.game.purchases.make("piggy_bank","PiggyBank_Screen").then(()=>this.onPiggyBankBreak())}getBreakButtonTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"32px",color:"#ffffff",align:"center",padding:{x:0,y:6},shadow:{offsetX:0,offsetY:3,fill:!0,color:"rgba(0,0,0,0.2)",blur:0}}}canBreak(){return this.scene.game.piggyBank.getCurrentCoins()>=window.game.config.piggy_bank.min_amount_to_open}showCantBreakWarning(){this.shakeCoinsText(),this.scene.audio.play(u.BOOSTER_CANT_USE,{volume:.75}),this.scene.game.toasts.show({message:this.scene.texts.piggy_bank.not_enough.replace("#",window.game.config.piggy_bank.min_amount_to_open.toString()),lifespan:3e3})}onPiggyBankBreak(){this.scene.input.once(Phaser.Input.Events.POINTER_DOWN,this.startFastForward,this);let e=this.scene.game.store.getNumber(g.PIGGY_BANK_COINS);this.getItemsToHide().forEach(t=>t.kill()),this.showTopLeftCoinsLabel(),this.updateGameStore(e),this.piggyBank.once(Qi.EXPLODE_COMPLETE,this.onExplodeComplete.bind(this,e)),this.piggyBank.explode(),this.emit(si.BREAK,this,e)}startFastForward(){this.scene.fastForward.start(1.5)}getItemsToHide(){return[this.title,this.hint,this.coinsLabel,this.coinsLabelText,this.breakButton,this.closeButton]}showTopLeftCoinsLabel(){this.topLeftCoinsLabel.syncWithGameStore(!0),this.topLeftCoinsLabel.revive()}updateGameStore(e){this.scene.game.store.saveValue(g.PIGGY_BANK_COINS,0),this.scene.game.store.changeNumber(g.COINS,e),this.scene.game.analytics.addResource(ue.COINS,e,Te.COIN,"PiggyBank")}onExplodeComplete(e){let t=10,s=os(()=>{this.topLeftCoinsLabel.syncWithGameStore(!1),this.topLeftCoinsLabel.playTextTween(),this.topLeftCoinsLabel.playAnimation(),this.topLeftCoinsLabel.showTextFx(`+${e}`)}),i=vt(t,()=>{this.scene.time.delayedCall(1100,()=>{this.hide()})});ke(t,()=>this.collectCoin(s,i)),this.scene.audio.play(u.COIN_SPEND,{volume:1})}collectCoin(e,t){let s=this.scene.add.image(0,0,"popups","popups/labels/Coin_2.png");s.x=this.piggyBank.x,s.y=this.piggyBank.y-60,this.addAt(s,1);let i={x:s.x+Phaser.Math.RND.between(30,60)*Phaser.Math.RND.sign(),y:s.y+Phaser.Math.RND.between(30,60)*Phaser.Math.RND.sign()},a={x:this.topLeftCoinsLabel.x,y:this.topLeftCoinsLabel.y},n=new Phaser.Curves.Spline([i.x,i.y,i.x-Phaser.Math.RND.between(-50,150),i.y-Phaser.Math.RND.between(-70,0),a.x,a.y]),r=Phaser.Math.RND.between(700,1100),o=0;this.scene.tweens.addCurveTween({delay:o,curve:n,target:s,duration:r,ease:m.QuadInOut,onComplete:()=>{s.destroy(),e(),t(),this.addCoinSound()}}),this.scene.tweens.add({targets:s,duration:r+o,ease:Phaser.Math.Easing.Back.In,angle:360}),s.scale=0,this.scene.tweens.add({delay:o,targets:s,duration:800,ease:Phaser.Math.Easing.Back.Out,scale:1})}shakeCoinsText(){this.coinsLabelText.x=this.coinsLabelText.originalX,this.scene.tweens.killTweensOf(this.coinsLabelText),this.scene.tweens.add({targets:this.coinsLabelText,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:"+=10",repeat:3,yoyo:!0})}onCloseButtonClick(){this.hide()}resize(){super.resize(),this.hint.originalY=this.hint.y,this.title.originalY=this.title.y,this.alignBreakButton()}alignBreakButton(){this.breakButton.y=this.coinsLabel.y+150,this.breakButton.originalY=this.breakButton.y}updateData(e){this.reset(),this.hint.text=this.getHintTextContent(),this.updateCoinsLabel(e.currentCoins,e.maxCoins),this.resize()}reset(){this.getItemsToHide().forEach(e=>e.revive()),this.topLeftCoinsLabel.kill(),this.piggyBank.reset(),this.breakButton.enableInput()}getHintTextContent(){return this.scene.game.piggyBank.isFull()?this.scene.texts.piggy_bank.warning:this.scene.texts.piggy_bank.hint}updateCoinsLabel(e,t){this.coinsLabelText.text=`${e} / ${t}`}show(e){this.emitShowEvent(),this.revive(),this.alpha=1,e.showBackground?(this.background.revive(),this.showBackground()):this.background.kill(),this.showPiggyBank(),this.showTopTexts(0),this.showBreakButton(0)}showPiggyBank(){this.piggyBank.setScale(1,1),[this.piggyBank,this.coinsLabel].forEach(t=>{t.alpha=0,this.scene.tweens.add({targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),t.scale=.8,this.scene.tweens.add({targets:t,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{t===this.piggyBank&&this.piggyBank.playIdleTween()}})})}showTopTexts(e){this.hint.scale=1,[this.hint,this.title].forEach((s,i)=>{let a=e+i*100;s.alpha=0,this.scene.tweens.add({delay:a,targets:s,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),s.scale=.75,this.scene.tweens.add({delay:a,targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1});let n=-50;s.y=s.originalY+n,this.scene.tweens.add({delay:a,targets:s,duration:500,ease:Phaser.Math.Easing.Back.Out,y:s.originalY,onComplete:()=>{s===this.hint&&this.piggyBankService.isFull()&&this.animateHint()}})})}animateHint(){this.scene.tweens.add({targets:this.hint,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}showBreakButton(e){this.breakButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.breakButton,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.breakButton.scale=.75,this.scene.tweens.add({delay:e,targets:this.breakButton,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1});let t=50;this.breakButton.y=this.breakButton.originalY+t,this.scene.tweens.add({delay:e,targets:this.breakButton,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.breakButton.originalY})}hide(){this.emit(b.HIDE_START),this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.startFastForward,this),this.scene.fastForward.stop(),this.scene.tweens.killTweensOf(this.piggyBank),this.scene.tweens.killTweensOf(this.hint),this.scene.game.toasts.dismissAll(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emit(b.HIDE_COMPLETE,this)}})}onLanguageChange(){this.title.text=this.scene.texts.piggy_bank.title,this.hint.text=this.getHintTextContent(),this.breakButton.text.text=this.scene.texts.piggy_bank.break_it}preDestroy(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.startFastForward,this),super.preDestroy()}},q;(function(e){e.GOTO_NEXT_LEVEL="__GOTO_NEXT_LEVEL",e.GOTO_PREV_LEVEL="__GOTO_PREV_LEVEL",e.GOTO_LEVEL_MAP="__GOTO_LEVEL_MAP",e.LEVEL_MAP_ON_FAIL="__LEVEL_MAP_ON_FAIL",e.LEVEL_MAP_ON_COMPLETE="__LEVEL_MAP_ON_COMPLETE",e.RESTART_LEVEL_FROM_POPUP="__START_LEVEL_FROM_POPUP",e.RESTART="__RESTART",e.SEND_GAMEPLAY_SESSION="__SEND_GAMEPLAY_SESSION"})(q||(q={}));var dC=class extends ct{init(e){super.init(),this.gameplay=e.gameplay,this.levelConfig=this.gameplay.levelConfig,this.goalsScreen=null,this.secondChanceScreen=null,this.failedScreen=null,this.pregameBoosterBuyScreen=null,this.preCompleteScreen=null,this.completeScreen=null,this.startLevelScreen=null,this.livesScreen=null,this.tutorial=null,this.quitScreen=null,this.shopScreen=null,this.piggyBankScreen=null}create(){this.addTopPanel(),this.addPowerupChefManager(),this.addPauseButton(),this.addUndoButton(),this.addBoostersPanel(),this.addMovesWarning(),this.addGoalsScreen(),this.addBoosterBuyScreen(),this.addBoosterHintScreen(),this.addBoosterWarning(),this.addPauseScreen(),this.addEmitters(),this.addUndoOverlay(),this.addGuides(),this.addKeyboardCallbacks(),this.goalItems=new vy(this),w.getBool("hideGui")&&this.scene.setVisible(!1)}addTopPanel(){this.topPanel=new U_(this,this.levelConfig),this.topPanel.setDepth(ee.TOP_PANEL),this.size(this.topPanel),this.pin(this.topPanel,.5,0),this.add.existing(this.topPanel)}addPowerupChefManager(){this.powerupChef=new sC(this,this.topPanel.chef)}addPauseButton(){this.pauseButton=new fe(this,"gameplay_gui","Red-RectangleButton"),this.pauseButton.addIcon("gameplay_gui","pause_icon"),this.pauseButton.setName("pause_button"),this.pin(this.pauseButton,0,1,57,-55),this.size(this.pauseButton),this.add.existing(this.pauseButton)}addUndoButton(){let e=this.game.boosters.getByType(I.UNDO);this.undoButton=new j_(this,e),this.pin(this.undoButton,1,1,-57,-55),this.size(this.undoButton),this.add.existing(this.undoButton)}addBoostersPanel(){let e=this.game.boosters.boosters.filter(s=>s.type!==I.UNDO),t=this.levelConfig.boosters;this.boostersPanel=new Y_(this,e,t),this.boostersPanel.setDepth(ee.BOOSTERS_PANEL),this.boostersPanel.on(tt.BUY_BOOSTER,this.onBuyBoosterClick,this),this.size(this.boostersPanel),this.add.existing(this.boostersPanel)}onBuyBoosterClick(e){let t=this.getBoosterBuyScreenData(e.type);this.boosterBuyScreen.updateData(t),this.boosterBuyScreen.show({showBackground:!0})}addMovesWarning(){this.movesWarning=new Ay(this),this.movesWarning.setDepth(ee.MOVES_WARNING),this.movesWarning.kill(),this.size(this.movesWarning),this.pin(this.movesWarning,.5,.5),this.add.existing(this.movesWarning)}addGoalsScreen(){w.getBool("skipGoals")||this.levelConfig.levelNumber===1||(this.goalsScreen=new yy(this,this.levelConfig.goals),this.goalsScreen.setDepth(ee.GOALS_SCREEN),this.goalsScreen.kill(),this.add.existing(this.goalsScreen))}addBoosterBuyScreen(){this.boosterBuyScreen=new on(this),this.boosterBuyScreen.setDepth(ee.VIDEO_REWARDS_SCREEN),this.boosterBuyScreen.kill(),this.boosterBuyScreen.on(Xe.SHOW_SHOP,()=>this.showShopScreen("Gameplay:BoosterBuyScreen")),this.boosterBuyScreen.on(Xe.BOOSTER_BUY_COMPLETE,this.onBoosterBuyComplete,this),this.boosterBuyScreen.on(b.HIDE_START,this.dismissAllToasts,this),this.add.existing(this.boosterBuyScreen)}getBoosterBuyScreenData(e){let t=Oe.getRewardByBooster(e),s=Oe.getVideoRewardScreenData(t,this.texts),i=e!==I.UNDO;return k(P({},s),{coinsTotal:this.game.store.getNumber(g.COINS),boosterPriceInCoins:1e3,disableVideoButton:i})}onBoosterBuyComplete(e,t){this.boosterBuyScreen.hideInstant();let s=Oe.getBoosterByReward(e.rewardType);this.game.boosters.getByType(s).num+=e.rewardNum,this.game.analytics.addResource(ue.BOOSTERS,e.rewardNum,s,`Level_${this.levelConfig.levelNumber}`),s===I.UNDO?this.time.delayedCall(200,()=>{this.undoButton.onRewardGranted()}):this.time.delayedCall(200,()=>{var i;(i=this.boostersPanel.getIconByType(s))==null||i.onBoosterIncrease(),this.boostersPanel.emulateClickOnIcon(s)})}showShopScreen(e){this.shopScreen||this.addShopScreen(),this.shopScreen.referrer=e,this.shopScreen.show({showBackground:!1})}addShopScreen(){this.shopScreen=new Yo(this),this.shopScreen.setDepth(ee.SHOP_SCREEN),this.shopScreen.on(b.SHOW,this.onShopScreenShow,this),this.shopScreen.on(b.HIDE_START,this.onShopScreenHideStart,this),this.shopScreen.on(_s.PURCHASE_COMPLETE,this.onShopPurchaseComplete,this),this.shopScreen.resize(),this.shopScreen.kill(),this.add.existing(this.shopScreen)}onShopScreenShow(){var e,t,s,i,a,n;((e=this.boosterBuyScreen)==null?void 0:e.visible)&&((t=this.boosterBuyScreen)==null||t.deactivate()),((s=this.secondChanceScreen)==null?void 0:s.visible)&&((i=this.secondChanceScreen)==null||i.deactivate()),((a=this.pregameBoosterBuyScreen)==null?void 0:a.visible)&&((n=this.pregameBoosterBuyScreen)==null||n.deactivate())}onShopScreenHideStart(){var e,t,s;(e=this.boosterBuyScreen)==null||e.activate(),(t=this.secondChanceScreen)==null||t.activate(),(s=this.pregameBoosterBuyScreen)==null||s.activate()}onShopPurchaseComplete(){var e,t,s;let i=this.game.store.getNumber(g.COINS);(e=this.boosterBuyScreen)==null||e.coinsLabel.updateCoinsNumInstant(i),(t=this.secondChanceScreen)==null||t.coinsLabel.updateCoinsNumInstant(i),(s=this.pregameBoosterBuyScreen)==null||s.coinsLabel.updateCoinsNumInstant(i)}addBoosterHintScreen(){this.boosterHintScreen=new z_(this,this.gameplay),this.boosterHintScreen.setDepth(ee.BOOSTER_HINT_SCREEN),this.boosterHintScreen.kill(),this.add.existing(this.boosterHintScreen)}addBoosterWarning(){let e=this.texts.booster_hint_cookie,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.5)",strokeThickness:8};this.boosterWarning=new Uy(this,e,t),this.boosterWarning.setLineSpacing(-12),this.boosterWarning.setWordWrapWidth(210,!0),this.boosterWarning.setOrigin(.5,.5),this.boosterWarning.setDepth(ee.BOOSTER_HINT_WARNING),this.boosterWarning.kill(),this.add.existing(this.boosterWarning)}addSecondChanceScreen(){this.secondChanceScreen=new Z_(this),this.secondChanceScreen.setDepth(ee.SECOND_CHANCE_SCREEN),this.secondChanceScreen.on(Vt.SHOW_SHOP,()=>this.showShopScreen("Gameplay:SecondChangeScreen")),this.secondChanceScreen.kill(),this.add.existing(this.secondChanceScreen),this.secondChanceScreen.resize()}addFailedScreen(){this.failedScreen=new sy(this),this.failedScreen.once(b.SHOW,this.onFailedScreenShow,this),this.failedScreen.restartText.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onFailedScreenContinue,this),this.failedScreen.popup.closeButton.once(_.RELEASE,this.onFailedScreenClose,this),this.failedScreen.setDepth(ee.LEVEL_FAILED_SCREEN),this.failedScreen.kill(),this.add.existing(this.failedScreen),this.failedScreen.resize()}onFailedScreenShow(){this.tweens.add({targets:this.gameplay.camera.camera,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.gameplay.scene.setActive(!1),this.gameplay.scene.setVisible(!1)}}),this.hideGuiOnLevelEnd()}onFailedScreenContinue(){this.failedScreen.hide(),this.showStartLevelScreen()}onFailedScreenClose(){this.game.ads.showInterstitialAd("Gameplay:FailedScreen:Close").finally(()=>{this.restartFromLevelMap()})}showStartLevelScreen(){this.startLevelScreen=new No(this),this.startLevelScreen.setDepth(ee.START_LEVEL_SCREEN),this.startLevelScreen.resize(),this.startLevelScreen.updateData(this.levelConfig.levelNumber),this.startLevelScreen.on(ei.SHOW_PIGGY_BANK_SCREEN,()=>this.showPiggyBankScreen({showBackground:!1})),this.startLevelScreen.popup.pregameBoosters.on(st.ADD_BOOSTER_CLICK,this.onPregameBoosterClick,this),this.startLevelScreen.popup.closeButton.once(_.RELEASE,this.onStartLevelClose,this),this.startLevelScreen.popup.playButton.on(_.RELEASE,this.onPlayButtonClick,this),this.add.existing(this.startLevelScreen),this.startLevelScreen.show({fadeInBackground:!1})}showPiggyBankScreen(e){this.piggyBankScreen||this.addPiggyBankScreen();let t={currentCoins:this.game.store.getNumber(g.PIGGY_BANK_COINS),maxCoins:window.game.config.piggy_bank.max_capacity};this.piggyBankScreen.resize(),this.piggyBankScreen.updateData(t),this.piggyBankScreen.show(e)}addPiggyBankScreen(){this.piggyBankScreen=new Vo(this),this.piggyBankScreen.setDepth(ee.PIGGY_BANK_SCREEN),this.piggyBankScreen.on(b.SHOW,this.onPiggyBankScreenShow,this),this.piggyBankScreen.on(b.HIDE_START,this.onPiggyBankScreenHideStart,this),this.piggyBankScreen.on(si.BREAK,this.onPiggyBankBreak,this),this.piggyBankScreen.kill(),this.add.existing(this.piggyBankScreen)}onPiggyBankScreenShow(){this.startLevelScreen.deactivate()}onPiggyBankScreenHideStart(){this.startLevelScreen.activate()}onPiggyBankBreak(e,t){var s;(s=this.pregameBoosterBuyScreen)==null||s.coinsLabel.syncWithGameStore(!0)}onPregameBoosterClick(e){this.startLevelScreen.deactivate(),this.pregameBoosterBuyScreen||(this.addPregameBoosterBuyScreen(),this.pregameBoosterBuyScreen.resize());let t=this.getPregameBoosterBuyScreenData(e);this.pregameBoosterBuyScreen.once(b.HIDE_COMPLETE,this.activateStartLevelScreen,this),this.pregameBoosterBuyScreen.updateData(t),this.pregameBoosterBuyScreen.show({showBackground:!1})}addPregameBoosterBuyScreen(){this.pregameBoosterBuyScreen=new on(this),this.pregameBoosterBuyScreen.setDepth(ee.VIDEO_REWARDS_SCREEN),this.pregameBoosterBuyScreen.kill(),this.pregameBoosterBuyScreen.on(Xe.SHOW_SHOP,()=>this.showShopScreen("Gameplay:PregameBoosterBuyScreen")),this.pregameBoosterBuyScreen.on(Xe.BOOSTER_BUY_COMPLETE,this.onPregameBoosterBuyComplete,this),this.pregameBoosterBuyScreen.on(b.HIDE_START,this.dismissAllToasts,this),this.add.existing(this.pregameBoosterBuyScreen)}dismissAllToasts(){this.game.toasts.dismissAll()}onPregameBoosterBuyComplete(e,t){var s,i;t==="coins"&&((s=this.shopScreen)==null||s.coinsLabel.syncWithGameStore(!0),(i=this.livesScreen)==null||i.coinsLabel.syncWithGameStore(!0)),this.saveVideoReward(e.rewardType,e.rewardNum),this.pregameBoosterBuyScreen.hide()}saveVideoReward(e,t){var s;if(Oe.isPregameBooster(e)){let i=Oe.getPregameBoosterByReward(e);i&&(this.game.pregameBoosters.getByType(i).num+=t,this.game.analytics.addResource(ue.PREGAME_BOOSTERS,t,i,"StartLevelPopup"),(s=this.startLevelScreen)==null||s.popup.pregameBoosters.getByType(i).onRewardArrive(t))}}getPregameBoosterBuyScreenData(e){let t=Oe.getRewardByPregameBooster(e.type),s=Oe.getRewardNum(t),{title:i,description:a}=this.getRewardTitleAndDescription(t);return{rewardType:t,rewardNum:s,title:i,description:a,boosterPriceInCoins:1e3,coinsTotal:this.game.store.getNumber(g.COINS),disableVideoButton:!1}}getRewardTitleAndDescription(e){let t=this.texts.video_rewards[e],s=t.title,i=t.description;return{title:s,description:i}}onStartLevelClose(){this.game.ads.showInterstitialAd("Gameplay:StartLevelScreen:Close").finally(()=>{this.events.emit(q.GOTO_LEVEL_MAP)})}onPlayButtonClick(){if(this.game.lives.getLivesNum()<=0){this.startLevelScreen.deactivate(),this.showLivesScreen();return}this.startLevelScreen.popup.playButton.disableInput(),this.game.ads.showInterstitialAd("Gameplay:StartLevelScreen:Play").finally(()=>{let t=this.startLevelScreen.popup.pregameBoosters.getSelectedBoosters();this.events.emit(q.RESTART_LEVEL_FROM_POPUP,t)})}showLivesScreen(){this.livesScreen=new Do(this),this.livesScreen.resize(),this.livesScreen.setDepth(ee.LIVES_SCREEN),this.add.existing(this.livesScreen),this.livesScreen.once(b.HIDE_START,this.dismissAllToasts,this),this.livesScreen.once(b.HIDE_COMPLETE,this.activateStartLevelScreen,this),this.livesScreen.show({backgroundAlpha:.001,autoCloseAfterAd:!0})}activateStartLevelScreen(){this.startLevelScreen.activate()}restartFromLevelMap(){this.audio.fadeInMusicLoop(1e3),this.events.emit(q.LEVEL_MAP_ON_FAIL)}addPreCompleteScreen(){this.preCompleteScreen=new Iy(this),this.preCompleteScreen.setDepth(ee.LEVEL_PRE_COMPLETE_SCREEN),this.preCompleteScreen.kill(),this.preCompleteScreen.resize(),this.add.existing(this.preCompleteScreen)}addCompleteScreen(){this.completeScreen=new uy(this),this.completeScreen.once(Xs.GOTO_NEXT_LEVEL,this.gotoNextLevel,this),this.completeScreen.setDepth(ee.LEVEL_COMPLETE_SCREEN),this.completeScreen.kill(),this.completeScreen.resize(),this.add.existing(this.completeScreen)}gotoNextLevel(){this.levelConfig.levelNumber<3?this.events.emit(q.GOTO_NEXT_LEVEL):this.events.emit(q.LEVEL_MAP_ON_COMPLETE)}addPauseScreen(){this.pauseScreen=new Oy(this),this.pauseScreen.setDepth(ee.PAUSE_SCREEN),this.pauseScreen.hintsButton.text.setText(this.getHintDelayTitle(this.gameplay.hint.getInitialDelay())),this.pauseScreen.hintsButton.on(zi.ARROW_PRESS,this.onHintsButtonClick,this),this.pauseScreen.quitButton.on(_.PRESS,this.onQuitButtonClick,this),this.pauseScreen.kill(),this.add.existing(this.pauseScreen)}onHintsButtonClick(e,t){let s=this.game.store.getValue(g.HINT_DELAY),i=wT,a=i.indexOf(s),n=Phaser.Math.Wrap(a+t,0,i.length),r=i[n];this.game.store.saveValue(g.HINT_DELAY,r),this.gameplay.hint.setInitialDelay(r),e.updateText(this.getHintDelayTitle(r))}getHintDelayTitle(e){let t=Phaser.Math.RoundTo(qa(e)/1e3,-1),s=this.game.texts.texts.hint_delay,a=s.value.replace("#",t.toString());switch(e){case Je.SHORT:case Je.LONG:return a;case Je.OFF:return s.off;default:let n=e}}onQuitButtonClick(){this.quitScreen||this.addQuitScreen(),this.quitScreen.show()}addQuitScreen(){this.quitScreen=new tC(this),this.quitScreen.on(b.SHOW,this.onQuitScreenShow,this),this.quitScreen.on(b.HIDE_START,this.onQuitScreenHideStart,this),this.quitScreen.popup.yesButton.once(_.PRESS,this.onConfirmQuitButtonClick,this),this.quitScreen.setDepth(ee.QUIT_SCREEN),this.quitScreen.kill(),this.quitScreen.resize(),this.add.existing(this.quitScreen)}onQuitScreenShow(){this.pauseScreen.ignoreBackgroundClicks=!0,this.pauseScreen.deactivate()}onQuitScreenHideStart(){this.pauseScreen.ignoreBackgroundClicks=!1,this.pauseScreen.activate()}onConfirmQuitButtonClick(){this.game.lives.removeLife(),this.events.emit(q.LEVEL_MAP_ON_FAIL)}addEmitters(){this.emitters=new Ty(this)}addUndoOverlay(){this.undoOverlay=this.add.image(0,0,"gameplay_gui","white_rect"),this.undoOverlay.setDepth(ee.UNDO_OVERLAY),this.undoOverlay.kill(),this.size(this.undoOverlay,et.FILL),this.pin(this.undoOverlay,.5,.5)}addGuides(){ye.development!==!1&&(this.guides=this.add.graphics({lineStyle:{color:16711680,alpha:1,width:1}}),this.guides.setDepth(ee.DEBUG_GUIDES),this.guides.kill())}customResize(){var e,t,s,i,a,n,r,o,l,d,f;super.resize(),this.alignBoostersPanel(),this.drawGuides(),this.pauseButton.originalScale=this.pauseButton.scale,this.undoButton.originalScale=this.undoButton.scale,this.pauseScreen.resize(),(e=this.quitScreen)==null||e.resize(),(t=this.goalsScreen)==null||t.resize(),(s=this.secondChanceScreen)==null||s.resize(),(i=this.failedScreen)==null||i.resize(),(a=this.preCompleteScreen)==null||a.resize(),(n=this.completeScreen)==null||n.resize(),(r=this.startLevelScreen)==null||r.resize(),(o=this.pregameBoosterBuyScreen)==null||o.resize(),this.boosterBuyScreen.resize(),(l=this.livesScreen)==null||l.resize(),(d=this.shopScreen)==null||d.resize(),(f=this.piggyBankScreen)==null||f.resize()}alignBoostersPanel(){this.boostersPanel.x=(E.GAME_WIDTH-this.boostersPanel.displayWidth)/2,this.boostersPanel.y=E.GAME_HEIGHT-this.boostersPanel.displayHeight-20*E.ASSETS_SCALE}drawGuides(){!this.guides||(this.guides.clear(),this.guides.beginPath(),this.drawVerticalGuide(this.topPanel.x-this.topPanel.displayWidth/2),this.drawVerticalGuide(this.topPanel.x),this.drawVerticalGuide(this.topPanel.x+this.topPanel.displayWidth/2),this.drawVerticalGuide(E.GAME_WIDTH*.235),this.drawVerticalGuide(E.GAME_WIDTH-E.GAME_WIDTH*.235),this.drawHorizontalGuide(80*E.ASSETS_SCALE),this.drawHorizontalGuide(E.GAME_HEIGHT*.25),this.drawHorizontalGuide(E.HALF_GAME_HEIGHT),this.drawHorizontalGuide(E.GAME_HEIGHT*.75),this.guides.closePath(),this.guides.strokePath())}drawVerticalGuide(e){this.guides.moveTo(e,0),this.guides.lineTo(e,E.GAME_HEIGHT)}drawHorizontalGuide(e){this.guides.moveTo(0,e),this.guides.lineTo(E.GAME_WIDTH,e)}postGameplayResize(){var e;this.boosterHintScreen.resize(),(e=this.tutorial)==null||e.resize()}addKeyboardCallbacks(){ye.development&&(this.onKeyDown("G",this.toggleGuides,this),this.onceKeyDown("SPACE",this.skipTutorial,this))}toggleGuides(){this.guides.visible?this.guides.kill():this.guides.revive()}skipTutorial(){var e;(e=this.tutorial)==null||e.skip(),this.gameplay.boosters.isTutorialMode&&(this.gameplay.boosters.cancelTutorialMode(),this.boostersPanel.enableInput(),this.undoButton.enableInput())}showTapOnCookieWarning(e,t){this.boosterWarning.x=e,this.boosterWarning.y=t,this.boosterWarning.show()}onLevelPreComplete(){this.hideBottomGui(),this.showPrecompleteScreen()}hideBottomGui(){let e=[this.pauseButton,this.boostersPanel,this.undoButton];this.tweens.add({targets:e,duration:250,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=15",onComplete:()=>{e.forEach(t=>t.kill())}})}showPrecompleteScreen(){let{moveCoins:e,powerupCoins:t}=this.getLevelCoins(),s={moveCoins:e,powerupCoins:t};this.addPreCompleteScreen(),this.preCompleteScreen.once(b.HIDE_START,this.onPreCompleteAnimationComplete,this),this.preCompleteScreen.updateData(s),this.preCompleteScreen.show()}onPreCompleteAnimationComplete(){this.gameplay.onLevelComplete()}hideGuiOnLevelEnd(){this.topPanel.kill(),this.boostersPanel.kill(),this.undoButton.kill(),this.pauseButton.kill()}showCompleteScreen(){let e=this.game.store.getLevelResult(this.levelConfig.levelNumber),{baseCoins:t,moveCoins:s,powerupCoins:i}=this.getLevelCoins(),a={levelNumber:this.levelConfig.levelNumber,isCompleteFirstTime:e.timesCompleteNum===1,baseCoins:t,bonusCoins:s+i};this.addCompleteScreen(),this.completeScreen.updateData(a),this.completeScreen.show()}getLevelCoins(){let e=window.game.config.ads.rewarded,t=this.levelConfig.hard?150:100,s=this.gameplay.moves,i=this.gameplay.items.getCookiesWithPowerups().length,a=this.game.piggyBank;return a===void 0?e?{baseCoins:t,moveCoins:s*5,powerupCoins:i*5}:{baseCoins:t*2,moveCoins:s*10,powerupCoins:i*10}:a.getBreakMethod()==="purchase"?{baseCoins:t*5,moveCoins:s*10,powerupCoins:i*10}:{baseCoins:t*3,moveCoins:s*10,powerupCoins:i*10}}addTutorial(e){return this.tutorial=new Fy(this,e),this.tutorial.once(Js.COMPLETE,this.onTutorialComplete,this),this.tutorial}onTutorialComplete(){this.tutorial.destroy(),this.tutorial=null}showUndoOverlay(){this.tweens.killTweensOf(this.undoOverlay),this.undoOverlay.revive(),this.undoOverlay.alpha=0,this.tweens.add({targets:this.undoOverlay,duration:33,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.tweens.add({targets:this.undoOverlay,duration:600,ease:Phaser.Math.Easing.Quadratic.In,alpha:0,onComplete:()=>{this.undoOverlay.kill()}})}})}onShutdown(){this.tutorial&&(this.tutorial.destroy(),this.tutorial=null),super.onShutdown()}},uC=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="cell_pointer",this.addPointer(),this.animatePointer()}addPointer(){this.pointer=this.scene.add.image(0,0,"gameplay","bottom_cell_pointer_2"),this.add(this.pointer)}animatePointer(){let e=800,t=8;this.pointer.y=-t,this.pointer.scale=.5,this.scene.tweens.add({targets:this.pointer,duration:e,ease:Phaser.Math.Easing.Sine.InOut,y:t,scale:1,repeat:-1,hold:500}),this.pointer.alpha=0,this.scene.tweens.add({targets:this.pointer,duration:e/2,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,yoyo:!0,repeat:-1,hold:500})}hideAndDestroy(){this.scene.tweens.killTweensOf(this.pointer),this.scene.tweens.add({targets:this.pointer,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.destroy()}})}},Y;(function(e){e.TOP="TOP",e.RIGHT="RIGHT",e.BOTTOM="BOTTOM",e.LEFT="LEFT",e.TOP_LEFT_OUTER="TOP_LEFT_OUTER",e.TOP_RIGHT_OUTER="TOP_RIGHT_OUTER",e.BOTTOM_RIGHT_OUTER="BOTTOM_RIGHT_OUTER",e.BOTTOM_LEFT_OUTER="BOTTOM_LEFT_OUTER",e.TOP_LEFT_INNER="TOP_LEFT_INNER",e.TOP_RIGHT_INNER="TOP_RIGHT_INNER",e.BOTTOM_RIGHT_INNER="BOTTOM_RIGHT_INNER",e.BOTTOM_LEFT_INNER="BOTTOM_LEFT_INNER",e.TOP_LONG="TOP_LONG",e.RIGHT_LONG="RIGHT_LONG",e.BOTTOM_LONG="BOTTOM_LONG",e.LEFT_LONG="LEFT_LONG"})(Y||(Y={}));var Ko=class{constructor(e,t){this.scene=e,this.borderImage=t,this.textures=[]}createFrames(){let e=this.borderImage;this.createLines(e),this.createConnectors(e),this.createOuterCorners(e),this.createInnerCorners(e),this.textures.forEach(t=>{let s=t.frame;s.setUVs(s.width,s.height,s.u0,s.v1,s.u1,s.v0)}),Ko.FRAMES_READY=!0}createBorderTexture(e){var t;let s=this.borderImage,i=e.crop,a=(t=e.drawOffset)!=null?t:{x:0,y:0},n=this.scene.make.renderTexture({width:s.width,height:s.height},!1);return s.setCrop(i.x,i.y,i.width,i.height),n.draw(s,s.width/2+a.x,s.height/2+a.y),n.saveTexture(e.key),s.setCrop(),this.textures.push(n),n}createLines(e){let t=e.width*.38,s=(e.width-t)/2;this.createBorderTexture({key:Y.TOP,crop:{x:s,y:0,width:t,height:e.height*.5}}),this.createBorderTexture({key:Y.BOTTOM,crop:{x:s,y:e.height*.5,width:t,height:e.height*.5}});let i=e.height*.38,a=(e.height-i)/2;this.createBorderTexture({key:Y.RIGHT,crop:{x:e.width*.5,y:a,width:e.height*.5,height:i}}),this.createBorderTexture({key:Y.LEFT,crop:{x:0,y:a,width:e.width*.5,height:i}})}createConnectors(e){let t=e.width*.47,s=(e.width-t)/2;this.createBorderTexture({key:Y.TOP_LONG,crop:{x:s,y:0,width:t,height:e.height*.5}}),this.createBorderTexture({key:Y.BOTTOM_LONG,crop:{x:s,y:e.height/2,width:t,height:e.height*.5}});let i=e.height*.47,a=(e.height-i)/2;this.createBorderTexture({key:Y.RIGHT_LONG,crop:{x:e.width/2,y:a,width:e.width/2,height:i}}),this.createBorderTexture({key:Y.LEFT_LONG,crop:{x:0,y:a,width:e.width/2,height:i}})}createOuterCorners(e){let t=e.width*.33,s=e.height*.33;this.createBorderTexture({key:Y.TOP_LEFT_OUTER,crop:{x:0,y:0,width:t,height:s}}),this.createBorderTexture({key:Y.TOP_RIGHT_OUTER,crop:{x:e.width-t,y:0,width:t,height:s}}),this.createBorderTexture({key:Y.BOTTOM_RIGHT_OUTER,crop:{x:e.width-t,y:e.height-s,width:t,height:s}}),this.createBorderTexture({key:Y.BOTTOM_LEFT_OUTER,crop:{x:0,y:e.height-s,width:t,height:s}})}createInnerCorners(e){let t=4,s=e.width*.33,i=e.height*.33;this.createBorderTexture({key:Y.TOP_LEFT_INNER,drawOffset:{x:t,y:t},crop:{x:0,y:0,width:s,height:i}}),this.createBorderTexture({key:Y.TOP_RIGHT_INNER,drawOffset:{x:-t,y:t},crop:{x:e.width-s,y:0,width:s,height:i}}),this.createBorderTexture({key:Y.BOTTOM_RIGHT_INNER,drawOffset:{x:-t,y:-t},crop:{x:e.width-s,y:e.height-i,width:s,height:i}}),this.createBorderTexture({key:Y.BOTTOM_LEFT_INNER,drawOffset:{x:t,y:-t},crop:{x:0,y:e.height-i,width:s,height:i}})}destroy(){this.scene=null,this.textures.forEach(e=>e.destroy()),this.textures=null}},cn=Ko;cn.FRAMES_READY=!1;var pC=class extends Phaser.GameObjects.RenderTexture{constructor(e,t,s,i,a,n=!1){super(e,-a,-a,s,i);this.scene=e,this.field=t,this.drawOffset=a,this.borderImage=this.scene.make.image({key:"gameplay",frame:"border"},!1),this.createBorderFrames(),n&&this.fill(16711680,1),this.beginDraw(),this.drawCells(),this.drawCorners(),this.drawDarkTiles(),this.drawBorder(),this.endDraw()}createBorderFrames(){if(cn.FRAMES_READY)return;let e=new cn(this.scene,this.borderImage);e.createFrames(),e.destroy()}drawCells(){let e=y/2-this.drawOffset,t=y/2-this.drawOffset;this.field.cells.forEach(s=>{let i=this.field.cells.getOrthoNeighborsAt(s.column,s.row),a=Object.values(i).filter(Boolean).length,n="field_cell_center";a===0?n="field_cell_alone":a===1?i.top?n="field_cell_bottom":i.right?n="field_cell_left":i.bottom?n="field_cell_top":n="field_cell_right":a===2&&(i.right&&i.bottom?n="field_cell_top_left":i.left&&i.bottom?n="field_cell_top_right":i.top&&i.left?n="field_cell_bottom_right":i.top&&i.right&&(n="field_cell_bottom_left"));let r=s.x-e,o=s.y-t;this.customBatchDrawFrame(r,o,"gameplay",n)})}drawCorners(){let e=y/2-this.drawOffset,t=y/2-this.drawOffset;this.field.cells.forEach(s=>{let{column:i,row:a}=s,n=this.field.cells.getNeighborsAt(i,a);n.bottom&&n.right&&!n.bottomRight&&this.drawCornerAt("corner_top_left",i+1,a+1,-e,-t),n.bottom&&n.left&&!n.bottomLeft&&this.drawCornerAt("corner_top_right",i-1,a+1,e-8,-t),n.top&&n.right&&!n.topRight&&this.drawCornerAt("corner_bottom_left",i+1,a-1,-e,t-6),n.top&&n.left&&!n.topLeft&&this.drawCornerAt("corner_bottom_right",i-1,a-1,e-4,t-6)})}drawCornerAt(e,t,s,i=0,a=0){let{x:n,y:r}=j(t,s);this.customBatchDrawFrame(n+i,r+a,"gameplay",e)}drawDarkTiles(){let e=this.scene.textures.getFrame("gameplay","field_cell_dark_2"),t=e.halfWidth-this.drawOffset,s=e.halfHeight-this.drawOffset,i=1;this.field.cells.forEach(a=>{let{column:n,row:r}=a;if(r%2==0&&n%2!=0||r%2!=0&&n%2==0){let{x:o,y:l}=j(n,r);this.customBatchDrawFrame(o-t,l-s,e.texture.key,e.name,i)}})}drawBorder(){w.getBool("hideBorder")||this.field.cells.forEach(t=>{let{column:s,row:i}=t,a=this.field.cells.getNeighborsAt(s,i);this.addLines(a,s,i),this.addOuterCorners(a,s,i),this.addInnerCorners(a,s,i),this.addConnectors(a,s,i)})}addLines(e,t,s){e.top||this.drawBorderFrameAt(Y.TOP,t,s),e.right||this.drawBorderFrameAt(Y.RIGHT,t,s),e.bottom||this.drawBorderFrameAt(Y.BOTTOM,t,s),e.left||this.drawBorderFrameAt(Y.LEFT,t,s)}addOuterCorners(e,t,s){!e.top&&!e.left&&this.drawBorderFrameAt(Y.TOP_LEFT_OUTER,t,s),!e.top&&!e.right&&this.drawBorderFrameAt(Y.TOP_RIGHT_OUTER,t,s),!e.bottom&&!e.right&&this.drawBorderFrameAt(Y.BOTTOM_RIGHT_OUTER,t,s),!e.bottom&&!e.left&&this.drawBorderFrameAt(Y.BOTTOM_LEFT_OUTER,t,s)}addInnerCorners(e,t,s){!e.topLeft&&e.top&&e.left&&this.drawBorderFrameAt(Y.BOTTOM_RIGHT_INNER,t-1,s-1),!e.topRight&&e.top&&e.right&&this.drawBorderFrameAt(Y.BOTTOM_LEFT_INNER,t+1,s-1),!e.bottomRight&&e.bottom&&e.right&&this.drawBorderFrameAt(Y.TOP_LEFT_INNER,t+1,s+1),!e.bottomLeft&&e.bottom&&e.left&&this.drawBorderFrameAt(Y.TOP_RIGHT_INNER,t-1,s+1)}addConnectors(e,t,s){!e.top&&!e.topRight&&e.right&&this.drawBorderFrameAt(Y.TOP_LONG,t,s,-y/2),!e.bottom&&!e.bottomRight&&e.right&&this.drawBorderFrameAt(Y.BOTTOM_LONG,t,s,-y/2),!e.right&&!e.bottomRight&&e.bottom&&this.drawBorderFrameAt(Y.RIGHT_LONG,t,s,0,-y/2),!e.left&&!e.bottomLeft&&e.bottom&&this.drawBorderFrameAt(Y.LEFT_LONG,t,s,0,-y/2)}drawBorderFrameAt(e,t,s,i=0,a=0){let n=this.borderImage.width/2-this.drawOffset+i,r=this.borderImage.height/2-this.drawOffset+a,{x:o,y:l}=j(t,s);this.customBatchDrawFrame(o-n,l-r,e,null)}customBatchDrawFrame(e,t,s,i,a){e=e-this.field.dimensions.left*y,t=t-this.field.dimensions.top*y,this.batchDrawFrame(s,i,e,t,a)}preDestroy(){this.borderImage.destroy(),super.preDestroy()}};function be(e){return{column:e.column,row:e.row,itemType:e.itemType}}var Lt=class{static getContentFrame(e,t,s=Phaser.Math.RND){if(this.isCookie(e))return e===V.RANDOM_COOKIE?this.getRandomCookieFrame(t):this.getCookieFrame(e,t);switch(e){case V.DROP_ITEM:return"generator/content/cookie_2";case V.CHICK:return"generator/content/chick";case V.MARSHMALLOW:return"generator/content/marshmallow_common";default:return null}}static isCookie(e){return e.includes("_COOKIE")}static getRandomCookieFrame(e){switch(e){case oe.RANDOM_STRIPES:case oe.VERTICAL_STRIPES:case oe.HORIZONTAL_STRIPES:return"generator/content/stripes";case oe.BOMB:return"generator/content/bombs";case oe.SUPER_SPHERE:return"generator/content/super_sphere";default:return null}}static getCookieFrame(e,t){let s=this.convertContentToCookieType(e),i=this.convertContentModToCookiePowerup(t),a=this.getBaseCookieFrame(s);switch(i){case T.VERTICAL_STRIPES:return a+"-Stripes-Vertical";case T.HORIZONTAL_STRIPES:return a+"-Stripes-Horizontal";case T.BOMB:return a+"-Bomb";case T.SUPER_SPHERE:return"generator/content/super_sphere";default:return a}}static getBaseCookieFrame(e){switch(e){case h.COOKIE_RED:return"generator/content/Circle-Cookie-Red";case h.COOKIE_BLUE:return"generator/content/Cube-Cookie-Blue";case h.COOKIE_ORANGE:return"generator/content/Polygon-Cookie-Orange";case h.COOKIE_PURPLE:return"generator/content/Donut-Cookie-Purple";case h.COOKIE_PINK:return"generator/content/Moon-Cookie-Pink";case h.COOKIE_YELLOW:return"generator/content/Heart-Cookie-Yellow";default:return null}}static convertContentToCookieType(e){switch(e){case V.ORANGE_COOKIE:return h.COOKIE_ORANGE;case V.BLUE_COOKIE:return h.COOKIE_BLUE;case V.YELLOW_COOKIE:return h.COOKIE_YELLOW;case V.PINK_COOKIE:return h.COOKIE_PINK;case V.RED_COOKIE:return h.COOKIE_RED;case V.PURPLE_COOKIE:return h.COOKIE_PURPLE;default:return null}}static convertContentModToCookiePowerup(e,t=Phaser.Math.RND){switch(e){case oe.RANDOM_STRIPES:return t.bool()?T.VERTICAL_STRIPES:T.HORIZONTAL_STRIPES;case oe.VERTICAL_STRIPES:return T.VERTICAL_STRIPES;case oe.HORIZONTAL_STRIPES:return T.HORIZONTAL_STRIPES;case oe.BOMB:return T.BOMB;case oe.SUPER_SPHERE:return T.SUPER_SPHERE;default:return null}}},V;(function(e){e.DROP_ITEM="DROP_ITEM",e.MARSHMALLOW="MARSHMALLOW",e.CHICK="CHICK",e.RANDOM_COOKIE="RANDOM_COOKIE",e.PURPLE_COOKIE="PURPLE_COOKIE",e.ORANGE_COOKIE="ORANGE_COOKIE",e.BLUE_COOKIE="BLUE_COOKIE",e.RED_COOKIE="RED_COOKIE",e.PINK_COOKIE="PINK_COOKIE",e.YELLOW_COOKIE="YELLOW_COOKIE"})(V||(V={}));var oe;(function(e){e.RANDOM_STRIPES="RANDOM_STRIPES",e.HORIZONTAL_STRIPES="HORIZONTAL_STRIPES",e.VERTICAL_STRIPES="VERTICAL_STRIPES",e.BOMB="BOMB",e.SUPER_SPHERE="SUPER_SPHERE",e.NONE="NONE"})(oe||(oe={}));var gC=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,0,0);this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1;var a,n;this.column=t,this.row=s,this.itemType=h.GENERATOR,this.itemSuperType=c.GENERATOR,this.options=i,(n=(a=this.options).turnsLeft)!=null||(a.turnsLeft=this.options.turnsTotal),this.addItem(),this.addBubble(),this.addPropeller(),this.addTurnsLabelBack(),this.addTurnsLabelText(),i.invisible&&this.kill(),this.setSize(this.bubble.width,this.bubble.height),this.playDropAnimationThrottled=Ft(this.doPlayDropAnimation.bind(this),300,{leading:!0,trailing:!1})}addItem(){let e=Lt.getContentFrame(this.options.content,this.options.contentMod);this.item=this.scene.add.image(0,0,"gameplay",e),this.item.y=6,this.item.originalY=this.item.y,this.add(this.item)}addBubble(){this.bubble=this.scene.add.image(0,0,"gameplay","generator/base"),this.bubble.y=3,this.add(this.bubble)}addPropeller(){this.propeller=this.scene.add.image(0,0,"gameplay","generator/propeller"),this.propeller.y=this.bubble.bottom,this.add(this.propeller)}addTurnsLabelBack(){this.turnLabelBack=this.scene.add.image(0,0,"gameplay","generator/label_back"),this.turnLabelBack.y=this.propeller.y,this.add(this.turnLabelBack)}addTurnsLabelText(){let e=this.options.turnsLeft.toString();this.turnLabel=this.scene.add.bitmapText(0,0,B.GENERATOR_TURNS,e,20),this.turnLabel.setOrigin(.5,.5),this.turnLabel.x=this.turnLabelBack.x,this.turnLabel.y=this.turnLabelBack.y+4,this.add(this.turnLabel)}alignToGrid(){ge(this),this.y-=8}createSave(){return k(P({},be(this)),{itemSuperType:c.GENERATOR,options:P({},this.options)})}playDropAnimation(){this.options.invisible||(this.playDropAnimationThrottled(),this.scene.sounds.generator())}doPlayDropAnimation(){this.playPropellerTween(),this.playItemTween()}playPropellerTween(){this.propeller.angle=0,this.scene.tweens.killTweensOf(this.propeller),this.scene.tweens.add({targets:this.propeller,duration:1e3,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.33],angle:360*3})}playItemTween(){this.scene.tweens.killTweensOf(this.item),this.item.alpha=0,this.scene.tweens.add({targets:this.item,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.item.scale=.75,this.scene.tweens.add({targets:this.item,duration:450,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:1})}updateTurnsLabel(){this.turnLabel.text=this.options.turnsLeft.toString()}destroy(){super.destroy()}toString(){return Ie.toString(this)+` [${this.options.content}, ${this.options.turnsLeft}/${this.options.turnsTotal}]`}},mC=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="field",this.columns=t.grid.columns,this.rows=t.grid.rows,this.addCells(t),this.addTexture(),this.addShadow(),this.addBottomCellPointers(t),this.setSize(this.cells.columns*y,this.cells.rows*y)}addCells(e){let t=e.field.map(s=>{let{column:i,row:a}=s,{x:n,y:r}=j(i,a);return{column:i,row:a,x:n,y:r}});this.cells=new De(e.grid.rows,e.grid.columns),this.cells.addMultiple(...t),this.columnsOfCells=qr(this.cells.toArray(),"column"),this.topCells=Object.values(this.columnsOfCells).map(s=>s[0]),this.bottomCells=Object.values(this.columnsOfCells).map(s=>Di(s)),this.dimensions=an(this.cells.toArray())}addTexture(){let e=6,t=this.dimensions.width*y+16,s=this.dimensions.height*y+16;this.texture=new pC(this.scene,this,t,s,e),this.texture.x=this.dimensions.left*y-e,this.texture.y=this.dimensions.top*y-e,this.add(this.texture)}addShadow(){this.scene.game.rendererType===yt.CANVAS?(this.shadow=this.scene.add.renderTexture(0,0,this.texture.width,this.texture.height),this.shadow.draw(this.texture,0,0),this.paintCanvasTextureBlack(this.shadow.texture)):(this.shadow=this.scene.add.image(0,0,this.texture.texture),this.shadow.setOrigin(0),this.shadow.tint=0),this.shadow.x=this.texture.x,this.shadow.y=this.texture.y+10,this.shadow.alpha=.15,this.addAt(this.shadow,0)}paintCanvasTextureBlack(e){let t=e.getData(0,0,e.width,e.height),s=t.data;for(let i=0;i<s.length;i+=4)s[i+3]>0&&(s[i]=0,s[i+1]=0,s[i+2]=0);e.putData(t,0,0)}addBottomCellPointers(e){let t=e.items.some(i=>i.itemType===h.DROP_ITEM),s=e.items.some(i=>{if(i.itemType===h.GENERATOR)return i.params.content===V.DROP_ITEM});(t||s)&&this.doAddBottomCellPointers()}doAddBottomCellPointers(){this.bottomCellPointers=this.bottomCells.map(e=>{let t=j(e.column,e.row),s=new uC(this.scene);return s.x=t.x,s.y=t.y+y/2+4,this.add(s),s})}isEmpty(e,t){return this.cells.checkAt(e,t)===!1}getCellAt(e,t){return this.cells.getAt(e,t)}getTopCells(){return this.topCells}getBottomCell(e){let t=this.columnsOfCells[e];return t?t[t.length-1]:null}getNonEmptyCellsNum(){return this.cells.toArray().length}hideBottomCellPointers(){var e;(e=this.bottomCellPointers)==null||e.forEach(t=>t.hideAndDestroy()),this.bottomCellPointers.length=0}},F;(function(e){e[e.FIELD=0]="FIELD",e[e.BISCUITS=1]="BISCUITS",e[e.GUMMIES=2]="GUMMIES",e[e.HIGHLIGHTS=3]="HIGHLIGHTS",e[e.BELOW_ITEMS_FX=4]="BELOW_ITEMS_FX",e[e.COOKIES=5]="COOKIES",e[e.COOKIE_PARTICLES=6]="COOKIE_PARTICLES",e[e.NEW_COOKIE=7]="NEW_COOKIE",e[e.MERGING_COOKIE=8]="MERGING_COOKIE",e[e.POWERUPED_COOKIE=9]="POWERUPED_COOKIE",e[e.TOP_ITEMS=10]="TOP_ITEMS",e[e.GENERATOR=11]="GENERATOR",e[e.POWERUP_FX=12]="POWERUP_FX",e[e.BOOSTER_FX=13]="BOOSTER_FX",e[e.DEBUG=14]="DEBUG"})(F||(F={}));var fC={[h.MARSHMALLOW_COMMON]:O.getSubtypes(c.COOKIE),[h.MARSHMALLOW_DOUBLE]:O.getSubtypes(c.COOKIE),[h.MARSHMALLOW_BLUE]:[h.COOKIE_BLUE],[h.MARSHMALLOW_RED]:[h.COOKIE_RED],[h.MARSHMALLOW_ORANGE]:[h.COOKIE_ORANGE],[h.MARSHMALLOW_PURPLE]:[h.COOKIE_PURPLE],[h.MARSHMALLOW_YELLOW]:[h.COOKIE_YELLOW],[h.MARSHMALLOW_YELLOW]:[h.COOKIE_YELLOW],[h.MARSHMALLOW_PINK]:[h.COOKIE_PINK]},Zi;(function(e){e.DAMAGE="__DAMAGE"})(Zi||(Zi={}));var EC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isSwappable=!0,this.isMatchable=!1,this.isDroppable=!0,this.matchIds=[],this.powerupIds=[],this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.MARSHMALLOW,this.maxHealth=this.itemType===h.MARSHMALLOW_DOUBLE?2:1,this.currentHealth=this.maxHealth}alignToGrid(){ge(this,this.column,this.row),this.y-=4}createSave(){return k(P({},be(this)),{health:this.currentHealth,itemSuperType:c.MARSHMALLOW})}setHealth(e){this.currentHealth=Phaser.Math.Clamp(e,0,this.maxHealth),this.updateFrameByHealth(this.currentHealth)}updateFrameByHealth(e){let t;e===2?t=O.getFrameByItemType(h.MARSHMALLOW_DOUBLE):this.itemType===h.MARSHMALLOW_DOUBLE?t=O.getFrameByItemType(h.MARSHMALLOW_COMMON):t=O.getFrameByItemType(this.itemType),this.setFrame(t)}damage(){this.currentHealth=Math.max(0,this.currentHealth-1),this.updateFrameByHealth(this.currentHealth),this.emit(Zi.DAMAGE,this,this.currentHealth)}isDead(){return this.currentHealth===0}canBeDamagedBy(e){return e.powerup===T.SUPER_SPHERE?!1:fC[this.itemType].includes(e.itemType)}destroy(){super.destroy()}toString(){return this.maxHealth>1?Ie.toString(this)+` health: ${this.currentHealth}/${this.maxHealth}`:Ie.toString(this)}},vC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.LICORICE}alignToGrid(){ge(this)}createSave(){return k(P({},be(this)),{itemSuperType:c.LICORICE})}destroy(){super.destroy()}toString(){return`${this.itemType} [${this.column}, ${this.row}]`}},TC=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,"gameplay",O.getFrameByItemType(h.BISCUIT));this.isMultiCell=!1,this.itemWidth=1,this.itemHeight=1,this.isSwappable=!1,this.isMatchable=!1,this.isDroppable=!1,this.column=t,this.row=s,this.itemType=h.BISCUIT,this.itemSuperType=c.BISCUIT}alignToGrid(){ge(this,this.column,this.row)}createSave(){return k(P({},be(this)),{itemSuperType:c.BISCUIT})}destroy(){super.destroy()}},_C={[h.CHOCOLATE_COMMON]:O.getSubtypes(c.COOKIE),[h.CHOCOLATE_DOUBLE]:O.getSubtypes(c.COOKIE),[h.CHOCOLATE_TRIPLE]:O.getSubtypes(c.COOKIE),[h.CHOCOLATE_BLUE]:[h.COOKIE_BLUE],[h.CHOCOLATE_RED]:[h.COOKIE_RED],[h.CHOCOLATE_ORANGE]:[h.COOKIE_ORANGE],[h.CHOCOLATE_PURPLE]:[h.COOKIE_PURPLE],[h.CHOCOLATE_YELLOW]:[h.COOKIE_YELLOW],[h.CHOCOLATE_YELLOW]:[h.COOKIE_YELLOW],[h.CHOCOLATE_PINK]:[h.COOKIE_PINK]},Ji;(function(e){e.DAMAGE="Chocolate_DAMAGE"})(Ji||(Ji={}));var yC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isSwappable=!1,this.isMatchable=!1,this.isDroppable=!1,this.matchIds=[],this.powerupIds=[],this.maxHealth=1,this.currentHealth=1,this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.CHOCOLATE,this.maxHealth=this.getMaxHealth(this.itemType),this.currentHealth=this.maxHealth}getMaxHealth(e){return e===h.CHOCOLATE_TRIPLE?3:e===h.CHOCOLATE_DOUBLE?2:1}setHealth(e){this.currentHealth=Phaser.Math.Clamp(e,0,this.maxHealth),this.updateFrameByHealth(this.currentHealth)}updateFrameByHealth(e){let t;e===3?t=O.getFrameByItemType(h.CHOCOLATE_TRIPLE):e===2?t=O.getFrameByItemType(h.CHOCOLATE_DOUBLE):this.itemType===h.CHOCOLATE_TRIPLE||this.itemType===h.CHOCOLATE_DOUBLE?t=O.getFrameByItemType(h.CHOCOLATE_COMMON):t=O.getFrameByItemType(this.itemType),this.setFrame(t)}damage(){this.currentHealth=Math.max(0,this.currentHealth-1),this.updateFrameByHealth(this.currentHealth),this.emit(Ji.DAMAGE,this,this.currentHealth),this.isDead()===!1&&this.playDamageTween()}playDamageTween(){var e;this.scale=1,(e=this.damageTween)==null||e.remove(),this.damageTween=this.scene.tweens.add({targets:this,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.15,yoyo:!0})}isDead(){return this.currentHealth===0}alignToGrid(){ge(this),this.y-=4}createSave(){return k(P({},be(this)),{itemSuperType:c.CHOCOLATE,health:this.currentHealth})}canBeDamagedBy(e){return e.powerup===T.SUPER_SPHERE?!1:_C[this.itemType].includes(e.itemType)}destroy(){super.destroy()}toString(){return this.maxHealth>1?Ie.toString(this)+` health: ${this.currentHealth}/${this.maxHealth}`:Ie.toString(this)}},ys;(function(e){e.EMIT_CANDY="__EMIT_CANDY",e.EMIT_PARTICLES="__EMIT_PARTICLES"})(ys||(ys={}));var CC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i=h.CANDY_BOTTLE){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isMatchable=!1,this.isDroppable=!1,this.isSwappable=!1,this.matchIds=[],this.powerupIds=[],this.setOrigin(.5,.95),this.column=t,this.row=s,this.itemType=i,this.itemSuperType=O.getItemSuperType(this.itemType)}emitCandy(e){var t,s;this.y=this.originalY,(t=this.yTween)==null||t.remove(),this.yTween=this.scene.tweens.add({delay:e+200,targets:this,duration:233,ease:Phaser.Math.Easing.Sine.InOut,y:this.originalY-25,yoyo:!0}),this.scaleX=1,this.scaleY=1,(s=this.scaleTween)==null||s.remove(),this.scaleTween=this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,scaleX:1.2,scaleY:.8,onStart:()=>{this.emit(ys.EMIT_PARTICLES,this)},onComplete:()=>{this.emit(ys.EMIT_CANDY,this),this.scaleTween=this.scene.tweens.add({targets:this,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scaleX:1,scaleY:1})}})}alignToGrid(){ge(this),this.y+=36}createSave(){return k(P({},be(this)),{itemSuperType:c.CANDY_BOTTLE})}destroy(){super.destroy()}toString(){return Ie.toString(this)}},SC=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.itemType=h.DROP_ITEM,this.itemSuperType=c.DROP_ITEM,this.isMatchable=!1,this.isDroppable=!0,this.isSwappable=!0,this.dropPath=[],this.appearDelay=0,this.column=t,this.row=s,this.itemType=i,this.addItem(),this.playIdleTweens()}addItem(){let e=O.getFrameByItemType(this.itemType);this.item=this.scene.add.image(0,0,"gameplay",e),this.add(this.item)}playIdleTweens(){this.item.y=Phaser.Math.RND.sign()*2,this.scene.tweens.add({targets:this.item,duration:1200,ease:Phaser.Math.Easing.Sine.InOut,y:-this.item.y,yoyo:!0,repeat:-1}),this.item.angle=Phaser.Math.RND.sign()*5,this.scene.tweens.add({targets:this.item,duration:900,ease:Phaser.Math.Easing.Sine.InOut,angle:-this.item.angle,yoyo:!0,repeat:-1})}stopIdleTweens(e,t){this.scene.tweens.killTweensOf(this.item),this.scene.tweens.add({delay:e,targets:this.item,duration:66,ease:Phaser.Math.Easing.Linear,angle:0,y:0,onComplete:t})}alignToGrid(){ge(this)}createSave(){return k(P({},be(this)),{itemSuperType:c.DROP_ITEM})}toString(){return Ie.toString(this)}},ea;(function(e){e.APPLE_REMOVE="ApplesPlatter_APPLE_REMOVE"})(ea||(ea={}));var OC=class extends Phaser.GameObjects.Container{constructor(e,t,s,i=9){super(e,0,0);this.isMultiCell=!0,this.itemWidth=1,this.itemHeight=1,this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.column=t,this.row=s,this.itemType=h.APPLES_PLATTER,this.itemSuperType=c.APPLE_PLATTER,this.matchIds=[],this.powerupIds=[],this.addPlatterBack(),this.addApples(i),this.alignApples(),this.addPlatterFrontEdge(),this.setMulticell(),this.setSize(this.platterBack.width,this.platterBack.height)}addPlatterBack(){this.platterBack=this.scene.add.image(0,0,"gameplay",O.getFrameByItemType(this.itemType)),this.add(this.platterBack)}addApples(e){this.apples=ke(e,()=>this.scene.make.image({key:"gameplay",frame:"apples_platter/apple"})),this.add(this.apples)}alignApples(){let e=this.getPositions();this.apples.forEach((t,s)=>{let i=e[s];t.x=i.x,t.y=i.y,this.bringToTop(t)}),this.apples=this.apples.reverse(),this.apples.forEach(t=>this.bringToTop(t))}getPositions(){let e=3,t=3,s=39,i=38,a=s*e,n=i*t,r=s/2-a/2,o=i/2-n/2-8,l=[];for(let d=0;d<e;d++)for(let f=0;f<t;f++)l.push({x:r+f*s,y:o+d*i});return l.reverse()}addPlatterFrontEdge(){this.platterFrontEdge=this.scene.add.image(0,0,"gameplay","apples_platter/Tray_01"),this.platterFrontEdge.setOrigin(.5,1),this.platterFrontEdge.y=this.platterBack.bottom,this.add(this.platterFrontEdge)}setMulticell(){let e=ae.getSize(this.itemType);this.isMultiCell=!0,this.itemWidth=e.width,this.itemHeight=e.height}removeApple(){if(this.isEmpty())return;let e=this.apples.shift();e&&(this.emit(ea.APPLE_REMOVE,this,e),e.destroy())}isEmpty(){return this.apples.length===0}getApplesNum(){return this.apples.length}alignToGrid(){tn(this),this.x+=3}createSave(){return k(P({},be(this)),{itemSuperType:c.APPLE_PLATTER,apples:this.apples.length})}toString(){return Ie.toString(this)+` ${this.apples.length} apples`}},ta;(function(e){e.EXPLODE="__EXPLODE"})(ta||(ta={}));var Se;(function(e){e.RED="Cake_color_01",e.BLUE="Cake_color_02",e.PURPLE="Cake_color_03",e.YELLOW="Cake_color_04",e.PINK="Cake_color_05",e.ORANGE="Cake_color_06"})(Se||(Se={}));var Cs={[h.COOKIE_RED]:Se.RED,[h.COOKIE_BLUE]:Se.BLUE,[h.COOKIE_PURPLE]:Se.PURPLE,[h.COOKIE_YELLOW]:Se.YELLOW,[h.COOKIE_PINK]:Se.PINK,[h.COOKIE_ORANGE]:Se.ORANGE},ii=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e,0,0);this.isMultiCell=!0,this.itemWidth=1,this.itemHeight=1,this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.column=t,this.row=s,this.itemType=h.COLOR_CAKE,this.itemSuperType=c.COLOR_CAKE,this.matchIds=[],this.powerupIds=[],this.addBase(),this.addPieces(i),this.sortPiecesByDepth(),this.addBombShadow(),this.addBomb(),this.addBombSparks(),this.getActivePiecesNum()<6&&(this.bombSparks.on=!0),this.setMulticell(),this.setSize(this.base.width,this.base.height)}static getDefaultContent(){return[Se.PURPLE,Se.YELLOW,Se.PINK,Se.ORANGE,Se.RED,Se.BLUE]}addBase(){this.base=this.scene.add.image(0,0,"gameplay","color_cake/Cake_01"),this.add(this.base)}addPieces(e){this.pieces=e.map((t,s)=>{if(!t)return null;let i=this.getPieceFrame(t,s),a=this.scene.make.image({key:"gameplay",frame:i});return a.pieceType=t,a}),this.add(this.pieces.filter(Boolean))}getPieceFrame(e,t){return`color_cake/${e}_0${t+1}`}sortPiecesByDepth(){this.bringPieceToTop(0),this.bringPieceToTop(5)}bringPieceToTop(e){let t=this.pieces[e];t&&this.bringToTop(t)}addBombShadow(){this.bombShadow=this.scene.add.image(0,0,"gameplay","color_cake/Cake_02"),this.bombShadow.alpha=.66,this.add(this.bombShadow)}addBomb(){this.bomb=this.scene.add.image(0,0,"gameplay","color_cake/Cake_03"),this.add(this.bomb)}addBombSparks(){this.particles=this.scene.add.particles("gameplay"),this.updateBombSparksPosition(),this.add(this.particles),this.bombSparks=this.particles.createEmitter({frame:"bomb_spark_2",lifespan:466,scale:{start:1.85,end:0,ease:m.Linear},alpha:{start:1,end:0,ease:m.ExpoIn},quantity:1,frequency:66,speed:50,gravityY:-200,on:!1})}setMulticell(){let e=ae.getSize(this.itemType);this.isMultiCell=!0,this.itemWidth=e.width,this.itemHeight=e.height}removePiece(e){if(this.isEmpty())return;let t=this.pieces.findIndex(s=>s&&s.pieceType===e);return t<0?!1:(this.doRemovePiece(t),this.animateBomb(),this.getActivePiecesNum()===5&&(this.bombSparks.on=!0,this.scene.sounds.bombIgnite()),!0)}doRemovePiece(e){let t=this.pieces[e];delete this.pieces[e],this.scene.tweens.add({targets:t,duration:400,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{t.destroy()}})}animateBomb(){this.isEmpty()||(this.bomb.scaleX=1,this.bomb.scaleY=1,this.bomb.y=0,this.scene.tweens.killTweensByProperty(this.bomb,"scaleX","scaleY"),this.scene.tweens.add({targets:this.bomb,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scaleX:.85,scaleY:1.15,y:"-=13",yoyo:!0}))}getActivePiecesNum(){return this.pieces.filter(Boolean).length}isEmpty(){return this.getActivePiecesNum()===0}alignToGrid(){tn(this),this.y-=10}createSave(){return k(P({},be(this)),{itemSuperType:c.COLOR_CAKE,colorCakeContent:this.pieces.map(e=>{var t;return(t=e==null?void 0:e.pieceType)!=null?t:null})})}explode(e){let t=e;this.scene.tweens.add({targets:this,duration:t,ease:Phaser.Math.Easing.Cubic.In,scale:1.15}),this.scene.tweens.add({targets:this.bomb,duration:t,ease:Phaser.Math.Easing.Cubic.In,scale:1.5,onUpdate:()=>{this.bombSparks.setScale({start:1.85*this.bomb.scale,end:0,ease:m.Linear}),this.updateBombSparksPosition()}}),this.scene.tweens.addYoyoTween({target:this,property:"x",base:this.x,delta:4,repeat:-1,duration:24}),this.scene.time.delayedCall(t,()=>{this.emit(ta.EXPLODE,this),this.destroy()})}updateBombSparksPosition(){let e=this.bomb.x+20*this.bomb.scale,t=this.bomb.y-55*this.bomb.scale;this.particles.setPosition(e,t)}getRandomActivePieceType(){let t=this.pieces.filter(Boolean).map(s=>s.pieceType);return Phaser.Math.RND.pick(t)}destroy(){super.destroy()}toString(){let e=this.pieces.map(t=>{let s=Be(Cs,i=>i===(t==null?void 0:t.pieceType));return s?s.split("_")[1]:"EMPTY"});return Ie.toString(this)+` [${e.join(", ")}]`}},$e;(function(e){e.OPENED="OPENED",e.CLOSED="CLOSED"})($e||($e={}));var bC=class extends Phaser.GameObjects.Container{constructor(e,t,s,i=$e.CLOSED){super(e,0,0);this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.wasJustOpened=!1,this._boxState=$e.CLOSED,this.column=t,this.row=s,this.itemType=h.DONUT_BOX,this.itemSuperType=c.DONUT_BOX,this.matchIds=[],this.powerupIds=[],this.addBoxBack(),this.addDonut(),this.addBoxFrontEdge(),this.addBoxCover(),this.setBoxState(i),this.setSize(this.boxCover.width,this.boxCover.height)}get boxState(){return this._boxState}addBoxBack(){this.boxBack=this.scene.add.image(0,0,"gameplay","donut_box/box_01"),this.add(this.boxBack)}addDonut(){this.donut=this.scene.add.image(0,0,"gameplay","donut_box/donut"),this.donut.y=-5,this.donut.originalY=this.donut.y,this.add(this.donut)}addBoxFrontEdge(){this.boxFrontEdge=this.scene.add.image(0,0,"gameplay","donut_box/box_02"),this.boxFrontEdge.y=-4,this.add(this.boxFrontEdge)}addBoxCover(){this.boxCover=this.scene.add.image(0,0,"gameplay","donut_box/box_03"),this.boxCover.y=-8,this.boxCover.originalY=this.boxCover.y,this.add(this.boxCover)}alignToGrid(){ge(this),this.y-=3}setBoxState(e){this._boxState!==e&&(this._boxState=e,this._boxState===$e.CLOSED?this.onClose():this.onOpen())}onOpen(){this.hideCover(),this.donut.y=this.donut.originalY-12,this.scene.tweens.killTweensOf(this.donut),this.scene.tweens.add({targets:this.donut,duration:600,ease:Phaser.Math.Easing.Bounce.Out,y:this.donut.originalY})}onClose(){this.showCover()}showCover(){this.boxCover.revive(),this.boxCover.scale=1,this.scene.tweens.killTweensOf(this.boxCover),this.boxCover.alpha=0,this.scene.tweens.add({targets:this.boxCover,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.boxCover.y=this.boxCover.originalY-14,this.scene.tweens.add({targets:this.boxCover,duration:600,ease:Phaser.Math.Easing.Bounce.Out,y:this.boxCover.originalY})}hideCover(){this.scene.tweens.killTweensOf(this.boxCover),this.scene.tweens.add({targets:this.boxCover,duration:400,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.boxCover.kill()}})}createSave(){return k(P({},be(this)),{itemSuperType:c.DONUT_BOX,donutBoxState:this._boxState,wasJustOpened:this.wasJustOpened})}hideInstant(){this.destroy()}hide(){this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.In,scale:.33,alpha:0,angle:270,onComplete:()=>{this.destroy()}})}destroy(){super.destroy()}toString(){return Ie.toString(this)+` ${this._boxState} ${this.wasJustOpened?"*just opened":""}`}},G=class{static reset(e){var t;e.dropSqueezeDisabled=!1,(t=e.budgeTween)==null||t.remove(),e.budgeTween=null,e.alignToGrid(),e.revive(),e.alpha=1,e.scale=1,e.sendPowerupToChef=!0,e.wasPoweruped=!1,e.wasMatched=!1,e.powerupId=void 0,e.matchId=void 0,e.dropPath&&(e.dropPath.length=0),e.depth!==F.COOKIES&&e.setDepth(F.COOKIES)}static setItemType(e,t){e.itemType!==t&&(e.itemType=t,e.itemSuperType=O.getItemSuperType(t),e.setFrame(G.getFrame(t,e.powerup)))}static getFrame(e,t){let s=O.getFrameByItemType(e);switch(t){case T.VERTICAL_STRIPES:return s+"-Stripes-Vertical";case T.HORIZONTAL_STRIPES:return s+"-Stripes-Horizontal";case T.BOMB:return s+"-Bomb";case T.SUPER_SPHERE:return"cookies/super_sphere";default:return s}}static createSave(e){return k(P({},be(e)),{itemSuperType:c.COOKIE,powerup:e.powerup})}static toString(e){let t=e.powerup?"*"+e.powerup:"";return`${e.itemType} [${e.column}, ${e.row}] ${t}`}static markAsMatched(e,t){e.wasMatched=!0,e.matchId=t}static markAsPoweruped(e,t){e.wasPoweruped=!0,e.powerupId=t}static popOut(e){!e.scene||(e.dropSqueezeDisabled=!0,this.fadeIn(e),this.playSqueezeTweens(e))}static fadeIn(e){e.alpha=0,e.scene.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}static playSqueezeTweens(e){e.item.scale=0,e.scene.tweens.add({targets:e.item,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1.25,onComplete:()=>{e.scene.tweens.add({targets:e.item,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1,onComplete:()=>{e.dropSqueezeDisabled=!1}})}})}},wC=class extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,"gameplay",O.getFrameByItemType(h.COOKIE_RED));this.wasMatched=!1,this.wasPoweruped=!1,this.wasJustCreated=!1,this.isSwappable=!0,this.isMatchable=!0,this.isDroppable=!0,this.appearDelay=0,this.dropDelay=0,this.dropSqueezeDisabled=!1,this.sendPowerupToChef=!0,this.name="cookie"}setItemType(e){G.setItemType(this,e)}alignToGrid(){ge(this)}createSave(){return G.createSave(this)}toString(){return G.toString(this)}markAsMatched(e){G.markAsMatched(this,e)}markAsPoweruped(e){G.markAsPoweruped(this,e)}popOut(){}reset(){G.reset(this)}hasPowerup(){return!1}get powerup(){return null}},zo=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.wasMatched=!1,this.wasPoweruped=!1,this.wasJustCreated=!1,this.isSwappable=!0,this.isMatchable=!0,this.isDroppable=!0,this.appearDelay=0,this.dropDelay=0,this.dropSqueezeDisabled=!1,this.sendPowerupToChef=!0,this.name="cookie_stripes",this._powerup=t,this.addItem(),this.setSize(this.item.width,this.item.height)}addItem(){let e=G.getFrame(h.COOKIE_RED,T.HORIZONTAL_STRIPES);this.item=this.scene.add.image(0,0,"gameplay",e),this.add(this.item)}setItemType(e){G.setItemType(this,e)}reset(){G.reset(this),this.item.scale=1}markAsMatched(e){G.markAsMatched(this,e)}markAsPoweruped(e){G.markAsPoweruped(this,e)}popOut(){G.popOut(this)}createSave(){return G.createSave(this)}alignToGrid(){ge(this)}setFrame(e){this.item.setFrame(e)}hasPowerup(){return!0}get powerup(){return this._powerup}toString(){return G.toString(this)}},PC=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.wasMatched=!1,this.wasPoweruped=!1,this.wasJustCreated=!1,this.isSwappable=!0,this.isMatchable=!0,this.isDroppable=!0,this.appearDelay=0,this.dropDelay=0,this.dropSqueezeDisabled=!1,this.sendPowerupToChef=!0,this.sparksPosition={x:23,y:-27},this.name="cookie_bomb",this._powerup=T.BOMB,this.addItem(),this.addSparks(),this.setSize(this.item.width,this.item.height)}addItem(){let e=G.getFrame(h.COOKIE_RED,T.BOMB);this.item=this.scene.add.image(0,0,"gameplay",e),this.add(this.item)}addSparks(){this.sparksManager=this.scene.add.particles("gameplay"),this.sparksManager.setPosition(this.sparksPosition.x,this.sparksPosition.y),this.add(this.sparksManager),this.sparksEmitter=this.sparksManager.createEmitter({frame:"bomb_spark_2",lifespan:466,scale:{start:1.85,end:0,ease:m.Linear},alpha:{start:1,end:0,ease:m.ExpoIn},quantity:1,frequency:66,speed:50,gravityY:-200,on:!1})}setItemType(e){G.setItemType(this,e)}reset(){G.reset(this),this.item.scale=1}markAsMatched(e){G.markAsMatched(this,e)}markAsPoweruped(e){G.markAsPoweruped(this,e)}popOut(){G.popOut(this)}createSave(){return G.createSave(this)}alignToGrid(){ge(this)}setFrame(e){this.item.setFrame(e)}hasPowerup(){return!0}get powerup(){return this._powerup}kill(){return this.sparksEmitter.killAll(),this.sparksEmitter.on=!1,super.kill()}revive(){super.revive(),this.sparksEmitter.on=!0}toString(){return G.toString(this)}},jo=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.wasMatched=!1,this.wasPoweruped=!1,this.wasJustCreated=!1,this.isSwappable=!0,this.isMatchable=!1,this.isDroppable=!0,this.appearDelay=0,this.dropDelay=0,this.dropSqueezeDisabled=!1,this.sendPowerupToChef=!0,this.name="super_sphere",this._powerup=T.SUPER_SPHERE,this.addItem(),this.addSparks(),this.setSize(this.item.width,this.item.height)}addItem(){let e=G.getFrame(h.COOKIE_RED,T.BOMB);this.item=this.scene.add.image(0,0,"gameplay",e),this.add(this.item)}addSparks(){this.sparksManager=this.scene.add.particles("gameplay"),this.add(this.sparksManager),this.sparksEmitter=this.sparksManager.createEmitter({frame:"star_particle",speed:20,lifespan:800,rotate:Me.onEmitRandom(0,360),angle:-90,scale:{start:.8,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:m.ExpoOut},frequency:300,on:!1}),this.sparksEmitter.setEmitZone({source:new Phaser.Geom.Circle(0,5,32),type:"random",quantity:360})}playIdleTweens(){let e=800;this.item.angle=Phaser.Math.RND.sign()*5,this.scene.tweens.add({targets:this.item,duration:e*1.5,ease:Phaser.Math.Easing.Sine.InOut,angle:-this.item.angle,yoyo:!0,repeat:-1}),this.item.y=Phaser.Math.RND.sign()*3,this.scene.tweens.add({targets:this.item,duration:e,ease:Phaser.Math.Easing.Sine.InOut,y:-this.item.y,yoyo:!0,repeat:-1})}stopIdleTweens(){this.scene.tweens.killTweensOf(this.item),this.scene.tweens.add({targets:this.item,duration:300,ease:Phaser.Math.Easing.Linear,angle:0,y:0})}stopIdleTweensInstant(){this.scene.tweens.killTweensOf(this.item),this.item.angle=0,this.item.y=0}revive(){super.revive(),this.sparksManager.revive(),this.sparksEmitter.on=!0,this.playIdleTweens()}kill(){return this.sparksManager.kill(),this.sparksEmitter.on=!1,this.stopIdleTweensInstant(),super.kill()}setItemType(e){G.setItemType(this,e)}reset(){G.reset(this),this.item.scale=1,this.item.angle=0,this.item.y=0}markAsMatched(e){G.markAsMatched(this,e)}markAsPoweruped(e){G.markAsPoweruped(this,e)}popOut(){G.popOut(this)}createSave(){return G.createSave(this)}alignToGrid(){ge(this)}setFrame(e){this.item.setFrame(e)}resetFrame(){this.setFrame(G.getFrame(this.itemType,this.powerup))}hasPowerup(){return!0}get powerup(){return this._powerup}toString(){return G.toString(this)}},ai=class{constructor(e){this.createCallback=e.createCallback,this.items=ke(e.initialSize,()=>e.createCallback())}getFirstInactive(){let e=this.items.find(s=>s.active===!1);if(e)return e;let t=this.createCallback();return this.items.push(t),t}destroy(){this.items=null}},LC=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.createPools()}createPools(){this.common=new ai({initialSize:this.scene.field.getNonEmptyCellsNum(),createCallback:()=>{let e=new wC(this.scene);return e.kill(),this.scene.add.existing(e),e}}),this.horStripes=new ai({initialSize:10,createCallback:()=>{let e=new zo(this.scene,T.HORIZONTAL_STRIPES);return e.kill(),this.scene.add.existing(e),e}}),this.vertStripes=new ai({initialSize:10,createCallback:()=>{let e=new zo(this.scene,T.VERTICAL_STRIPES);return e.kill(),this.scene.add.existing(e),e}}),this.bombs=new ai({initialSize:12,createCallback:()=>{let e=new PC(this.scene);return e.kill(),this.scene.add.existing(e),e}}),this.superSpheres=new ai({initialSize:5,createCallback:()=>{let e=new jo(this.scene);return e.kill(),this.scene.add.existing(e),e}})}getCookie(e){return this.getPoolByPowerupType(e).getFirstInactive()}getPoolByPowerupType(e){switch(e){case T.VERTICAL_STRIPES:return this.vertStripes;case T.HORIZONTAL_STRIPES:return this.horStripes;case T.BOMB:return this.bombs;case T.SUPER_SPHERE:return this.superSpheres;default:return this.common}}destroy(){let e=[this.common,this.horStripes,this.vertStripes,this.bombs,this.superSpheres];e.forEach(t=>t.destroy()),e=null}},IC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isMultiCell=!0,this.itemWidth=1,this.itemHeight=1,this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.GUMMY,this.setMulticell(),this.setSize(this.itemWidth*y,this.itemHeight*y)}setMulticell(){let e=ae.getSize(this.itemType);e&&(this.isMultiCell=!0,this.itemWidth=e.width,this.itemHeight=e.height)}alignToGrid(){let e=j(this.column,this.row),t=e.y-y/2,s=e.x-y/2;this.x=s+this.width/2,this.y=t+this.height/2}createSave(){return k(P({},be(this)),{itemSuperType:c.GUMMY})}isLarge(){return this.itemType.includes("LARGE")}isHorizontal(){return this.itemType.includes("HORIZONTAL")}toString(){return Ie.toString(this)}},sa;(function(e){e.OPEN="__OPEN"})(sa||(sa={}));var AC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isSwappable=!0,this.isMatchable=!1,this.isDroppable=!0,this.matchIds=[],this.powerupIds=[],this.appearDelay=0,this.dropDelay=0,this.dropSqueezeDisabled=!1,this.wasJustCreated=!0,this.isOpened=!1,this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.MYSTERY_BOX,this.content=a}open(e=0){this.isOpened||(this.isOpened=!0,this.scene.time.delayedCall(e,()=>{this.emit(sa.OPEN,this)}))}alignToGrid(){ge(this,this.column,this.row)}createSave(){return k(P({},be(this)),{itemSuperType:c.MYSTERY_BOX,content:this.content})}destroy(){super.destroy()}toString(){return Ie.toString(this)+` content: ${this.content.type}`}convertContentToGameItemConfig(){return O.getSubtypes(c.COOKIE).includes(this.content.type)?{column:this.column,row:this.row,itemType:this.content.type,params:{type:"cookie",powerup:this.content.powerup}}:{column:this.column,row:this.row,itemType:this.content.type,params:{type:"basic"}}}},xC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isSwappable=!0,this.isMatchable=!1,this.isDroppable=!0,this.matchIds=[],this.powerupIds=[],this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.CHICK}alignToGrid(){ge(this,this.column,this.row),this.y-=4}createSave(){return k(P({},be(this)),{itemSuperType:c.CHICK})}destroy(){super.destroy()}toString(){return Ie.toString(this)}},BC=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"gameplay",O.getFrameByItemType(i));this.isDroppable=!1,this.isMatchable=!1,this.isSwappable=!1,this.column=t,this.row=s,this.itemType=i,this.itemSuperType=c.GUMMY_BLOCKER}alignToGrid(){ge(this)}createSave(){return k(P({},be(this)),{itemSuperType:c.GUMMY_BLOCKER})}destroy(){super.destroy()}toString(){return Ie.toString(this)}},kC=class{constructor(e){this.scene=e,this.mysteryBoxGenerator=this.scene.mysteryBoxContentGenerator,this.cookiesPool=new LC(this.scene)}create(e){switch(O.getItemSuperType(e.itemType)){case c.BISCUIT:return this.createBiscuit(e.column,e.row);case c.COOKIE:return this.createCookie(e.column,e.row,e.itemType,e.params.powerup);case c.MARSHMALLOW:return this.createMarshmallow(e.column,e.row,e.itemType);case c.DROP_ITEM:return this.createDropItem(e.column,e.row,e.itemType);case c.CHOCOLATE:return this.createChocolate(e.column,e.row,e.itemType);case c.CANDY_BOTTLE:return this.createCandyBottle(e.column,e.row);case c.DONUT_BOX:return this.createDonutBox(e.column,e.row);case c.APPLE_PLATTER:return this.createApplePlatter(e.column,e.row,e.params.applesNum);case c.COLOR_CAKE:return this.createColorCake(e.column,e.row,e.params.content);case c.LICORICE:return this.createLicorice(e.column,e.row,e.itemType);case c.GUMMY:return this.createGummy(e.column,e.row,e.itemType);case c.GUMMY_BLOCKER:return this.createGummyBlocker(e.column,e.row,e.itemType);case c.MYSTERY_BOX:return this.createMysteryBox(e.column,e.row,e.itemType,this.mysteryBoxGenerator.getMysteryBoxContent());case c.GENERATOR:let{turnsNum:s,content:i,contentMod:a,invisible:n}=e.params;return this.createGenerator(e.column,e.row,{content:i,contentMod:a,turnsTotal:s,invisible:n});case c.CHICK:return this.createChick(e.column,e.row,e.itemType);default:return null}}createBiscuit(e,t){let s=new TC(this.scene,e,t);return s.alignToGrid(),s.setDepth(F.BISCUITS),this.scene.items.add(s),this.scene.add.existing(s),s}createCookie(e,t,s,i){let a=this.cookiesPool.getCookie(i);return a.column=e,a.row=t,a.setItemType(s),a.reset(),this.scene.items.add(a),a}createDropItem(e,t,s){let i=new SC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}createMarshmallow(e,t,s,i){let a=new EC(this.scene,e,t,s);return a.alignToGrid(),a.setDepth(F.COOKIES),a.on(Zi.DAMAGE,this.scene.onMarshmallowDamage,this.scene),typeof i!="undefined"&&a.setHealth(i),this.scene.items.add(a),this.scene.add.existing(a),a}createChocolate(e,t,s,i){let a=new yC(this.scene,e,t,s);return a.alignToGrid(),a.setDepth(F.COOKIES),a.on(Ji.DAMAGE,this.scene.onChocolateDamage,this.scene),typeof i!="undefined"&&a.setHealth(i),this.scene.items.add(a),this.scene.add.existing(a),a}createDonutBox(e,t,s=$e.CLOSED){let i=new bC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}createCandyBottle(e,t){let s=new CC(this.scene,e,t);return s.alignToGrid(),s.setDepth(F.COOKIES),s.on(ys.EMIT_PARTICLES,this.scene.onCandyBottleLanded,this.scene),s.on(ys.EMIT_CANDY,this.scene.onCandyCollect,this.scene),s.originalY=s.y,this.scene.items.add(s),this.scene.add.existing(s),s}createApplePlatter(e,t,s){let i=new OC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),i.on(ea.APPLE_REMOVE,this.scene.onAppleCollect,this.scene),this.scene.items.add(i),this.scene.add.existing(i),i}createColorCake(e,t,s){let i=new ii(this.scene,e,t,s!=null?s:ii.getDefaultContent());return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}createLicorice(e,t,s){let i=new vC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}createGummy(e,t,s){let i=new IC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.GUMMIES),this.scene.items.add(i),this.scene.add.existing(i),i}createGummyBlocker(e,t,s){let i=new BC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}createMysteryBox(e,t,s,i){let a=new AC(this.scene,e,t,s,i);return a.alignToGrid(),a.setDepth(F.COOKIES),a.once(sa.OPEN,this.scene.onMysteryBoxOpen,this.scene),this.scene.items.add(a),this.scene.add.existing(a),a}createGenerator(e,t,s){let i=new gC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.GENERATOR),this.scene.items.add(i),this.scene.add.existing(i),i}createChick(e,t,s){let i=new xC(this.scene,e,t,s);return i.alignToGrid(),i.setDepth(F.COOKIES),this.scene.items.add(i),this.scene.add.existing(i),i}destroy(){this.cookiesPool.destroy()}},It;(function(e){e.SWAP_START="__SWAP_START",e.SWAP_COMPLETE="__SWAP_COMPLETE",e.SWAP_BACK_COMPLETE="__SWAP_BACK_COMPLETE"})(It||(It={}));var ni;(function(e){e.HORIZONTAL="HORIZONTAL",e.VERTICAL="VERTICAL"})(ni||(ni={}));var MC=class extends Phaser.Events.EventEmitter{constructor(e){super();this.trackSwapping=!1,this.scene=e,this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this)}onPointerDown(e,t){if(this.scene.isLocked||t.length>0)return;let s=this.getPointerCameraPosition(e),i=this.getItemAtXY(s.x,s.y);!i||!this.canBeSwapped(i)||(this.pointerDownItem=i,this.pointerDownPosition=s,this.pointer=e,this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.once(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.startTrackSwapping())}getPointerCameraPosition(e){return e.positionToCamera(this.scene.cameras.main)}getItemAtXY(e,t){let{column:s,row:i}=Vs(e,t);return this.scene.items.mainItems.getAt(s,i)}canBeSwapped(e){return e.isSwappable&&this.scene.items.hasLicoriceOver(e)===!1}onPointerUp(){this.stopTrackSwapping()}startTrackSwapping(){this.trackSwapping=!0}stopTrackSwapping(){this.trackSwapping=!1}tryToSwap(e){if(!this.pointerDownItem){this.sendExceptionToSentry(e);return}let t=Phaser.Math.Angle.BetweenPoints(this.pointerDownPosition,e),s=Phaser.Math.RadToDeg(t),i=xo(s),a=this.scene.items.mainItems.getNeighborAtDirection(this.pointerDownItem.column,this.pointerDownItem.row,i);a&&this.canBeSwapped(a)?this.swapItems(this.pointerDownItem,a):this.playCantSwapTween(this.pointerDownItem,t)}sendExceptionToSentry(e){let t=Vs(this.pointerDownPosition.x,this.pointerDownPosition.y),s=Phaser.Math.Angle.BetweenPoints(this.pointerDownPosition,e),i=Phaser.Math.RadToDeg(s),a=xo(i);this.scene.sentry.captureException(new Error("No pointerDownItem!"),n=>(n.setContext("Swapping error",{cell:`[${t.column}, ${t.row}]`,angle:Math.round(i).toString(),direction:a,level:this.scene.levelNumber,movesDone:this.scene.levelConfig.moves-this.scene.moves,moveListenersNum:this.scene.input.listenerCount(Phaser.Input.Events.POINTER_MOVE),upListenersNum:this.scene.input.listenerCount(Phaser.Input.Events.POINTER_UP),isPointerOverGame:this.scene.input.isOver,scene:this.scene.scene.key}),n))}swapItems(e,t){this.emit(It.SWAP_START,e,t),this.lastSwap={item_1:e,item_2:t,swappedItems:[e,t],direction:this.getSwapDirection(e,t)},this.scene.items.swapItems(e,t),this.scene.audio.play(u.SWAP,{volume:.66}),this.playSwapTweens(e,t,()=>{this.emit(It.SWAP_COMPLETE,e,t)})}playSwapTweens(e,t,s){let i=200,a=Phaser.Math.Easing.Cubic.Out;this.scene.tweens.add({targets:e,duration:i,ease:a,x:t.x,y:t.y,onStart:()=>{e.setDepth(F.NEW_COOKIE)},onComplete:()=>{e.setDepth(F.COOKIES),s()}}),this.scene.tweens.add({targets:e,duration:i/2,ease:Phaser.Math.Easing.Sine.Out,scale:1.33,yoyo:!0}),this.scene.tweens.add({targets:t,duration:i,ease:a,x:e.x,y:e.y}),this.scene.tweens.add({targets:t,duration:i/2,ease:Phaser.Math.Easing.Sine.Out,scale:.8,yoyo:!0})}getSwapDirection(e,t){let s=Phaser.Math.Angle.Between(e.column,e.row,t.column,t.row)*Phaser.Math.RAD_TO_DEG;return s===180||s===0?ni.HORIZONTAL:ni.VERTICAL}swapItemsBack(e,t){this.scene.items.swapItems(e,t),this.scene.audio.play(u.SWAP_BACK,{volume:.75}),this.playSwapTweens(t,e,()=>{this.emit(It.SWAP_BACK_COMPLETE,e,t)})}playCantSwapTween(e,t){let s=Phaser.Math.Snap.To(t,Math.PI/2),i=y*.2,a=e.x+Math.cos(s)*i,n=e.y+Math.sin(s)*i,r=120;this.onCantSwapTweenStart(e),this.scene.tweens.add({targets:e,duration:r,ease:Phaser.Math.Easing.Sine.InOut,x:a,y:n,yoyo:!0}),this.scene.tweens.addYoyoTween({target:e,property:"angle",base:0,delta:13,duration:r/2,repeat:1,ease:m.SineInOut,onComplete:()=>{this.onCantSwapTweenComplete()}})}onCantSwapTweenStart(e){var t,s;this.scene.isLocked=!0,this.scene.audio.play(u.CANT_SWAP,{volume:.33}),((s=(t=this.scene.hint.hint)==null?void 0:t.getItems())!=null?s:[]).includes(e)&&this.scene.hint.cancel()}onCantSwapTweenComplete(){this.scene.isLocked=!1,this.scene.hint.hint||this.scene.hint.start()}update(e){this.trackSwapping!==!1&&this.doTrackSwapping()}doTrackSwapping(){let e=this.getPointerCameraPosition(this.pointer);Phaser.Math.Distance.BetweenPoints(this.pointerDownPosition,e)>y/3&&(this.stopTrackSwapping(),this.tryToSwap(e),this.pointerDownItem=null)}destroy(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.stopTrackSwapping()}},RC=class{constructor(e,t){this.isComplete=!1,this.speed=1.22,this.scene=e,this.item=t,this.dropDelay=t.dropDelay,this.path=this.item.dropPath.map(s=>j(s.column,s.row)),this.path=this.path.reverse(),this.path.length===1?this.playLastTween(this.dropDelay):this.destination=this.path.pop()}update(e){if(!this.destination)return;let t=e*this.scene.fastForward.timeScale;if(this.dropDelay-=t,this.dropDelay>0)return;let s=this.destination.x-this.item.x,i=this.destination.y-this.item.y,a=Math.atan2(i,s),n=this.speed*t;this.item.x+=Math.cos(a)*n,this.item.y+=Math.sin(a)*n,Math.sqrt(s*s+i*i)<=n&&(this.path.length===1?(this.destination=null,this.playLastTween(0)):this.destination=this.path.pop())}playLastTween(e){let t=this.isLastDropDiagonal(),s=300,i=t?s*1.5:s,a=this.path[0];this.item.dropSqueezeDisabled||this.scene.tweens.add({delay:e+i/2,targets:this.item,duration:s/2,ease:Phaser.Math.Easing.Linear,scaleX:1,scaleY:1,onStart:()=>{var n;(n=this.item.dropSqueezeTween)==null||n.remove(),this.item.dropSqueezeTween=null}}),this.scene.tweens.add({delay:e,duration:i,targets:this.item,ease:Phaser.Math.Easing.Back.Out,easeParams:[.66],x:a.x,y:a.y,onComplete:()=>{this.isComplete=!0}})}isLastDropDiagonal(){let e=this.item.dropPath,t=e[e.length-1],s=e[e.length-2];return s&&s.column!==t.column}},NC=class extends Phaser.Events.EventEmitter{constructor(e){super();this.fixMatchesChance=.8,this.extraMatchChance=.15,this.increaseExtraMatchesOnFail=!1,this.extraMatchScheduled=!1,this.fixMatchScheduled=!1,this.scene=e,this.items=this.scene.items,this.itemTypes=this.scene.cookieTypesGenerator.getItemTypes(),this.rnd=new Phaser.Math.RandomDataGenerator(e.initData.rndSeed),this.setChances()}setChances(){this.increaseExtraMatchesOnFail&&this.doIncreaseExtraMatchesOnFail();let e=w.getNumber("fixMatches",-1);e>-1&&(this.fixMatchesChance=Phaser.Math.Clamp(e/100,0,1));let t=w.getNumber("extraMatches",-1);t>-1&&(this.extraMatchChance=Phaser.Math.Clamp(t/100,0,1))}doIncreaseExtraMatchesOnFail(){let e=this.extraMatchChance,t=.05,s=.3,i=this.scene.game.store.getLevelResult(this.scene.levelNumber);i?this.extraMatchChance=Math.min(s,e+i.timesFailedNum*t):this.extraMatchChance=e}process(){let e=this.scene.gui.tutorial;if(e&&e.hasMatchTutorial()){this.fixAutoMatches();return}this.extraMatchScheduled||this.extraMatchChance>this.rnd.frac()?(this.extraMatchScheduled=!0,this.addAutoMatches()):(this.fixMatchScheduled||this.fixMatchesChance>this.rnd.frac())&&(this.fixMatchScheduled=!0,this.fixAutoMatches())}fixAutoMatches(){let e=this.items.mainItems.filter(a=>a.isMatchable),t=this.items.mainItems.filter(a=>a.wasJustCreated&&!a.isFromGenerator&&!a.isPredefined&&te(a)),s=10,i;do i=Ee.findAll(e,t),i.forEach(a=>{a.items.some(n=>{if(n.wasJustCreated)return n.setItemType(this.scene.cookieTypesGenerator.getItem()),!0})});while(i.length>0&&--s);i.length===0&&(this.fixMatchScheduled=!1)}addAutoMatches(){let e=this.items.mainItems.filter(i=>i.isMatchable),t=this.items.mainItems.filter(i=>i.wasJustCreated&&!i.isFromGenerator&&!i.isPredefined&&te(i)),s=this.rnd.shuffle(this.itemTypes.slice(0));for(let i=0;i<s.length;i++){let a=s[i],n=Phaser.Math.Clamp(Math.ceil(t.length*.5),1,4);if(this.rnd.shuffle(t.slice(0)).slice(0,n).forEach(d=>d.setItemType(a)),Ee.findAll(e,t).some(d=>d.result!==null)){this.extraMatchScheduled=!1;return}}}getState(){return{fixMatchesChance:this.fixMatchesChance,extraMatchChance:this.extraMatchChance,fixMatchScheduled:this.fixMatchScheduled,extraMatchScheduled:this.extraMatchScheduled,rnd:this.rnd.state()}}setState(e){this.fixMatchesChance=e.fixMatchesChance,this.extraMatchChance=e.extraMatchChance,this.fixMatchScheduled=e.fixMatchScheduled,this.extraMatchScheduled=e.extraMatchScheduled,this.rnd.state(e.rnd)}},DC=class{constructor(e){this.scene=e,this.factory=e.itemsFactory,this.cookieTypesGenerator=e.cookieTypesGenerator}createItem(e){let{options:t}=e,s=e.column,i=e.row+1;switch(t.content){case V.DROP_ITEM:return this.factory.createDropItem(s,i,h.DROP_ITEM);case V.MARSHMALLOW:return this.factory.createMarshmallow(s,i,h.MARSHMALLOW_COMMON);case V.CHICK:return this.factory.createChick(s,i,h.CHICK);case V.RANDOM_COOKIE:let a=this.cookieTypesGenerator.getItem(),n=Lt.convertContentModToCookiePowerup(t.contentMod,this.scene.rnd);return this.factory.createCookie(s,i,a,n);case V.PURPLE_COOKIE:case V.ORANGE_COOKIE:case V.BLUE_COOKIE:case V.RED_COOKIE:case V.PINK_COOKIE:case V.YELLOW_COOKIE:return this.createCookie(e);default:return t.content,null}}createCookie(e){let t=Lt.convertContentToCookieType(e.options.content),s=Lt.convertContentModToCookiePowerup(e.options.contentMod,this.scene.rnd);return this.factory.createCookie(e.column,e.row,t,s)}},HC=Phaser.Events.EventEmitter,Ge;(function(e){e.IDLE="IDLE",e.DROP_ANIMATION="DROP_ANIMATION",e.WAITING_TO_DROP="WAITING_TO_DROP",e.CALCULATING_DROP="CALCULATING_DROP"})(Ge||(Ge={}));var ri;(function(e){e.DROP_START="__DROP_START",e.DROP_COMPLETE="__DROP_COMPLETE"})(ri||(ri={}));var GC=class extends HC{constructor(e){super();this.state=Ge.IDLE,this.preDropTimer=0,this.preDropLocks=[],this.preDropLockCounter=0,this.newItemsCounter=0,this.scene=e,this.field=this.scene.field,this.items=this.scene.items,this.autoMatches=new NC(this.scene),this.generatorItemsFactory=new DC(this.scene),this.newItemsTypes=this.getNewItemsTypes()}getNewItemsTypes(){if(this.scene.levelConfig.newItemsTypes==="")return{};try{return JSON.parse(this.scene.levelConfig.newItemsTypes)}catch(t){}return{}}lockPreDrop(e=""){this.preDropLockCounter++;let t=e?`${e}__${this.preDropLockCounter}`:this.preDropLockCounter.toString();return this.preDropLocks.push(t),t}unlockPreDrop(e){let t=this.preDropLocks.indexOf(e);t>-1&&this.preDropLocks.splice(t,1)}startPreDropTimer(e=150){this.state===Ge.CALCULATING_DROP||this.state===Ge.DROP_ANIMATION||(this.state=Ge.WAITING_TO_DROP,this.preDropTimer=Math.max(this.preDropTimer,e))}update(e){switch(this.state){case Ge.WAITING_TO_DROP:this.preDropTimer-=e,this.preDropTimer<0&&this.preDropLocks.length===0&&(this.state=Ge.CALCULATING_DROP,this.itemsToDrop=this.items.getItemsToDrop().sort(sn),this.dropIteration=0,this.resetItemsDrop());break;case Ge.CALCULATING_DROP:let t=0;for(;t<10;){let i=performance.now();if(this.calculateItemsDrop(this.dropIteration++,this.itemsToDrop)){this.state=Ge.DROP_ANIMATION,this.autoMatches.process(),this.itemDroppers=this.createItemDroppers(this.itemsToDrop),this.itemsToDrop=null;break}t+=performance.now()-i}break;case Ge.DROP_ANIMATION:this.itemDroppers.forEach(i=>i.update(e)),this.itemDroppers.every(i=>i.isComplete)&&(this.itemDroppers.length=0,this.completeDrop());break;default:break}}resetItemsDrop(){this.items.mainItems.forEach(e=>{e.isDroppable!==!1&&(e.dropPath||(e.dropPath=[]),e.appearDelay=0,e.dropPath.length=0,e.dropDelay=0,e.wasJustCreated=!1,e.isFromGenerator=!1,e.isPredefined=!1)})}calculateItemsDrop(e=0,t){let s=!1;t.forEach(a=>{let n=this.field.getCellAt(a.column,a.row+1);n&&this.isCellFree(n)&&(s=!0,this.dropItemToCell(a,n))});let i=this.createNewItemsDuringTheDrop();return i.length>0&&(i.forEach(a=>{a.appearDelay=e*100,a.alpha=0,a.wasJustCreated=!0}),t.push(...i),t=t.sort(sn),s=!0),t.forEach(a=>{let{column:n,row:r}=a,o,l=this.field.getCellAt(n,r+1);if(l&&this.isCellFree(l))return;let d=this.field.getCellAt(n-1,r+1);if(d&&this.isCellFree(d)&&(o=d),!o){let A=this.field.getCellAt(n+1,r+1);A&&this.isCellFree(A)&&(o=A)}if(!o)return;let f=o.column;t.some(A=>{if(A.column!==f||A.row>=o.row)return!1;for(let x=A.row+1;x<o.row;x++){let X=this.field.cells.checkAt(f,x),Z=this.items.topItems.checkAt(f,x)||this.items.mainItems.checkAt(f,x);if(X===!1||Z)return!1}return!0})===!1&&(this.dropItemToCell(a,o),s=!0)}),!s}createNewItemsDuringTheDrop(){let t=this.getTopEmptyCells().filter(a=>this.hasGeneratorAbove(a)===!1).map(a=>this.createNewItemAboveTheCell(a)),i=this.items.generators.filter(({column:a,row:n})=>this.isCellFree({column:a,row:n+1})).map(a=>--a.options.turnsLeft==0?(a.options.turnsLeft=a.options.turnsTotal,a.updateTurnsLabel(),a.playDropAnimation(),this.createItemFromGenerator(a)):(a.updateTurnsLabel(),this.createNewItemAboveTheCell({column:a.column,row:a.row+1})));return[...t,...i]}hasGeneratorAbove(e){return this.items.generators.checkAt(e.column,e.row-1)}isCellFree(e){return this.items.mainItems.checkAt(e.column,e.row)===!1}dropItemToCell(e,t){this.items.mainItems.remove(e),e.column=t.column,e.row=t.row,this.items.mainItems.add(e),e.dropPath.push(t)}createNewItemAboveTheCell(e){let t=j(e.column,e.row-1),s=this.createNewItem(e.column,e.row);return s.x=t.x,s.y=t.y,s.dropPath=[e],s}createItemFromGenerator(e){let t=e.column,s=e.row+1,i=j(t,s-1),a=this.generatorItemsFactory.createItem(e);return a.x=i.x,a.y=i.y,a.dropPath=[{column:t,row:s}],a.isFromGenerator=!0,a}getTopEmptyCells(){let{mainItems:e,topItems:t}=this.items;return this.field.getTopCells().filter(s=>{let{column:i,row:a}=s,n=e.checkAt(i,a),r=t.checkAt(i,a);return n===!1&&r===!1})}createNewItem(e,t){this.newItemsCounter++;let s=this.newItemsTypes[this.newItemsCounter]?this.newItemsTypes[this.newItemsCounter]:this.scene.itemTypesGenerator.getItem();if(s===h.MYSTERY_BOX)return this.scene.itemsFactory.createMysteryBox(e,t,s,this.scene.mysteryBoxContentGenerator.getMysteryBoxContent());{let i=this.scene.itemsFactory.createCookie(e,t,s);return i.newItemId=this.newItemsCounter,i.isPredefined=this.newItemsTypes.hasOwnProperty(this.newItemsCounter),i}}createItemDroppers(e){let t=e.filter(a=>{var n;return((n=a.dropPath)==null?void 0:n.length)>0});if(t.length===0)return this.completeDrop(),null;let s=16/this.scene.fastForward.timeScale,i=ze(t,"row").row;return t.map(a=>{var n;return(n=a.budgeTween)==null||n.remove(),a.dropDelay=(i-a.row)*s+a.appearDelay,a.dropDelay>0?this.scene.tweens.add({delay:a.dropDelay,targets:a,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}):a.alpha=1,a.dropSqueezeDisabled||(a.dropSqueezeTween=this.scene.tweens.add({delay:a.dropDelay,targets:a,duration:200,ease:Phaser.Math.Easing.Linear,scaleX:.75,scaleY:1.2})),new RC(this.scene,a)})}completeDrop(){this.state=Ge.IDLE,this.emit(ri.DROP_COMPLETE,this)}destroy(){super.destroy(),this.itemsToDrop=null,this.itemDroppers=null}},FC=We(require("@sentry/types")),oi;(function(e){e.SHUFFLE_START="ItemsShuffler_SHUFFLE_START",e.SHUFFLE_COMPLETE="ItemsShuffler_SHUFFLE_COMPLETE"})(oi||(oi={}));var UC=class extends Phaser.Events.EventEmitter{constructor(e){super();this.shufflesInRow=0,this.scene=e}shuffleItems(e,t){++this.shufflesInRow==5&&this.sendTooManyShufflesEventToSentry();let s=this.getCookiesToShuffle(e),i=this.getGridAlignedPositions(s),a=performance.now(),n=33,r=0,o=!1;do this.scene.rnd.shuffle(i),s.forEach(d=>{e.mainItems.remove(d)}),s.forEach((d,f)=>{let S=i[f],{column:A,row:x}=en(S);d.column=A,d.row=x,e.mainItems.add(d)}),r=performance.now()-a,o=jt.isDeadlock(e);while(o&&r<n);let l=o?this.getCookieTypesToPreventDeadlock(s,e,t):s.map(d=>d.itemType);this.playShuffleAnimation(s,i,l)}sendTooManyShufflesEventToSentry(){return $(this,null,function*(){var e;(e=this.scene.sentry)==null||e.captureMessage("Too many shuffles",{level:FC.Severity.Warning,extra:{level:this.scene.levelNumber,snapshot:yield this.scene.sentry.getGameSnapshotAsBlob(),json:JSON.stringify(this.scene.session,null,4),fps:this.scene.game.fpsTracker.getMedianFps()}})})}getCookiesToShuffle(e){return e.mainItems.filter(t=>te(t)&&t.hasPowerup()===!1&&e.topItems.checkAt(t.column,t.row)===!1)}getGridAlignedPositions(e){return e.map(t=>j(t.column,t.row))}playShuffleAnimation(e,t,s){let i=os(()=>{this.emit(oi.SHUFFLE_COMPLETE)});e.forEach((a,n)=>{let r=t[n],o=s[n],l=o===a.itemType?_a:os((d,f)=>this.updateCookieType(d,f));this.scene.tweens.add({targets:a,duration:1e3,ease:Phaser.Math.Easing.Back.InOut,easeParams:[1.2],x:r.x,y:r.y,onComplete:i,onUpdate:d=>{d.progress>.5&&l(a,o)}})})}getCookieTypesToPreventDeadlock(e,t,s){let i=e.map(o=>o.itemType),a=[],n=s.getItemTypes(),r=100;for(;jt.isDeadlock(t)&&--r>0;)e.forEach((o,l)=>{let d=Tt(n,o.itemType),f=this.scene.rnd.pick(d);o.itemType=f,a[l]=f});return e.forEach((o,l)=>{o.itemType=i[l]}),a}updateCookieType(e,t){this.scene.tweens.add({targets:e,duration:100,ease:Phaser.Math.Easing.Sine.InOut,scale:.33,alpah:0,yoyo:!0,onYoyo:()=>{e.setItemType(t)}})}resetShufflesInRow(){this.shufflesInRow=0}},WC=class{constructor(e){this.scene=e,this.camera=this.scene.cameras.main}resize(){let e=E.GAME_WIDTH*.9,t=this.getMaxHeight(),s=e/this.getWidth(),i=t/this.getHeight(),a=Math.min(s,i),n=this.getViewportX()*a,r=this.getViewportY()*a+this.getTopOffset();this.camera.setViewport(n,r,E.GAME_WIDTH,E.GAME_HEIGHT),this.camera.setZoom(a),this.camera.originalZoom=this.camera.zoom,this.camera.scrollX=-(E.GAME_WIDTH-this.getWidth())/2,this.camera.scrollY=-(E.GAME_HEIGHT-this.getHeight())/2}getTopOffset(){return 20*E.ASSETS_SCALE}getMaxHeight(){let e=180*E.ASSETS_SCALE;return E.GAME_HEIGHT-e*2}get zoom(){return this.camera.zoom}get displayWidth(){return this.camera.displayWidth}get displayHeight(){return this.camera.displayHeight}getWidth(){return this.scene.field.width}getHeight(){return this.scene.field.height}getPadding(){let e=(E.GAME_WIDTH-this.getWidth()*this.camera.zoom)/2,t=(E.GAME_HEIGHT-this.getHeight()*this.camera.zoom)/2;return{x:e,y:t}}getViewportX(){let e=9,t=this.scene.gridDimensions,s=e-t.width,i=t.left;return(s/2-i)*y}getViewportY(){let e=10,t=this.scene.gridDimensions,s=e-t.height,i=t.top;return(s/2-i)*y}getWorldPosition(e){return this.getWorldPositionXY(e.x,e.y)}getWorldPositionXY(e,t){let s=this.camera,i=this.getPadding(),a=s.zoom,n=s.x+i.x+e*a,r=s.y+i.y+t*a;return{x:n,y:r}}playZoomTween(e,t=233){this.camera.zoom=this.camera.originalZoom,this.scene.tweens.killTweensByProperty(this.camera,"zoom"),this.scene.tweens.add({targets:this.camera,duration:t,ease:Phaser.Math.Easing.Sine.InOut,zoom:e,yoyo:!0})}},YC=Phaser.Events.EventEmitter,hi;(function(e){e.SAVE="UndoHandler_SAVE",e.RESTORE="UndoHandler_RESTORE"})(hi||(hi={}));var VC=class extends YC{constructor(e){super();this.savedStatesMax=10,this.scene=e,this.savedStates=[]}save(){let e={items:this.scene.items.save(),goals:this.scene.goals.save(),moves:this.scene.moves,autoMatches:this.scene.itemsDropper.autoMatches.getState(),itemTypesGenerator:this.scene.itemTypesGenerator.getState(),cookiesTypesGenerator:this.scene.cookieTypesGenerator.getState(),mysteryBoxesGenerator:this.scene.mysteryBoxContentGenerator.getState(),powerupChef:this.scene.gui.powerupChef.save(),boosters:this.scene.game.boosters.save(),gameplayRnd:this.scene.rnd.state(),rnd:Phaser.Math.RND.state()};this.savedStates.push(e),this.savedStates.length>this.savedStatesMax&&this.savedStates.shift(),this.emit(hi.SAVE,this,e)}canRestore(){return this.savedStates.length>0}restore(){let e=this.savedStates.pop();!e||(this.scene.items.restore(this.scene.itemsFactory,e.items),this.scene.goals.restore(e.goals),this.scene.moves=e.moves,this.scene.itemsDropper.autoMatches.setState(e.autoMatches),this.scene.itemTypesGenerator.setState(e.itemTypesGenerator),this.scene.cookieTypesGenerator.setState(e.cookiesTypesGenerator),this.scene.mysteryBoxContentGenerator.setState(e.mysteryBoxesGenerator),this.scene.gui.powerupChef.restore(e.powerupChef),this.scene.game.boosters.restore(e.boosters),this.scene.rnd.state(e.gameplayRnd),Phaser.Math.RND.state(e.rnd),this.emit(hi.RESTORE,this,e))}removeLastSavedState(){this.savedStates.length>0&&this.savedStates.pop()}adjustMovesAfterSecondChance(e){this.savedStates.forEach((t,s)=>{s>=this.savedStates.length-e&&(t.moves+=e)})}},ia;(function(e){e.COMPLETE="DoubleSpheresFx_COMPLETE"})(ia||(ia={}));var KC=class extends Phaser.Events.EventEmitter{constructor(e,t,s){super();this.scene=e,this.sphere_1=t,this.sphere_2=s,this.addWhiteSphere(),this.addParticles()}addWhiteSphere(){this.whiteSphere=this.scene.add.image(0,0,"gameplay","cookies/super_sphere_x2_white"),this.whiteSphere.setDepth(F.POWERUP_FX),this.whiteSphere.kill()}addParticles(){this.particleManager=this.scene.add.particles("gameplay"),this.particleManager.setPosition(this.sphere_1.x,this.sphere_1.y),this.particleManager.setDepth(F.POWERUP_FX),this.gravityWell=this.particleManager.createGravityWell({power:10,epsilon:250,gravity:200});let e=new Phaser.Geom.Circle(0,0,this.sphere_1.displayWidth*2);this.attractEmitter=this.particleManager.createEmitter({frame:"double_spheres_particle",lifespan:800,alpha:{start:0,end:1,ease:m.ExpoOut},scale:{start:1.33,end:.33},quantity:2,on:!1}).setDeathZone({source:new Phaser.Geom.Circle(0,0,e.radius*.25),type:"onEnter"}).setEmitZone({source:e,type:"random"})}start(){this.mergeSpheresIntoOneBigSphere().then(()=>this.shrinkBigSphere()).then(()=>{this.sphere_1.kill(),this.sphere_1.resetFrame(),this.whiteSphere.kill(),this.scene.emitters.doubleSpheresExplosion.explode(100,this.sphere_1.x,this.sphere_1.y),this.disableAttractEmitter(),this.emit(ia.COMPLETE,this.sphere_1),this.destroy(),this.scene.camera.camera.shakeEffect.start(400,.015,!0),this.scene.camera.playZoomTween(.85,400),this.scene.audio.play(u.DOUBLE_SPHERES_EXPLODE)})}mergeSpheresIntoOneBigSphere(){let e={x:this.sphere_1.x,y:this.sphere_1.y},t={x:this.sphere_2.x,y:this.sphere_2.y},s=Phaser.Geom.Point.Interpolate(e,t,.5),a=[this.sphere_1,this.sphere_2].map(n=>(n.setDepth(F.MERGING_COOKIE),n.stopIdleTweens(),n.sparksEmitter.on=!1,n.sparksEmitter.killAll(),this.scene.tweens.add({targets:n,duration:300,ease:Phaser.Math.Easing.Back.In,x:s.x,y:s.y,onComplete:()=>{this.scene.camera.camera.shake(200,.01)}})));return new Promise((n,r)=>{a[0].once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.sphere_2.kill(),this.sphere_1.setFrame("cookies/super_sphere_x2"),this.sphere_1.scale=.5,this.scene.emitters.doubleSpheresMergeCircles.explode(1,this.sphere_1.x,this.sphere_1.y),this.scene.emitters.doubleSpheresMergeParticles.setPosition(this.sphere_1.x,this.sphere_1.y),this.scene.emitters.doubleSpheresMergeParticles.explode(12,this.sphere_1.x,this.sphere_1.y),this.scene.tweens.add({targets:this.sphere_1,duration:233,ease:Phaser.Math.Easing.Sine.InOut,angle:10,yoyo:!0}),this.scene.tweens.add({targets:this.sphere_1,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{n()}})})})}shrinkBigSphere(){var e;this.particleManager.setPosition(this.sphere_1.x,this.sphere_1.y),this.attractEmitter.on=!0,this.whiteSphere.revive(),this.whiteSphere.scale=this.sphere_1.scale*2,this.whiteSphere.x=this.sphere_1.x,this.whiteSphere.y=this.sphere_1.y,this.whiteSphere.alpha=0;let t=1333;this.scene.tweens.add({targets:this.whiteSphere,duration:t,ease:Phaser.Math.Easing.Cubic.In,alpha:1}),this.scene.tweens.add({targets:this.sphere_1,duration:t,ease:Phaser.Math.Easing.Expo.In,alpha:0});let s=this.scene.tweens.add({targets:[this.sphere_1,this.whiteSphere],duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:"-=6",repeat:-1,yoyo:!0});return this.scene.camera.camera.shakeEffect.start(t,.0066,!0),(e=this.scene.audio.play(u.DOUBLE_SPHERES_CHARGE))==null||e.fade(0,1,t*.5),new Promise(i=>{this.scene.tweens.add({targets:this.sphere_1,duration:t,ease:Phaser.Math.Easing.Linear,scale:this.sphere_1.scale*.4,onUpdate:()=>{this.whiteSphere.scale=this.sphere_1.scale*2}}).once(Phaser.Tweens.Events.TIMELINE_COMPLETE,()=>{s.remove(),i()})})}disableAttractEmitter(){this.gravityWell.active=!1,this.attractEmitter.active=!1,this.attractEmitter.on=!1,this.attractEmitter.killAll()}destroy(){super.destroy(),this.particleManager.destroy(),this.whiteSphere.destroy(),this.sphere_1.kill(),this.sphere_2.kill()}},zC=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.items=t}processSpecialCombo(e,t,s){switch(s){case ne.SUPER_SPHERE_x2:this.processDoubleSuperSpheres(e,t);break;case ne.SUPER_SPHERE_BOMB:this.processSuperSphereBomb(e,t);break;case ne.SUPER_SPHERE_STRIPED:this.processSuperSphereStripes(e,t);break;case ne.SUPER_SPHERE:this.processSingleSuperSphere(e,t);break;case ne.BOMB_x2:this.processDoubleBombs(e,t);break;case ne.BOMB_STRIPED:this.processBombStripes(e,t);break;case ne.STRIPED_x2:this.processDoubleStripes(e,t);break;default:break}}processDoubleSuperSpheres(e,t){let s=new KC(this.scene,e,t);s.once(ia.COMPLETE,i=>{this.onSpecialComboMergeComplete(e,t),this.onDoubleSpheresFxComplete(i)}),s.start()}onDoubleSpheresFxComplete(e){let t=this.scene.getMaxExplosionRadius(e);this.scene.powerupsHandler.applyBomb(e.column,e.row,t,e.itemType),this.scene.powerupsHandler.showBombFxAt(e.x,e.y,7),this.scene.camera.camera.shake(400,.02,!0)}processSuperSphereBomb(e,t){let{superSphere:s,cookie:i}=this.sortCookies(e,t),a=this.scene.itemsDropper.lockPreDrop();this.mergeCookies(s,i,()=>{this.showSuperSphereMergeFx(s),this.onSpecialComboMergeComplete(s,i),this.onSuperSphereBombMergeComplete(s,i,a)})}onSuperSphereBombMergeComplete(e,t,s){let i=this.items.mainItems.filter(n=>n.itemType===t.itemType).filter(n=>n.powerup!==T.SUPER_SPHERE),a=os(()=>{this.scene.camera.camera.shake(400,.02,!0)});i.length>0?this.scene.sounds.superSphere():(this.scene.itemsDropper.unlockPreDrop(s),this.scene.itemsDropper.startPreDropTimer()),i.forEach(n=>{this.scene.powerupsHandler.sendSuperSphereCharge(e,n,()=>{n.hasPowerup()===!1&&(this.scene.removeItemFromGrid(n),n.kill(),n=this.scene.itemsFactory.createCookie(n.column,n.row,n.itemType,T.BOMB),n.sendPowerupToChef=!1),this.scene.removeItemFromGrid(n);let r=this.scene.tweens.add({targets:n,duration:66,ease:Phaser.Math.Easing.Sine.InOut,angle:8*Phaser.Math.RND.sign(),yoyo:!0,repeat:-1});this.scene.tweens.add({targets:n,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1.2,onComplete:()=>{r.remove(),a(),n.kill(),this.scene.onCookieRemove(n),this.scene.itemsDropper.unlockPreDrop(s),this.scene.itemsDropper.startPreDropTimer()}})})})}processSuperSphereStripes(e,t){let{superSphere:s,cookie:i}=this.sortCookies(e,t),a=this.scene.itemsDropper.lockPreDrop();this.mergeCookies(s,i,()=>{this.showSuperSphereMergeFx(s),this.onSpecialComboMergeComplete(s,i),this.onSuperSphereStripesMergeComplete(s,i,a)})}sortCookies(e,t){let s,i;return e.powerup===T.SUPER_SPHERE?(s=e,i=t):(s=t,i=e),{superSphere:s,cookie:i}}onSuperSphereStripesMergeComplete(e,t,s){let i=()=>this.scene.rnd.bool()?T.VERTICAL_STRIPES:T.HORIZONTAL_STRIPES,a=this.items.mainItems.filter(n=>n.itemType===t.itemType).filter(n=>n.powerup!==T.SUPER_SPHERE);a.length>0?this.scene.sounds.superSphere():(this.scene.itemsDropper.unlockPreDrop(s),this.scene.itemsDropper.startPreDropTimer()),a.forEach(n=>{this.scene.powerupsHandler.sendSuperSphereCharge(e,n,()=>{n.hasPowerup()===!1&&(this.scene.removeItemFromGrid(n),n.kill(),n=this.scene.itemsFactory.createCookie(n.column,n.row,n.itemType,i()),n.sendPowerupToChef=!1),this.scene.removeItemFromGrid(n),this.scene.tweens.add({targets:n,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1.2,onComplete:()=>{this.scene.tweens.add({targets:n,duration:300,ease:Phaser.Math.Easing.Expo.In,scale:1,onComplete:()=>{n.kill(),this.scene.onCookieRemove(n),this.scene.itemsDropper.unlockPreDrop(s),this.scene.itemsDropper.startPreDropTimer()}})}})})})}processSingleSuperSphere(e,t){let{superSphere:s,cookie:i}=this.sortCookies(e,t);s.itemsTypeToClear=i.itemType,this.mergeCookies(s,i,()=>{this.showSuperSphereMergeFx(s),this.onSpecialComboMergeComplete(s,i),this.scene.powerupsHandler.applySuperSphere(s)})}processDoubleBombs(e,t){this.mergeCookies(e,t,()=>{this.onSpecialComboMergeComplete(e,t);let s=2;this.scene.powerupsHandler.applyBomb(e.column,e.row,s,e.itemType),this.scene.powerupsHandler.showBombFx(e.column,e.row,s),this.scene.powerupsHandler.budger.budgeItemsAround(e.column,e.row,s+1.8),this.scene.camera.camera.shake(400,.016,!0)})}processBombStripes(e,t){this.mergeCookies(e,t,()=>{this.onSpecialComboMergeComplete(e,t);let{column:s,row:i,itemType:a}=e;this.scene.powerupsHandler.applyCross(s,i,a,3),this.scene.sounds.bomb()})}processDoubleStripes(e,t){this.mergeCookies(e,t,()=>{this.onSpecialComboMergeComplete(e,t),this.scene.powerupsHandler.applyCross(e.column,e.row,e.itemType,1)})}mergeCookies(e,t,s){t.setDepth(F.MERGING_COOKIE);let i=266;this.scene.tweens.add({targets:t,duration:i,ease:Phaser.Math.Easing.Back.In,scale:.5});let a=i*.75;this.scene.tweens.add({targets:e,delay:i-a,duration:a,ease:Phaser.Math.Easing.Back.In,scale:1.66});let n=i*.5;this.scene.tweens.add({targets:[e,t],delay:i-n,duration:n,ease:Phaser.Math.Easing.Expo.In,alpha:0}),this.scene.tweens.add({targets:[e,t],duration:i,ease:Phaser.Math.Easing.Back.In,easeParams:[1.6],x:e.x,y:e.y,onComplete:()=>{t.scale=1,t.kill(),e.kill(),s(e,t)}})}showSuperSphereMergeFx(e){this.scene.emitters.doubleSpheresMergeCircles.explode(1,e.x,e.y),this.scene.emitters.doubleSpheresMergeParticles.setPosition(e.x,e.y),this.scene.emitters.doubleSpheresMergeParticles.explode(12,e.x,e.y)}onSpecialComboMergeComplete(e,t){e.wasPoweruped=!0,this.scene.onCookieRemove(e,!1),t.wasPoweruped=!0,this.scene.onCookieRemove(t,!1)}},jC=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.items=t}budgeItemsInColumn(e,t){this.items.mainItems.forEach(s=>{if(this.isBudgeable(s)===!1||s.column!==e-1&&s.column!==e+1||s.budgeTween)return;let a=Ks(e,t,s.column,s.row)*50,r=(s.row>t?1:-1)*20;this.playBudgeTween(s,a,{y:r})})}budgeItemsInRow(e,t){this.items.mainItems.forEach(s=>{if(this.isBudgeable(s)===!1||s.row!==t-1&&s.row!==t+1||s.budgeTween)return;let a=Ks(e,t,s.column,s.row)*50,r=(s.column>e?1:-1)*20;this.playBudgeTween(s,a,{x:r})})}budgeItemsAround(e,t,s){this.items.mainItems.forEach(i=>{if(this.isBudgeable(i)===!1)return;let a=Ks(e,t,i.column,i.row);if(a>s||i.budgeTween)return;let n=a*66,r=Phaser.Math.Angle.Between(e,t,i.column,i.row),o=24,l=Math.cos(r)*o,d=Math.sin(r)*o;this.playBudgeTween(i,n,{x:l,y:d})})}playBudgeTween(e,t,s){let i={};s.x&&(i.x=e.x+s.x),s.y&&(i.y=e.y+s.y),e.budgeTween=this.scene.tweens.add(k(P({delay:t},i),{targets:e,duration:200,ease:Phaser.Math.Easing.Sine.InOut,yoyo:!0,onComplete:()=>{this.onBudgeTweenComplete(e)}}))}onBudgeTweenComplete(e){e.budgeTween=null;let t=j(e.column,e.row);Phaser.Math.Distance.Between(t.x,t.y,e.x,e.y)>2&&this.scene.tweens.add({targets:e,duration:100,ease:Phaser.Math.Easing.Linear,x:t.x,y:t.y})}isBudgeable(e){return e.itemSuperType===c.MARSHMALLOW||e.itemSuperType===c.COOKIE||e.itemSuperType===c.DROP_ITEM||e.itemSuperType===c.CHICK}},XC=class{constructor(e){this.powerupIdCounter=0,this.scene=e,this.items=e.items,this.itemsDropper=e.itemsDropper,this.budger=new jC(this.scene,this.items),this.itemSuperTypesAffectedByStripes=this.getSuperTypesAffectedByStripes(),this.itemSuperTypesAffectedByBomb=this.getSuperTypesAffectedByBombs(),this.addSuperSphereChargesPool(),this.items,this.itemsDropper}getSuperTypesAffectedByStripes(){return[c.COOKIE,c.MARSHMALLOW,c.CHOCOLATE,c.CANDY_BOTTLE,c.DONUT_BOX,c.APPLE_PLATTER,c.MYSTERY_BOX,c.CHICK,c.GUMMY_BLOCKER]}getSuperTypesAffectedByBombs(){return[c.COOKIE,c.MARSHMALLOW,c.CHOCOLATE,c.CANDY_BOTTLE,c.DONUT_BOX,c.MYSTERY_BOX,c.CHICK,c.GUMMY_BLOCKER]}addSuperSphereChargesPool(){let e={classType:Phaser.GameObjects.Image,defaultKey:"gameplay",defaultFrame:"cracker_hit_particle",createCallback:t=>{t.scale=2,t.setDepth(F.POWERUP_FX),t.kill()}};this.superSphereCharges=this.scene.add.group(e),this.superSphereCharges.createItems(15)}createPowerupId(e){return`${e}_${this.powerupIdCounter++}`}processCookiePowerup(e){switch(e.powerup&&e.sendPowerupToChef&&this.scene.gui.powerupChef.sendChargeToChef(e),e.powerup){case T.HORIZONTAL_STRIPES:this.applyHorizontalStripes(e.column,e.row,e.itemType,this.createPowerupId("horiz_stripes"));break;case T.VERTICAL_STRIPES:this.applyVerticalStripes(e.column,e.row,e.itemType,this.createPowerupId("vert_stripes"));break;case T.BOMB:let t=1;this.applyBomb(e.column,e.row,t,e.itemType),this.showBombFx(e.column,e.row,t),this.budger.budgeItemsAround(e.column,e.row,t+1.8);break;case T.SUPER_SPHERE:this.applySuperSphere(e);break;default:break}}applyHorizontalStripes(e,t,s,i){let a=this.itemSuperTypesAffectedByStripes,n=this.items.mainItems.getItemsByRow(t).filter(l=>a.includes(l.itemSuperType)&&this.items.hasLicoriceOver(l)===!1),r=this.items.topItems.filter(l=>l.row===t),o=[...n,...r];this.budger.budgeItemsInRow(e,t),this.applyStripes(o,e,t,s,i),this.showStripesFx(e,t,"horizontal"),this.scene.sounds.stripes()}applyVerticalStripes(e,t,s,i){let a=this.itemSuperTypesAffectedByStripes,n=this.items.mainItems.getItemsByColumn(e).filter(l=>a.includes(l.itemSuperType)&&this.items.hasLicoriceOver(l)===!1),r=this.items.topItems.filter(l=>l.column===e),o=[...n,...r];this.budger.budgeItemsInColumn(e,t),this.applyStripes(o,e,t,s,i),this.showStripesFx(e,t,"vertical"),this.scene.sounds.stripes()}showStripesFx(e,t,s){let i=j(e,t),a=this.scene.emitters;(s==="horizontal"?a.horizontalStripesFx:a.verticalStripesFx).explode(1,i.x,i.y),a.stripesParticles.setPosition(i.x,i.y),a.stripesParticles.explode(10,i.x,i.y),a.stripesFxCircles.explode(1,i.x,i.y)}applyStripes(e,t,s,i,a){let n=this.itemsDropper.lockPreDrop("stripes"),r=0;e.forEach(o=>{this.preProcessPowerupedItem(o,a)}),e.forEach(o=>{let d=Ks(t,s,o.column,o.row)*50;this.processPowerupedItem(o,i,d,a),r=Math.max(r,d),!(o.itemSuperType===c.APPLE_PLATTER||o.itemSuperType===c.CANDY_BOTTLE)&&(qs(o)||this.scene.time.delayedCall(d,()=>{this.scene.emitters.stripedItemParticles.explode(3,o.x,o.y),this.scene.emitters.stripedItemCircles.explode(1,o.x,o.y)}))}),this.scene.time.delayedCall(r,()=>{this.itemsDropper.unlockPreDrop(n)})}preProcessPowerupedItem(e,t){switch(e.itemSuperType){case c.COOKIE:let s=e;s.markAsPoweruped(t),this.scene.removeItemFromGrid(s);break;case c.MARSHMALLOW:let i=e;i.currentHealth===1&&this.scene.removeItemFromGrid(i);break;case c.CHOCOLATE:let a=e;a.currentHealth===1&&this.scene.removeItemFromGrid(a);break;case c.APPLE_PLATTER:let n=e;n.getApplesNum()===1&&this.scene.removeItemFromGrid(n);break;case c.LICORICE:this.scene.removeItemFromGrid(e);break;case c.MYSTERY_BOX:this.scene.removeItemFromGrid(e);break;case c.CHICK:this.scene.removeItemFromGrid(e);break;case c.GUMMY_BLOCKER:this.scene.removeItemFromGrid(e);break;default:break}}processPowerupedItem(e,t,s,i){switch(e.itemSuperType){case c.COOKIE:this.processPowerupedCookie(e,s,t);break;case c.LICORICE:this.scene.time.delayedCall(s,()=>{this.scene.destroyLicorice(e)});break;case c.MARSHMALLOW:let a=e;a.powerupIds.includes(i)===!1&&(a.powerupIds.push(i),this.processPowerupedMarshmallow(a,s));break;case c.CHOCOLATE:let n=e;n.powerupIds.includes(i)===!1&&(n.powerupIds.push(i),this.processPowerupedChocolate(n,s));break;case c.CANDY_BOTTLE:let r=e;r.powerupIds.includes(i)===!1&&(r.powerupIds.push(i),r.emitCandy(s));break;case c.DONUT_BOX:let o=e;o.powerupIds.includes(i)===!1&&(o.powerupIds.push(i),this.processPoweredupDonutBox(o,s));break;case c.APPLE_PLATTER:let l=e;l.powerupIds.includes(i)===!1&&(l.powerupIds.push(i),this.processPoweredupApplePlatter(l,s));break;case c.MYSTERY_BOX:e.open(s);break;case c.CHICK:this.itemsDropper.startPreDropTimer(s+50),this.scene.time.delayedCall(s,()=>{this.scene.destroyChick(e)});break;case c.GUMMY_BLOCKER:this.itemsDropper.startPreDropTimer(s+50),this.scene.time.delayedCall(s,()=>{this.scene.destroyGummyBlocker(e)});break;default:break}}processPowerupedCookie(e,t,s){if(e instanceof jo){e.itemsTypeToClear=this.items.getMostPopularExistingCookieType(),this.processSuperSpheredCookie(e,t);return}let i=200;this.scene.tweens.add({delay:t,targets:e,duration:i,ease:Phaser.Math.Easing.Cubic.Out,scale:1.33,alpha:0,onStart:()=>{this.scene.onCookieRemove(e)},onComplete:()=>{e.kill()}}),this.scene.itemsDropper.startPreDropTimer(t+i+100)}processSuperSpheredCookie(e,t){let s=300;this.scene.removeItemFromGrid(e);let i=this.scene.itemsDropper.lockPreDrop(),a=this.scene.tweens.add({delay:t,targets:e,duration:66,ease:Phaser.Math.Easing.Sine.InOut,angle:-6,yoyo:!0,repeat:-1});this.scene.tweens.add({delay:t,targets:e,duration:s,ease:Phaser.Math.Easing.Back.In,scale:1.66,onStart:()=>{e.sparksEmitter.on=!1,e.sparksEmitter.killAll()},onComplete:()=>{this.scene.emitters.superSphereCircles.explode(1,e.x,e.y),this.scene.emitters.superSphereSparks.setPosition(e.x,e.y),this.scene.emitters.superSphereSparks.explode(15,e.x,e.y),this.scene.itemsDropper.unlockPreDrop(i),this.scene.itemsDropper.startPreDropTimer(),this.applySuperSphere(e),a.remove(),e.kill()}}),this.scene.tweens.add({delay:t+300,targets:e,duration:100,ease:Phaser.Math.Easing.Expo.In,alpha:0})}processPowerupedMarshmallow(e,t){if(e.currentHealth>1){this.scene.time.delayedCall(t,()=>{e.damage()});return}this.scene.itemsDropper.startPreDropTimer(t+300),this.scene.time.delayedCall(t,()=>{this.scene.destroyMarshmallow(e)})}processPowerupedChocolate(e,t){if(e.currentHealth>1){this.scene.time.delayedCall(t,()=>{e.damage()});return}this.scene.itemsDropper.startPreDropTimer(t+300),this.scene.time.delayedCall(t,()=>{this.scene.destroyChocolate(e)})}processPoweredupDonutBox(e,t){this.scene.time.delayedCall(t,()=>{this.scene.updateDonutBox(e)})}processPoweredupApplePlatter(e,t){this.scene.time.delayedCall(t,()=>{this.scene.removeApple(e)})}applyCross(e,t,s,i){let a=this.createPowerupId("cross"),n=Math.floor(i/2),r=e-n;for(let l=r;l<=e+n;l++)this.applyVerticalStripes(l,t,s,a);let o=t-n;for(let l=o;l<=t+n;l++)this.applyHorizontalStripes(e,l,s,a)}applyBomb(e,t,s=1,i){let a=this.itemSuperTypesAffectedByBomb,n=this.getItemsAffectedByBomb(this.items.mainItems,e,t,s).filter(S=>a.includes(S.itemSuperType)&&this.items.hasLicoriceOver(S)===!1),r=this.getItemsAffectedByBomb(this.items.topItems,e,t,s),o=[...n,...r],l=this.createPowerupId("bomb"),d=this.itemsDropper.lockPreDrop("bomb_x"+s),f=0;o.forEach(S=>{this.preProcessPowerupedItem(S,l)}),o.forEach(S=>{let x=Ks(e,t,S.column,S.row)*50;this.processPowerupedItem(S,i,x,l),f=Math.max(f,x)}),this.scene.time.delayedCall(f,()=>{this.itemsDropper.unlockPreDrop(d)}),this.scene.sounds.bomb()}getItemsAffectedByBomb(e,t,s,i){let a=i*2+1,n=i*2+1,r=t-i,o=s-i,l=[];for(let d=o;d<o+n;d++)for(let f=r;f<r+a;f++){let S=e.getAt(f,d);S&&l.includes(S)===!1&&l.push(S)}return l}applySuperSphere(e){let t=this.createPowerupId("sphere"),s=this.itemsDropper.lockPreDrop("super-sphere"),i=this.getItemsAffectedBySuperSphere(e);i.length===0&&(this.itemsDropper.unlockPreDrop(s),this.itemsDropper.startPreDropTimer(300));let a=vt(i.length,()=>{this.itemsDropper.unlockPreDrop(s)});i.forEach(n=>{this.preProcessPowerupedItem(n,t)}),i.forEach(n=>{this.sendSuperSphereCharge(e,n,()=>{this.processPowerupedItem(n,e.itemType,0,t),a()})}),this.scene.sounds.superSphere()}getItemsAffectedBySuperSphere(e){return this.items.mainItems.filter(s=>s.itemSuperType===c.COOKIE&&s.itemType===e.itemsTypeToClear).filter(s=>s.powerup!==T.SUPER_SPHERE).map(s=>this.items.hasLicoriceOver(s)?this.items.topItems.getAt(s.column,s.row):s)}sendSuperSphereCharge(e,t,s){let i=this.superSphereCharges.getFirstDead(!0);i.revive(),i.setPosition(e.x,e.y),i.angle=Phaser.Math.Angle.Between(i.x,i.y,t.x,t.y)*Phaser.Math.RAD_TO_DEG+90,i.alpha=0,this.scene.tweens.add({targets:i,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({targets:i,duration:250,ease:Phaser.Math.Easing.Linear,x:t.x,y:t.y,onComplete:()=>{this.scene.emitters.stripedItemCircles.explode(1,i.x,i.y),this.scene.emitters.superSphereChargeSparks.explode(10,i.x,i.y),i.kill(),s()}})}showBombFx(e,t,s){let i=j(e,t);this.showBombFxAt(i.x,i.y,s)}showBombFxAt(e,t,s){let i=this.scene.emitters.bombExplosion;i.setScale({start:0,end:3+s,ease:m.ExpoOut}),i.explode(1,e,t);let a=this.scene.emitters.bombParticles;a.setPosition(e,t),a.explode(12,e,t)}},$C=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="field_labels",this.field=t,this.addLabels()}addLabels(){this.labels=[];for(let e=0;e<this.field.rows;e++)for(let t=0;t<this.field.columns;t++){let s=this.scene.add.image(0,0,"gameplay","cell_label_back");ge(s,t,e),s.y-=y/2-18,s.alpha=this.field.isEmpty(t,e)?.33:.75,s.scaleX=.8,s.scaleY=.9,this.add(s);let i=this.createLabel(t,e);i.x=s.x,i.y=s.y+4,i.alpha=s.alpha,this.labels.push(i),this.add(i)}}createLabel(e,t){let s=`${e},${t}`,i=this.scene.add.bitmapText(0,0,B.GAME_FIELD_LABELS,s,22);return i.setOrigin(.5,.5),i}},aa;(function(e){e.GOAL_COMPLETE="__GOAL_COMPLETE"})(aa||(aa={}));var dn=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.goalsConfig=t,this.goals=ut.createGoalsArray(t),this.goalItemTypes=this.getGoalItemTypes(this.goals)}getIncompleteGoals(){return this.goals.filter(e=>e.targetNum-e.collectedNum>0)}save(){return ns(this.goals)}restore(e){this.goals=e}isGoalItem(e){return this.isGoalItemType(e.itemType)}isGoalItemType(e){return this.goalItemTypes.includes(e)}getGoalItemTypes(e){return e.map(i=>i.type).flatMap(i=>dn.GOALS_ITEM_TYPES_MAP[i])}getGoalCookieTypes(){let e=O.getSubtypes(c.COOKIE),t=this.goals.filter(i=>i.collectedNum<i.targetNum);return this.getGoalItemTypes(t).filter(i=>e.includes(i))}update(e){let t=this.getGoalTypeByItemType(e.itemType),s=this.goals.find(i=>i.type===t);return s&&s.collectedNum<s.targetNum?(s.collectedNum++,s.collectedNum===s.targetNum&&this.emit(aa.GOAL_COMPLETE,s),!0):!1}getGoalTypeByItemType(e){return Be(dn.GOALS_ITEM_TYPES_MAP,t=>t.includes(e))}areComplete(){return this.goals.every(e=>e.collectedNum>=e.targetNum)}toString(){return this.goals.map(e=>{let t=e.collectedNum>=e.targetNum;return`${e.type}: ${e.collectedNum}/${e.targetNum} ${t?"\u2714":""}`}).join(`
`)}},Xo=dn;Xo.GOALS_ITEM_TYPES_MAP={[C.COOKIE_BLUE]:[h.COOKIE_BLUE],[C.COOKIE_RED]:[h.COOKIE_RED],[C.COOKIE_ORANGE]:[h.COOKIE_ORANGE],[C.COOKIE_YELLOW]:[h.COOKIE_YELLOW],[C.COOKIE_PINK]:[h.COOKIE_PINK],[C.COOKIE_PURPLE]:[h.COOKIE_PURPLE],[C.APPLE]:[h.APPLES_PLATTER],[C.DROP_ITEM]:[h.DROP_ITEM],[C.MARSHMALLOW]:O.getSubtypes(c.MARSHMALLOW),[C.CHOCOLATE]:O.getSubtypes(c.CHOCOLATE),[C.LICORICE]:O.getSubtypes(c.LICORICE),[C.BISCUIT]:[h.BISCUIT],[C.DONUT]:[h.DONUT_BOX],[C.CANDY]:[h.CANDY_BOTTLE],[C.GUMMY]:O.getSubtypes(c.GUMMY),[C.CHICK]:O.getSubtypes(c.CHICK)};var qC=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.items=this.scene.items}process(){let e=this.items.mainItems.filter(s=>my(s)&&this.items.hasLicoriceOver(s)===!1);if(e.length===0)return!1;let t=!1;return e.sort(sn).forEach(s=>{let i=this.scene.field.getCellAt(s.column,s.row),a=this.scene.field.getBottomCell(s.column);if(i===a||this.canDropToBottomCell(s,a)){this.scene.removeItemFromGrid(s);let r=(a.row-i.row)*33;s.stopIdleTweens(r,()=>{this.processDroppedItem(s)}),t=!0}}),t}canDropToBottomCell(e,t){let{column:s,row:i}=e;for(let a=i+1;a<=t.row;a++)if(this.items.mainItems.getAt(s,a))return!1;return!0}processDroppedItem(e){if(this.scene.sounds.dropItemCollect(),this.scene.goals.isGoalItem(e)){this.scene.goals.update(e),this.scene.gui.goalItems.collectItem(e),e.destroy();return}this.scene.tweens.add({targets:e,duration:400,ease:Phaser.Math.Easing.Quartic.Out,scale:1.6,alpha:0,onComplete:()=>{e.destroy()}})}},QC=class extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,"gameplay","glove")}show(){this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=1.5,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:()=>{this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.destroy()}})}})}destroy(){super.destroy()}},ZC=Phaser.Math.DegToRad,JC=class extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,"gameplay","rolling_pin")}show(){this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let e={x:this.x,y:this.y};this.moveAway(),this.scale=1.5,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,x:e.x,y:e.y,onComplete:()=>{this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,scale:this.scale*1.33,onComplete:()=>{this.destroy()}})}})}moveAway(){let t=ZC(-55),s=44;this.x=this.x+Math.cos(t)*s,this.y=this.y+Math.sin(t)*s}destroy(){super.destroy()}},eS=class extends Phaser.GameObjects.Image{constructor(e){super(e,0,0,"gameplay","lollipop")}show(){this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.angle=30,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,angle:66,scale:1.2,completeDelay:200,onComplete:()=>{this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.In,scale:1,angle:0,onComplete:()=>{this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,scale:this.scale*1.33,onComplete:()=>{this.destroy()}})}})}})}destroy(){super.destroy()}},it;(function(e){e.SELECT="__SELECT",e.CANCEL="__CANCEL",e.ACTIVATE="__ACTIVATE",e.COMPLETE="__COMPLETE"})(it||(it={}));var tS=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.isTutorialMode=!1,this.boostersUsedNum=0,this.scene=e,this.gui=t,this.boostersPanel=this.gui.boostersPanel,this.boostersPanel.on(tt.SELECT,this.onBoosterSelect,this),this.boostersPanel.on(tt.CANCEL,this.onBoosterCancel,this),this.boosterHint=this.gui.boosterHintScreen}testBoosterSelect(e){this.scene.time.delayedCall(100,()=>{this.onBoosterSelect(this.getBooster(e))})}testBooster(e,t){t=t!=null?t:{x:Phaser.Math.RND.between(0,this.scene.field.columns),y:Phaser.Math.RND.between(0,this.scene.field.rows)};let s=this.scene.field.getCellAt(t.y,t.x);s&&this.scene.time.delayedCall(100,()=>{this.applyBooster(this.getBooster(e),s.x,s.y)})}testBoosterByClick(e){}onBoosterSelect(e,t){this.emit(it.SELECT,e),this.showBlackOverlay(),this.selectedBooster=e,this.boosterHint.updateData(e,t),this.boosterHint.show(),this.gui.topPanel.kill(),this.gui.pauseButton.kill(),this.gui.undoButton.kill(),this.boostersPanel.highlight(e.type),this.scene.sentry.addBreadcrumb({category:"boosters",message:"booster_select",data:{boosterType:e.type}}),this.addPointerDownCallback()}getRootScene(){return this.scene.scene.get(M.GAMEPLAY_ROOT)}showBlackOverlay(){this.getRootScene().showBlackOverlay()}hideBlackOverlay(){this.getRootScene().hideBlackOverlay()}getBoosterableCookies(){return this.scene.items.mainItems.filter(e=>te(e))}addPointerDownCallback(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this)}removePointerDownCallback(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this)}onPointerDown(e){let{column:t,row:s}=Vs(e.worldX,e.worldY);if(this.canApplyBooster(this.selectedBooster.type,t,s))this.removePointerDownCallback(),this.applyBooster(this.selectedBooster,t,s),this.scene.audio.play(u.FANCY_TAP);else switch(this.selectedBooster.type){case I.GLOVE:case I.ROLLING_PIN:this.gui.boosterWarning.text=this.scene.texts.booster_hint_field,this.showBoosterWarning(e.x,e.y),this.scene.audio.play(u.BOOSTER_CANT_USE);break;case I.LOLLIPOP:this.gui.boosterWarning.text=this.scene.texts.booster_hint_cookie,this.showBoosterWarning(e.x,e.y),this.hignlightCookies(this.getBoosterableCookies()),this.scene.audio.play(u.BOOSTER_CANT_USE);break;default:break}}canApplyBooster(e,t,s){switch(e){case I.GLOVE:return this.canApplyGlove(t,s);case I.ROLLING_PIN:return this.canApplyRollingPin(t,s);case I.LOLLIPOP:return this.canApplyLollipop(t,s)}}canApplyGlove(e,t){return typeof this.getItemForGlove(e,t)!="undefined"}canApplyRollingPin(e,t){let s=this.scene.field.dimensions;return e>=s.left&&e<=s.right&&t>=s.top&&t<=s.bottom}canApplyLollipop(e,t){return this.scene.items.mainItems.filter(s=>te(s)).some(s=>s.column===e&&s.row===t)}getItemForGlove(e,t){let s=this.scene.items.bottomItems.getAt(e,t),i=this.scene.items.mainItems.getAt(e,t),a=this.scene.items.topItems.getAt(e,t),n=Tt(O.getAllSuperTypes(),c.GUMMY,c.GENERATOR);return[s,i,a].filter(o=>o&&n.includes(o.itemSuperType)).pop()}hignlightCookies(e){e.forEach(t=>{let{column:s,row:i}=t;this.scene.getHighlightAt(s,i).highlightTo({hold:400})})}showBoosterWarning(e,t){this.gui.showTapOnCookieWarning(e,t)}applyBooster(e,t,s){switch(this.scene.analytics.subtractResource(ue.BOOSTERS,1,e.type,`Level_${this.scene.levelNumber}`),this.scene.sentry.addBreadcrumb({category:"boosters",message:"booster_activate",data:{boosterType:e.type,column:t,row:s}}),this.isTutorialMode===!1&&this.boostersUsedNum++,this.onBeforeBoosterApply(e,t,s),e.type){case I.GLOVE:this.applyGlove(e,t,s);break;case I.ROLLING_PIN:this.applyRollingPin(e,t,s);break;case I.LOLLIPOP:this.applyLollipop(e,t,s);break;default:break}}onBeforeBoosterApply(e,t,s){this.scene.undoHandler.save(),e.num-=1,this.hideBlackOverlay(),this.boosterHint.hide(),this.gui.topPanel.revive(),this.gui.pauseButton.revive(),this.gui.undoButton.revive(),this.gui.undoButton.disableInput(),this.boostersPanel.resetHighlight(),this.boostersPanel.disableInput(),this.scene.lock(),this.emit(it.ACTIVATE,e,t,s)}applyGlove(e,t,s){let i=this.getItemForGlove(t,s);qs(i)&&(i.itemsTypeToClear=this.scene.items.getMostPopularExistingCookieType());let{x:a,y:n}=this.getGlovePosition(i),r=new QC(this.scene);r.x=a,r.y=n,r.setDepth(F.BOOSTER_FX),r.show(),this.scene.add.existing(r),this.scene.time.delayedCall(300,()=>{this.scene.audio.play(u.BOOSTER_GLOVE),this.scene.emitters.gloveParticles.setPosition(r.x,r.y),this.scene.emitters.gloveParticles.explode(10,r.x,r.y),this.scene.emitters.gloveCircle.explode(2,r.x,r.y),this.doApplyGloveToItem(i),this.onBoosterComplete(e)})}getGlovePosition(e){return e.itemSuperType===c.CANDY_BOTTLE?{x:e.x,y:e.y-40}:{x:e.x,y:e.y}}doApplyGloveToItem(e){switch(e.itemSuperType){case c.BISCUIT:this.scene.destroyBiscuit(e),this.scene.unlock();break;case c.COOKIE:let t=e;t.kill(),this.scene.removeItemFromGrid(t),this.scene.onCookieRemove(t),this.scene.itemsDropper.startPreDropTimer(150);break;case c.DROP_ITEM:this.scene.dropItemsManager.processDroppedItem(e),this.scene.removeItemFromGrid(e),this.scene.itemsDropper.startPreDropTimer(250);break;case c.MARSHMALLOW:let s=e;s.damage(),s.isDead()?this.scene.destroyMarshmallow(s):this.scene.unlock();break;case c.CHOCOLATE:let i=e;i.damage(),i.isDead()?this.scene.destroyChocolate(i):this.scene.unlock();break;case c.APPLE_PLATTER:let a=e;a.getApplesNum()>1&&this.scene.unlock(),this.scene.removeApple(a);break;case c.DONUT_BOX:let n=e;n.boxState===$e.CLOSED&&this.scene.unlock(),this.scene.updateDonutBox(n);break;case c.CANDY_BOTTLE:e.emitCandy(0),this.scene.unlock();break;case c.COLOR_CAKE:let r=e;r.getActivePiecesNum()>1&&this.scene.unlock(),this.scene.removePieceFromColorCake(r,r.getRandomActivePieceType());break;case c.MYSTERY_BOX:e.open(0),this.scene.unlock();break;case c.CHICK:this.scene.destroyChick(e),this.scene.unlock();break;case c.LICORICE:this.scene.destroyLicorice(e),this.scene.unlock();break;case c.GUMMY_BLOCKER:this.scene.destroyGummyBlocker(e)===!1&&this.scene.unlock();break;default:this.scene.unlock();break}}applyRollingPin(e,t,s){let{x:i,y:a}=j(t,s),n=new JC(this.scene);n.x=i,n.y=a,n.setDepth(F.BOOSTER_FX),n.show(),this.scene.add.existing(n),this.scene.time.delayedCall(300,()=>{this.scene.audio.play(u.BOOSTER_ROLLING_PIN,{volume:.5});let r=this.scene.items.getMostPopularExistingCookieType();this.scene.powerupsHandler.applyCross(t,s,r,1),this.scene.itemsDropper.startPreDropTimer(200),this.onBoosterComplete(e)})}applyLollipop(e,t,s){let i=this.scene.items.mainItems.getAt(t,s);if(!i)return;let a=new eS(this.scene);a.x=i.x+28,a.y=i.y+62,a.setDepth(F.BOOSTER_FX),a.show(),this.scene.add.existing(a),this.scene.time.delayedCall(1020,()=>{this.scene.audio.play(u.BOOSTER_LOLLIPOP),this.doApplyLollipop(i,e)})}doApplyLollipop(e,t){let s=e.itemType,i=qs(e)?this.scene.items.mainItems.filter(o=>qs(o)):this.scene.items.mainItems.filter(o=>te(o)&&o.itemType===s&&o.powerup!==T.SUPER_SPHERE),a=vt(i.length,()=>{this.scene.itemsDropper.startPreDropTimer(150)}),n=[],r=[];i.forEach(o=>{let{column:l,row:d}=o,f=this.scene.items.topItems.getAt(l,d);f?n.push(f):r.push(o)}),n.forEach(o=>{this.scene.powerupsHandler.sendSuperSphereCharge(e,o,()=>{this.scene.destroyLicorice(o),a()})}),r.forEach(o=>{qs(o)&&(o.itemsTypeToClear=this.scene.items.getMostPopularExistingCookieType()),this.scene.removeItemFromGrid(o),this.scene.powerupsHandler.sendSuperSphereCharge(e,o,()=>{this.scene.onCookieRemove(o),o.kill(),a()})}),this.scene.emitters.gloveCircle.explode(1,e.x,e.y),this.scene.camera.camera.shake(300,.01,!0),this.onBoosterComplete(t)}onBoosterComplete(e){this.isTutorialMode=!1,this.emit(it.COMPLETE,e)}onBoosterCancel(e){this.removePointerDownCallback(),this.hideBlackOverlay(),this.boostersPanel.resetHighlight(),this.boosterHint.hide(),this.gui.topPanel.revive(),this.gui.pauseButton.revive(),this.gui.undoButton.revive(),this.isTutorialMode=!1,this.emit(it.CANCEL,e)}getBooster(e){return this.scene.game.boosters.getByType(e)}setTutorialMode(e,t){let s=this.getBooster(e);this.onBoosterSelect(s,t),this.isTutorialMode=!0}cancelTutorialMode(){this.selectedBooster&&this.onBoosterCancel(this.selectedBooster)}destroy(){this.removePointerDownCallback(),this.boostersPanel.off(tt.SELECT,this.onBoosterSelect,this),this.boostersPanel.off(tt.CANCEL,this.onBoosterCancel,this)}},sS=class{constructor(e){this.scene=e,this.aboveItemsParticles=this.scene.add.particles("gameplay"),this.aboveItemsParticles.setDepth(F.POWERUP_FX),this.belowItemsParticles=this.scene.add.particles("gameplay"),this.belowItemsParticles.setDepth(F.BELOW_ITEMS_FX),this.createEmitters()}createEmitters(){this.addCollapseCookiesEmitters(),this.addStripesEmitters(),this.addBombEmitters(),this.addSuperSphereEmitters(),this.addDoubleSpheresEmtters(),this.addPregameBoostersEmitters(),this.addBoostersEmitters(),this.addMatchedCookieEmitters(),this.addFallingItemsEmitters()}addCollapseCookiesEmitters(){this.collapseCircles=this.aboveItemsParticles.createEmitter({frame:"circle_fx_3",scale:{start:.33,end:3,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1800,on:!1}),this.collapseSparks=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(35)),{speed:60,frame:"double_spheres_particle",lifespan:{min:500,max:900},scale:{start:1.33,end:.5},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1}))}addStripesEmitters(){let e={frame:"stripes_fx",scaleX:{start:1,end:1.5,ease:m.ExpoIn},scaleY:{start:0,end:1.75,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoIn},lifespan:700,on:!1};this.verticalStripesFx=this.aboveItemsParticles.createEmitter(P({},e)),this.horizontalStripesFx=this.aboveItemsParticles.createEmitter(k(P({},e),{rotate:90})),this.stripesFxCircles=this.aboveItemsParticles.createEmitter({frame:"stripes_fx_circle",scale:{start:.4,end:2.5,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:2e3,on:!1}),this.stripesParticles=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y/2)),{speed:150,frame:"particle_star_01",lifespan:{min:500,max:900},scale:{start:1,end:.5},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1})),this.stripedItemParticles=this.aboveItemsParticles.createEmitter({speed:75,frame:"particle_star_01",lifespan:{min:500,max:900},scale:{start:1,end:.5},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1}),this.stripedItemCircles=this.aboveItemsParticles.createEmitter({frame:"circle_fx_3",scale:{start:.66,end:1.66,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1200,on:!1})}addBombEmitters(){this.bombExplosion=this.aboveItemsParticles.createEmitter({frame:"bomb_explosion",scale:{start:1,end:4,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1e3,on:!1,blendMode:Phaser.BlendModes.ADD}),this.bombParticles=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y)),{frame:"cracker_hit_particle",speed:{min:350,max:550},lifespan:{min:200,max:300},scale:{start:1.5,end:.1,ease:m.QuintIn},on:!1}))}addSuperSphereEmitters(){this.superSphereCircles=this.aboveItemsParticles.createEmitter({frame:"circle_fx_3",scale:{start:1,end:3,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1e3,on:!1}),this.superSphereSparks=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y*.4)),{frame:"particle_star_01",speed:{min:350,max:550},lifespan:{min:200,max:300},scale:{start:1.5,end:.1,ease:m.QuintIn},on:!1})),this.superSphereChargeSparks=this.aboveItemsParticles.createEmitter({speed:200,frame:"particle_star_01",lifespan:{min:500,max:800},rotate:{min:0,max:180},scale:{start:1,end:.5},alpha:{start:1,end:0},on:!1})}addDoubleSpheresEmtters(){this.doubleSpheresMergeCircles=this.aboveItemsParticles.createEmitter({frame:"bomb_explosion",scale:{start:1,end:3,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1e3,on:!1}),this.doubleSpheresMergeParticles=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y/2)),{frame:"cracker_hit_particle",speed:{min:350,max:550},lifespan:{min:200,max:300},scale:{start:1.5,end:.1,ease:m.QuintIn},on:!1})),this.doubleSpheresExplosion=this.aboveItemsParticles.createEmitter({frame:"double_spheres_particle",lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1})}addPregameBoostersEmitters(){this.pregameBoosterCircles=this.aboveItemsParticles.createEmitter({frame:"circle_fx_3",scale:{start:.5,end:1.75,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:2e3,on:!1}),this.pregameBoosterSparks=this.aboveItemsParticles.createEmitter({speed:50,angle:-90,frame:"double_spheres_particle",lifespan:{min:800,max:1400},scale:{start:1,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:gs.BellSqrt},on:!1}),this.pregameBoosterSparks.setEmitZone({source:new Phaser.Geom.Circle(0,22,y*.5),type:"random"})}addBoostersEmitters(){this.gloveCircle=this.aboveItemsParticles.createEmitter({frame:"bomb_explosion",scale:{start:.8,end:2.5,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1e3,on:!1}),this.gloveParticles=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y/2)),{speed:200,frame:"star_particle",lifespan:{min:300,max:550},scale:{start:1,end:.25},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1}))}addColorCakeEmitters(){this.colorCakeCircles=this.aboveItemsParticles.createEmitter({frame:"bomb_explosion",scale:{start:2,end:10,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1e3,blendMode:Phaser.BlendModes.ADD,on:!1}),this.colorCakeSparks=this.aboveItemsParticles.createEmitter({frame:"double_spheres_particle",lifespan:2e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoIn},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1}).reserve(100)}addCandyBottleEmitters(){this.candyBottleCircles=this.belowItemsParticles.createEmitter({frame:"bottle_circle_fx",scale:{start:2.5,end:.7,ease:m.ExpoOut},alpha:{start:.33,end:1,ease:m.ExpoOut},lifespan:1200,on:!1})}addMatchedCookieEmitters(){this.matchedCookieSparks=this.aboveItemsParticles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(y*.5)),{speed:{min:20,max:40},frame:"double_spheres_particle",lifespan:{min:600,max:900},scale:{start:1,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:gs.Bell},on:!1})),this.matchedCookieCircles=this.aboveItemsParticles.createEmitter({frame:"circle_fx_3",scale:{start:.8,end:1.4,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:900,on:!1})}addFallingItemsEmitters(){let e={frame:O.getFrameByItemType(h.CHOCOLATE_COMMON),gravityY:2e3,speedY:-300,alpha:{start:1,end:0,ease:m.ExpoIn},lifespan:1e3,on:!1};this.fallingItemRight=this.aboveItemsParticles.createEmitter(k(P({},e),{speedX:{min:50,max:110},rotate:{start:0,end:45}})),this.fallingItemLeft=this.aboveItemsParticles.createEmitter(k(P({},e),{speedX:{min:-50,max:-110},rotate:{start:0,end:-45}}))}},iS=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.move=t;let[s,i]=this.sortByItemType(t.swap,t.match.itemsType),a=this.convertVectorToPoint(j(s.column,s.row)),n=this.convertVectorToPoint(j(i.column,i.row));this.mainItem=s,this.mainItemTargetPosition=Phaser.Geom.Point.Interpolate(a,n,.2),this.matchItems=t.match.items}sortByItemType(e,t){let{item_1:s,item_2:i}=e;return i.itemType===t?[i,s]:[s,i]}convertVectorToPoint(e){return new Phaser.Geom.Point(e.x,e.y)}show(){let e=333;this.matchItems.forEach(t=>{let{column:s,row:i}=t;this.scene.getHighlightAt(s,i).highlightTo({hold:e*3})}),this.scaleTween=this.scene.tweens.add({targets:this.matchItems,duration:e,ease:Phaser.Math.Easing.Sine.InOut,scale:1.17,yoyo:!0,repeat:1}),this.positionTween=this.scene.tweens.add({targets:this.mainItem,duration:e,ease:Phaser.Math.Easing.Sine.InOut,x:this.mainItemTargetPosition.x,y:this.mainItemTargetPosition.y,yoyo:!0,repeat:1,onComplete:()=>{this.emit(li.COMPLETE,this)}})}getItems(){return this.matchItems}destroy(){var e;super.destroy(),this.matchItems.forEach(t=>{let{column:s,row:i}=t;this.scene.getHighlightAt(s,i).resetHighlight()}),this.scaleTween&&(this.scaleTween.targets.forEach(t=>t.scale=1),this.scaleTween.remove(),this.scaleTween=null),(e=this.positionTween)==null||e.remove(),this.mainItem.alignToGrid()}smoothDestroy(e){var t,s;super.destroy(),this.matchItems.forEach(n=>{let{column:r,row:o}=n;this.scene.getHighlightAt(r,o).resetHighlightSmooth(e)}),(t=this.scaleTween)==null||t.remove(),this.scene.tweens.add({targets:this.matchItems,duration:e,ease:Phaser.Math.Easing.Quadratic.Out,scale:1});let{x:i,y:a}=j(this.mainItem.column,this.mainItem.row);(s=this.positionTween)==null||s.remove(),this.scene.tweens.add({targets:this.mainItem,duration:e,ease:Phaser.Math.Easing.Quadratic.Out,x:i,y:a})}},aS=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.move=t}show(){let{item_1:e,item_2:t}=this.move,s=this.getAlignGridPosition(e),i=this.getAlignGridPosition(t),a=.1,n=Phaser.Geom.Point.Interpolate(s,i,a),r=Phaser.Geom.Point.Interpolate(i,s,a),o=333;this.tween=this.scene.tweens.add({targets:[e,t],duration:o,ease:Phaser.Math.Easing.Sine.InOut,x:d=>d===e?n.x:r.x,y:d=>d===e?n.y:r.y,scale:1.17,yoyo:!0,repeat:1,onComplete:()=>{this.emit(li.COMPLETE,this)}});let l={hold:o*3};this.scene.getHighlightAt(e.column,e.row).highlightTo(l),this.scene.getHighlightAt(t.column,t.row).highlightTo(l)}getAlignGridPosition(e){let t=j(e.column,e.row);return new Phaser.Geom.Point(t.x,t.y)}getItems(){return[this.move.item_1,this.move.item_2]}destroy(){var e;super.destroy(),(e=this.tween)==null||e.remove(),this.tween=null;let{item_1:t,item_2:s}=this.move;t.alignToGrid(),t.scale=1,s.alignToGrid(),s.scale=1,this.scene.getHighlightAt(t.column,t.row).resetHighlight(),this.scene.getHighlightAt(s.column,s.row).resetHighlight()}smoothDestroy(e){var t;super.destroy(),(t=this.tween)==null||t.remove(),this.tween=null;let{item_1:s,item_2:i}=this.move;this.scene.getHighlightAt(s.column,s.row).resetHighlightSmooth(e),this.scene.getHighlightAt(i.column,i.row).resetHighlightSmooth(e),this.scene.tweens.add({targets:[s,i],duration:e,ease:Phaser.Math.Easing.Quadratic.Out,scale:1});let{x:a,y:n}=j(s.column,s.row);this.scene.tweens.add({targets:s,duration:e,ease:Phaser.Math.Easing.Quadratic.Out,x:a,y:n});let{x:r,y:o}=j(i.column,i.row);this.scene.tweens.add({targets:i,duration:e,ease:Phaser.Math.Easing.Quadratic.Out,x:r,y:o})}},li;(function(e){e.COMPLETE="__COMPLETE"})(li||(li={}));var nS=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.isEnabled=!0,this.isStarted=!1,this.scene=e,this.options=t}start(){this.isEnabled!==!1&&(this.isStarted||(this.bestMove=jt.findBestMove(this.scene.items,this.scene.goals.getGoalCookieTypes()),!!this.bestMove&&(this.isStarted=!0,this.hint=this.createHint(this.bestMove),this.doStart())))}doStart(){let{inbetweenDelayMs:e,inbetweenRepeats:t,initialDelayMs:s}=this.options;this.timerEvent=this.scene.time.delayedCall(s,()=>{this.timerEvent=this.scene.time.addEvent({startAt:e,delay:e,repeat:t-1,callback:()=>{this.hint.show(),this.timerEvent.getRepeatCount()===0&&this.hint.once(li.COMPLETE,()=>this.doStart())}})})}createHint(e){return e.type==="match"?new iS(this.scene,e):new aS(this.scene,e)}cancel(){var e,t;this.isStarted=!1,(e=this.timerEvent)==null||e.remove(),this.timerEvent=null,(t=this.hint)==null||t.destroy(),this.hint=null}cancelSmooth(){var e,t;this.isStarted=!1,(e=this.timerEvent)==null||e.remove(),this.timerEvent=null,(t=this.hint)==null||t.smoothDestroy(150),this.hint=null}setInitialDelay(e){this.options.initialDelay!==e&&(this.options.initialDelay=e,this.options.initialDelayMs=qa(e),this.isStarted&&(this.cancel(),this.start()))}getInitialDelay(){return this.options.initialDelay}};function rS(e,t,s,i){let a=ns(e),r=pn(a).filter(f=>f.params.powerup!==T.SUPER_SPHERE),o=r.filter(f=>!f.params.locked),l=!1,d=performance.now();for(;(Ee.hasAny(r)||ci(a))&&performance.now()-d<s;)$o(o,t),qo(r,t,i),l=!0;return{items:a,hasMatches:Ee.hasAny(r),hasDeadlock:ci(a),wasChanged:l}}function oS(e,t,s,i){if(e.every(f=>f.params.locked))return{items:e,hasMatches:Ee.hasAny(e),hasDeadlock:ci(e),wasChanged:!1};let n=ns(e),o=pn(n).filter(f=>f.params.powerup!==T.SUPER_SPHERE),l=o.filter(f=>!f.params.locked),d=performance.now();do $o(l,t),qo(o,t,i);while((Ee.hasAny(o)||ci(n))&&performance.now()-d<s);return{items:n,hasMatches:Ee.hasAny(o),hasDeadlock:ci(n),wasChanged:!0}}function $o(e,t){e.forEach(s=>{s.itemType=t.getItem()})}function qo(e,t,s){Ee.findAll(e).forEach(i=>{hS(i,e,t,s)})}function hS(e,t,s,i){let a=e.items.filter(r=>!r.params.locked);if(a.length===0)return;a=i.shuffle(a);let n=Tt(s.getItemTypes(),e.itemsType);a.length<=3?un(a[0],t,n,i):a.length>3&&(un(a[0],t,n,i),un(a[1],t,n,i))}function un(e,t,s,i){let{column:a,row:n}=e,r=i.pick(s),o=t.find(l=>l.column===a&&l.row===n);o.itemType=r}function pn(e){let t=O.getSubtypes(c.COOKIE);return e.filter(s=>t.includes(s.itemType))}function ci(e){let t=e.filter(i=>O.getItemSuperType(i.itemType)===c.LICORICE),s=e.filter(i=>{let{column:a,row:n,itemType:r}=i,o=O.getItemSuperType(r);if((o===c.COOKIE||o===c.MARSHMALLOW||r===h.DROP_ITEM)&&t.some(d=>d.column===a&&d.row===n)===!1)return!0});return!lS(s)&&!cS(s)}function lS(e){let t=e.filter(i=>O.getItemSuperType(i.itemType)===c.COOKIE);return t.filter(i=>!!i.params.powerup).some(i=>{let{column:a,row:n}=i,r=t.find(l=>l.column===a&&l.row===n+1);if(r&&(r.params.powerup||i.params.powerup===T.SUPER_SPHERE))return!0;let o=t.find(l=>l.column===a+1&&l.row===n);if(o&&(o.params.powerup||i.params.powerup===T.SUPER_SPHERE))return!0})}function cS(e){let t=e.filter(s=>O.getItemSuperType(s.itemType)===c.COOKIE&&s.params.powerup!==T.SUPER_SPHERE);return e.some(s=>{let{column:i,row:a,itemType:n}=s,r=e.find(l=>l.column===i&&l.row===a+1&&l.itemType!==n);if(r&&Qo(s,r,t))return!0;let o=e.find(l=>l.column===i+1&&l.row===a&&l.itemType!==n);if(o&&Qo(s,o,t))return!0})}function Qo(e,t,s){let{column:i,row:a}=e,{column:n,row:r}=t;e.column=n,e.row=r,t.column=i,t.row=a;let o=Ee.hasAny(s);return e.column=i,e.row=a,t.column=n,t.row=r,o}var dS=class{constructor(e){this.scene=e,this.howler=this.scene.audio,this.isEnabled=this.scene.game.audioType===cs.WEB_AUDIO,this.initThrottledSounds()}initThrottledSounds(){let e=.8;this.match_1=this.throttleSound(u.MATCH_1,{volume:.7}),this.match_2=this.throttleSound(u.MATCH_2,{volume:e}),this.match_3=this.throttleSound(u.MATCH_3,{volume:e}),this.match_4=this.throttleSound(u.MATCH_4,{volume:e}),this.match_5=this.throttleSound(u.MATCH_5,{volume:e}),this.stripesCreated=this.throttleSound(u.STRIPES_CREATED,{volume:.5}),this.bombCreated=this.throttleSound(u.BOMB_CREATED,{volume:.5}),this.superSphereCreated=this.throttleSound(u.SPHERE_CREATED,{volume:.6}),this.stripes=this.throttleSound(u.STRIPES),this.bomb=this.throttleSound(u.BOMB),this.bombIgnite=this.throttleSound(u.BOMB_IGNITE),this.superSphere=this.throttleSound(u.SUPER_SPHERE,{volume:.5}),this.dropItemCollect=this.throttleSound(u.DROP_ITEM_COLLECT),this.appleCollect=this.throttleSound(u.APPLE_COLLECT),this.candyCollect=this.throttleSound(u.CANDY_BOTTLE_OPEN,{volume:.66}),this.donutClose=this.throttleSound(u.DONUT_BOX_CLOSE,{volume:.66}),this.donutBite=this.throttleSound(u.DONUT_BITE,{volume:.66}),this.cookieUnlock=this.throttleSound(u.COOKIE_UNLOCK,{volume:.66}),this.colorCakeBite=this.throttleSound(u.COLOR_CAKE_BITE),this.gummyCollect=this.throttleSound(u.GUMMY_COLLECT,{volume:.5}),this.gummyBlockDrop=this.throttleSound(u.GUMMY_BLOCK_DROP,{volume:.4}),this.mysteryBoxOpen=this.throttleSound(u.MYSTERY_BOX,{volume:.5}),this.cupcake=this.throttleSound(u.CUPCAKE,{volume:.75}),this.chick=this.throttleSound(u.CHICK,{volume:.75}),this.generator=this.throttleSound(u.GENERATOR,{volume:.5}),this.biscuitCollect=this.throttleSound(u.BISCUIT_COLLECT),this.goalUpdate=this.throttleSound(u.GOAL_UPDATE,{volume:.33},{wait:50}),this.goalComplete=this.throttleSound(u.GOAL_COMPLETE,{volume:.66}),this.coinAdd=this.throttleSound(u.COIN_ADD,{volume:.5},{wait:50}),this.powerupToChef=this.throttleSound(u.TWINKLE_2,{volume:.66})}throttleSound(e,t,s){return this.isEnabled===!1?_a:(s=P({wait:100,trailing:!1},s),Ft(()=>{this.playSound(e,t)},s.wait,s))}playSound(e,t){this.howler.play(e,t)}destroy(){}},uS=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,"gameplay","field_cell_highlight");this.column=0,this.row=0,this.column=t,this.row=s}highlightTo(e){var t;this.revive();let s,i;this.scene.items.bottomItems.checkAt(this.column,this.row)?(s=.66,i=.88):(s=1,i=1),this.scale=i,this.alpha=0,(t=this.alphaTween)==null||t.remove(),this.alphaTween=this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Sine.InOut,alpha:s,hold:e.hold,yoyo:!0,onComplete:()=>{this.kill()}})}resetHighlight(){var e;(e=this.alphaTween)==null||e.remove(),this.kill()}resetHighlightSmooth(e){var t;(t=this.alphaTween)==null||t.remove(),this.scene.tweens.add({targets:this,duration:e,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.kill()}})}destroy(){super.destroy()}},pS=class extends Ws{constructor(e,t,s){super(e.mysteryBoxes,t);this.config=e,this.cookieTypesGenerator=s}getMysteryBoxContent(){let e=this.getItem();switch(e){case"COOKIE_BASIC":return{type:this.cookieTypesGenerator.getItem()};case"COOKIE_STRIPED":return{type:this.cookieTypesGenerator.getItem(),powerup:this.rnd.bool()?T.HORIZONTAL_STRIPES:T.VERTICAL_STRIPES};case"COOKIE_BOMB":return{type:this.cookieTypesGenerator.getItem(),powerup:T.BOMB};case"COOKIE_SUPER_SPHERE":return{type:this.cookieTypesGenerator.getItem(),powerup:T.SUPER_SPHERE};case"MARSHMALLOW_COLORED":return{type:this.getColoredMarshmallowType()};default:return{type:e}}}getColoredMarshmallowType(){let e=this.cookieTypesGenerator.getItemTypes().map(t=>{switch(t){case h.COOKIE_RED:return h.MARSHMALLOW_RED;case h.COOKIE_BLUE:return h.MARSHMALLOW_BLUE;case h.COOKIE_ORANGE:return h.MARSHMALLOW_ORANGE;case h.COOKIE_PURPLE:return h.MARSHMALLOW_PURPLE;case h.COOKIE_PINK:return h.MARSHMALLOW_PINK;case h.COOKIE_YELLOW:return h.MARSHMALLOW_YELLOW;default:return h.MARSHMALLOW_COMMON}});return this.rnd.pick(e)}};function Zo(e){let t=e.initData.pregameBoosters,s=gS(e,t.length);return s.length===0?Promise.resolve():new Promise(i=>{let a=100,n=vt(s.length,()=>{e.sys.queueDepthSort(),i()});s.forEach((r,o)=>{let l=t[o],d=mS(l,e.rnd);e.game.pregameBoosters.getByType(l).num--,e.game.analytics.subtractResource(ue.PREGAME_BOOSTERS,1,l,`Level_${e.levelNumber}`),e.time.delayedCall(o*a,()=>{fS(e,r,d,n)})})})}function gS(e,t){let s=e.items.getCookiesWithoutPowerups(),[i,a]=bv(s,o=>e.items.hasLicoriceOver(o)===!1),r=e.rnd.shuffle(i).slice(0,t);if(r.length<t){let l=e.rnd.shuffle(a).slice(0,t-r.length);r.push(...l)}return r}function mS(e,t){switch(e){case W.STRIPES:return t.bool()?T.HORIZONTAL_STRIPES:T.VERTICAL_STRIPES;case W.BOMB:return T.BOMB;case W.SUPER_SPHERE:return T.SUPER_SPHERE;default:let s=e;break}}function fS(e,t,s,i){let a=700,n=700,r=e.add.image(0,0,"gameplay","cracker_hit_particle");r.x=t.x,r.y=t.y-n,r.angle=180,r.scale=9,r.setDepth(F.POWERUP_FX),e.time.delayedCall(a/2,()=>{e.audio.play(u.BOOSTER_WHOOSH,{volume:.5})}),r.alpha=0,e.tweens.add({targets:r,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),e.tweens.add({targets:r,duration:a,ease:Phaser.Math.Easing.Linear,scale:2.2}),e.tweens.add({targets:r,duration:a,ease:Phaser.Math.Easing.Quadratic.In,x:t.x,y:t.y,onComplete:()=>{ES(e,t,s,i),r.destroy()}})}function ES(e,t,s,i){e.emitters.pregameBoosterCircles.emitParticle(1,t.x,t.y),e.emitters.pregameBoosterSparks.emitParticle(20,t.x,t.y);let a=e.applyPowerupToCookie(t,s);e.tweens.add({targets:a,duration:166,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,yoyo:!0}),e.audio.play(u.BOOSTER_LAND),i()}var vS=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e}onCreate(e=0){this.scene.time.delayedCall(e,()=>{})}onGuiCreate(e=0){this.scene.time.delayedCall(e,()=>{this.doStartTestSwap()})}doStartTestSwap(){let e=w.get("swap");if(e&&e.includes("x")){let[t,s]=e.split("x");t&&s&&this.testSwapItems(t,s)}}testSwapItems(e,t){let[s,i]=e.split(",").map(l=>parseInt(l)),[a,n]=t.split(",").map(l=>parseInt(l)),r=this.scene.items.mainItems.getAt(s,i),o=this.scene.items.mainItems.getAt(a,n);r&&o&&this.scene.itemsSwapper.canBeSwapped(r)&&this.scene.itemsSwapper.canBeSwapped(o)&&this.scene.itemsSwapper.swapItems(r,o)}testPreCompleteScreen(){this.scene.hint.cancel(),this.scene.lock(),this.scene.onLevelPreComplete()}testLevelCompleteScreenClean(){this.scene.game.store.removeLevelResult(this.scene.levelNumber),this.scene.onLevelComplete()}testLevelCompleteScreen(){this.scene.onLevelComplete()}testLevelCompleteScreenWithGift(){let e={complete:!0,boostersUsedNum:0,pregameBoostersUsedNum:0,secondChancesNum:0,timesFailedNum:0,timesAlmostCompleteNum:0,timesCompleteNum:0};this.scene.game.store.saveLevelResult(this.scene.levelNumber,e),this.scene.game.store.saveValue(g.GIFT_STARS_NUM,this.scene.game.gifts.getTargetStars()),this.scene.onLevelComplete()}testLevelFailedScreen(){let e={levelNumber:this.scene.levelNumber,goals:this.scene.goals.save()};this.scene.gui.addFailedScreen(),this.scene.gui.failedScreen.updateData(e),this.scene.gui.failedScreen.show({smooth:!0})}testBoosterRewardScreen(e){this.scene.boosters.testBoosterSelect(e)}},gn=We(require("@sentry/types")),TS=class{constructor(e){this.session={level:e.levelNumber,pregameBoosters:e.initData.pregameBoosters,rndSeed:e.initData.rndSeed,actions:[]}}pushAction(e){this.session.actions.push(P({step:this.session.actions.length+1},e))}toString(e=!1){return JSON.stringify(this.session,null,e?4:0)}},_S=Phaser.Scale.ScaleModes,me;(function(e){e.SWAP_COMPLETE="__SWAP_COMPLETE",e.TURN_COMPLETE="__TURN_COMPLETE",e.UNDO_COMPLETE="__UNDO_COMPLETE",e.LEVEL_START="__LEVEL_START"})(me||(me={}));var yS=class extends ct{init(e){var t;super.init(e),this.levelNumber=e.levelConfig.levelNumber,this.levelConfig=e.levelConfig,this.initGoalsManager(),this.boosters=null,this.moves=this.levelConfig.moves,this.isLocked=!1,this.isLevelPreComplete=!1,this.secondChancesUsedNum=0,this.maxSecondChances=window.game.config.ads.rewarded?2:1,(t=this.sounds)!=null||(this.sounds=new dS(this)),this.tester=null,this.session=new TS(this),this.rnd=new Phaser.Math.RandomDataGenerator(this.initData.rndSeed)}initGoalsManager(){this.goals=new Xo(this,this.levelConfig.goals),this.goals.on(aa.GOAL_COMPLETE,this.onGoalComplete,this)}onGoalComplete(e){var t;e.type===C.DROP_ITEM&&((t=this.field)==null||t.hideBottomCellPointers())}create(){PokiSDK.gameplayStart(),this.sendAnalyticsOnStart(),this.camera=new WC(this),this.setCustomDepthSort(),this.addField(),this.addCellHightlights(),this.addPointerHighlight(),this.addGenerators(),this.addFactory(),this.addFieldLabels(),this.addItems(),this.addUndoHandler(),this.addItemsSwapper(),this.addItemsDropper(),this.addGameplayEmitters(),this.calculateGridDimensions(),this.addHintsManager(),this.itemsShuffler=new UC(this),this.specialCombosHandler=new zC(this,this.items),this.powerupsHandler=new XC(this),this.dropItemsManager=new qC(this),this.addPointerCallbacks(),this.addKeyboardCallbacks(),ye.development&&(this.tester=new vS(this),this.tester.onCreate(100))}sendAnalyticsOnStart(){this.game.store.isLevelComplete(this.levelNumber)||this.analytics.sendLevelStart(this.levelNumber)}setCustomDepthSort(){let e=this.sys.displayList.sortByDepth;e.name==="sortByDepth"!==!1&&(this.sys.displayList.sortByDepth=(s,i)=>this.isGameItem(s)&&this.isGameItem(i)&&s.depth===i.depth?s.row-i.row:e(s,i))}isGameItem(e){return e.hasOwnProperty("itemType")}addField(){this.field=new mC(this,this.levelConfig),this.field.setDepth(F.FIELD),this.field.y=1,this.add.existing(this.field)}addCellHightlights(){this.cellHighlights=new De(this.levelConfig.grid.rows,this.levelConfig.grid.columns),this.field.cells.forEach(e=>{let t=j(e.column,e.row),s=new uS(this,e.column,e.row);s.setPosition(t.x,t.y),s.setDepth(F.HIGHLIGHTS),s.kill(),this.cellHighlights.add(s),this.add.existing(s)})}addPointerHighlight(){this.game.scale.scaleMode===_S.FIT!==!1&&(this.pointerHighlight=this.add.image(0,0,"gameplay","field_cell_highlight"),this.pointerHighlight.setDepth(F.HIGHLIGHTS),this.pointerHighlight.kill())}getHighlightAt(e,t){return this.cellHighlights.getAt(e,t)}addGenerators(){let e=this.levelConfig.generator.weights,t=e,{MYSTERY_BOX:s}=t,i=fi(t,["MYSTERY_BOX"]),a=this.initData.rndSeed;this.itemTypesGenerator=new Ws(e,a),this.cookieTypesGenerator=new Ws(i,a),this.mysteryBoxContentGenerator=new pS(this.levelConfig,a,this.cookieTypesGenerator)}addFactory(){this.itemsFactory=new kC(this)}addFieldLabels(){ye.development!==!1&&(this.fieldLabels=new $C(this,this.field),this.fieldLabels.kill(),this.fieldLabels.setDepth(F.DEBUG),this.add.existing(this.fieldLabels))}addItems(){let{columns:e,rows:t}=this.levelConfig.grid,s=this.getStartItemsLayout();this.items=new Bo(e,t),this.items.addItemsFromConfig(this.itemsFactory,s),w.getBool("hideItems")&&(this.items.bottomItems.forEach(a=>a.kill()),this.items.mainItems.forEach(a=>a.kill()),this.items.topItems.forEach(a=>a.kill()))}getStartItemsLayout(){let e=oS(this.levelConfig.items,this.cookieTypesGenerator,100,this.rnd);return e.hasMatches||e.hasDeadlock?this.levelConfig.items:e.items}addUndoHandler(){this.undoHandler=new VC(this),this.undoHandler.on(hi.RESTORE,this.onRestore,this)}onRestore(e,t){this.gui.topPanel.goalsPanel.updateData(t.goals),this.gui.topPanel.movesLabel.updateMovesNum(t.moves,!0)}addItemsSwapper(){this.itemsSwapper=new MC(this),this.itemsSwapper.on(It.SWAP_START,this.onItemsSwapStart,this),this.itemsSwapper.on(It.SWAP_COMPLETE,this.onItemsSwapComplete,this)}addItemsDropper(){this.itemsDropper=new GC(this),this.itemsDropper.on(ri.DROP_START,this.onDropStart,this),this.itemsDropper.on(ri.DROP_COMPLETE,this.onDropComplete,this)}onDropStart(){}onDropComplete(){this.sys.queueDepthSort(),this.checkFieldForMatches()}addGameplayEmitters(){this.emitters=new sS(this),this.levelConfig.items.some(i=>i.itemType===h.COLOR_CAKE)&&this.emitters.addColorCakeEmitters();let t=this.levelConfig.items.some(i=>i.itemType===h.CANDY_BOTTLE),s=this.levelConfig.mysteryBoxes.CANDY_BOTTLE>0;(t||s)&&this.emitters.addCandyBottleEmitters()}calculateGridDimensions(){let e=this.field.cells.toArray(),t=this.items.generators.toArray(),s=[...e,...t];this.gridDimensions=an(s)}addHintsManager(){let e=this.game.store.getValue(g.HINT_DELAY),t={initialDelay:e,initialDelayMs:qa(e),inbetweenDelayMs:2200,inbetweenRepeats:3};this.hint=new nS(this,t)}checkFieldForMatches(){return $(this,null,function*(){if(this.dropItemsManager.process()){this.itemsDropper.startPreDropTimer(100);return}let t=this.items.mainItems.filter(n=>n.isMatchable),s=Ee.findAll(t);if(s.length>0){this.matchesStep++,this.processMatches(s),this.itemsShuffler.resetShufflesInRow();return}if(yield this.waitForPowerupsToChef(),yield this.waitForPowerupsFromChef(),this.isLevelComplete()){this.onGoalsComplete();return}if(this.isLevelFailed()){this.onLevelFailed();return}let i=jt.isDeadlock(this.items);if(i){this.shuffleItems();return}if(i===!1&&this.itemsShuffler.resetShufflesInRow(),this.gui.movesWarning.movesNum===this.moves&&this.secondChancesUsedNum===0&&(this.gui.movesWarning.show(),this.audio.play(u.MOVES_WARNING)),this.gui.tutorial){this.events.emit(me.TURN_COMPLETE,this);return}this.closeDonutBoxes(),this.hint.start(),this.unlock(),this.events.emit(me.TURN_COMPLETE,this)})}waitForPowerupsToChef(){return new Promise((e,t)=>{let s=this.gui.powerupChef;if(s.getChargesInMotionNum()>0===!1)return e();s.once(ti.ALL_CHARGES_ARRIVED,()=>e())})}waitForPowerupsFromChef(){return new Promise((e,t)=>$(this,null,function*(){let s=this.gui.powerupChef;if(s.isPowerupReady()===!1)return e();let i=this.getCookieForChefPowerup();if(i===void 0)return this.sendCantUseChefChargeSentryMessage(),e();yield s.sendChargeFromChef(i),yield this.waitForPowerupsFromChef(),e()}))}isLevelComplete(){return this.goals.areComplete()}isLevelFailed(){return this.moves===0}sendCantUseChefChargeSentryMessage(){return $(this,null,function*(){var e;(e=this.sentry)==null||e.captureMessage("Can't use chef charge",{level:gn.Severity.Warning,extra:{snapshot:yield this.sentry.getGameSnapshotAsBlob(),json:this.session.toString(!0),cellsNum:this.field.getNonEmptyCellsNum(),itemsNum:this.items.mainItems.toArrayUniq().length,cookiesNum:this.items.mainItems.filter(t=>te(t)).length,cookiesWithPowerupsNum:this.items.getCookiesWithPowerups().length,cookiesWithoutPowerupsNum:this.items.getCookiesWithoutPowerups().length,move:`${this.moves} / ${this.levelConfig.moves}`}})})}sendEmptyMatchSentryMessage(e){return $(this,null,function*(){var t;let s={};if(this.itemsSwapper.lastSwap){let{item_1:i,item_2:a}=this.itemsSwapper.lastSwap;s={item_1:i==null?void 0:i.toString(),item_2:a==null?void 0:a.toString()}}(t=this.sentry)==null||t.captureMessage("Empty match",{level:gn.Severity.Warning,extra:{snapshot:yield this.sentry.getGameSnapshotAsBlob(),json:this.session.toString(!0),match:{type:e.type,result:e.result,itemsType:e.itemsType},lastSwap:s}})})}getCookieForChefPowerup(){let e=this.items.getCookiesWithoutPowerups(),t=e.filter(s=>this.items.hasLicoriceOver(s)===!1);return t.length>0?this.rnd.pick(t):this.rnd.pick(e)}onGoalsComplete(){if(this.isLevelPreComplete){this.onLevelComplete();return}let e=()=>{this.time.delayedCall(400,()=>{this.onLevelPreComplete()})},t=this.gui.goalItems.getActiveItemsNum();if(t===0){e();return}this.gui.goalItems.on(Kt.GOAL_ITEM_ARRIVED,()=>{--t==0&&(this.gui.goalItems.off(Kt.GOAL_ITEM_ARRIVED),e())})}onLevelPreComplete(){this.isLevelPreComplete=!0,this.gui.onLevelPreComplete()}onLevelComplete(){var e;this.tweens.add({targets:this.camera.camera,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.scene.setActive(!1),this.scene.setVisible(!1)}}),this.saveLevelResultOnComplete(),this.addLevelCompleteBreadcrumb(),this.sendAnalyticsOnComplete(),this.sendAdsWatchedDataOnComplete(),PokiSDK.gameplayStop(),(e=this.gui.preCompleteScreen)==null||e.hide(),this.gui.hideGuiOnLevelEnd(),this.gui.showCompleteScreen()}saveLevelResultOnComplete(){let e=this.game.store.getLevelResult(this.levelNumber),t=e?e.timesFailedNum:0,s=e?e.timesCompleteNum+1:1,i=e?e.timesAlmostCompleteNum:0,a=e?e.pregameBoostersUsedNum+this.getPregameBoostersUsedNum():this.getPregameBoostersUsedNum(),n=e?e.boostersUsedNum+this.boosters.boostersUsedNum:this.boosters.boostersUsedNum,r=e?e.secondChancesNum+this.secondChancesUsedNum:this.secondChancesUsedNum;this.game.store.saveLevelResult(this.levelNumber,{complete:!0,timesFailedNum:t,timesCompleteNum:s,timesAlmostCompleteNum:i,pregameBoostersUsedNum:a,boostersUsedNum:n,secondChancesNum:r})}addLevelCompleteBreadcrumb(){this.sentry.addBreadcrumb({category:"game.flow",message:`Level ${this.levelNumber} complete`})}sendAnalyticsOnComplete(){let e=this.game.store.getLevelResult(this.levelNumber);if(e.timesCompleteNum===1===!1)return;let s=this.levelConfig.moves,i=this.secondChancesUsedNum>0?this.moves-this.getSecondChanceTotalExtraMovesNum():this.moves,a=s-i;this.analytics.sendLevelComplete(this.levelNumber,i);let n=`Level_${this.levelNumber.toString().padStart(3,"0")}`;this.analytics.sendDesignEvent(`PregameBoostersUsed:${n}`,e.pregameBoostersUsedNum),this.analytics.sendDesignEvent(`BoostersUsed:${n}`,e.boostersUsedNum),this.analytics.sendDesignEvent(`SecondChance:${n}`,e.secondChancesNum),this.moves<=1&&this.analytics.sendDesignEvent(`Wow:${n}`),this.analytics.sendDesignEvent(`Fuuu:${n}`,this.calculateFuuuFactor(e))}calculateFuuuFactor(e){let{timesFailedNum:t,timesAlmostCompleteNum:s}=e;return s===0?t:t/s}sendAdsWatchedDataOnComplete(){if(this.levelNumber%25==0===!1||this.game.store.getLevelResult(this.levelNumber).timesCompleteNum===1===!1)return;let i=`Ad:Watched:Level_${this.levelNumber.toString().padStart(3,"0")}`;this.analytics.sendDesignEvent(`${i}:Interstitials`,this.game.store.getNumber(g.INTERSTITIAL_ADS_WATCHED)),this.analytics.sendDesignEvent(`${i}:Rewarded`,this.game.store.getNumber(g.REWARDED_ADS_WATCHED))}saveLevelResultOnFail(){let e,t=this.game.store.getLevelResult(this.levelNumber),s=this.isLevelAlmostComplete();t?e={complete:t.complete,timesFailedNum:t.timesFailedNum+1,timesCompleteNum:t.timesCompleteNum,timesAlmostCompleteNum:t.timesAlmostCompleteNum+(s?1:0),pregameBoostersUsedNum:t.pregameBoostersUsedNum+this.getPregameBoostersUsedNum(),boostersUsedNum:t.boostersUsedNum+this.boosters.boostersUsedNum,secondChancesNum:t.secondChancesNum+this.secondChancesUsedNum}:e={complete:!1,timesFailedNum:1,timesCompleteNum:0,timesAlmostCompleteNum:s?1:0,pregameBoostersUsedNum:this.getPregameBoostersUsedNum(),boostersUsedNum:this.boosters.boostersUsedNum,secondChancesNum:this.secondChancesUsedNum},this.game.store.saveLevelResult(this.levelNumber,e)}isLevelAlmostComplete(){return this.goals.getIncompleteGoals().every(t=>{let s=t.targetNum-t.collectedNum;switch(t.type){case C.BISCUIT:case C.MARSHMALLOW:case C.CHOCOLATE:case C.APPLE:case C.LICORICE:case C.CANDY:case C.DONUT:case C.DROP_ITEM:case C.GUMMY:return s===1;case C.CHICK:return s<=2;case C.COOKIE_RED:case C.COOKIE_BLUE:case C.COOKIE_ORANGE:case C.COOKIE_PURPLE:case C.COOKIE_PINK:case C.COOKIE_YELLOW:return s<=3;default:let i=t.type;return!1}})}getPregameBoostersUsedNum(){return this.initData.pregameBoosters.filter(Boolean).length}addLevelFailedBreadcrumb(){this.sentry.addBreadcrumb({category:"game.flow",message:`Level ${this.levelNumber} failed`})}sendAnalyticsOnFail(){if(this.game.store.isLevelComplete(this.levelNumber))return;let s=this.goals.getIncompleteGoals().reduce((i,a)=>(i+=a.targetNum-a.collectedNum,i),0);this.analytics.sendLevelFail(this.levelNumber,s)}onLevelFailed(){let e=()=>{this.secondChancesUsedNum===this.maxSecondChances?this.time.delayedCall(333,()=>{this.showLevelFailedScreen({smooth:!0})}):this.showSecondChanceScreen()},t=this.gui.goalItems.getActiveItemsNum();if(t===0){e();return}this.gui.goalItems.on(Kt.GOAL_ITEM_ARRIVED,()=>{--t==0&&(this.gui.goalItems.off(Kt.GOAL_ITEM_ARRIVED),this.time.delayedCall(300,()=>{e()}))})}showSecondChanceScreen(){this.scene.pause(),this.gui.secondChanceScreen||this.gui.addSecondChanceScreen();let e=this.gui.secondChanceScreen;e.outOfMovesPopup.updateData(this.goals.save()),e.secondChancePopup.closeButton.off(_.PRESS),e.secondChancePopup.closeButton.once(_.PRESS,this.onSecondChanceClose,this),e.once(Vt.PROCEED,this.giveSecondChance,this),e.show()}onSecondChanceClose(){this.gui.secondChanceScreen.kill(),this.showLevelFailedScreen({smooth:!1}),this.game.toasts.dismissAll()}giveSecondChance(){let e=this.getSecondChanceExtraMovesNum();this.session.pushAction({type:"second_chance_accept"}),this.sentry.addBreadcrumb({category:"game.flow",message:`Second chance #${this.secondChancesUsedNum+1} (+${e} moves)`}),this.gui.secondChanceScreen.once(b.HIDE_COMPLETE,this.onSecondChanceScreenHide.bind(this,e)),this.gui.secondChanceScreen.hide(),this.undoHandler.adjustMovesAfterSecondChance(e),this.secondChancesUsedNum++,this.moves+=e,this.checkFieldForMatches(),""+this.secondChancesUsedNum+e}getSecondChanceExtraMovesNum(){return Oe.getRewardNum(D.EXTRA_MOVES)}getSecondChanceTotalExtraMovesNum(){return this.getSecondChanceExtraMovesNum()*this.secondChancesUsedNum}onSecondChanceScreenHide(e){let t=this.gui.topPanel.movesLabel;t.onExtraMovesGranted(e);let s=t.movesNumText.getWorldPosition();s.x+=3,s.y-=7,this.gui.emitters.goalItemCircles.emitParticle(1,s.x,s.y),this.gui.emitters.goalItemSparks.setPosition(s.x,s.y),this.gui.emitters.goalItemSparks.explode(14,s.x,s.y),this.audio.play(u.EXTRA_MOVES)}showLevelFailedScreen(e){this.game.lives.removeLife(),this.saveLevelResultOnFail(),this.addLevelFailedBreadcrumb(),this.sendAnalyticsOnFail();let t={levelNumber:this.levelNumber,goals:this.goals.save()};this.gui.addFailedScreen(),this.gui.failedScreen.updateData(t),this.gui.failedScreen.show(e)}closeDonutBoxes(){this.items.getDonutBoxes().forEach(e=>{e.boxState===$e.OPENED&&e.wasJustOpened===!1&&(e.setBoxState($e.CLOSED),this.sounds.donutClose()),e.wasJustOpened=!1})}onItemsSwapStart(e,t){this.cancelHint(e,t),this.showSwapFx(e,t),this.undoHandler.save(),this.lock()}cancelHint(e,t){if(!this.hint.hint)return;let s=this.hint.hint.getItems();s.includes(e)||s.includes(t)?this.hint.cancel():this.hint.cancelSmooth()}showSwapFx(e,t){this.getHighlightAt(e.column,e.row).highlightTo({hold:200}),this.getHighlightAt(t.column,t.row).highlightTo({hold:200})}onItemsSwapComplete(e,t){var s;this.matchesStep=1;let i=Mo(e,t);if(i){(s=this.sentry)==null||s.addBreadcrumb({category:"game",message:`special combo ${i}`,data:{item_1:e.toString(),item_2:t.toString()}}),te(e)&&e.powerup&&this.gui.powerupChef.sendChargeToChef(e),te(t)&&t.powerup&&this.gui.powerupChef.sendChargeToChef(t),this.events.emit(me.SWAP_COMPLETE),this.updateMovesNum(),this.removeItemFromGrid(e),this.removeItemFromGrid(t),this.specialCombosHandler.processSpecialCombo(e,t,i),this.session.pushAction({type:"swap",cell_1:{column:e.column,row:e.row},cell_2:{column:t.column,row:t.row}});return}let a=this.findMatchesAfterSwap(e,t);if(a.length>0){this.events.emit(me.SWAP_COMPLETE),this.updateMovesNum(),this.processMatches(a),this.session.pushAction({type:"swap",cell_1:{column:e.column,row:e.row},cell_2:{column:t.column,row:t.row}});return}this.itemsSwapper.once(It.SWAP_BACK_COMPLETE,this.onSwapItemsBackComplete,this),this.itemsSwapper.swapItemsBack(e,t)}onSwapItemsBackComplete(){this.hint.start(),this.undoHandler.removeLastSavedState(),this.unlock()}findMatchesAfterSwap(e,t){let s=this.items.mainItems.filter(n=>n.isMatchable&&(n.itemType===e.itemType||n.itemType===t.itemType)),i=Ee.findBestMatchOf(s,e),a=Ee.findBestMatchOf(s,t);return[i,a].filter(Boolean)}updateMovesNum(){this.moves=Math.max(0,this.moves-1),this.gui.topPanel.movesLabel.updateMovesNum(this.moves,!1)}processMatches(e){if(e.forEach(t=>{let[s,i]=this.sortMatchedCookies(t);s.forEach(a=>{a.markAsMatched(t.id),this.removeItemFromGrid(a),this.destroyBiscuitUnder(a),this.damageChocolateAround(a),this.damageMarshmallowsAround(a),this.updateDonutBoxesAround(a),this.updateCandyBottlesAround(a),this.updateApplePlattersAround(a),this.updateColorCakesAround(a),this.updateMysteryBoxesAround(a),this.updateGummyBlockersAround(a),this.goals.update(a)}),s.forEach(a=>{this.powerupsHandler.processCookiePowerup(a)}),i.forEach(a=>{let n=this.items.topItems.getAt(a.column,a.row);n&&(this.items.remove(n),this.destroyLicorice(n))}),i.length>0&&(t.result=null),t.items=s}),e=e.filter(t=>{let s=t.items.length===0;return s&&this.sendEmptyMatchSentryMessage(t),s===!1}),e.length===0){this.itemsDropper.startPreDropTimer(150);return}e.forEach(t=>{let s=t.items,i=this.createCookieFromMatch(t);i?(i.visible=!1,this.collapseMatchIntoNewCookie(s,i),this.itemsDropper.startPreDropTimer(250)):(this.processMatchedCookies(s),this.time.delayedCall(100,()=>{s.forEach(a=>{this.emitters.matchedCookieSparks.setPosition(a.x,a.y),this.emitters.matchedCookieSparks.explode(4,a.x,a.y),this.emitters.matchedCookieCircles.explode(1,a.x,a.y)})}),this.itemsDropper.startPreDropTimer(150),this.playMatchSound())})}playMatchSound(){this.matchesStep===1?this.sounds.match_1():this.matchesStep===2?this.sounds.match_2():this.matchesStep===3?this.sounds.match_3():this.matchesStep===4?this.sounds.match_4():this.sounds.match_5()}sortMatchedCookies(e){let t=[],s=[];return e.items.forEach(i=>{this.items.hasLicoriceOver(i)?s.push(i):t.push(i)}),[t,s]}onCookieRemove(e,t=!0){this.destroyBiscuitUnder(e),this.damageChocolateAround(e),this.damageMarshmallowsAround(e),this.updateDonutBoxesAround(e),this.updateCandyBottlesAround(e),this.updateApplePlattersAround(e),this.updateColorCakesAround(e),this.updateMysteryBoxesAround(e),this.updateGummyBlockersAround(e),t&&this.powerupsHandler.processCookiePowerup(e),this.goals.isGoalItem(e)&&e.powerup!==T.SUPER_SPHERE&&(this.goals.update(e),this.gui.goalItems.collectItem(e))}removeItemFromGrid(e){this.items.remove(e)}collapseMatchIntoNewCookie(e,t){if(this.goals.isGoalItem(e[0])){this.onCollapseMatchComplete(e,t);return}this.tweens.add({targets:e,duration:100,ease:Phaser.Math.Easing.Linear,x:t.x,y:t.y,alpha:0,onComplete:()=>{this.onCollapseMatchComplete(e,t)}})}onCollapseMatchComplete(e,t){this.emitters.collapseCircles.emitParticle(3,t.x,t.y),this.emitters.collapseSparks.setPosition(t.x,t.y),this.emitters.collapseSparks.explode(10,t.x,t.y),this.playCookiePowerupCreationSound(t.powerup),this.processMatchedCookies(e),this.showNewCookie(t)}playCookiePowerupCreationSound(e){switch(e){case T.VERTICAL_STRIPES:case T.HORIZONTAL_STRIPES:this.sounds.stripesCreated();break;case T.BOMB:this.sounds.bombCreated();break;case T.SUPER_SPHERE:this.sounds.superSphereCreated();break;default:break}}processMatchedCookies(e){if(this.goals.isGoalItem(e[0])){e.forEach((s,i)=>{let a=i*50;this.time.delayedCall(a,()=>{this.gui.goalItems.collectItem(s),s.kill()})});return}e.forEach(s=>{this.tweens.add({targets:s,duration:66,ease:Phaser.Math.Easing.Linear,scale:.33,alpha:0,onComplete:()=>{s.kill()}})})}showNewCookie(e){e.visible=!0,e.popOut()}destroyBiscuitUnder(e){let t=this.items.bottomItems.getAt(e.column,e.row);t&&py(t)&&this.destroyBiscuit(t)}destroyBiscuit(e){this.goals.isGoalItemType(h.BISCUIT)&&(this.gui.goalItems.collectItem(e),this.goals.update(e)),this.items.bottomItems.remove(e),this.sounds.biscuitCollect(),e.destroy()}damageChocolateAround(e){let{column:t,row:s}=e;this.items.mainItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&a.itemSuperType===c.CHOCOLATE).filter(a=>a.canBeDamagedBy(e)).forEach(a=>{e.wasMatched&&a.matchIds.includes(e.matchId)||e.wasPoweruped&&a.powerupIds.includes(e.powerupId)||(a.matchIds.push(e.matchId),a.powerupIds.push(e.powerupId),a.damage(),a.isDead()&&this.destroyChocolate(a))})}onChocolateDamage(e,t){e.isDead()||this.emitters.pregameBoosterCircles.emitParticle(1,e.x,e.y-14)}destroyChocolate(e){if(this.goals.isGoalItemType(e.itemType))this.goals.update(e),this.gui.goalItems.collectItem(e);else{let t=Phaser.Math.RND.bool()?this.emitters.fallingItemRight:this.emitters.fallingItemLeft;t.setFrame(e.frame.name),t.explode(1,e.x,e.y)}this.itemsDropper.startPreDropTimer(100),this.items.mainItems.remove(e),e.destroy()}damageMarshmallowsAround(e){let{column:t,row:s}=e;this.items.mainItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&fy(a)&&a.canBeDamagedBy(e)&&this.items.hasLicoriceOver(a)===!1).forEach(a=>{e.wasMatched&&a.matchIds.includes(e.matchId)||e.wasPoweruped&&a.powerupIds.includes(e.powerupId)||(a.matchIds.push(e.matchId),a.powerupIds.push(e.powerupId),a.damage(),a.isDead()&&this.destroyMarshmallow(a))})}onMarshmallowDamage(e,t){e.isDead()||this.emitters.pregameBoosterCircles.emitParticle(1,e.x,e.y-14)}destroyMarshmallow(e){if(this.goals.isGoalItem(e))this.goals.update(e),this.gui.goalItems.collectItem(e);else{let t=Phaser.Math.RND.bool()?this.emitters.fallingItemLeft:this.emitters.fallingItemRight;t.setFrame(e.frame.name),t.explode(1,e.x,e.y)}this.itemsDropper.startPreDropTimer(100),this.items.mainItems.remove(e),e.destroy()}updateDonutBoxesAround(e){let{column:t,row:s}=e;this.items.mainItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&a.itemSuperType===c.DONUT_BOX).forEach(a=>{e.wasMatched&&a.matchIds.includes(e.matchId)||e.wasPoweruped&&a.powerupIds.includes(e.powerupId)||(a.matchIds.push(e.matchId),a.powerupIds.push(e.powerupId),this.updateDonutBox(a))})}updateDonutBox(e){if(e.boxState===$e.CLOSED){this.emitters.pregameBoosterCircles.emitParticle(1,e.x,e.y-14),e.setBoxState($e.OPENED),e.wasJustOpened=!0;return}this.items.mainItems.getAt(e.column,e.row)===e!==!1&&(this.sounds.donutBite(),this.items.mainItems.remove(e),this.itemsDropper.startPreDropTimer(400),this.goals.isGoalItemType(h.DONUT_BOX)?(this.goals.update(e),this.gui.goalItems.collectDonut(e.donut),e.hideInstant()):e.hide())}destroyLicorice(e){if(this.goals.isGoalItem(e))this.goals.update(e),this.gui.goalItems.collectItem(e);else{let s=Phaser.Math.RND.bool()?this.emitters.fallingItemRight:this.emitters.fallingItemLeft;s.setFrame(e.frame.name),s.explode(1,e.x,e.y)}this.removeItemFromGrid(e),this.sounds.cookieUnlock(),e.destroy()}destroyChick(e){this.goals.isGoalItem(e)&&(this.goals.update(e),this.gui.goalItems.collectItem(e)),this.itemsDropper.startPreDropTimer(150),this.removeItemFromGrid(e),this.sounds.cupcake(),e.destroy()}updateCandyBottlesAround(e){let{column:t,row:s}=e;this.items.mainItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&a.itemSuperType===c.CANDY_BOTTLE).forEach(a=>{e.wasMatched&&a.matchIds.includes(e.matchId)||e.powerupId&&a.powerupIds.includes(e.powerupId)||(a.matchIds.push(e.matchId),a.powerupIds.push(e.powerupId),a.emitCandy(0))})}onCandyCollect(e){this.goals.isGoalItemType(h.CANDY_BOTTLE)&&(this.goals.update(e),this.gui.goalItems.collectCandy(e),this.sounds.candyCollect(),this.itemsDropper.startPreDropTimer(150))}onCandyBottleLanded(e){this.emitters.candyBottleCircles.emitParticle(1,e.x,e.y-24)}onAppleCollect(e,t){this.goals.isGoalItemType(h.APPLES_PLATTER)&&(this.goals.update(e),this.gui.goalItems.collectApple(e,t))}updateApplePlattersAround(e){this.items.getApplePlatters().filter(i=>i.isEmpty()===!1).filter(i=>ae.getOrthoNeighborPositions(i).some(r=>r.column===e.column&&r.row===e.row)).forEach(i=>{e.wasMatched&&i.matchIds.includes(e.matchId)||e.wasPoweruped&&i.powerupIds.includes(e.powerupId)||(i.matchIds.push(e.matchId),i.powerupIds.push(e.powerupId),this.removeApple(i))})}removeApple(e){this.sounds.appleCollect(),e.removeApple(),e.isEmpty()&&(this.items.remove(e),this.itemsDropper.startPreDropTimer(400),this.emitters.fallingItemRight.setFrame(O.getFrameByItemType(e.itemType)),this.emitters.fallingItemRight.emitParticle(1,e.x,e.y),e.destroy())}updateColorCakesAround(e){if(e.powerup===T.SUPER_SPHERE)return;this.items.getColorCakes().filter(i=>i.isEmpty()===!1).filter(i=>ae.getOrthoNeighborPositions(i).some(r=>r.column===e.column&&r.row===e.row)).forEach(i=>{if(e.wasMatched&&i.matchIds.includes(e.matchId)||e.wasPoweruped&&e.wasMatched===!1)return;i.matchIds.push(e.matchId),i.powerupIds.push(e.powerupId);let n=Cs[e.itemType];this.removePieceFromColorCake(i,n)})}removePieceFromColorCake(e,t){if(this.sounds.colorCakeBite(),e.removePiece(t),e.isEmpty()){this.audio.play(u.COLOR_CAKE_INFLATE);let s=1300;e.once(ta.EXPLODE,this.onColorCakeExplode,this),e.explode(s),this.itemsDropper.startPreDropTimer(s+66)}}onColorCakeExplode(e){var t;(t=this.sentry)==null||t.addBreadcrumb({message:"color cake explosion",category:"game",data:{cake:e.toString()}}),this.audio.play(u.COLOR_CAKE_EXPLODE),this.items.remove(e);let s=this.getMaxExplosionRadius(e);this.powerupsHandler.applyBomb(e.column,e.row,s),this.emitters.colorCakeSparks.emitParticle(100,e.x,e.y),this.emitters.colorCakeCircles.emitParticle(1,e.x,e.y),this.camera.playZoomTween(this.camera.camera.originalZoom*1.15)}getMaxExplosionRadius(e){let{column:t,row:s}=e,i=this.field.dimensions,a=Math.max(t-i.left,i.right-t),n=Math.max(s-i.top,i.bottom-s);return Math.max(a,n)}updateMysteryBoxesAround(e){let{column:t,row:s}=e;this.items.mainItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&a.itemSuperType===c.MYSTERY_BOX).forEach(a=>{e.wasMatched&&a.matchIds.includes(e.matchId)||e.wasPoweruped&&a.powerupIds.includes(e.powerupId)||(a.matchIds.push(e.matchId),a.powerupIds.push(e.powerupId),a.open())})}onMysteryBoxOpen(e){this.items.remove(e),this.createItemFromMysteryBox(e),this.emitters.pregameBoosterCircles.emitParticle(1,e.x,e.y-20),this.sounds.mysteryBoxOpen(),e.destroy()}createItemFromMysteryBox(e){let t=e.convertContentToGameItemConfig(),s=this.itemsFactory.create(t);return s?(this.itemsDropper.startPreDropTimer(300),s.alpha=0,this.tweens.add({targets:s,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),s.scale=.66,this.tweens.add({targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.tweens.add({targets:s,duration:200,ease:Phaser.Math.Easing.Sine.InOut,y:"-=20",yoyo:!0}),s):null}updateGummyBlockersAround(e){let{column:t,row:s}=e;this.items.topItems.getOrthoNeighborsArrayAt(t,s).filter(a=>a&&a.itemSuperType===c.GUMMY_BLOCKER).forEach(a=>{this.destroyGummyBlocker(a)})}destroyGummyBlocker(e){let t=Phaser.Math.RND.bool()?this.emitters.fallingItemRight:this.emitters.fallingItemLeft;return t.setFrame(e.frame.name),t.explode(1,e.x,e.y),this.sounds.gummyBlockDrop(),this.removeItemFromGrid(e),e.destroy(),this.updateGummiesUnder(e)}updateGummiesUnder(e){let t=this.items.mainItems.getAt(e.column,e.row);if(!t||gy(t)===!1)return!1;let s=t;return ae.getItemPositions(s).some(n=>{var r;return((r=this.items.topItems.getAt(n.column,n.row))==null?void 0:r.itemSuperType)===c.GUMMY_BLOCKER})?!1:(this.goals.isGoalItem(s)&&(this.goals.update(s),this.gui.goalItems.collectGummy(s)),this.sounds.gummyCollect(),this.itemsDropper.startPreDropTimer(200),this.removeItemFromGrid(s),s.destroy(),!0)}createCookieFromMatch(e){if(!e.result)return null;let t=this.itemsSwapper.lastSwap,{column:s,row:i}=this.getMatchCollectPosition(e,t),a=this.getPowerupFromMatch(e,t);return this.itemsFactory.createCookie(s,i,e.itemsType,a)}getMatchCollectPosition(e,t){if(t){let i=e.items.find(a=>t.item_1===a||t.item_2===a);if(i)return{column:i.column,row:i.row}}return Es.getCollectPosition(e,this.rnd)}getPowerupFromMatch(e,t){if(e.result===He.STRIPES)return this.getStripesPowerup(e,t);if(e.result===He.BOMB)return T.BOMB;if(e.result===He.SUPER_SPHERE)return T.SUPER_SPHERE}getStripesPowerup(e,t){return t&&e.items.find(i=>t.item_1===i||t.item_2===i)?t.direction===ni.VERTICAL?T.VERTICAL_STRIPES:T.HORIZONTAL_STRIPES:this.rnd.frac()>this.levelConfig.verticalStripesChance?T.HORIZONTAL_STRIPES:T.VERTICAL_STRIPES}onGuiCreated(){var e;this.lock(),this.addBoostersManager(),this.showGoals(),this.gui.events.on(q.SEND_GAMEPLAY_SESSION,this.sendSessionToSentry,this),this.gui.undoButton.on(_.PRESS,this.onUndoButtonClick,this),(e=this.tester)==null||e.onGuiCreate(100)}showGoals(){this.gui.goalsScreen?(this.gui.goalsScreen.once(b.HIDE_COMPLETE,this.showTutorial,this),this.gui.goalsScreen.show()):this.showTutorial()}showTutorial(){let e=w.getBool("skipTutorial"),t=this.game.store.getValue(g.COMPLETE_TUTORIALS).includes(this.levelNumber);if(e||t||this.levelConfig.tutorial.autoGenerated)this.onTutorialSkip();else{this.sentry.addBreadcrumb({category:"game.flow",message:`Tutorial start - Level ${this.levelNumber}`});let s=this.gui.addTutorial(this.levelConfig.tutorial);s.once(Js.COMPLETE,this.onTutorialComplete,this),s.showNextScreen()}}onTutorialSkip(){Zo(this).then(()=>this.startLevel())}onTutorialComplete(){this.updateCompleteTutorials(),this.analytics.sendDesignEvent(`Tutorial:Level_${this.levelNumber}:Complete`),this.sentry.addBreadcrumb({category:"game.flow",message:`Tutorial complete - Level ${this.levelNumber}`}),!this.levelConfig.tutorial.steps.some(s=>s.type===L.BOOSTER)&&Zo(this).then(()=>this.startLevel())}updateCompleteTutorials(){var e;let t=(e=this.game.store.getValue(g.COMPLETE_TUTORIALS))!=null?e:[];t.includes(this.levelNumber)===!1&&(t.push(this.levelNumber),t.sort((s,i)=>s-i),this.game.store.saveValue(g.COMPLETE_TUTORIALS,t))}startLevel(){if(jt.isDeadlock(this.items)){this.itemsShuffler.once(oi.SHUFFLE_COMPLETE,this.startLevel,this),this.itemsShuffler.shuffleItems(this.items,this.cookieTypesGenerator);return}let t=this.items.mainItems.filter(i=>i.isMatchable),s=Ee.findAll(t);if(s.length>0){this.processMatches(s);return}this.levelConfig.showHintOnStart&&this.hint.start(),this.unlock(),this.events.emit(me.LEVEL_START,this)}addBoostersManager(){this.boosters=new tS(this,this.gui),this.boosters.on(it.SELECT,this.onBoosterSelect,this),this.boosters.on(it.CANCEL,this.onBoosterCancel,this),this.boosters.on(it.ACTIVATE,this.onBoosterActivate,this),this.boosters.on(it.COMPLETE,this.onBoosterComplete,this)}onBoosterSelect(){this.hint.cancelSmooth(),this.isLocked=!0}onBoosterCancel(){this.hint.start(),this.isLocked=!1}onBoosterActivate(e,t,s){this.matchesStep=1,this.session.pushAction({type:"booster",boosterType:e.type,cell:{column:t,row:s}})}onBoosterComplete(e){}onUndoButtonClick(e){if(e.undoBooster.num>0){this.applyUndo();return}if(window.game.config.ads.rewarded){let t=this.gui.getBoosterBuyScreenData(I.UNDO);this.gui.boosterBuyScreen.updateData(t),this.gui.boosterBuyScreen.show({showBackground:!0})}else e.shakeNumLabel()}applyUndo(){if(!this.undoHandler.canRestore()){this.audio.play(u.BOOSTER_CANT_USE);return}this.session.pushAction({type:"undo"}),this.game.analytics.subtractResource(ue.BOOSTERS,1,I.UNDO,`Level_${this.levelNumber}`),this.game.sentry.addBreadcrumb({category:"game.flow",message:"Undo"}),this.gui.showUndoOverlay(),this.audio.play(u.UNDO),this.game.boosters.getByType(I.UNDO).num--,this.hint.cancel(),this.undoHandler.restore(),this.hint.start(),this.events.emit(me.UNDO_COMPLETE,this)}update(e,t){super.update(e,t),this.itemsSwapper.update(t),this.itemsDropper.update(t)}customResize(){this.camera.resize()}addPointerCallbacks(){ye.development&&this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.pointerHighlight&&this.input.on(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}onPointerDown(e){if(e.event.shiftKey===!1)return;let t=e.positionToCamera(this.cameras.main),{column:s,row:i}=en(t),a=this.items.bottomItems.getAt(s,i),n=this.items.mainItems.getAt(s,i),r=this.items.topItems.getAt(s,i),o=[a,n,r].filter(Boolean),l=o.length>0?o.map(d=>d.itemType).join(", "):"EMPTY";""+s+i}onPointerMove(e){var t;let s=(t=this.gui)==null?void 0:t.tutorial;if(s&&s.getCurrentTutorialType()!==L.MATCH){this.pointerHighlight.kill();return}let i=e.positionToCamera(this.cameras.main),{column:a,row:n}=en(i),r=this.items.mainItems.getAt(a,n);if(r&&r.isSwappable&&this.items.hasLicoriceOver(r)===!1){let{x:o,y:l}=j(a,n);this.pointerHighlight.x=o,this.pointerHighlight.y=l,this.pointerHighlight.revive(),this.pointerHighlight.alpha=this.items.bottomItems.checkAt(a,n)?.66:1}else this.pointerHighlight.kill()}addKeyboardCallbacks(){ye.development&&(this.onKeyDown("S",this.forceShuffle,this),this.onKeyDown("L",this.toggleFieldCellLabels,this),this.onKeyDown("BACKSPACE",this.applyUndo,this),this.onKeyDown("F",()=>{var e;return(e=this.tester)==null?void 0:e.testLevelFailedScreen()}),this.onKeyDown("X",()=>this.tester.testPreCompleteScreen()),this.onKeyDown("Z",this.onLevelFailed,this),this.onKeyDown("C",this.onLevelComplete,this),this.onKeyDown("G",this.logGoals,this),this.onKeyDown("U",this.giveUndo,this))}giveUndo(e){let t=e.shiftKey?5:1;this.gui.undoButton.undoBooster.num+=t,this.gui.undoButton.onRewardGranted()}forceShuffle(){this.isLocked||(this.hint.cancel(),this.shuffleItems())}logGoals(){this.goals.toString()}toggleFieldCellLabels(){!this.fieldLabels||(this.fieldLabels.visible?this.fieldLabels.kill():this.fieldLabels.revive())}shuffleItems(){this.itemsShuffler.once(oi.SHUFFLE_COMPLETE,this.onShuffleComplete,this),this.itemsShuffler.shuffleItems(this.items,this.cookieTypesGenerator),this.audio.play(u.SHUFFLE)}onShuffleComplete(){this.sentry.addBreadcrumb({category:"game.flow",message:"shuffle complete"}),this.sys.displayList.queueDepthSort(),this.checkFieldForMatches()}applyPowerupToCookie(e,t){let{column:s,row:i,itemType:a}=e;return e.kill(),this.removeItemFromGrid(e),this.itemsFactory.createCookie(s,i,a,t)}lock(){this.isLocked||(this.isLocked=!0,this.gui.boostersPanel.disableInput(),this.gui.undoButton.disableInteractive())}unlock(){this.isLocked!==!1&&(this.isLocked=!1,this.gui.boostersPanel.enableInput(),this.gui.undoButton.setInteractive())}sendSessionToSentry(){return $(this,null,function*(){var e;(e=this.sentry)==null||e.captureMessage("Gameplay session",{level:gn.Severity.Warning,extra:{level:this.levelNumber,snapshot:yield this.sentry.getGameSnapshotAsBlob(),json:this.session.toString(!0)}}),this.game.toasts.show({message:`Report was sent
${Date.now()}`,lifespan:3e3})})}onShutdown(){var e,t;super.onShutdown(),PokiSDK.gameplayStop(),(e=this.gui)==null||e.events.off(q.SEND_GAMEPLAY_SESSION,this.sendSessionToSentry,this),this.itemsFactory.destroy(),this.itemsFactory=null,(t=this.boosters)==null||t.destroy(),this.boosters=null,this.itemsSwapper.destroy(),this.itemsSwapper=null,this.itemsDropper.destroy(),this.itemsDropper=null}},mn;(function(e){e.REPLAY_COMPLETE="__REPLAY_COMPLETE"})(mn||(mn={}));var CS=class extends Phaser.Events.EventEmitter{constructor(e,t,s){super();this.scene=e,this.scene.events.once("shutdown",this.destroy,this),this.gameplay=this.scene.gameplay,this.gui=this.scene.gui,this.session=t,this.actionsCopy=ns(this.session.actions).reverse(),this.options=s,this.gameplay.hint.isEnabled=!1,this.gameplay.fastForward.start(this.options.timescale),this.gui.fastForward.start(this.options.timescale),""+this.actionsCopy.length,this.playNextAction()}playNextAction(){if(this.actionsCopy.length===0){this.onComplete();return}let e=()=>{this.playAction(this.actionsCopy.pop())};this.options.delayBetweenActions>0?this.scene.time.delayedCall(this.options.delayBetweenActions,e):e()}playAction(e){let t=e,{step:s,type:i}=t,a=fi(t,["step","type"]);switch(e.type){case"swap":let{cell_1:n,cell_2:r}=e,o=this.gameplay.items.mainItems.getAt(n.column,n.row),l=this.gameplay.items.mainItems.getAt(r.column,r.row);this.gameplay.events.once(me.TURN_COMPLETE,this.playNextAction,this),this.gameplay.itemsSwapper.swapItems(o,l);break;case"booster":let{boosterType:d,cell:f}=e;this.gameplay.events.once(me.TURN_COMPLETE,this.playNextAction,this),this.gameplay.boosters.applyBooster(this.scene.game.boosters.getByType(d),f.column,f.row);break;case"undo":this.gameplay.events.once(me.UNDO_COMPLETE,this.playNextAction,this),this.gameplay.applyUndo();break;case"second_chance_accept":this.gameplay.events.once(me.TURN_COMPLETE,this.playNextAction,this),this.gameplay.giveSecondChance();break;default:let S=e;break}}onComplete(){this.gameplay.hint.isEnabled=!0,this.gameplay.hint.start(),this.gameplay.fastForward.stop(),this.gui.fastForward.stop(),this.emit(mn.REPLAY_COMPLETE,this)}destroy(){this.gameplay.events.off(me.TURN_COMPLETE,this.playNextAction,this),this.gameplay.events.off(me.UNDO_COMPLETE,this.playNextAction,this),super.destroy()}},SS=class extends ct{constructor(){super(...arguments);this.canResize=!1}init(e){super.init(e),this.initData.type==="play"?(this.levelNumber=this.initData.levelNumber,this.initData.rndSeed=(w.getNumber("levelSeed")||Date.now()).toString()):this.levelNumber=this.initData.session.level,this.levelConfig=this.game.levelConfigs.get(this.levelNumber),this.gameplay=null,this.gui=null,this.canResize=!1,""+this.levelNumber+this.levelConfig.originalLevelNumber,this.stringifyGoals(this.levelConfig.goals),this.levelConfig.moves}stringifyGoals(e){return Object.entries(e).filter(([t,s])=>s>0).map(([t,s])=>`${t}: ${s}`).join(", ")}preload(){let e=this.game.globalScene.delayedLoader;e.areGameplayAssetsReady===!1&&(this.analytics.sendLoadingEvent("gameplay","start"),this.waitForGameplayAssets(e))}waitForGameplayAssets(e){this.game.loadingScreen.hidePreloader(),this.game.loadingScreen.fadeIn(),this.load.rexAwait(Phaser.Math.RND.uuid(),{callback:t=>{e.once(Gs.GAMEPLAY_ASSETS_READY,()=>{this.analytics.sendLoadingEvent("gameplay","complete"),t()})}})}create(){if(!this.levelConfig){""+this.levelNumber,this.gotoEditor();return}this.addBackground(),this.addBlackOverlay(),this.launchGameplay(),this.addKeyboardCallbacks()}addBackground(){this.background=this.add.image(0,0,"gameplay_bg_1"),this.pin(this.background,.5,.5),this.size(this.background,et.ENVELOP)}addBlackOverlay(){this.blackOverlay=this.add.image(0,0,"gameplay","black_rect"),this.blackOverlay.alpha=.75,this.blackOverlay.originalAlpha=this.blackOverlay.alpha,this.blackOverlay.kill(),this.pin(this.blackOverlay,.5,.5),this.size(this.blackOverlay,et.FILL)}showBlackOverlay(){this.blackOverlay.revive(),this.tweens.add({targets:this.blackOverlay,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.blackOverlay.originalAlpha})}hideBlackOverlay(){this.tweens.killTweensOf(this.blackOverlay),this.tweens.add({targets:this.blackOverlay,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.blackOverlay.kill()}})}launchGameplay(){let e=this.getGameplayInitData();this.gameplay=this.launchScene(M.GAMEPLAY,e),this.gameplay.events.once(Phaser.Scenes.Events.CREATE,this.launchGUI,this),this.gameplay.events.once(me.LEVEL_START,this.onLevelStart,this),this.game.sentry.trackSceneInput(this.gameplay.scene.key)}getGameplayInitData(){let e=this.initData.type==="replay"?this.initData.session.pregameBoosters:this.initData.pregameBoosters,t=this.initData.type==="replay"?this.initData.session.rndSeed:this.initData.rndSeed;return{levelConfig:this.levelConfig,pregameBoosters:e!=null?e:[],rndSeed:t}}launchGUI(){this.gui=this.launchScene(M.GAMEPLAY_GUI,{gameplay:this.gameplay}),this.gui.events.once(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this),this.gui.events.once(q.LEVEL_MAP_ON_COMPLETE,this.gotoLevelMapOnComplete,this),this.gui.events.once(q.LEVEL_MAP_ON_FAIL,this.gotoLevelMapOnFail,this),this.gui.events.once(q.GOTO_LEVEL_MAP,this.gotoLevelMap,this),this.gui.events.once(q.GOTO_PREV_LEVEL,this.gotoPrevLevel,this),this.gui.events.once(q.GOTO_NEXT_LEVEL,this.gotoNextLevel,this),this.gui.events.once(q.RESTART_LEVEL_FROM_POPUP,this.restartLevelFromPopup,this),this.gui.events.once(q.RESTART,()=>this.restart()),this.game.sentry.trackSceneInput(this.gui.scene.key)}launchScene(e,t){return this.scene.launch(e,t).get(e)}onGuiCreated(){this.canResize=!0,this.resize(),this.gameplay.gui=this.gui,this.gameplay.onGuiCreated(),this.gui.pauseButton.on(_.PRESS,this.pause,this),this.game.loadingScreen.isVisible()&&this.game.loadingScreen.fadeOut()}onLevelStart(){this.initData.type==="replay"&&this.startReplay(this.initData.session)}startReplay(e){let t=new CS(this,e,{timescale:w.getNumber("replaySpeed",1),delayBetweenActions:200})}togglePause(){var e;((e=this.gameplay)==null?void 0:e.scene.isPaused())?this.resume():this.pause()}pause(){var e,t,s;PokiSDK.gameplayStop(),(e=this.gameplay)==null||e.scene.pause(),(t=this.gameplay)==null||t.scene.setVisible(!1),this.gui.pauseScreen.once(ji.CLOSE,this.resume,this),this.gui.pauseScreen.show(),(s=this.sentry)==null||s.addBreadcrumb({category:"game.flow",message:"pause"})}resume(){var e,t,s;PokiSDK.gameplayStart(),(e=this.gameplay)==null||e.scene.resume(),(t=this.gameplay)==null||t.scene.setVisible(!0),this.gui.pauseScreen.hide(),(s=this.sentry)==null||s.addBreadcrumb({category:"game.flow",message:"resume"})}addKeyboardCallbacks(){ye.development&&(this.onceKeyDown("R",this.onKeydownR,this),this.onKeyDown("P",this.togglePause,this),this.onceKeyDown("ESC",this.gotoLevelMap,this),this.onceKeyDown("LEFT",this.gotoPrevLevel,this),this.onceKeyDown("RIGHT",this.gotoNextLevel,this)),ye.editorEnabled&&this.onceKeyDown("E",this.gotoEditor,this)}onKeydownR(e){this.restart(this.initData)}gotoPrevLevel(){let e=this.game.levelConfigs.getLevelNumbers(),t=e.indexOf(this.levelNumber),s=e[t-1];s&&this.gotoLevel(s)}gotoNextLevel(){let e=this.game.levelConfigs.getLevelNumbers(),t=e.indexOf(this.levelNumber),s=e[t+1];s&&this.gotoLevel(s)}gotoLevel(e){if(this.game.levelConfigs.check(e)===!1){""+e;return}this.changeScene(M.GAMEPLAY_ROOT,{type:"play",levelNumber:e})}gotoEditor(){this.changeScene(M.LEVEL_EDITOR_ROOT,{levelNumber:this.levelNumber})}gotoLevelMapOnComplete(){let e={type:"complete",levelNumber:this.levelNumber};this.changeScene(M.LEVEL_MAP,e)}gotoLevelMapOnFail(){let e={type:"restart",failedLevel:this.levelNumber};this.changeScene(M.LEVEL_MAP,e)}gotoLevelMap(){let e={type:"basic",levelNumber:this.levelNumber};this.changeScene(M.LEVEL_MAP,e)}restartLevelFromPopup(e){this.changeScene(M.GAMEPLAY_ROOT,{type:"play",levelNumber:this.levelNumber,pregameBoosters:e})}resize(){var e,t,s;super.resize(),this.canResize!==!1&&((e=this.gui)==null||e.customResize(),(t=this.gameplay)==null||t.customResize(),(s=this.gui)==null||s.postGameplayResize())}onShutdown(){super.onShutdown(),this.stopChildScenes()}stopChildScenes(){this.getChildScenes().forEach(e=>{e&&e.scene.stop()}),this.gameplay&&(this.gameplay.events.off(Phaser.Scenes.Events.CREATE,this.launchGUI,this),this.gameplay.events.off(me.LEVEL_START,this.onLevelStart,this)),this.gui&&(this.gui.events.off(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this),this.gui.events.off(q.LEVEL_MAP_ON_COMPLETE,this.gotoLevelMapOnComplete,this),this.gui.events.off(q.LEVEL_MAP_ON_FAIL,this.gotoLevelMapOnFail,this),this.gui.events.off(q.GOTO_LEVEL_MAP,this.gotoLevelMap,this),this.gui.events.off(q.GOTO_PREV_LEVEL,this.gotoPrevLevel,this),this.gui.events.off(q.GOTO_NEXT_LEVEL,this.gotoNextLevel,this),this.gui.events.off(q.RESTART),this.gui.events.off(q.RESTART_LEVEL_FROM_POPUP))}getChildScenes(){return[this.gameplay,this.gui]}},OS=Phaser.Events.EventEmitter,qe=class extends OS{constructor(e,t,s){super();this.scene=e,this.panel=new Tweakpane({title:s,container:t})}disableInput(){this.panel.element.classList.add("disable-panel-input")}enableInput(){this.panel.element.classList.remove("disable-panel-input")}refresh(){this.panel.refresh()}collapse(){this.panel.expanded=!1}expand(){this.panel.expanded=!0}show(){this.panel.element.style.display="block"}hide(){this.panel.element.style.display="none"}destroy(){this.panel.dispose()}},fn;(function(e){e.APPLE="apple",e.BISCUIT="biscuit",e.CANDY_BOTTLE="candy_bottle",e.CHOCOLATE="chocolate",e.COLOR_CAKE="color_cake",e.COLOR_CHOCOLATE="color_chocolate",e.COLOR_MARSHMALLOW="color_marshmallow",e.DONUT="donut",e.GINGERBREAD="gingerbread",e.LICORICE="licorice",e.MARSHMALLOW="marshmallow"})(fn||(fn={}));var bS=class extends qe{constructor(e,t,s){super(e,t,`Level ${s.levelNumber}`);this.levelConfig=s,this.panel.addInput(this.levelConfig,"originalLevelNumber",{step:1}),this.panel.addInput(this.levelConfig,"verticalStripesChance",{step:.01,min:0,max:1,label:"vertical stripes"}),this.panel.addInput(this.levelConfig,"hard"),this.panel.addInput(this.levelConfig,"showHintOnStart",{label:"hint on start"}),this.bgInput=this.panel.addInput(this.levelConfig,"background",{options:this.getBackgrounds()}),this.panel.addInput(this.levelConfig,"newElement",{options:this.getNewElementOptions()}),this.panel.addInput(this.levelConfig,"newItemsTypes")}getBackgrounds(){return[{text:"green",value:"background_1"},{text:"pink",value:"background_2"},{text:"night",value:"background_3"}]}getNewElementOptions(){let e=Object.values(fn).map(t=>({text:t,value:t}));return e.unshift({text:"none",value:"none"}),e}},U;(function(e){e[e.BASE_GRID=0]="BASE_GRID",e[e.FIELD=1]="FIELD",e[e.BOTTOM_ITEMS=2]="BOTTOM_ITEMS",e[e.MAIN_ITEMS=3]="MAIN_ITEMS",e[e.TOP_ITEMS=4]="TOP_ITEMS",e[e.GENERATORS=5]="GENERATORS",e[e.LOCKS=6]="LOCKS",e[e.TUTORIAL=7]="TUTORIAL",e[e.SELECT_FRAMES=8]="SELECT_FRAMES",e[e.FLOATING_BUTTONS=9]="FLOATING_BUTTONS",e[e.POPOVERS=10]="POPOVERS"})(U||(U={}));var na;(function(e){e.LAYER_UPDATE="LayersPanel_LAYER_UPDATE"})(na||(na={}));var wS=class extends qe{constructor(e,t,s){super(e,t,"Layers");Object.keys(s).filter(i=>i!==U.GENERATORS.toString()).forEach(i=>{let a=this.getLayerLabel(parseInt(i));this.panel.addInput(s,i,{label:a}).on("change",this.onLayerChange.bind(this))})}getLayerLabel(e){return{[U.BASE_GRID]:"grid",[U.FIELD]:"field",[U.BOTTOM_ITEMS]:"bottom",[U.MAIN_ITEMS]:"middle",[U.TOP_ITEMS]:"top",[U.TUTORIAL]:"tutorial"}[e]||`layers_${e}`}onLayerChange(e){this.emit(na.LAYER_UPDATE,parseInt(e.presetKey),e.value)}},ra;(function(e){e.WEIGHT_CHANGE="GeneratorPanel_WEIGHT_CHANGE"})(ra||(ra={}));var PS=class extends qe{constructor(e,t,s){super(e,t,"Generator");this.config=s,this.addWeightsFolder()}addWeightsFolder(){let e=this.config.weights,t=this.panel.addFolder({title:"Weights"});Object.keys(e).forEach(s=>{t.addInput(e,s,{step:1,min:0,max:100}).on("change",this.onWeightChange.bind(this,s))}),t.addButton({title:"Reset"}).on("click",this.resetWeights.bind(this)),t.addButton({title:"Enable All"}).on("click",this.enableAll.bind(this))}onWeightChange(e,t){this.emit(ra.WEIGHT_CHANGE,e,t)}resetWeights(){let e=Us.getDefaultWeights();Object.assign(this.config.weights,e),this.refresh()}enableAll(){let e=50;Object.keys(this.config.weights).forEach(t=>this.config.weights[t]=e),this.refresh()}},LS=class extends qe{constructor(e,t,s){super(e,t,"Goals");this.goalsConfig=s.goals,this.panel.addInput(s,"moves",{step:1,min:1,max:50}),this.panel.addSeparator(),this.addGoalInputs(),this.panel.addButton({title:"Reset"}).on("click",this.resetGoals.bind(this))}addGoalInputs(){Object.keys(this.goalsConfig).forEach(e=>{this.panel.addInput(this.goalsConfig,e,{step:1,min:0,max:100})})}resetGoals(){Object.keys(this.goalsConfig).forEach(e=>{this.goalsConfig[e]=0}),this.refresh()}},IS=class extends qe{constructor(e,t,s,i){super(e,t,"Chef Powerups");this.config=s,this.defaultConfig=i,this.panel.addInput(this.config,"isEnabled"),this.panel.addInput(this.config,"powerupsNum",{min:1,max:20,step:1}),this.panel.addSeparator(),this.addWeights(),this.resetButton=this.panel.addButton({title:"Reset"}),this.resetButton.on("click",this.reset.bind(this))}addWeights(){Object.values(T).forEach(t=>{let s=t.toLowerCase().replace("_"," ");this.panel.addInput(this.config,t,{min:0,max:100,step:1,label:s})})}reset(){Object.assign(this.config,this.defaultConfig),this.refresh()}},AS=class extends qe{constructor(e,t,s){super(e,t,"Boosters");this.config=s,Object.keys(s).forEach(i=>{this.panel.addInput(this.config,i)})}},xS=class extends qe{constructor(e,t,s){super(e,t,"Pregame Boosters");this.config=s,Object.keys(s).forEach(i=>{this.panel.addInput(this.config,i)})}},Ss;(function(e){e.SHOW_TUTORIAL_AREA="__SHOW_TUTORIAL_AREA",e.HIDE_TUTORIAL_AREA="__HIDE_TUTORIAL_AREA"})(Ss||(Ss={}));var BS=class extends qe{constructor(e,t,s){super(e,t,"Tutorial");this.folders=[],this.config=s,this.panel.addSeparator(),this.panel.addSeparator(),this.typeInput=this.panel.addInput({type:"type"},"type",{options:this.getStepTypes()}),this.panel.addButton({title:"+"}).on("click",this.onAddStepButtonClick.bind(this)),s.steps.forEach(i=>{this.addStepFolder(i)})}getStepTypes(){return Object.values(L).map(e=>({text:e,value:e}))}onAddStepButtonClick(){let e=this.typeInput.controller.controller.value.rawValue,t=this.createTutorialStep(e);this.config.steps.push(t),this.addStepFolder(t)}createTutorialStep(e){switch(e){case L.MATCH:return{type:L.MATCH,textKey:"",showHint:!0,showDelay:0,swapCell_1:{x:0,y:0},swapCell_2:{x:0,y:0},cells:[],areaId:0,areaVisible:!0};case L.BOOSTER:return{type:L.BOOSTER,textKey:"",showDelay:0,boosterType:I.GLOVE,boosterCell:{x:0,y:0}};case L.GOALS:return{type:L.GOALS,textKey:"",showDelay:0};case L.MOVES:return{type:L.MOVES,textKey:"",showDelay:0};case L.CHEF:return{type:L.CHEF,textKey:"",showDelay:0};case L.UNDO:return{type:L.UNDO,textKey:"",showDelay:0}}}addStepFolder(e){let t=this.folders.length+1,s=`Step ${t} - ${e.type}`,i=t,a=this.panel.addFolder({title:s,index:i});if(e.type===L.BOOSTER){let n={x:{step:1,min:0,max:8},y:{step:1,min:0,max:8}};a.addInput(e,"boosterCell",n),a.addInput(e,"boosterType",{options:this.getBoosterOptions()})}if(e.type===L.MATCH){let n={x:{step:1,min:0,max:8},y:{step:1,min:0,max:8}};a.addInput(e,"swapCell_1",n),a.addInput(e,"swapCell_2",n),a.addInput(e,"areaId",{step:1,min:0,max:10}),a.addInput(e,"areaVisible").on("change",this.onAreaVisibleCheckboxChange.bind(this,e)),a.addInput(e,"showHint")}a.addInput(e,"showDelay",{step:50,min:0,max:2e3}),a.addInput(e,"textKey",{options:this.getTutorialKeys()}),a.addButton({title:"-"}).on("click",this.onRemoveStepButtonClick.bind(this,a)),this.folders.push(a)}onAreaVisibleCheckboxChange(e,t){t?this.emit(Ss.SHOW_TUTORIAL_AREA,e.areaId):this.emit(Ss.HIDE_TUTORIAL_AREA,e.areaId)}onRemoveStepButtonClick(e){e.dispose(),this.onFolderRemove(e)}onFolderRemove(e){let t=this.folders.indexOf(e);t>-1&&(this.config.steps.splice(t,1),this.folders.splice(t,1),this.updateStepFolderTitles())}updateStepFolderTitles(){this.folders.forEach((e,t)=>{let s=this.config.steps[t];e.controller.view.titleElement.childNodes.item(0).textContent=`Step ${t+1} - ${s.type}`})}getBoosterOptions(){return[{text:I.GLOVE,value:I.GLOVE},{text:I.ROLLING_PIN,value:I.ROLLING_PIN},{text:I.LOLLIPOP,value:I.LOLLIPOP}]}getTutorialKeys(){let e=this.scene.texts.tutorial;return Object.keys(e).map(t=>({text:t,value:t}))}},kS=class extends qe{constructor(e,t,s){super(e,t,"Pregame Boosters Hints");this.config=s,Object.keys(s).forEach(i=>{this.panel.addInput(this.config,i)})}},En=class extends qe{constructor(e,t,s){super(e,t,s);this.ignoreConfigUpdates=!1,this.config=this.getDefaultConfig(),this.addInputs(),this.addResetButton()}getDefaultConfig(){return null}addInputs(){}addResetButton(){this.panel.addButton({title:"Reset"}).on("click",this.onResetButtonClick.bind(this))}onResetButtonClick(){Object.assign(this.config,this.getDefaultConfig()),this.refresh()}setItem(e){this.item=e,this.ignoreConfigUpdates=!0,Object.assign(this.config,this.getConfigFromItem(this.item)),this.refresh(),this.ignoreConfigUpdates=!1}resetItem(){this.item=null}getConfigFromItem(e){return null}},K;(function(e){e.SELECT="ISelectable_SELECT",e.UNSELECT="ISelectable_UNSELECT"})(K||(K={}));var Jo=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,t,O.getFrameByItemType(s));this._isSelected=!1,this.itemType=s,this.itemSuperType=O.getItemSuperType(this.itemType),this.id=Phaser.Math.RND.uuid(),this.params={type:"basic"},this.setData("itemType",this.itemType),this.setData("itemSuperType",this.itemSuperType),this.setInteractive(),this.setMulticell()}get isSelected(){return this._isSelected}setMulticell(){if(this.isMultiCell=ae.isMulticell(this.itemType),this.isMultiCell){let e=ae.getSize(this.itemType);this.itemWidth=e.width,this.itemHeight=e.height}}updateItemType(e){if(O.getItemSuperType(this.itemType)!==this.itemSuperType){""+this.itemType+this.column+this.row;return}this.itemType=e,this.setData("itemType",this.itemType),this.setFrame(O.getFrameByItemType(e))}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}destroy(){super.destroy()}},di;(function(e){e.POWERUP_CHANGE="__POWERUP_CHANGE"})(di||(di={}));var MS=class extends Jo{constructor(e,t,s){super(e,t,s)}setPowerup(e=null){e===null?delete this.params.powerup:this.params.powerup=e,this.emit(di.POWERUP_CHANGE,this,this.params.powerup),this.updateFrame(this.itemType,this.params.powerup)}updateFrame(e,t){this.setFrame(G.getFrame(e,t))}destroy(){super.destroy(),this.lock&&(this.lock.destroy(),this.lock=null)}},RS=class extends En{constructor(e,t,s="Cookie"){super(e,t,s)}getDefaultConfig(){return{type:h.COOKIE_RED,powerup:"NONE"}}addInputs(){this.panel.addInput(this.config,"type",{options:this.getCookieTypes()}).on("change",this.onTypeChange.bind(this)),this.panel.addInput(this.config,"powerup",{options:this.getPowerupTypes()}).on("change",this.onPowerupChange.bind(this))}onTypeChange(e){this.ignoreConfigUpdates||(this.item.updateItemType(e.value),this.item.updateFrame(this.item.itemType,this.item.params.powerup))}onPowerupChange(e){if(this.ignoreConfigUpdates)return;let t=e.value,s=t==="NONE"?null:t;this.item.setPowerup(s)}getCookieTypes(){return O.getSubtypes(c.COOKIE).map(e=>({text:e,value:e}))}getPowerupTypes(){return["NONE",...b_].map(t=>({text:t,value:t}))}getConfigFromItem(e){var t;return{type:e.itemType,powerup:(t=e.params.powerup)!=null?t:"NONE"}}setItem(e){var t;super.setItem(e),(t=this.item)==null||t.on(di.POWERUP_CHANGE,this.onCookiePowerupChange,this)}resetItem(){var e;(e=this.item)==null||e.off(di.POWERUP_CHANGE,this.onCookiePowerupChange,this),super.resetItem()}onCookiePowerupChange(e,t){this.config.powerup=t!=null?t:"NONE",this.refresh()}},NS=class extends qe{constructor(e,t,s,i="Mystery Boxes"){super(e,t,i);this.config=s,this.addInputs(),this.addResetButton()}addInputs(){Object.keys(this.config).forEach(e=>{this.panel.addInput(this.config,e,{step:1,min:0,max:100})})}addResetButton(){this.panel.addButton({title:"Reset"}).on("click",this.onResetButtonClick.bind(this))}onResetButtonClick(){Object.assign(this.config,Us.createDefaultMysteryBoxesConfig()),this.refresh()}},Xt;(function(e){e.TURNS_CHANGE="__TURNS_CHANGE",e.INVISIBILITY_CHANGE="__INVISIBILITY_CHANGE"})(Xt||(Xt={}));var DS=class extends Phaser.GameObjects.Container{constructor(e,t=3,s=V.DROP_ITEM,i=oe.NONE,a=!1){super(e);this.isMultiCell=!1,this.itemWidth=1,this.itemHeight=1,this.itemType=h.GENERATOR,this.itemSuperType=c.GENERATOR,this._isSelected=!1,this.name="color_cake",this.id=Phaser.Math.RND.uuid(),this.params={type:"generator",turnsNum:t,content:s,contentMod:i,invisible:a},this.setData("itemType",this.itemType),this.setData("itemSuperType",this.itemSuperType),this.addItem(),this.addBubble(),this.addInvisibleIcon(),this.addPropeller(),this.addTurnsLabel(),this.setSize(this.bubble.width,this.bubble.height),this.setInteractive()}get isSelected(){return this._isSelected}addItem(){let e=Lt.getContentFrame(this.params.content,this.params.contentMod);this.item=this.scene.add.image(0,0,"gameplay",e),this.item.y=3,this.add(this.item)}addBubble(){this.bubble=this.scene.add.image(0,0,"gameplay","generator/base"),this.add(this.bubble)}addInvisibleIcon(){this.invisibleIcon=this.scene.add.image(0,0,"editor","invisible_icon"),this.invisibleIcon.x=y/2-14,this.invisibleIcon.y=-y/2+14,this.add(this.invisibleIcon),this.params.invisible===!1&&this.invisibleIcon.kill()}addPropeller(){this.propeller=this.scene.add.image(0,0,"gameplay","generator/propeller"),this.propeller.y=this.bubble.bottom,this.add(this.propeller)}addTurnsLabel(){this.turnLabelBack=this.scene.add.image(0,0,"gameplay","generator/label_back"),this.turnLabelBack.y=this.propeller.y,this.add(this.turnLabelBack);let e=this.params.turnsNum.toString(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"20px",color:"#7D473D",align:"center"};this.turnLabel=this.scene.add.text(0,0,e,t),this.turnLabel.setOrigin(.5,.5),this.turnLabel.x=this.turnLabelBack.x,this.turnLabel.y=this.turnLabelBack.y,this.add(this.turnLabel)}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}updateTurnsNum(e){this.params.turnsNum=Phaser.Math.Clamp(e,1,10),this.turnLabel.text=this.params.turnsNum.toString(),this.emit(Xt.TURNS_CHANGE,this,this.params.turnsNum)}updateContentType(e,t){this.params.content=e,this.params.contentMod=t,this.item.setFrame(Lt.getContentFrame(e,t))}updateInvisibility(e){this.params.invisible=e,e?this.invisibleIcon.revive():this.invisibleIcon.kill(),this.emit(Xt.INVISIBILITY_CHANGE,this,this.params.invisible)}toggleInvisibility(){let e=!this.params.invisible;this.updateInvisibility(e)}},HS=class extends En{constructor(e,t,s="Generator"){super(e,t,s)}getDefaultConfig(){return{content:V.DROP_ITEM,contentMod:oe.NONE,turns:3,invisible:!1}}addInputs(){this.panel.addInput(this.config,"content",{options:this.getContentTypes()}).on("change",this.onContentTypeChange.bind(this)),this.panel.addInput(this.config,"contentMod",{options:this.getContentMods()}).on("change",this.onContentModChange.bind(this)),this.panel.addInput(this.config,"turns",{step:1,min:1,max:10}).on("change",this.onTurnsNumChange.bind(this)),this.panel.addInput(this.config,"invisible").on("change",this.onInvisibilityChange.bind(this))}getContentTypes(){return Object.keys(V).map(e=>({text:V[e],value:V[e]}))}getContentMods(){return Object.keys(oe).map(e=>({text:oe[e],value:oe[e]}))}onContentTypeChange(e){this.ignoreConfigUpdates||(this.fixContentMod(),this.item.updateContentType(this.config.content,this.config.contentMod))}onContentModChange(e){this.ignoreConfigUpdates||(this.fixContentMod(),this.item.updateContentType(this.config.content,this.config.contentMod))}fixContentMod(){Lt.isCookie(this.config.content)===!1&&this.config.contentMod!==oe.NONE&&(this.config.contentMod=oe.NONE,this.refresh()),this.config.content===V.RANDOM_COOKIE&&this.config.contentMod===oe.NONE&&(this.config.contentMod=oe.RANDOM_STRIPES,this.refresh())}onTurnsNumChange(e){this.ignoreConfigUpdates||this.item.updateTurnsNum(e.value)}onInvisibilityChange(e){this.ignoreConfigUpdates||this.item.updateInvisibility(e.value)}setItem(e){var t,s;super.setItem(e),(t=this.item)==null||t.on(Xt.TURNS_CHANGE,this.onItemTurnChange,this),(s=this.item)==null||s.on(Xt.INVISIBILITY_CHANGE,this.onItemInvisibilityChange,this)}onItemTurnChange(){this.ignoreConfigUpdates=!0,this.config.turns=this.item.params.turnsNum,this.refresh(),this.ignoreConfigUpdates=!1}onItemInvisibilityChange(e,t){this.ignoreConfigUpdates=!0,this.config.invisible=t,this.refresh(),this.ignoreConfigUpdates=!1}resetItem(){var e;(e=this.item)==null||e.off(Xt.TURNS_CHANGE,this.onItemTurnChange,this),super.resetItem()}getConfigFromItem(e){return{turns:this.item.params.turnsNum,content:this.item.params.content,contentMod:this.item.params.contentMod,invisible:this.item.params.invisible}}},ui;(function(e){e.CONTENT_CHANGE="__CONTENT_CHANGE"})(ui||(ui={}));var eh=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.itemType=h.COLOR_CAKE,this.itemSuperType=c.COLOR_CAKE,this._isSelected=!1,this.name="color_cake",this.id=Phaser.Math.RND.uuid(),this.params={type:"color_cake",content:t},this.setData("itemType",this.itemType),this.setData("itemSuperType",this.itemSuperType),this.setMulticell(),this.pieces=[],this.addBase(),this.addBombShadow(),this.addBomb(),this.setContent(t),this.setSize(this.base.width,this.base.height),this.setInteractive()}get isSelected(){return this._isSelected}addBase(){this.base=this.scene.add.image(0,0,"gameplay","color_cake/Cake_01"),this.add(this.base)}addPieces(e){this.pieces=e.map((t,s)=>{if(!t)return null;let i=this.getPieceFrame(t,s),a=this.scene.make.image({key:"gameplay",frame:i});return a.pieceType=t,a}),this.add(this.pieces.filter(Boolean))}getPieceFrame(e,t){return`color_cake/${e}_0${t+1}`}addBombShadow(){this.bombShadow=this.scene.add.image(0,0,"gameplay","color_cake/Cake_02"),this.bombShadow.alpha=.66,this.add(this.bombShadow)}addBomb(){this.bomb=this.scene.add.image(0,0,"gameplay","color_cake/Cake_03"),this.add(this.bomb)}setMulticell(){if(this.isMultiCell=ae.isMulticell(this.itemType),this.isMultiCell){let e=ae.getSize(this.itemType);this.itemWidth=e.width,this.itemHeight=e.height}}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}getContent(){return this.content}setContent(e){this.content=e,this.params.content=this.content,this.pieces.forEach(t=>t==null?void 0:t.destroy()),this.addPieces(this.content),this.bringToTop(this.bombShadow),this.bringToTop(this.bomb)}getLastActivePieceIndex(){for(let e=this.pieces.length-1;e>-1;e--)if(this.pieces[e]!==null)return e+1;return-1}setActivePiecesNum(e,t){let s=Phaser.Math.Clamp(e,1,eh.PIECES_NUM),i=this.getLastActivePieceIndex();if(i===s)return;let a;if(s>i){let n=Phaser.Math.RND.pick(t);a=this.content.slice(0),a[i]=Cs[n]}else a=this.content.slice(0),a[i-1]=null;this.setContent(a),this.emit(ui.CONTENT_CHANGE,this,this.content)}},th=eh;th.PIECES_NUM=6;var GS=class extends En{constructor(e,t){super(e,t,"Color Cake Editor");this.addRandomizeSection()}getDefaultConfig(){return this.contentToConfig(ii.getDefaultContent())}addInputs(){super.addInputs();let e=this.getOptions();Object.keys(this.config).forEach((t,s)=>{this.panel.addInput(this.config,t,{options:e}).on("change",this.onPieceTypeChange.bind(this,s))})}getOptions(){return[{text:"NONE",value:""},...this.getPieceTypes()]}getPieceTypes(){return Object.values(Se).map(e=>({text:Be(Se,t=>t===e),value:e}))}onPieceTypeChange(e){var t;this.ignoreConfigUpdates||(t=this.item)==null||t.setContent(this.configToContent(this.config))}addRandomizeSection(){this.randomizeConfig={colorsNum:5},this.panel.addSeparator(),this.panel.addInput(this.randomizeConfig,"colorsNum",{step:1,min:1,max:ii.getDefaultContent().length}),this.panel.addButton({title:"Randomize"}).on("click",this.onRandomizeButtonClick.bind(this))}onRandomizeButtonClick(){let e=this.getRandomContent(),t=this.contentToConfig(e);Object.assign(this.config,t),this.refresh()}getRandomContent(){let e=this.getEnabledCookieTypes(),t=Math.min(this.randomizeConfig.colorsNum,e.length),i=Phaser.Math.RND.shuffle(e).slice(0,t).map(n=>Cs[n]),a=ke(6,n=>i[Phaser.Math.Wrap(n,0,i.length)]);return Phaser.Math.RND.shuffle(a)}getEnabledCookieTypes(){let e=this.scene.levelConfig.generator;return Object.keys(e.weights).filter(t=>O.getItemSuperType(t)===c.COOKIE).filter(t=>e.weights[t]>0)}getEnabledCookieTypesNum(){return this.getEnabledCookieTypes().length}setItem(e){var t;super.setItem(e),(t=this.item)==null||t.on(ui.CONTENT_CHANGE,this.onCakeContentChange,this)}onCakeContentChange(e,t){this.ignoreConfigUpdates=!0,Object.assign(this.config,this.contentToConfig(t)),this.refresh(),this.ignoreConfigUpdates=!1}resetItem(){var e;(e=this.item)==null||e.off(ui.CONTENT_CHANGE,this.onCakeContentChange,this),super.resetItem()}getConfigFromItem(e){return this.contentToConfig(e.getContent())}contentToConfig(e){return e.reduce((t,s,i)=>(t[i]=s!=null?s:"",t),{})}configToContent(e){return Object.entries(e).map(([t,s])=>s===""?null:s)}},FS=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.levelConfig=this.scene.levelConfig,this.addPanelContainers(),this.addTutorialPanel(),this.addBoostersPanel(),this.addPregameBoostersPanel(),this.addPregameBoostersHintsPanel(),this.addMysteryBoxesPanel(),this.addItemPanels(),this.addConfigPanel(),this.addLayersPanel(),this.addGeneratorPanel(),this.addGoalsPanel(),this.addChefPowerupPanel()}addPanelContainers(){let e=this.scene.game.store.getNumber(g.EDITOR_ZOOM);this.leftPanels=this.getPanelsContainer("editor-panels-left"),this.leftPanels.style.visibility="visible",this.leftPanels.style.zoom=e.toString(),this.rightPanels=this.getPanelsContainer("editor-panels-right"),this.rightPanels.style.visibility="visible",this.rightPanels.style.zoom=e.toString()}getPanelsContainer(e){var t;return(t=document.getElementById(e))!=null?t:this.createPanelsContainer(e)}createPanelsContainer(e){let t=document.createElement("div");return t.id=e,t.classList.add("editor-panels"),this.scene.game.canvas.parentNode.insertBefore(t,this.scene.game.canvas.nextSibling),t}addTutorialPanel(){this.tutorialPanel=new BS(this.scene,this.leftPanels,this.levelConfig.tutorial),this.tutorialPanel.on(Ss.SHOW_TUTORIAL_AREA,this.showTutorialArea,this),this.tutorialPanel.on(Ss.HIDE_TUTORIAL_AREA,this.hideTutorialArea,this)}showTutorialArea(e){var t;(t=this.scene.getTutorialById(e))==null||t.revive()}hideTutorialArea(e){var t;(t=this.scene.getTutorialById(e))==null||t.kill()}addBoostersPanel(){this.boostersPanel=new AS(this.scene,this.leftPanels,this.levelConfig.boosters)}addPregameBoostersPanel(){this.pregameBoostersPanel=new xS(this.scene,this.leftPanels,this.levelConfig.preGameBoosters)}addPregameBoostersHintsPanel(){this.pregameBoostersHintsPanel=new kS(this.scene,this.leftPanels,this.levelConfig.preGameBoostersHints)}addMysteryBoxesPanel(){this.mysteryBoxesPanel=new NS(this.scene,this.leftPanels,this.levelConfig.mysteryBoxes)}addItemPanels(){let e=this.leftPanels;this.itemPanels={[c.COLOR_CAKE]:new GS(this.scene,e),[c.COOKIE]:new RS(this.scene,e),[c.GENERATOR]:new HS(this.scene,e)},Object.values(this.itemPanels).forEach(t=>t.hide())}addConfigPanel(){this.configPanel=new bS(this.scene,this.rightPanels,this.levelConfig),this.configPanel.bgInput.on("change",this.onBackgroundChange.bind(this))}onBackgroundChange(e){this.scene.events.emit(ve.BACKGROUND_CHANGE,e)}addLayersPanel(){this.layersPanel=new wS(this.scene,this.rightPanels,this.scene.layers),this.layersPanel.on(na.LAYER_UPDATE,this.onLayerVisibilityUpdate,this)}onLayerVisibilityUpdate(e,t){switch(e){case U.BASE_GRID:this.scene.grid.visible=t;break;case U.FIELD:this.scene.field.visible=t;break;case U.BOTTOM_ITEMS:case U.MAIN_ITEMS:case U.TOP_ITEMS:this.scene.items.setLayerVisibility(e,t);break;case U.TUTORIAL:this.scene.tutorialLayer.visible=t;break;default:break}}addGeneratorPanel(){this.generatorPanel=new PS(this.scene,this.rightPanels,this.levelConfig.generator),this.generatorPanel.on(ra.WEIGHT_CHANGE,this.onItemWeightChange,this)}onItemWeightChange(e,t){t>0||(this.updateCookiesOnWeightsChange(e),this.updateCakesOnWeightsChange())}updateCookiesOnWeightsChange(e){let t=this.getAllowedCookieTypes();this.scene.items.mainItems.filter(s=>s.itemSuperType===c.COOKIE&&s.itemType===e&&s.params.locked===!1).forEach(s=>{let i=Phaser.Math.RND.pick(t);s.updateItemType(i)})}updateCakesOnWeightsChange(){let e=this.getAllowedCookieTypes().map(t=>Cs[t]);this.scene.items.getCakes().forEach(t=>{let s=t.getContent(),i=ot(Tt(s.filter(Boolean),...e)),a=s.map(n=>n&&i.includes(n)?Phaser.Math.RND.pick(e):n);t.setContent(a)})}getAllowedCookieTypes(){return O.getSubtypes(c.COOKIE).filter(e=>this.levelConfig.generator.weights[e]>0)}addGoalsPanel(){this.goalsPanel=new LS(this.scene,this.rightPanels,this.levelConfig)}addChefPowerupPanel(){let e=this.levelConfig.chefPowerups,t=this.scene.game.levelConfigs.createDefaultChefPowerupsConfig();this.chefPowerupsPanel=new IS(this.scene,this.rightPanels,e,t)}enablePanels(){this.leftPanels.classList.remove("disable-panel-input"),this.rightPanels.classList.remove("disable-panel-input")}disablePanels(){this.leftPanels.classList.add("disable-panel-input"),this.rightPanels.classList.add("disable-panel-input")}changeZoom(e=1){let s=(parseFloat(this.rightPanels.style.zoom)||1)+Phaser.Math.Sign(e)*.1;s=Math.max(.2,s),this.leftPanels.style.zoom=s.toString(),this.rightPanels.style.zoom=s.toString(),this.scene.game.store.saveValue(g.EDITOR_ZOOM,s)}resetZoom(){let e=1;this.rightPanels.style.zoom=e.toString(),this.scene.game.store.saveValue(g.EDITOR_ZOOM,e)}destroy(){super.destroy(),this.leftPanels.style.visibility="hidden",this.rightPanels.style.visibility="hidden",this.tutorialPanel.destroy(),this.boostersPanel.destroy(),this.pregameBoostersPanel.destroy(),this.pregameBoostersHintsPanel.destroy(),this.mysteryBoxesPanel.destroy(),this.configPanel.destroy(),this.layersPanel.destroy(),this.generatorPanel.destroy(),this.goalsPanel.destroy(),this.chefPowerupsPanel.destroy(),this.destroyItemsPanels()}destroyItemsPanels(){Object.values(this.itemPanels).forEach(e=>e.destroy())}},sh=class extends Phaser.GameObjects.Image{constructor(e,t,s,i,a){super(e,0,0,t,s);this._isSelected=!1,this.name="grid_cell",this._column=i,this._row=a,this.alpha=.25,this.setInteractive()}get isSelected(){return this._isSelected}get row(){return this._row}set row(e){this._row=e}get column(){return this._column}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}destroy(){super.destroy()}},Q;(function(e){e.GRID_CELL="GRID_CELL",e.FIELD_CELL="FIELD_CELL",e.ITEM="ITEM",e.TUTORIAL="TUTORIAL"})(Q||(Q={}));var Fe;(function(e){e.ADD_ROW="add_row",e.REMOVE_ROW="remove_row",e.ADD_CELL="add_cell",e.REMOVE_CELL="remove_cell",e.HIGHLIGHT="highlight",e.UNHIGHLIGHT="unhighlight"})(Fe||(Fe={}));var US=class extends Phaser.GameObjects.Container{get columns(){return this._columns}get rows(){return this._rows}constructor(e,t,s){super(e);this.name="grid",this.editor=this.scene,this.rowLabels=[],this.removeRowButtons=[],this.initialColumns=t,this.initialRows=s,this._columns=t,this._rows=0,this.cells=new De(this.initialRows,this.initialColumns),this.addInitialRows(),this.addColumnLabels(),this.addAddRowButton(),this.updateSize()}updateSize(){this.setSize(this._columns*y,this._rows*y)}addInitialRows(){ke(this.initialRows,this.addRow.bind(this))}addRow(){this.addRowOfCells(this._rows),this.addRowLabel(this._rows),this.addRemoveRowButton(this._rows),this._rows++,this.emit(Fe.ADD_ROW,this,this._rows)}addRowOfCells(e){ke(this._columns,t=>{this.addCell(t,e)})}addCell(e,t){let s=new sh(this.scene,"editor","grid_cell",e,t);return ge(s),s.setData("type",Q.GRID_CELL),this.cells.add(s),this.add(s),this.emit(Fe.ADD_CELL,s),s}addColumnLabels(){ke(this._columns,e=>{let t=e.toString(),s=this.createLabel(t);return s.x=e*y+y/2,s.y=this._rows*y+y/2,s.setData("column",e),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onLabelPointerOver.bind(this,"column",e,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onLabelPointerOut.bind(this,"column",e,s)),this.add(s),s})}addRowLabel(e){let t=e.toString(),s=this.createLabel(t);return s.x=-y/2,s.y=y/2+e*y,s.setData("row",e),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onLabelPointerOver.bind(this,"row",e,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onLabelPointerOut.bind(this,"row",e,s)),this.rowLabels.push(s),s}createLabel(e){let t=new Phaser.Geom.Rectangle(-y/2+6,-y/2+17,y,y),s=this.scene.add.bitmapText(0,0,B.LEVEL_EDITOR_GRID,e,28);return s.setOrigin(.5,.5),s.setInteractive(t,Phaser.Geom.Rectangle.Contains),s.input.customHitArea=!0,this.add(s),s}onLabelPointerOver(e,t,s){this.emit(Fe.HIGHLIGHT,e,t)}onLabelPointerOut(e,t,s){this.emit(Fe.UNHIGHLIGHT,e,t)}addRemoveRowButton(e){let t=this.scene.add.button("editor","remove_row_button",this);t.on(_.RELEASE,this.onRemoveRowButtonClick,this),t.setData("row",e),t.x=this.getWidth()+t.displayWidth/2+10,t.y=-e*y-y/2,this.removeRowButtons.push(t),t.kill()}onRemoveRowButtonClick(e){let t=3;if(this._rows<=t){""+t;return}let s=e.getData("row");this.removeRow(s)}removeRow(e){this.removeCellsByRow(e),this.removeRowLabel(e),this.removeRemoveRowButton(e),this.updateRowsAbove(e),this._rows--,this.alignAddRowButton(),this.emit(Fe.REMOVE_ROW,e)}removeCellsByRow(e){this.cells.filter(s=>s.row===e).forEach(s=>{s.destroy(),this.cells.remove(s),this.emit(Fe.REMOVE_CELL,s)})}removeRowLabel(e){let t=this.rowLabels.findIndex(s=>s.getData("row")===e);t!==-1&&(this.rowLabels[t].destroy(),this.rowLabels.splice(t,1))}removeRemoveRowButton(e){let t=this.removeRowButtons.findIndex(s=>s.getData("row")===e);t!==-1&&(this.removeRowButtons[t].destroy(),this.removeRowButtons.splice(t,1))}addAddRowButton(){this.addRowButton=this.scene.add.button("editor","add_row_button",this),this.addRowButton.on(_.RELEASE,this.onAddRowClick,this),this.alignAddRowButton(),this.addRowButton.kill()}alignAddRowButton(){this.addRowButton.x=this.getWidth()/2,this.addRowButton.y=-y/2-this._rows*y}onAddRowClick(e,t){let s=t.event.shiftKey?5:1;for(let i=0;i<s;i++)this.addRow(),this.alignAddRowButton()}getWidth(){return this._columns*y}getCellAt(e,t){return this.cells.getAt(e,t)}updateRowsAbove(e){this.cells.filter(t=>t.row>e).forEach(t=>{t.row--,t.y=this.getYByRow(t.row)}),this.rowLabels.filter(t=>t.getData("row")>e).forEach(t=>{let s=t.getData("row")-1;t.setData("row",s),t.y=this.getYByRow(s),t.text=s.toString()}),this.removeRowButtons.filter(t=>t.getData("row")>e).forEach(t=>{let s=t.getData("row")-1;t.setData("row",s),t.y=this.getYByRow(s)})}getYByRow(e){return-y/2-e*y}},ih=class extends Phaser.GameObjects.Image{get isSelected(){return this._isSelected}constructor(e,t,s){super(e,0,0,"editor","field_cell_center");this.name=`field_cell_${t}x${s}`,this.column=t,this.row=s,this.setInteractive()}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}destroy(){super.destroy()}},pi;(function(e){e.ADD_CELL="Field_ADD_CELL",e.REMOVE_CELL="Field_REMOVE_CELL"})(pi||(pi={}));var WS=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="field",this.cells=new De(t,s),this.corners=[]}addCell(e,t){if(this.cells.checkAt(e,t))return;let s=this.doAddCell(e,t);return this.updateCells(),this.updateCorners(),s}doAddCell(e,t){let s=new ih(this.scene,e,t);return ge(s),s.once(Phaser.GameObjects.Events.DESTROY,this.onCellDestroy,this),s.setData("type",Q.FIELD_CELL),this.cells.add(s),this.add(s),this.emit(pi.ADD_CELL,s),s}onCellDestroy(e){this.cells.remove(e),this.updateCells(),this.updateCorners()}updateCells(){this.cells.forEach(e=>{let t=this.cells.getOrthoNeighborsAt(e.column,e.row),s=Object.values(t).filter(Boolean).length,i="field_cell_center";s===0?i="field_cell_alone":s===1?t.top?i="field_cell_bottom":t.right?i="field_cell_left":t.bottom?i="field_cell_top":i="field_cell_right":s===2&&(t.right&&t.bottom?i="field_cell_top_left":t.left&&t.bottom?i="field_cell_top_right":t.top&&t.left?i="field_cell_bottom_right":t.top&&t.right&&(i="field_cell_bottom_left")),e.setFrame(i)})}updateCorners(){this.corners.forEach(e=>e.destroy()),this.cells.forEach(e=>{let t=this.cells.getNeighborsAt(e.column,e.row),{column:s,row:i}=e;t.bottom&&t.right&&!t.bottomRight&&this.addCorner(s+1,i+1,"corner_top_left"),t.bottom&&t.left&&!t.bottomLeft&&this.addCorner(s-1,i+1,"corner_top_right"),t.top&&t.right&&!t.topRight&&this.addCorner(s+1,i-1,"corner_bottom_left"),t.top&&t.left&&!t.topLeft&&this.addCorner(s-1,i-1,"corner_bottom_right")})}addCorner(e,t,s){let i=this.scene.add.image(0,0,"editor",s);i.x=y/2+e*y,i.y=y/2+t*y,this.corners.push(i),this.add(i)}getCellAt(e,t){return this.cells.getAt(e,t)}fillFromConfig(e){e.forEach(t=>{this.addCell(t.column,t.row)})}},ah=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,"editor",i!=null?i:"grid_cell_select");this.column=t,this.row=s}destroy(){super.destroy()}},$t;(function(e){e.SELECT="SelectionManager_SELECT",e.UNSELECT="SelectionManager_UNSELECT",e.UNSELECT_ALL="SelectionManager_UNSELECT_ALL"})($t||($t={}));var YS=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.lastSelected=null,this.selectionType=null,this.name="select_frames",this.selectables=[],this.selectableTypes=[Q.GRID_CELL,Q.FIELD_CELL,Q.ITEM,Q.TUTORIAL]}addSelectable(e){(Array.isArray(e)?e:[e]).forEach(s=>{s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onItemPointerOver.bind(this,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onItemPointerOut.bind(this,s)),s.on(K.SELECT,this.onItemSelect,this),s.on(K.UNSELECT,this.onItemUnselect,this),s.once(Phaser.GameObjects.Events.DESTROY,this.onItemDestroy,this),this.selectables.push(s)})}onItemPointerOver(e,t){var s;let i=this.getSelectFrameAt(e.column,e.row);if(!(i==null?void 0:i.visible)&&((s=this.getOverFrameAt(e.column,e.row))==null||s.revive(),t.isDown)){let a=e.getData("type");this.selectionType===null&&(this.selectionType=a),a===this.selectionType&&e.select()}}onItemPointerOut(e,t){var s;let i=this.getSelectFrameAt(e.column,e.row);(i==null?void 0:i.visible)||(s=this.getOverFrameAt(e.column,e.row))==null||s.kill()}onItemSelect(e){var t,s;(t=this.getSelectFrameAt(e.column,e.row))==null||t.revive(),(s=this.getOverFrameAt(e.column,e.row))==null||s.kill(),this.emit($t.SELECT,e),this.lastSelected=e}onItemUnselect(e){var t;(t=this.getSelectFrameAt(e.column,e.row))==null||t.kill(),this.emit($t.UNSELECT,e),this.lastSelected===e&&(this.lastSelected=null)}onItemDestroy(e){e.off(K.SELECT,this.onItemSelect,this),e.off(K.UNSELECT,this.onItemUnselect,this),this.onItemUnselect(e),hs(this.selectables,e)}removeSelectable(e){hs(this.selectables,e)}getSelectedItems(){return this.selectables.filter(e=>e.isSelected)}unselectAll(){this.selectables.forEach(e=>{e.isSelected&&e.unselect()}),this.emit($t.UNSELECT_ALL,this),this.lastSelected=null,this.selectionType=null}getFrameAt(e,t,s){return e.find(i=>i.column===t&&i.row===s)}getOverFrameAt(e,t){return this.getFrameAt(this.overFrames,e,t)}getSelectFrameAt(e,t){return this.selectFrames.find(s=>s.column===e&&s.row===t)}addFrames(e){this.addOverFrames(e),this.addSelectFrames(e)}addOverFrames(e){this.overFrames=e.cells.toArray().map(t=>{let s=new ah(this.scene,t.column,t.row,"over_frame");return s.x=y/2+t.column*y,s.y=y/2+t.row*y,s.kill(),s}),this.add(this.overFrames)}addSelectFrames(e){this.selectFrames=e.cells.toArray().map(t=>{let s=new ah(this.scene,t.column,t.row);return ge(s),s.kill(),s}),this.add(this.selectFrames)}handleClick(e,t){let s=t[0];if(!s){this.unselectAll();return}let i=s.getData("type");if(!this.selectableTypes.includes(i))return;let n=s;if(this.selectionType!==null&&i!==this.selectionType&&this.unselectAll(),e.event.ctrlKey){this.onCtrlSelect(n,i);return}if(e.event.shiftKey){this.onShiftSelect(n,i);return}this.unselectAll(),this.selectionType=i,n.select()}onCtrlSelect(e,t){e.isSelected?e.unselect():(this.selectionType=t,e.select())}onShiftSelect(e,t){var s;let i=this.getArrayForSelectedItem(e);if(!i)return;let a=this.getSelectedItems();if(a.length===0){this.selectionType=t,e.select();return}let n=an(a);n.left>e.column?(n.right=n.left,n.left=e.column):n.right=e.column,n.top>e.row?(n.bottom=n.top,n.top=e.row):n.bottom=e.row,i.forEach(r=>r.unselect()),this.selectionType=t;for(let r=n.top;r<=n.bottom;r++)for(let o=n.left;o<=n.right;o++)(s=i.getAt(o,r))==null||s.select()}getArrayForSelectedItem(e){return e instanceof sh?this.scene.grid.cells:e instanceof ih?this.scene.field.cells:this.scene.items.getArrayByItemSuperType(e.itemSuperType)}highlightColumn(e){this.overFrames.filter(t=>t.column===e).forEach(t=>t.revive())}unhighlightColumn(e){this.overFrames.filter(t=>t.column===e).forEach(t=>t.kill())}highlightRow(e){this.overFrames.filter(t=>t.row===e).forEach(t=>t.revive())}unhighlightRow(e){this.overFrames.filter(t=>t.row===e).forEach(t=>t.kill())}},VS=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.name=i,this.itemType=i,this.addBack(t),this.addIcon(s),this.setSize(this.back.width,this.back.height),this.setInteractive(),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onPointerOver,this),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onPointerOut,this)}addBack(e){let t="editor_item_back";this.scene.textures.exists(t)===!1&&this.createBackTexture(t,e),this.back=this.scene.add.image(0,0,t),this.back.alpha=.33,this.back.kill(),this.add(this.back)}createBackTexture(e,t){let s=this.scene.make.graphics();s.fillStyle(16777215),s.fillRoundedRect(0,0,t,t,20),s.generateTexture(e,t,t),s.destroy()}addIcon(e){let t=this.back.width*.9,s=this.back.height*.9;this.icon=this.scene.add.image(0,0,e,O.getFrameByItemType(this.itemType)),this.icon.scale=Math.min(1,t/this.icon.width,s/this.icon.height),this.add(this.icon)}onPointerOver(){this.back.revive()}onPointerOut(){this.back.kill()}},KS=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.cellSize=100,this.lineHeight=100,this.name="item_icons",this.atlas=t,this.icons=[],this.addIconLines(s)}addIconLines(e){let t=e.map((s,i)=>{let a=this.createIconsLine(s);return a.y=i*this.lineHeight,a});this.add(t)}createIconsLine(e){let t=e.map((s,i)=>{if(s===null)return null;let a=new VS(this.scene,this.cellSize,this.atlas,s);return a.x=this.cellSize/2+i*this.cellSize,a.y=this.cellSize/2,this.icons.push(a),a});return this.scene.add.container(0,0,t.filter(Boolean))}},oa;(function(e){e.ITEM_CLICK="AddItemPopover_ITEM_CLICK"})(oa||(oa={}));var zS=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.backAlpha=.87,this.name="add_item_popover",this.addBack(),this.addTip(),this.addIcons(t,s),this.alignIcons(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"editor","items_popover_back"),this.back.setOrigin(.5,1),this.back.setDisplaySize(this.back.displayWidth+40,this.back.displayHeight+80),this.back.alpha=this.backAlpha,this.back.setInteractive(),this.add(this.back)}addTip(){this.tip=this.scene.add.image(0,0,"editor","items_popover_tip"),this.tip.y=this.back.bottom,this.tip.alpha=this.backAlpha,this.add(this.tip)}addIcons(e,t){this.icons=new KS(this.scene,e,t),this.icons.icons.forEach(s=>s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onIconClick.bind(this,s))),this.add(this.icons)}onIconClick(e){this.emit(oa.ITEM_CLICK,e.itemType)}alignIcons(){this.icons.setScale(1);let e=this.icons.getBounds(),t=e.width,s=e.height,i=this.back.displayWidth*.95,a=this.back.displayHeight*.9,n=i/t,r=a/s,o=Math.min(1,n,r);this.icons.scale=o;let l=this.back.getTopLeft();this.icons.x=l.x+(this.back.displayWidth-e.width*o)/2,this.icons.y=l.y+(this.back.displayHeight-e.height*o)/2}show(){this.revive(),this.alpha=0,this.scale=.75,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,scale:1,alpha:1})}hide(){this.kill()}setTipOffset(e){this.tip.x=e}},jS=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.backAlpha=.87,this.name="modifiers_popover",this.addBack(),this.addTip(),this.addButtons(),this.alignButtons(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"editor","items_popover_back"),this.back.setOrigin(.5,1),this.back.alpha=this.backAlpha,this.back.setInteractive(),this.back.setDisplaySize(450,100),this.add(this.back)}addTip(){this.tip=this.scene.add.image(0,0,"editor","items_popover_tip"),this.tip.y=this.back.bottom,this.tip.alpha=this.backAlpha,this.add(this.tip)}addButtons(){this.horizontalStripes=this.scene.add.button("editor","item_mod_horizontal_stripes"),this.horizontalStripes.setData("mod",T.HORIZONTAL_STRIPES),this.verticalStripes=this.scene.add.button("editor","item_mod_vertical_stripes"),this.verticalStripes.setData("mod",T.VERTICAL_STRIPES),this.bomb=this.scene.add.button("editor","item_mod_bomb"),this.bomb.setData("mod",T.BOMB),this.superSphere=this.scene.add.button("editor","item_mod_super"),this.superSphere.setData("mod",T.SUPER_SPHERE),this.clear=this.scene.add.button("editor","item_mod_clear");let e=70,t=[this.horizontalStripes,this.verticalStripes,this.bomb,this.superSphere,this.clear];this.buttonsContainer=this.scene.add.container(0,0,t),this.buttonsContainer.gridAlign({width:t.length,cellWidth:e,x:e/2,y:e/2}),t.forEach(s=>{s.setData("originalY",s.y),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onButtonOver.bind(this,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onButtonOut.bind(this,s))}),this.add(this.buttonsContainer)}onButtonOver(e){e.y=e.getData("originalY")-7}onButtonOut(e){e.y=e.getData("originalY")}alignButtons(){let e=this.buttonsContainer.getBounds();this.buttonsContainer.x=-e.width/2,this.buttonsContainer.y=this.back.getCenter().y-e.height/2}show(){this.revive(),this.alpha=0,this.scale=.75,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,scale:1,alpha:1})}hide(){this.kill()}setTipOffset(e){this.tip.x=e}},Os;(function(e){e.ADD_ITEM="ItemsContainer_ADD_ITEM",e.REMOVE_ITEM="ItemsContainer_REMOVE_ITEM"})(Os||(Os={}));var XS=class extends Phaser.GameObjects.Container{constructor(e,t,s,i){super(e);this.name="items",this.layersVisibility=i,this.bottomItems=new De(t,s),this.mainItems=new De(t,s),this.topItems=new De(t,s)}getArrayByItemSuperType(e){switch(e){case c.BISCUIT:return this.bottomItems;case c.LICORICE:case c.GUMMY_BLOCKER:return this.topItems;default:return this.mainItems}}addItem(e,t,s,i){let a=O.getItemSuperType(s),n=this.getArrayByItemSuperType(a);if(n.checkAt(e,t)){""+e+t;return}let o=this.scene.factory.create({column:e,row:t,itemType:s,params:i});if(!!o)return o.column=e,o.row=t,o.setData("type",Q.ITEM),o.setDepth(this.getDepthByItemSuperType(a)),o.setVisible(this.layersVisibility[o.depth]),o.once(Phaser.GameObjects.Events.DESTROY,this.onItemDestroy,this),this.addToGridArray(n,o),this.alignItem(o),this.add(o),this.sort("depth",this.sortChildren.bind(this)),this.emit(Os.ADD_ITEM,o),o}addToGridArray(e,t){t.isMultiCell?ae.addToArray(e,t):e.add(t)}alignItem(e){if(typeof e.alignToGrid=="function"){e.alignToGrid();return}ae.isMulticell(e.itemType)?tn(e):ge(e,e.column,e.row)}getDepthByItemSuperType(e){return{[c.BISCUIT]:U.BOTTOM_ITEMS,[c.LICORICE]:U.TOP_ITEMS,[c.GUMMY_BLOCKER]:U.TOP_ITEMS,[c.GENERATOR]:U.GENERATORS}[e]||U.MAIN_ITEMS}onItemDestroy(e){this.removeItemFromGridArray(e),this.emit(Os.REMOVE_ITEM,e)}removeItemFromGridArray(e){let t=this.getArrayByItemSuperType(e.itemSuperType);e.isMultiCell?ae.removeFromArray(t,e):t.remove(e)}getArrayByDepth(e){switch(e){case U.BOTTOM_ITEMS:return this.bottomItems;case U.MAIN_ITEMS:return this.mainItems;case U.TOP_ITEMS:return this.topItems;default:return null}}setLayerVisibility(e,t){var s;(s=this.getArrayByDepth(e))==null||s.forEach(i=>i.visible=t)}getMatchableItems(){let e=this.mainItems.filter(s=>s.itemSuperType===c.COOKIE);return to(e,"row","column")}fillFromConfig(e){e.forEach(t=>{let s=this.addItem(t.column,t.row,t.itemType,t.params);s.itemSuperType===c.COOKIE&&(s.setFrame(G.getFrame(s.itemType,s.params.powerup)),t.params.locked&&this.lockCookie(s))})}sortChildren(e,t){return e.depth===t.depth?e.row-t.row>0:e.depth-t.depth>0}lockCookie(e){e.lock||(e.params.locked=!0,e.lock=this.createCookieLock(e))}unlockCookie(e){!e.lock||(e.lock.destroy(),e.lock=null,e.params.locked=!1)}createCookieLock(e){let t=this.scene.add.image(0,0,"editor","lock_icon");return t.x=e.x+25,t.y=e.y-25,t.setDepth(U.LOCKS),this.add(t),t}getCookies(){return this.mainItems.filter(e=>e.itemSuperType===c.COOKIE)}getCakes(){return ot(this.mainItems.filter(e=>e.itemSuperType===c.COLOR_CAKE))}},nh=class{static validate(e,t){let{items:s,goals:i}=e,a=this.getEnabledCookieTypes(e.generator),n=this.getItemTypesFromGenerators(s.filter(H=>H.itemType===h.GENERATOR),a),r=this.getItemTypesFromMysteryBoxes(e.mysteryBoxes,a),o=[],l=Object.values(i).filter(H=>H>0).length;l===0&&o.push("Please set some goals.");let d=4;l>d&&o.push(`Too much goals (${l}). Max number of goals is ${d}.`),[C.BISCUIT,C.MARSHMALLOW,C.DONUT,C.CHOCOLATE,C.DROP_ITEM,C.CHICK,C.GUMMY].forEach(H=>{let re=i[H];if(re<=0)return;let le=ut.getItemTypes(H),we=s.filter(z=>le.includes(z.itemType)).length;if(we<re){let z=le.some(gt=>n.includes(gt)),Pe=le.some(gt=>r.includes(gt));!z&&!Pe&&o.push(`Not enough ${H}(s)! Add ${re-we} more. ${we}/${re}`)}});let S=i.APPLE;if(S>0){let re=s.filter(le=>le.itemType===h.APPLES_PLATTER).length*9;re!==S&&o.push(`Invalid APPLES amount! ${re}/${S}`)}i.CANDY>0&&s.filter(re=>re.itemType===h.CANDY_BOTTLE).length===0&&e.mysteryBoxes.CANDY_BOTTLE===0&&o.push("There are no candy bottles! Add the bottles or remove candies from the goals.");let x=s.filter(H=>H.itemType===h.COLOR_CAKE);if(x.length>0){let H=x.flatMap(z=>z.params.content.map(Pe=>Pe));H=ot(H.filter(Boolean));let re=H.map(z=>Be(Cs,Pe=>Pe===z)),le=Object.keys(e.generator.weights).filter(z=>e.generator.weights[z]>0),we=Tt(re,...le);we.length>0&&o.push(`Next cookie types should be enabled for color cake: ${we.join(", ")}`),x.forEach(z=>{z.params.content.filter(Boolean).length===0&&o.push(`Cake at {x: ${z.column}, y: ${z.row}} is EMPTY!`)})}let X=e.tutorial;X.autoGenerated===!1&&X.steps.forEach((H,re)=>{H.type===L.MATCH&&H.cells.length===0&&o.push(`Please specify cells for tutorial step #${re+1} (areaId = ${H.areaId})`)});let Z=e.newElement;if(Z!=="none"){let re=t.map(le=>({levelNumber:le.levelNumber,newElement:le.newElement})).filter(le=>le.newElement!=="none"&&le.levelNumber!==e.levelNumber).find(le=>le.newElement===Z);re&&o.push(`The new element (${Z}) is introduced on level ${re.levelNumber}! You shouldn't introduce the same new element twice!`)}let he=e.mysteryBoxes;if(s.some(H=>H.itemType===h.MYSTERY_BOX)&&Object.values(he).every(re=>re===0)&&o.push("Invalid mystery boxes config. All values are equal zero!"),e.newItemsTypes){let H=ap(()=>JSON.parse(e.newItemsTypes));(hr(H)||this.areNewItemsTypesValid(H)===!1)&&o.push(`Invalid value for "newItemsTypes"! ${e.newItemsTypes}`)}return{success:o.length===0,messages:o}}static getEnabledCookieTypes(e){let t=O.getSubtypes(c.COOKIE);return Object.keys(e.weights).filter(s=>t.includes(s)).filter(s=>e.weights[s]>0)}static doGeneratorContains(e,t,...s){let i=this.getGeneratorItemTypes(e,t);return s.some(a=>i.includes(a))}static doMysteryBoxContains(e,t,...s){let i=this.getMysteryBoxItemTypes(e,t);return s.some(a=>i.includes(a))}static getItemTypesFromGenerators(e,t){return e.flatMap(s=>{let i=s.params;return this.getGeneratorItemTypes(i.content,t)})}static getGeneratorItemTypes(e,t){switch(e){case V.RANDOM_COOKIE:return t;case V.MARSHMALLOW:return[h.MARSHMALLOW_COMMON];case V.CHICK:return[h.CHICK];case V.DROP_ITEM:return[h.DROP_ITEM];default:return[Lt.convertContentToCookieType(e)]}}static getItemTypesFromMysteryBoxes(e,t){return Object.keys(e).filter(s=>e[s]>0).flatMap(s=>this.getMysteryBoxItemTypes(s,t))}static getMysteryBoxItemTypes(e,t){switch(e){case h.MARSHMALLOW_COMMON:return[h.MARSHMALLOW_COMMON];case h.MARSHMALLOW_DOUBLE:return[h.MARSHMALLOW_DOUBLE];case"MARSHMALLOW_COLORED":return[h.MARSHMALLOW_PURPLE,h.MARSHMALLOW_ORANGE,h.MARSHMALLOW_BLUE,h.MARSHMALLOW_RED,h.MARSHMALLOW_PINK,h.MARSHMALLOW_YELLOW];case h.CHOCOLATE_COMMON:return[h.CHOCOLATE_COMMON];case h.CANDY_BOTTLE:return[h.CANDY_BOTTLE];case h.DONUT_BOX:return[h.DONUT_BOX];default:return t}}static areNewItemsTypesValid(e){let t=O.getAllTypes();return Object.values(e).every(s=>t.includes(s))}},$S={[W.STRIPES]:{goalTypes:[C.GUMMY,C.CHICK],itemSuperTypes:[c.GUMMY,c.CHICK]},[W.BOMB]:{goalTypes:[C.GUMMY,C.CHICK],itemSuperTypes:[c.GUMMY,c.CHICK]},[W.SUPER_SPHERE]:{goalTypes:[C.COOKIE_RED,C.COOKIE_BLUE,C.COOKIE_ORANGE,C.COOKIE_PURPLE,C.COOKIE_PINK,C.COOKIE_YELLOW],itemSuperTypes:[]}};function qS(e,t){let s=ot(e.map(a=>O.getItemSuperType(a.itemType))),i=Object.keys(t).filter(a=>t[a]>0);return Object.entries($S).filter(([a,{goalTypes:n,itemSuperTypes:r}])=>Qr(i,n).length>0||Qr(s,r).length>0).reduce((a,[n,r])=>(a[n]=!0,a),{})}var QS=class{constructor(e){this.scene=e,this.configsManager=this.scene.game.levelConfigs,this.config=this.scene.levelConfig}saveAs(){let e=this.configsManager.getLevelNumbers(),t=Math.max(...e)+1||1,s=prompt("Enter level number",t.toString()),i=parseInt(s);if(isNaN(i))return;if(e.includes(i)){""+i;return}this.config=ns(this.config),this.config.levelNumber=i,this.configsManager.add(this.config),this.save().then(()=>{this.scene.events.emit(ve.CHANGE_LEVEL,i)}).catch(n=>{})}save(){this.updateLevelConfig();let e=nh.validate(this.config,this.scene.game.levelConfigs.getAll());return e.success===!1?(e.messages.forEach(t=>console.warn(t)),Promise.reject("Invalid config!")):(this.scene.gui.bottomBar.saveButton.disableInput(),this.scene.editorPanels.disablePanels(),""+this.config.levelNumber,Promise.allSettled([this.configsManager.saveLocally()]).then(()=>{}).catch(t=>{}).finally(()=>{this.scene.gui.bottomBar.saveButton.enableInput(),this.scene.editorPanels.enablePanels()}))}fixExistingMatchesAndDeadlock(){let e,t=1e3,s=this.scene.items.getMatchableItems(),i=this.getItemTypes();do e=Ee.findAll(s),e.forEach(a=>{for(let n=0;n<a.items.length;n++){let r=a.items[n],o=r.itemType,l=Phaser.Math.RND.pickExcept(i,r.itemType);if(r.updateItemType(l),Ee.findAll(s).length===e.length)r.updateItemType(o);else break}});while(e.length>0&&--t>0)}getItemTypes(){return Object.keys(this.config.generator.weights).filter(e=>{let t=O.getItemSuperType(e)===c.COOKIE,s=this.config.generator.weights[e]>0;return t&&s})}remove(){return this.scene.editorPanels.disablePanels(),this.scene.gui.bottomBar.disableInput(),this.configsManager.remove(this.config.levelNumber),this.configsManager.saveLocally().then(()=>{""+this.config.levelNumber}).catch(e=>{""+this.config.levelNumber}).finally(()=>{this.scene.editorPanels.enablePanels(),this.scene.gui.bottomBar.enableInput()})}removeAndShift(){return this.scene.editorPanels.disablePanels(),this.scene.gui.bottomBar.disableInput(),this.configsManager.removeAndShift(this.config.levelNumber),this.configsManager.saveLocally().then(()=>{""+this.config.levelNumber}).catch(e=>{""+this.config.levelNumber}).finally(()=>{this.scene.editorPanels.enablePanels(),this.scene.gui.bottomBar.enableInput()})}swapWith(e){let t=this.scene.game.levelConfigs,s=this.config.levelNumber,i=e,a=t.get(s),n=t.get(i);return!a||!n?Promise.reject("These levels don't exist!"):(this.scene.editorPanels.disablePanels(),this.scene.gui.topBar.disableInput(),this.scene.gui.bottomBar.disableInput(),t.remove(s),t.remove(i),a.levelNumber=i,t.add(a),n.levelNumber=s,t.add(n),this.configsManager.saveLocally().then(()=>{""+s+i}).catch(r=>{""+s+i}).finally(()=>{this.scene.editorPanels.enablePanels(),this.scene.gui.topBar.enableInput(),this.scene.gui.bottomBar.enableInput()}))}updateLevelConfig(){let e=this.getItemsConfig(),t=rS(e,this.scene.createCookieTypesGenerator(),100,Phaser.Math.RND);t.hasDeadlock,t.hasMatches,!t.hasMatches&&!t.hasDeadlock&&t.wasChanged,this.updateExistingCookies(t.items),this.suggestPregameBoostersHints(this.config.items,this.config.goals),this.config.grid={columns:this.scene.grid.columns,rows:this.scene.grid.rows},this.config.field=this.getFieldConfig(),this.config.tutorial=this.getTutorialConfig(),this.config.items=t.items}getItemsConfig(){let e=this.scene.items,t=e.bottomItems.toArrayUniq().slice(0),s=e.mainItems.toArrayUniq().slice(0),i=e.topItems.toArray().slice(0);return[...t,...s,...i].sort(Ui).map(n=>({column:n.column,row:n.row,itemType:n.itemType,params:n.params}))}getFieldConfig(){return this.scene.field.cells.toArray().slice(0).sort(Ui).map(e=>({column:e.column,row:e.row}))}suggestPregameBoostersHints(e,t){let s=Object.keys(qS(e,t)),i=Object.keys(this.config.preGameBoostersHints).filter(n=>this.config.preGameBoostersHints[n]),a=Tt(s,...i);a.length>0&&a.join(", ")}getTutorialConfig(){return this.config.tutorial.autoGenerated=this.config.tutorial.steps.length===0,this.config.tutorial.steps.forEach(e=>{if(e.type===L.MATCH){let t=this.scene.getTutorialById(e.areaId);t&&(e.cells=t.cells.slice(0))}}),this.config.tutorial}updateExistingCookies(e){let t=pn(e),s=this.scene.items.getCookies();t.forEach(i=>{let{column:a,row:n,itemType:r}=i,o=s.find(d=>d.column===a&&d.row===n);if(o.itemType===r)return;o.updateItemType(r);let l=o.params.powerup;l&&o.setFrame(G.getFrame(o.itemType,l))})}},bs=class extends ls{constructor(e,t,s,i){super(e,t,s,i);this.defaultAlpha=.75,this.alpha=this.defaultAlpha,this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onPointerOver,this),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onPointerOut,this)}onPointerOver(){this.alpha=1}onPointerOut(){this.alpha=this.defaultAlpha}enableInput(){super.enableInput(),this.alpha=this.defaultAlpha}disableInput(){super.disableInput(),this.alpha=.33}},ZS=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.slotSize=46,this.name="float_buttons",this.addButtons(),this.gridAlign({width:this.list.length,cellWidth:this.slotSize,position:Phaser.Display.Align.CENTER,x:this.slotSize/2}),this.setSize(this.list.length*this.slotSize,this.removeButton.height)}addButtons(){this.removeButton=new bs(this.scene,"editor","small_button_remove",this),this.fillButton=new bs(this.scene,"editor","small_button_fill",this),this.addButton=new bs(this.scene,"editor","small_button_add",this),this.modsButton=new bs(this.scene,"editor","small_button_edit",this),this.lockButton=new bs(this.scene,"editor","small_button_lock",this),this.tutorialButton=new bs(this.scene,"editor","small_button_tutorial",this)}show(){var e;this.revive(),(e=this.hideTween)==null||e.remove(),this.alpha=1}hide(){this.hideTween=this.scene.tweens.add({delay:50,targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}enableAllButtons(){this.iterate(e=>{e.enableInput()})}updateViewBySelection(e){switch(e.getData("type")){case Q.GRID_CELL:this.removeButton.disableInput(),this.fillButton.enableInput(),this.addButton.enableInput(),this.modsButton.disableInput(),this.lockButton.disableInput(),this.tutorialButton.enableInput();break;case Q.FIELD_CELL:this.removeButton.enableInput(),this.fillButton.enableInput(),this.addButton.enableInput(),this.modsButton.disableInput(),this.lockButton.disableInput(),this.tutorialButton.enableInput();break;case Q.ITEM:let s=e;this.removeButton.enableInput(),this.fillButton.disableInput(),this.addButton.enableInput(),this.tutorialButton.enableInput(),s.itemSuperType===c.COOKIE?(this.modsButton.enableInput(),this.lockButton.enableInput()):(this.modsButton.disableInput(),this.lockButton.disableInput());break;case Q.TUTORIAL:this.removeButton.enableInput(),this.fillButton.disableInput(),this.addButton.disableInput(),this.modsButton.disableInput(),this.lockButton.disableInput(),this.tutorialButton.disableInput();break;default:this.enableAllButtons();break}}},JS=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.column=0,this.row=0,this._isSelected=!1,this.id=t,this.name=`tutorial_${this.id}`,this.cells=s,this.setData("type",Q.TUTORIAL),this.calculateGridBounds(),this.addGraphics(),this.addIdText(),this.fillCells(),this.setSize(y,y),this.setInteractive(),this.input.cursor="pointer"}get isSelected(){return this._isSelected}calculateGridBounds(){let e=Gt(this.cells,"row").row,t=ze(this.cells,"row").row,s=Gt(this.cells,"column").column,i=ze(this.cells,"column").column;this.column=s,this.row=e,this.gridBounds={column:s,row:e,width:i-s+1,height:t-e+1}}addGraphics(){this.graphics=this.scene.add.graphics(),this.graphics.fillStyle(0,.8),this.graphics.x=-y/2,this.graphics.y=-y/2,this.add(this.graphics)}addIdText(){let e=this.id.toString(),t={fontFamily:"monospace",fontStyle:p.DEFAULT_WEIGHT,fontSize:"22px",color:"#ffffff",align:"center"};this.idText=this.scene.add.text(0,0,e,t),this.idText.setStroke("#000000",12),this.idText.setOrigin(.5,.5),this.add(this.idText)}fillCells(){let e=this.gridBounds.column,t=this.gridBounds.row;this.cells.forEach(s=>{let i=s.column-e,a=s.row-t;this.graphics.fillRect(i*y,a*y,y,y)})}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}alignToGrid(){let{x:e,y:t}=j(this.gridBounds.column,this.gridBounds.row);this.x=e,this.y=t}},e0=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,"gameplay",O.getFrameByItemType(t));this.itemSuperType=c.GUMMY,this._isSelected=!1,this.name="gummy",this.id=Phaser.Math.RND.uuid(),this.itemType=t,this.params=s,this.setData("itemType",this.itemType),this.setData("itemSuperType",this.itemSuperType),this.setMulticell(),this.setSize(this.itemWidth*y,this.itemHeight*y),this.setInteractive()}get isSelected(){return this._isSelected}setMulticell(){if(this.isMultiCell=ae.isMulticell(this.itemType),this.isMultiCell){let e=ae.getSize(this.itemType);this.itemWidth=e.width,this.itemHeight=e.height}}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}alignToGrid(){let e=j(this.column,this.row),t=e.y-y/2,s=e.x-y/2;this.x=s+this.width/2,this.y=t+this.height/2}},vn;(function(e){e.APPLES_NUM_CHANGE="__APPLES_NUM_CHANGE"})(vn||(vn={}));var rh=class extends Phaser.GameObjects.Container{constructor(e,t){super(e,0,0);this.itemType=h.APPLES_PLATTER,this.itemSuperType=c.APPLE_PLATTER,this._isSelected=!1,this.id=Phaser.Math.RND.uuid(),this.name=`apple_platter__${this.id}`,this.params=t,this.setData("itemType",this.itemType),this.setData("itemSuperType",this.itemSuperType),this.setMulticell(),this.addPlatterBack(),this.addApples(this.params.applesNum),this.alignApples(),this.addPlatterFrontEdge(),this.setSize(this.itemWidth*y,this.itemHeight*y),this.setInteractive()}get isSelected(){return this._isSelected}setMulticell(){if(this.isMultiCell=ae.isMulticell(this.itemType),this.isMultiCell){let e=ae.getSize(this.itemType);this.itemWidth=e.width,this.itemHeight=e.height}}addPlatterBack(){this.platterBack=this.scene.add.image(0,0,"gameplay",O.getFrameByItemType(this.itemType)),this.add(this.platterBack)}addApples(e){this.apples=ke(e,()=>this.scene.make.image({key:"gameplay",frame:"apples_platter/apple"})),this.add(this.apples)}alignApples(){let e=this.getApplePositions();this.apples.forEach((t,s)=>{let i=e[s];t.x=i.x,t.y=i.y,this.bringToTop(t)}),this.apples=this.apples.reverse(),this.apples.forEach(t=>this.bringToTop(t))}getApplePositions(){let e=3,t=3,s=39,i=38,a=s*e,n=i*t,r=s/2-a/2,o=i/2-n/2-8,l=[];for(let d=0;d<e;d++)for(let f=0;f<t;f++)l.push({x:r+f*s,y:o+d*i});return l.reverse()}addPlatterFrontEdge(){this.platterFrontEdge=this.scene.add.image(0,0,"gameplay","apples_platter/Tray_01"),this.platterFrontEdge.setOrigin(.5,1),this.platterFrontEdge.y=this.platterBack.bottom,this.add(this.platterFrontEdge)}select(){this._isSelected||(this._isSelected=!0,this.emit(K.SELECT,this))}unselect(){this._isSelected!==!1&&(this._isSelected=!1,this.emit(K.UNSELECT,this))}getApplesNum(){return this.params.applesNum}setApplesNum(e){let t=this.params.applesNum,s=Phaser.Math.Clamp(e,1,rh.DEFAULT_APPLES_NUM);s!==t&&(this.params.applesNum=s,this.updateApplesVisibility(s),this.emit(vn.APPLES_NUM_CHANGE,this,s))}updateApplesVisibility(e){this.apples.forEach((t,s)=>{this.apples.length-1-s<e?t.revive():t.kill()})}},Tn=rh;Tn.DEFAULT_APPLES_NUM=9;var t0=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e}create(e){switch(O.getItemSuperType(e.itemType)){case c.BISCUIT:case c.MARSHMALLOW:case c.DROP_ITEM:case c.CHOCOLATE:case c.CANDY_BOTTLE:case c.DONUT_BOX:case c.LICORICE:case c.MYSTERY_BOX:case c.CHICK:case c.GUMMY_BLOCKER:return this.createBasicItem(e.itemType,e.params);case c.COOKIE:return this.createCookie(e.itemType,e.params);case c.COLOR_CAKE:return this.createColorCake(e.params);case c.GENERATOR:return this.createGenerator(e.params);case c.GUMMY:return this.createGummy(e.itemType,e.params);case c.APPLE_PLATTER:return this.createApplePlatter(e.params);default:return null}}createBasicItem(e,t){let s=new Jo(this.scene,"gameplay",e);return s.params=t!=null?t:{type:"basic"},s}createCookie(e,t){let s=new MS(this.scene,"gameplay",e);return s.params=t!=null?t:{type:"cookie"},s.on(K.SELECT,this.onItemSelect,this),s.on(K.UNSELECT,this.onItemUnselect,this),s}createColorCake(e){e=e!=null?e:{type:"color_cake",content:ii.getDefaultContent()};let t=new th(this.scene,e.content);return t.params=e,t.on(K.SELECT,this.onItemSelect,this),t.on(K.UNSELECT,this.onItemUnselect,this),t}createGenerator(e){e=e!=null?e:{type:"generator",turnsNum:3,content:V.DROP_ITEM,contentMod:oe.NONE,invisible:!1};let t=new DS(this.scene,e.turnsNum,e.content,e.contentMod,e.invisible);return t.params=e,t.on(K.SELECT,this.onItemSelect,this),t.on(K.UNSELECT,this.onItemUnselect,this),t}createGummy(e,t){t!=null||(t={type:"gummy"});let s=new e0(this.scene,e,t);return s.on(K.SELECT,this.onItemSelect,this),s.on(K.UNSELECT,this.onItemUnselect,this),s}createApplePlatter(e){e!=null||(e={type:"apple_platter",applesNum:Tn.DEFAULT_APPLES_NUM});let t=new Tn(this.scene,e);return t.on(K.SELECT,this.onItemSelect,this),t.on(K.UNSELECT,this.onItemUnselect,this),t}onItemSelect(e){let t=this.scene.editorPanels.itemPanels[e.itemSuperType];t&&(t.setItem(e),t.show())}onItemUnselect(e){let t=this.scene.editorPanels.itemPanels[e.itemSuperType];t&&(t.resetItem(),t.hide())}},ve;(function(e){e.BACKGROUND_CHANGE="__BACKGROUND_CHANGE",e.CONFIG_REMOVE="__CONFIG_REMOVE",e.TEST_LEVEL="__TEST_LEVEL",e.CHANGE_LEVEL="__CHANGE_LEVEL",e.RESTART="__RESTART"})(ve||(ve={}));var s0=class extends ct{init(e){super.init(e),this.levelConfig=e,this.levelConfigHelper=new QS(this),this.levelNumber=e.levelNumber,this.tutorialsId=1}create(){this.setLayersVisibility(),this.addEditorPanels(),this.addSelectionManager(),this.addItemsFactory(),this.addGrid(),this.addField(),this.addItemsLayer(),this.addTutorialLayer(),this.addFloatButtons(),this.addItemsPopover(),this.addCookiePowerupsPopover(),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.resize()}setLayersVisibility(){this.layers={[U.BOTTOM_ITEMS]:!0,[U.MAIN_ITEMS]:!0,[U.TOP_ITEMS]:!0,[U.TUTORIAL]:!0,[U.GENERATORS]:!0}}addEditorPanels(){this.editorPanels=new FS(this)}addSelectionManager(){this.selection=new YS(this),this.selection.on($t.SELECT,this.onItemSelect,this),this.selection.on($t.UNSELECT,this.onItemUnselect,this),this.selection.setDepth(U.SELECT_FRAMES),this.add.existing(this.selection)}onItemSelect(e){let t=this.floatButtons.visible===!1;this.moveFloatButtonsTo(e.column,e.row,t),this.floatButtons.revive(),this.floatButtons.updateViewBySelection(e)}onItemUnselect(e){let t=this.selection.getSelectedItems();if(t.length===0){this.floatButtons.kill();return}let s=Gt(t,i=>Phaser.Math.Distance.Between(e.x,e.y,i.x,i.y));this.moveFloatButtonsTo(s.column,s.row,!1)}addSelectable(e){this.selection.addSelectable(e)}removeSelectable(e){this.selection.removeSelectable(e)}addItemsFactory(){this.factory=new t0(this)}addGrid(){this.grid=new US(this,this.levelConfig.grid.columns,this.levelConfig.grid.rows),this.grid.on(Fe.ADD_CELL,this.addSelectable,this),this.grid.on(Fe.REMOVE_CELL,this.removeSelectable,this),this.grid.on(Fe.HIGHLIGHT,this.onGridHighlight,this),this.grid.on(Fe.UNHIGHLIGHT,this.onGridUnhighlight,this),this.add.existing(this.grid),this.selection.addFrames(this.grid),this.selection.addSelectable(this.grid.cells.toArray())}onGridHighlight(e,t){e==="column"?this.selection.highlightColumn(t):this.selection.highlightRow(t)}onGridUnhighlight(e,t){e==="column"?this.selection.unhighlightColumn(t):this.selection.unhighlightRow(t)}addField(){this.field=new WS(this,this.grid.rows,this.grid.columns),this.field.on(pi.ADD_CELL,this.onFieldCellAdd,this),this.field.on(pi.REMOVE_CELL,this.onFieldCellRemove,this),this.field.fillFromConfig(this.levelConfig.field),this.add.existing(this.field),this.addDefaultField()}onFieldCellAdd(e){this.selection.addSelectable(e)}onFieldCellRemove(e){this.selection.removeSelectable(e)}addDefaultField(){if(this.levelConfig.field.length===0)for(let t=1;t<this.grid.rows-1;t++)for(let s=1;s<this.grid.columns-1;s++)this.field.addCell(s,t)}addItemsLayer(){this.items=new XS(this,this.grid.rows,this.grid.columns,this.layers),this.items.setDepth(U.MAIN_ITEMS),this.items.on(Os.ADD_ITEM,this.addSelectable,this),this.items.on(Os.REMOVE_ITEM,this.removeSelectable,this),this.items.fillFromConfig(this.levelConfig.items),this.add.existing(this.items)}addTutorialLayer(){this.tutorialLayer=this.add.container(0,0),this.tutorialLayer.setName("tutorial"),this.tutorialLayer.setDepth(U.TUTORIAL),this.tutorials=[],this.levelConfig.tutorial.steps.forEach(e=>{e.type===L.MATCH&&this.doAddTutorial(e.cells)})}addFloatButtons(){this.floatButtons=new ZS(this),this.floatButtons.setDepth(U.FLOATING_BUTTONS),this.floatButtons.kill(),this.floatButtons.fillButton.on(_.PRESS,this.onFloatingFillButtonClick,this),this.floatButtons.removeButton.on(_.PRESS,this.onFloatingRemoveButtonClick,this),this.floatButtons.lockButton.on(_.PRESS,this.onFloatingLockButtonClick,this),this.floatButtons.addButton.on(_.PRESS,this.onFloatingAddButtonClick,this),this.floatButtons.modsButton.on(_.PRESS,this.onFloatingModsButtonClick,this),this.floatButtons.tutorialButton.on(_.PRESS,this.tryToAddTutorial,this),this.add.existing(this.floatButtons)}onFloatingFillButtonClick(){this.fillSelectedCells()}onFloatingRemoveButtonClick(){this.removeSelectedItems(),this.floatButtons.kill()}onFloatingLockButtonClick(){this.lockSelectedCookies(),this.floatButtons.kill()}onKeyDownL(){this.selection.selectionType===Q.ITEM&&this.getSelectedCookies().length>0?this.lockSelectedCookies():this.fillSelectedFieldCellsWith(h.LICORICE_CHOCO)}lockSelectedCookies(){this.getSelectedCookies().forEach(e=>{e.params.locked||this.items.lockCookie(e)})}unlockSelectedCookies(){this.getSelectedCookies().forEach(e=>{e.params.locked&&this.items.unlockCookie(e)})}lockAllCookies(){this.items.getCookies().forEach(e=>{e.params.locked||this.items.lockCookie(e)})}unlockAllCookies(){this.items.getCookies().forEach(e=>{e.params.locked&&this.items.unlockCookie(e)})}onFloatingAddButtonClick(){let e=this.selection.lastSelected;!e||(e.once(K.UNSELECT,()=>{this.itemsPopover.hide()}),this.showPopoverAt(this.itemsPopover,e.column,e.row),this.floatButtons.kill())}onFloatingModsButtonClick(){let e=this.selection.lastSelected;!e||(e.once(K.UNSELECT,()=>{this.powerupsPopover.hide()}),this.showPopoverAt(this.powerupsPopover,e.column,e.row),this.floatButtons.kill())}tryToAddTutorial(){this.selection.getSelectedItems().length!==0&&(this.addTutorial(),this.selection.unselectAll(),this.floatButtons.kill())}addTutorial(){let e=this.selection.getSelectedItems().map(t=>({column:t.column,row:t.row}));this.doAddTutorial(e)}doAddTutorial(e,t){let s=t!=null?t:this.getNewTutorialId(),i=new JS(this,s,e);return i.once(Phaser.GameObjects.Events.DESTROY,this.onTutorialDestroy.bind(this,i)),i.alignToGrid(),this.addSelectable(i),this.tutorialLayer.add(i),this.tutorials.push(i),i}getNewTutorialId(){let e=this.tutorials.map(t=>t.id);return e.length>0?Math.max(...e)+1:1}onTutorialDestroy(e){hs(this.tutorials,e)}getTutorialById(e){return this.tutorials.find(t=>t.id===e)}showPopoverAt(e,t,s){let i=this.grid.getCellAt(t,s);if(!i)return;let a=i.getWorldPosition(),n=e.width/2+10,r=n,o=E.GAME_WIDTH-n;e.x=Phaser.Math.Clamp(a.x,r,o);let l=e.height-20,d=E.GAME_HEIGHT;e.y=Phaser.Math.Clamp(a.y-40,l,d),e.setTipOffset(a.x-e.x),e.show()}moveFloatButtonsTo(e,t,s=!0){var i;let a=this.grid.getCellAt(e,t);if(!a)return;(i=this.floatButtons.moveTween)==null||i.remove();let n=a.getWorldPosition(),r=n.x-this.floatButtons.width/2,o=n.y-this.floatButtons.height/2-42;s?(this.floatButtons.x=r,this.floatButtons.y=o):this.floatButtons.moveTween=this.tweens.add({targets:this.floatButtons,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,x:r,y:o})}addItemsPopover(){let e=[[null,...O.getSubtypes(c.COOKIE)],O.getSubtypes(c.MARSHMALLOW),O.getSubtypes(c.CHOCOLATE),[h.DROP_ITEM,h.BISCUIT,h.CANDY_BOTTLE,h.DONUT_BOX,...O.getSubtypes(c.LICORICE),h.APPLES_PLATTER,h.COLOR_CAKE],[...O.getSubtypes(c.GUMMY),h.GUMMY_BLOCKER,h.MYSTERY_BOX,h.GENERATOR,h.CHICK]];this.itemsPopover=new zS(this,"gameplay",e),this.itemsPopover.on(oa.ITEM_CLICK,this.addItemsToSelectedCells,this),this.itemsPopover.kill(),this.itemsPopover.setDepth(U.POPOVERS),this.add.existing(this.itemsPopover)}addItemsToSelectedCells(e){if(e===h.GENERATOR){this.addGeneratorsToSelectedCells();return}this.selection.getSelectedItems().map(t=>this.field.getCellAt(t.column,t.row)).forEach(t=>{if(ae.isMulticell(e)===!1){this.items.addItem(t.column,t.row,e);return}if(this.canAddMulticellItemAt(e,t)){let a=this.items.addItem(t.column,t.row,e);a.itemSuperType===c.GUMMY&&this.autoAddGummyBlockers(a)}}),this.itemsPopover.hide(),this.selection.unselectAll()}addGeneratorsToSelectedCells(){this.selection.getSelectedItems().filter(({column:e,row:t})=>this.field.cells.checkAt(e,t)===!1).forEach(({column:e,row:t})=>{this.items.addItem(e,t,h.GENERATOR)}),this.itemsPopover.hide(),this.selection.unselectAll()}canAddMulticellItemAt(e,t){let s=ae.getSize(e);return ae.getPositions(t.column,t.row,s).every(a=>{let n=!!this.field.getCellAt(a.column,a.row),r=this.items.mainItems.checkAt(a.column,a.row)===!1;return n&&r})}autoAddGummyBlockers(e){ae.getItemPositions(e).forEach(t=>{this.items.addItem(t.column,t.row,h.GUMMY_BLOCKER)})}addCookiePowerupsPopover(){this.powerupsPopover=new jS(this),this.powerupsPopover.horizontalStripes.on(_.PRESS,this.onModButtonClick,this),this.powerupsPopover.verticalStripes.on(_.PRESS,this.onModButtonClick,this),this.powerupsPopover.bomb.on(_.PRESS,this.onModButtonClick,this),this.powerupsPopover.superSphere.on(_.PRESS,this.onModButtonClick,this),this.powerupsPopover.clear.on(_.PRESS,this.clearMods,this),this.powerupsPopover.setDepth(U.POPOVERS),this.powerupsPopover.kill(),this.add.existing(this.powerupsPopover),this.powerupsPopover.x=E.HALF_GAME_WIDTH,this.powerupsPopover.y=E.HALF_GAME_HEIGHT}getSelectedCookies(){return this.selection.selectionType!==Q.ITEM?[]:this.selection.getSelectedItems().filter(t=>t.itemSuperType===c.COOKIE)}onModButtonClick(e){let t=e.getData("mod");this.getSelectedCookies().forEach(s=>this.setPowerupOnCookie(s,t)),this.powerupsPopover.hide()}setPowerupOnCookie(e,t){e.setPowerup(t)}clearMods(){this.getSelectedCookies().forEach(e=>this.removePowerupFromCookie(e)),this.powerupsPopover.hide()}removePowerupFromCookie(e){e.setPowerup(null)}addPointerCallbacks(){this.input.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPointerDown,this),this.input.on(Phaser.Input.Events.POINTER_WHEEL,this.onPointerWheel,this)}onPointerDown(e,t){let s=e.event;if(s instanceof MouseEvent&&s.button===1){let i=this.items.pointToContainer({x:e.x,y:e.y}),{column:a,row:n}=Vs(i.x,i.y),r=this.items.mainItems.getAt(a,n);if(!r)return;if(r.itemSuperType===c.COOKIE){let o=[T.VERTICAL_STRIPES,T.HORIZONTAL_STRIPES,T.BOMB,T.SUPER_SPHERE],l=r.params.powerup;if(l){if(l===T.SUPER_SPHERE){this.removePowerupFromCookie(r);return}let d=o.indexOf(l),f=Phaser.Math.Wrap(d+1,0,o.length),S=o[f];this.setPowerupOnCookie(r,S)}else this.setPowerupOnCookie(r,o[0])}else r.itemSuperType===c.GENERATOR&&r.toggleInvisibility();return}this.selection.handleClick(e,t)}onPointerWheel(e,t,s,i){this.selection.getSelectedItems().filter(r=>r.getData("type")===Q.ITEM).forEach(r=>{let o=r.itemSuperType,l=-Phaser.Math.Sign(i);if(o===c.GENERATOR){let x=r;x.updateTurnsNum(x.params.turnsNum+l);return}if(o===c.APPLE_PLATTER){let x=r;x.setApplesNum(x.getApplesNum()+l);return}if(o===c.COLOR_CAKE){let x=r,X=x.getLastActivePieceIndex(),Z=nh.getEnabledCookieTypes(this.levelConfig.generator);x.setActivePiecesNum(X+l,Z);return}let d=this.getItemTypesToScrollThrough(o);if(!d)return;let f=d.indexOf(r.itemType),S=Phaser.Math.Wrap(f+l,0,d.length),A=d[S];if(r.updateItemType(A),o===c.COOKIE){let x=r.params.powerup;x&&r.setFrame(G.getFrame(r.itemType,x))}})}getItemTypesToScrollThrough(e){let t=O.getSubtypes(e);return e===c.COOKIE?t.filter(s=>this.levelConfig.generator.weights[s]>0):t}addKeyboardCallbacks(){this.onKeyDown("A",this.onKeyDownA,this),this.onKeyDown("I",this.toggleItemsPopover,this),this.onKeyDown("S",this.onKeyDownS,this),this.onKeyDown("F",this.fillSelectedCells,this),this.onKeyDown("B",this.fillSelectedFieldCellsWith.bind(this,h.BISCUIT)),this.onKeyDown("M",this.fillSelectedFieldCellsWith.bind(this,h.MARSHMALLOW_COMMON)),this.onKeyDown("D",this.fillSelectedFieldCellsWith.bind(this,h.DONUT_BOX)),this.onKeyDown("C",this.fillSelectedFieldCellsWith.bind(this,h.CHOCOLATE_COMMON)),this.onKeyDown("G",this.onKeyDownG,this),this.onKeyDown("L",this.onKeyDownL,this),this.onKeyDown("U",this.unlockSelectedCookies,this),this.onKeyDown("T",this.tryToAddTutorial,this),this.onKeyDown("DELETE",this.removeSelectedItems,this),this.onKeyDown("ENTER",this.testLevel,this),this.onKeyDown("PLUS",()=>this.editorPanels.changeZoom(1)),this.onKeyDown("MINUS",()=>this.editorPanels.changeZoom(-1)),this.onKeyDown("ZERO",()=>this.editorPanels.resetZoom()),this.onKeyDown("OPEN_BRACKET",this.changeCanvasMargin.bind(this,-1)),this.onKeyDown("CLOSED_BRACKET",this.changeCanvasMargin.bind(this,1)),this.onKeyDown("BACK_SLASH",this.resetCanvasMargin,this)}onKeyDownA(e){e.ctrlKey&&(this.selection.selectionType=Q.GRID_CELL,this.grid.cells.forEach(t=>t.select()))}toggleItemsPopover(){if(this.itemsPopover.visible)this.itemsPopover.hide();else{let e=this.input.activePointer;this.itemsPopover.show(),this.itemsPopover.x=e.x,this.itemsPopover.y=e.y}}onKeyDownS(e){e.shiftKey?this.saveLevelConfigAs():this.saveLevelConfig()}clearField(){this.field.cells.forEach(e=>e.destroy())}clearAllItems(){this.items.bottomItems.forEach(e=>e.destroy()),this.items.mainItems.forEach(e=>e.destroy()),this.items.topItems.forEach(e=>e.destroy())}clearCookies(){this.items.mainItems.filter(e=>e.itemSuperType===c.COOKIE).forEach(e=>e.destroy())}onKeyDownG(){if(this.selection.selectionType===Q.GRID_CELL){this.fillSelectedGridCellsWith(h.GENERATOR);return}let e=this.field.cells.filter(t=>this.items.mainItems.checkAt(t.column,t.row)===!1);this.fillCellsWithCookies(e)}fillCellsWithCookies(e){let t=[],s=this.createCookieTypesGenerator();return e.forEach(i=>{let a=!1,n=1e3;do{let r=s.getItem(),o=this.items.addItem(i.column,i.row,r),l=this.items.getMatchableItems();Ee.hasAny(l)?(o.destroy(),a=!0):(t.push(o),a=!1)}while(a&&--n>0)}),t}createCookieTypesGenerator(){let e=this.levelConfig.generator.weights,t=Date.now().toString();return new Ws(e,t)}fillSelectedCells(){let e=this.selection.selectionType;if(e!==Q.GRID_CELL&&e!==Q.FIELD_CELL)return[];let t=this.selection.getSelectedItems();if(t.length===0)return[];let s=[];return e===Q.GRID_CELL?s=t.map(i=>this.field.addCell(i.column,i.row)):e===Q.FIELD_CELL&&(s=this.fillCellsWithCookies(t)),this.selection.unselectAll(),s}fillSelectedFieldCellsWith(e){if(this.selection.selectionType!==Q.FIELD_CELL)return[];let s=this.selection.getSelectedItems().map(i=>this.items.addItem(i.column,i.row,e));this.selection.unselectAll(),s.forEach(i=>i.select())}fillSelectedGridCellsWith(e){if(this.selection.selectionType!==Q.GRID_CELL)return[];if([h.GENERATOR].includes(e)===!1)return[];this.selection.getSelectedItems().forEach(i=>{this.items.addItem(i.column,i.row,e)}),this.selection.unselectAll()}removeSelectedItems(){this.selection.getSelectedItems().filter(e=>e.getData("type")!==Q.GRID_CELL).forEach(e=>{e.getData("type")!==Q.GRID_CELL&&e.destroy()})}changeCanvasMargin(e){let t=this.game.canvas.style,s=t.marginLeft.slice(0,-2),a=parseFloat(s)+50*e;t.marginLeft=a+"px"}resetCanvasMargin(){this.scale.updateCenter()}resize(){super.resize(),this.alignGrid(),this.alignField(),this.alignItems(),this.alignSelection(),this.alignTutorial()}alignGrid(){let e=E.GAME_WIDTH*.8;this.grid.scale=e/this.grid.width,this.grid.x=(E.GAME_WIDTH-this.grid.displayWidth)/2,this.grid.y=(E.GAME_HEIGHT-this.grid.displayHeight)/2}alignField(){this.field.scale=this.grid.scale,this.field.x=this.grid.x,this.field.y=this.grid.y}alignItems(){this.items.scale=this.grid.scale,this.items.x=this.grid.x,this.items.y=this.grid.y}alignSelection(){this.selection.scale=this.grid.scale,this.selection.x=this.grid.x,this.selection.y=this.grid.y}alignTutorial(){this.tutorialLayer.scale=this.grid.scale,this.tutorialLayer.x=this.grid.x,this.tutorialLayer.y=this.grid.y}onGuiCreated(){let{lockButton:e,unlockButton:t,clearButton:s,generateButton:i}=this.gui.topBar;e.on(_.PRESS,this.lockAllCookies,this),t.on(_.PRESS,this.unlockAllCookies,this),s.on(_.PRESS,this.onClearButtonClick,this),i.on(_.PRESS,this.onGenerateButtonClick,this)}onClearButtonClick(){this.shiftKey.isDown?(this.clearField(),this.clearAllItems()):this.clearCookies()}onGenerateButtonClick(){this.onKeyDownG()}testLevel(){this.levelConfigHelper.updateLevelConfig(),this.events.emit(ve.TEST_LEVEL,{type:"play",levelNumber:this.levelNumber})}removeLevelConfig(){window.confirm(`Do you want to remove level ${this.levelNumber} config?`)!==!1&&this.levelConfigHelper.remove().then(()=>{var t;let s=this.game.levelConfigs.getLevelNumbers(),i=s.find(n=>n>this.levelNumber),a=(t=i!=null?i:s[0])!=null?t:1;this.events.emit(ve.CHANGE_LEVEL,a)})}removeAndShiftLevelConfig(){window.confirm(`Do you want to remove level ${this.levelNumber} config and shift all the levels after?`)!==!1&&this.levelConfigHelper.removeAndShift().then(()=>{let t=this.game.levelConfigs.getLevelNumbers(),s=t.includes(this.levelNumber)?this.levelNumber:Di(t);s===this.levelNumber?this.events.emit(ve.RESTART):this.events.emit(ve.CHANGE_LEVEL,s)})}saveLevelConfigAs(){this.levelConfigHelper.saveAs()}saveLevelConfig(){this.levelConfigHelper.save().catch(e=>{})}onShutdown(){super.onShutdown(),this.editorPanels.destroy()}},ha=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.isActiveLevel=!1,this.name="level_"+t,this.levelNumber=t,this.addBack(),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"editor","levels_list_active"),this.back.setOrigin(0,0),this.back.alpha=.2,this.back.kill(),this.back.displayWidth=ha.WIDTH-ha.PADDING,this.back.displayHeight=ha.HEIGHT,this.add(this.back)}addText(){let e=`Level ${this.levelNumber}`;this.text=this.scene.add.bitmapText(0,0,B.LEVELS_EDITOR_LIST,e,22),this.text.setOrigin(0,.5),this.text.x=this.back.left+25,this.text.y=this.back.displayHeight/2+2,this.text.originalX=this.text.x,this.add(this.text)}markAsActive(){this.isActiveLevel=!0,this.text.text=`> Level ${this.levelNumber}`,this.back.revive(),this.back.alpha=.3}markAsHard(){this.addSkullIcon()}addSkullIcon(){let e=this.scene.add.image(0,0,"editor","skull_icon");e.x=166,e.y=this.back.displayHeight/2-3,e.scale=.4,this.add(e)}markAsTutorial(){this.addTutorialIcon()}addTutorialIcon(){let e=this.scene.add.image(0,0,"editor","tutorial_icon");e.x=194,e.y=this.back.displayHeight/2-3,this.add(e)}makeInteractive(){this.setInteractive(),this.input.hitArea.x+=this.width/2,this.input.hitArea.y+=this.height/2,this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onPointerOver,this),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onPointerOut,this)}onPointerOver(){var e;this.back.revive(),(e=this.moveTween)==null||e.remove(),this.moveTween=this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,x:this.text.originalX+12})}onPointerOut(){var e;this.back.kill(),(e=this.moveTween)==null||e.remove(),this.moveTween=this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,x:this.text.originalX})}},At=ha;At.WIDTH=250,At.HEIGHT=46,At.PADDING=2;var i0=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,"editor","levels_list_scrollbar");this.inactiveAlpha=.8,this.minY=t,this.maxY=s,this.deltaY=this.maxY-this.minY,this.setAlpha(this.inactiveAlpha),this.setInteractive(this.createHitArea(),Phaser.Geom.Rectangle.Contains),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onPointerOver,this),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onPointerOut,this),this.input.cursor="pointer",this.scene.input.setDraggable(this),this.on(Phaser.Input.Events.DRAG,this.onDrag,this)}createHitArea(){let e=this.displayWidth*5,t=this.displayHeight*1.5,s=-(e-this.displayWidth)/2,i=-(t-this.displayHeight)/2;return new Phaser.Geom.Rectangle(s,i,e,t)}onDrag(e,t,s){this.updatePositionY(s)}getScrollPercent(){return(this.y-this.minY)/this.deltaY}setScrollPercent(e){this.updatePositionY(this.calculatePositionY(e))}calculatePositionY(e){return this.minY+this.deltaY*Phaser.Math.Clamp(e,0,1)}updatePositionY(e){this.y=Phaser.Math.Clamp(e,this.minY,this.maxY)}onPointerOver(){this.alpha=1}onPointerOut(){this.alpha=this.inactiveAlpha}},la;(function(e){e.LEVEL_SELECT="LevelsList_LEVEL_SELECT"})(la||(la={}));var a0=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.name="levels_list",this.addBack(),this.addLevels(t,s),this.addScrollbar(),this.setSize(this.back.displayWidth,this.back.displayHeight),this.disableInvisibleItems(),this.scrollToLevel(t),this.scene.input.on(Phaser.Input.Events.POINTER_WHEEL,this.onWheel,this)}addBack(){this.back=this.scene.add.image(0,0,"editor","levels_list_back"),this.back.setOrigin(0,0),this.add(this.back)}addLevels(e,t){this.levels=this.createLevelItems(t,e);let s=this.levels[0].height*this.levels.length,i=4,a=i+this.back.height-s;this.levelsContainer=this.scene.add.container(0,i,this.levels),this.levelsContainer.setSize(this.levels[0].displayWidth,s),this.levelsContainer.minY=a,this.levelsContainer.maxY=i,this.levelsContainer.deltaY=i-a,this.levelsContainer.originalY=this.levelsContainer.y,this.add(this.levelsContainer)}createLevelItems(e,t){return e.map((s,i)=>{let a=this.scene.game.levelConfigs.get(s),n=new At(this.scene,s);return n.x=At.PADDING,n.y=i*n.height,n.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onLevelItemClick.bind(this,n)),a.hard&&n.markAsHard(),a.tutorial.autoGenerated===!1&&n.markAsTutorial(),s===t?n.markAsActive():n.makeInteractive(),n})}onLevelItemClick(e){this.emit(la.LEVEL_SELECT,e.levelNumber)}addScrollbar(){let e=30,t=this.back.top+e,s=this.back.bottom-e;this.scrollbar=new i0(this.scene,t,s),this.scrollbar.x=this.back.right-12,this.scrollbar.y=t,this.scrollbar.on(Phaser.Input.Events.DRAG_START,this.onScrollbarDragStart,this),this.scrollbar.on(Phaser.Input.Events.DRAG_END,this.onScrollbarDragEnd,this),this.add(this.scrollbar)}onScrollbarDragStart(){this.levels.forEach(e=>e.disableInteractive())}onScrollbarDragEnd(e,t,s){let i=Phaser.Math.Snap.To(this.levelsContainer.y,At.HEIGHT,this.levelsContainer.maxY),a=(this.levelsContainer.maxY-i)/this.levelsContainer.deltaY,n=this.scrollbar.calculatePositionY(a);this.scrollTo(n)}onWheel(e,t,s,i){if(this.visible===!1)return;let a=e.event.shiftKey?5:1,n=-Phaser.Math.Sign(i)*At.HEIGHT*a,r=Phaser.Math.Clamp(this.levelsContainer.y+n,this.levelsContainer.minY,this.levelsContainer.maxY),o=(this.levelsContainer.maxY-r)/this.levelsContainer.deltaY,l=this.scrollbar.calculatePositionY(o);this.scrollTo(l)}scrollToBottom(){this.scrollTo(this.scrollbar.maxY)}scrollToTop(){this.scrollTo(this.scrollbar.minY)}scrollToLevel(e){let t=this.levels.find(r=>r.levelNumber===e);if(!t)return;let s=-t.y+this.displayHeight/2,i=Phaser.Math.Snap.To(s,At.HEIGHT,this.levelsContainer.maxY),a=(this.levelsContainer.maxY-i)/this.levelsContainer.deltaY,n=this.scrollbar.calculatePositionY(a);this.scrollTo(n)}scrollTo(e){this.scrollbar.updatePositionY(e),this.updateLevelsPosition(),this.disableInvisibleItems()}updateLevelsPosition(){let e=this.levelsContainer.originalY,t=e-this.levelsContainer.height+this.displayHeight,s=e-t;this.levelsContainer.y=this.levelsContainer.originalY-s*this.scrollbar.getScrollPercent()}disableInvisibleItems(){let e=this.levelsContainer.originalY-this.levelsContainer.y,t=e+this.displayHeight;this.levels.forEach(s=>{if(s.isActiveLevel)return;let i=s.y+s.displayHeight/2;i>=e&&i<=t?s.setInteractive():s.disableInteractive()})}preUpdate(e,t){this.updateLevelsPosition()}preDestroy(){this.scene.input.off(Phaser.Input.Events.POINTER_WHEEL,this.onWheel,this),super.preDestroy()}},n0=class extends ct{init(e){super.init(e),this.levelNumber=e?e.levelNumber:1,this.levelConfig=this.getLevelConfig(this.levelNumber),""+this.levelNumber,this.editor=null,this.editorGui=null}getLevelConfig(e){return this.game.levelConfigs.check(e)?this.game.levelConfigs.get(e):this.game.levelConfigs.create(e)}preload(){let e=this.game.globalScene.delayedLoader;e.areGameplayAssetsReady===!1&&this.waitForGameplayAssets(e)}waitForGameplayAssets(e){this.load.rexAwait(Phaser.Math.RND.uuid(),{callback:t=>{e.once(Gs.GAMEPLAY_ASSETS_READY,()=>{t()})}})}create(){this.addBackground(),this.addKeyboardCallbacks(),this.launchEditorScene()}addBackground(){this.background=this.add.image(0,0,"editor","Background"),this.background.alpha=.5}addKeyboardCallbacks(){this.onceKeyDown("R",this.restart,this),this.onceKeyDown("ESC",this.gotoLevelsMapDev,this)}restart(){this.changeScene(M.LEVEL_EDITOR_ROOT,{levelNumber:this.levelNumber})}gotoPrevLevel(){let e=this.game.levelConfigs.getPrevExistingLevel(this.levelNumber);e&&this.gotoLevel(e)}gotoNextLevel(){let e=this.game.levelConfigs.getNextExistingLevel(this.levelNumber);e&&this.gotoLevel(e)}gotoLevel(e){if(e===this.levelNumber)return;if(this.game.levelConfigs.check(e)===!1){""+e;return}this.scene.start(M.LEVEL_EDITOR_ROOT,{levelNumber:e})}gotoLevelsMapDev(){this.scene.start(M.LEVEL_MAP_EDITOR)}launchEditorScene(){this.editor=this.launchScene(M.LEVEL_EDITOR,this.levelConfig),this.editor.events.on(Phaser.Scenes.Events.CREATE,this.launchEditorGuiScene,this),this.editor.events.on(ve.BACKGROUND_CHANGE,this.onBackgroundChange,this),this.editor.events.on(ve.CONFIG_REMOVE,this.gotoLevelsMapDev,this),this.editor.events.once(ve.TEST_LEVEL,this.testLevelConfig,this),this.editor.events.once(ve.CHANGE_LEVEL,this.gotoLevel,this),this.editor.events.once(ve.RESTART,this.restart,this)}launchEditorGuiScene(){this.editorGui=this.launchScene(M.LEVEL_EDITOR_GUI,{levelConfig:this.levelConfig,editor:this.editor}),this.editorGui.events.on(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this)}onGuiCreated(){this.editor.gui=this.editorGui,this.editor.onGuiCreated(),this.editorGui.bottomBar.swapButton.on(_.RELEASE,this.onSwapButtonClick,this),this.editorGui.bottomBar.removeButton.on(_.RELEASE,this.onRemoveButtonClick,this),this.editorGui.bottomBar.createButton.on(_.RELEASE,this.onCreateButtonClick,this),this.editorGui.bottomBar.saveButton.on(_.RELEASE,this.onSaveButtonClick,this),this.editorGui.bottomBar.playButton.on(_.RELEASE,this.onPlayButtonClick,this),this.editorGui.bottomBar.exitButton.on(_.RELEASE,this.onExitButtonClick,this),this.editorGui.bottomBar.prevLevelButton.on(_.RELEASE,this.gotoPrevLevel,this),this.editorGui.bottomBar.nextLevelButton.on(_.RELEASE,this.gotoNextLevel,this),this.editorGui.levelsList.once(la.LEVEL_SELECT,this.gotoLevel,this),this.resize()}onSwapButtonClick(){let e=prompt(`Enter level number (current level ${this.levelNumber} will be swapped with it)`);if(e===null)return;let t=parseInt(e);if(isNaN(t))return;if(!this.game.levelConfigs.check(t)){""+t;return}this.editor.levelConfigHelper.swapWith(t).then(()=>this.restart())}onRemoveButtonClick(e,t){t.event.shiftKey?this.editor.removeAndShiftLevelConfig():this.editor.removeLevelConfig()}onCreateButtonClick(){let e=this.game.levelConfigs.getGaps()[0],t=e!=null?e:this.game.levelConfigs.getLastLevelNumber()+1,s=prompt("Enter new level number",t.toString());if(s===null)return;let i=parseInt(s);if(isNaN(i))return;if(this.game.levelConfigs.getLevelNumbers().includes(i)){""+i;return}this.scene.start(M.LEVEL_EDITOR_ROOT,{levelNumber:i})}onSaveButtonClick(e,t){t.event.shiftKey?this.editor.saveLevelConfigAs():this.editor.saveLevelConfig()}onPlayButtonClick(){this.editor.testLevel()}onExitButtonClick(){this.gotoLevelsMapDev()}onBackgroundChange(e){this.background.setFrame(e),this.background.setOrigin(.5,1)}testLevelConfig(e){this.scene.start(M.GAMEPLAY_ROOT,e)}launchScene(e,t){return this.scene.launch(e,t).get(e)}resize(){super.resize(),this.resizeBackground()}resizeBackground(){this.background.envelop(E.GAME_WIDTH+2,E.GAME_HEIGHT+2),this.background.x=E.HALF_GAME_WIDTH,this.background.y=E.HALF_GAME_HEIGHT}onShutdown(){super.onShutdown(),this.editor&&(this.scene.stop(this.editor.scene.key),this.editor.events.off(Phaser.Scenes.Events.CREATE,this.launchEditorGuiScene,this),this.editor.events.off(ve.BACKGROUND_CHANGE,this.onBackgroundChange,this),this.editor.events.off(ve.CONFIG_REMOVE,this.gotoLevelsMapDev,this),this.editor.events.off(ve.TEST_LEVEL,this.testLevelConfig,this),this.editor.events.off(ve.CHANGE_LEVEL,this.gotoLevel,this),this.editor.events.off(ve.RESTART,this.restart,this)),this.editorGui&&(this.scene.stop(this.editorGui.scene.key),this.editorGui.events.off(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this))}},at=class extends ls{constructor(e,t,s,i){super(e,t,s,i);this.originalY=0,this.deltaY=5,this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onPointerOver,this),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onPointerOut,this)}onPointerOver(){var e;(e=this.moveTween)==null||e.remove(),this.moveTween=this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,y:this.originalY-this.deltaY})}onPointerOut(){var e;(e=this.moveTween)==null||e.remove(),this.moveTween=this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,y:this.originalY})}disableInput(){super.disableInput(),this.alpha=.5}enableInput(){super.enableInput(),this.alpha=1}},r0=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.separatorAlpha=.4,this.name="main_panel",this.addBack(),this.addLevelButton(t),this.addPrevLevelButton(),this.addNextLevelButton(),this.addSeparator_1(),this.addButtonsGroup(),this.addSeparator_2(),this.addExitButton(),this.align(),this.setSize(this.back.width,this.back.height),this.addInputOverlay()}addBack(){this.back=this.scene.add.rectangle(0,0,E.SOURCE_GAME_WIDTH,60,0,.5),this.back.setOrigin(0,.5),this.add(this.back)}addLevelButton(e){let t="Level "+e.toString();this.levelButton=new fe(this.scene,"editor","levels_list_button_back"),this.levelButton.back.alpha=.66,this.levelButton.addBitmapText(t,B.LEVELS_EDITOR_LIST,25,0,4),this.add(this.levelButton)}addPrevLevelButton(){this.prevLevelButton=this.scene.add.button("editor","button_prev_level",this),this.prevLevelButton.alpha=.8,this.prevLevelButton.areTweensEnabled=!1,this.addPointerListeners(this.prevLevelButton)}addNextLevelButton(){this.nextLevelButton=this.scene.add.button("editor","button_next_level",this),this.nextLevelButton.alpha=this.prevLevelButton.alpha,this.nextLevelButton.areTweensEnabled=!1,this.addPointerListeners(this.nextLevelButton)}addPointerListeners(e){e.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,this.onLevelButtonPointerOver.bind(this,e)),e.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.onLevelButtonPointerOut.bind(this,e))}onLevelButtonPointerOver(e){e.alpha=1,e.scale=1.15}onLevelButtonPointerOut(e){e.alpha=.8,e.scale=1}addSeparator_1(){this.separator_1=this.scene.add.image(0,0,"editor","panel_separator"),this.separator_1.alpha=this.separatorAlpha,this.add(this.separator_1)}addButtonsGroup(){this.swapButton=new at(this.scene,"editor","swap_button",this),this.removeButton=new at(this.scene,"editor","remove_icon",this),this.createButton=new at(this.scene,"editor","create_icon_2",this),this.saveButton=new at(this.scene,"editor","save_icon",this),this.playButton=new at(this.scene,"editor","play_icon",this)}addSeparator_2(){this.separator_2=this.scene.add.image(0,0,"editor","panel_separator"),this.separator_2.alpha=this.separatorAlpha,this.add(this.separator_2)}addExitButton(){this.exitButton=new at(this.scene,"editor","exit_icon",this)}align(){let e=61,t=40;this.exitButton.x=this.back.right-t,this.separator_2.x=this.exitButton.x-t,this.playButton.x=this.exitButton.x-t*2,this.saveButton.x=this.playButton.x-e,this.createButton.x=this.saveButton.x-e,this.removeButton.x=this.createButton.x-e,this.swapButton.x=this.removeButton.x-e,this.separator_1.x=this.swapButton.x-t,this.alignLevelButton()}alignLevelButton(){let e=0,s=this.separator_1.x-e;this.levelButton.x=e+s/2;let i=114;this.prevLevelButton.x=this.levelButton.x-i,this.prevLevelButton.originalX=this.prevLevelButton.x,this.nextLevelButton.x=this.levelButton.x+i,this.nextLevelButton.originalX=this.nextLevelButton.x}addInputOverlay(){this.inputOverlay=this.scene.add.rectangle(0,0,this.width,this.height,16777215),this.inputOverlay.setOrigin(.5,.5),this.inputOverlay.x=this.width/2,this.inputOverlay.setInteractive(),this.inputOverlay.alpha=.2,this.inputOverlay.kill(),this.add(this.inputOverlay)}enableInput(){this.inputOverlay.kill()}disableInput(){this.inputOverlay.revive()}},o0=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.separatorAlpha=.4,this.name="editor_bar",this.addBack(),this.addContent(),this.setSize(this.back.width,this.back.height),this.addInputOverlay()}addBack(){this.back=this.scene.add.rectangle(0,0,E.SOURCE_GAME_WIDTH,60,0,.5),this.back.setOrigin(0,.5),this.add(this.back)}addContent(){}addSeparator(e){let t=this.scene.add.image(0,0,"editor","panel_separator");return t.alpha=this.separatorAlpha,this.add(t),typeof e!="undefined"&&(t.x=e),t}addInputOverlay(){this.inputOverlay=this.scene.add.rectangle(0,0,this.width,this.height,16777215),this.inputOverlay.setOrigin(.5,.5),this.inputOverlay.x=this.width/2,this.inputOverlay.setInteractive(),this.inputOverlay.alpha=.2,this.inputOverlay.kill(),this.add(this.inputOverlay)}enableInput(){this.inputOverlay.kill()}disableInput(){this.inputOverlay.revive()}},h0=class extends o0{constructor(e){super(e);this.name="top_bar"}addContent(){this.separator_2=this.addSeparator(),this.addLockButton(),this.addUnlockButton(),this.separator_1=this.addSeparator(),this.addClearButton(),this.addGenerateButton(),this.align()}addLockButton(){this.lockButton=new at(this.scene,"editor","lock_button",this),this.lockButton.deltaY=-5}addUnlockButton(){this.unlockButton=new at(this.scene,"editor","unlock_button",this),this.unlockButton.deltaY=-5}addClearButton(){this.clearButton=new at(this.scene,"editor","clear_button",this),this.clearButton.deltaY=-5}addGenerateButton(){this.generateButton=new at(this.scene,"editor","generate_button",this),this.generateButton.deltaY=-5}align(){let e=61,t=40;this.generateButton.x=this.back.right-t,this.clearButton.x=this.generateButton.x-e,this.separator_1.x=this.clearButton.x-t,this.unlockButton.x=this.separator_1.x-t,this.lockButton.x=this.unlockButton.x-e,this.separator_2.x=this.lockButton.x-t}},l0=class extends ct{init(e){super.init(e),this.editor=e.editor,this.levelConfig=e.levelConfig}create(){this.addTopBar(),this.addBottomBar(),this.addLevelsList(),this.addLevelsListMask(),this.resize(),this.addKeyboardCallbacks()}addTopBar(){this.topBar=new h0(this),this.pin(this.topBar,0,0,0,this.topBar.height/2),this.size(this.topBar),this.add.existing(this.topBar)}addBottomBar(){let e=this.levelConfig.levelNumber;this.bottomBar=new r0(this,e),this.bottomBar.levelButton.on(_.PRESS,this.onLevelButtonPress,this),this.pin(this.bottomBar,0,1,0,-this.bottomBar.height/2),this.size(this.bottomBar),this.add.existing(this.bottomBar)}onLevelButtonPress(){this.levelsList.visible?this.hideLevelsList():this.showLevelsList()}showLevelsList(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.hideLevelsListByClick,this),this.editor.input.enabled=!1,this.levelsList.revive(),this.levelsList.alpha=0,this.tweens.killTweensOf(this.levelsList),this.tweens.add({targets:this.levelsList,duration:100,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1})}hideLevelsListByClick(e,t){t.length>0||this.hideLevelsList()}hideLevelsList(){this.input.off(Phaser.Input.Events.POINTER_DOWN,this.hideLevelsListByClick,this),this.editor.input.enabled=!0,this.levelsList.kill()}addLevelsList(){let e=this.levelConfig.levelNumber,t=this.game.levelConfigs.getLevelNumbers();this.levelsList=new a0(this,e,t),this.levelsList.kill(),this.size(this.levelsList),this.add.existing(this.levelsList)}addLevelsListMask(){this.levelsListMask=this.make.graphics(),this.levelsList.mask=this.levelsListMask.createGeometryMask()}resize(){super.resize(),this.alignLevelsList(),this.alignLevelsListMask()}alignLevelsList(){let e=this.bottomBar.levelButton,t=e.getWorldPosition();this.levelsList.x=t.x-e.displayWidth/2,this.levelsList.y=t.y-e.displayHeight/2-this.levelsList.displayHeight-12}alignLevelsListMask(){this.levelsListMask.clear(),this.levelsListMask.fillRect(0,0,this.levelsList.displayWidth,this.levelsList.displayHeight),this.levelsListMask.x=this.levelsList.x,this.levelsListMask.y=this.levelsList.y}addKeyboardCallbacks(){this.onKeyDown("HOME",this.scrollToFirstLevel,this),this.onKeyDown("END",this.scrollToLastLevel,this)}scrollToFirstLevel(){this.game.levelConfigs.getLevelNumbers()[0]&&this.levelsList.scrollToTop()}scrollToLastLevel(){Di(this.game.levelConfigs.getLevelNumbers())&&this.levelsList.scrollToBottom()}onShutdown(){super.onShutdown()}},oh=class extends Phaser.GameObjects.Container{constructor(e){super(e);this._levelNumber=0,this.name="level_icon",this.addBack(),this.addLevelNumberText(),this.setSize(this.back.width,this.back.height),this.setInteractive()}get levelNumber(){return this._levelNumber}set levelNumber(e){this._levelNumber=e,this.levelNumberText.text=this._levelNumber.toString()}addBack(){this.back=this.scene.add.image(0,0,"level_map","level_icons/level_icon_classic"),this.add(this.back)}addLevelNumberText(){this.levelNumberText=this.scene.add.bitmapText(0,0,B.LEVEL_ICONS_CLASSIC,"0",38),this.levelNumberText.setOrigin(.5,.5),this.levelNumberText.x=-4,this.levelNumberText.y=-16,this.add(this.levelNumberText)}},c0=class{static saveLocally(e,t){if(typeof window.___browserSync___!="undefined"===!1)return Promise.resolve(!1);let i=`${location.protocol}//${location.host}/files`;return this.doSave(i,e,t)}static saveRemotely(e,t){let s=E.SERVER_URL+"upload.php";return this.doSave(s,e,t)}static doSave(e,t,s){return new Promise((i,a)=>{let n=new XMLHttpRequest;n.open("POST",e,!0),n.onload=function(){i(n)},n.onerror=function(){a(n)},n.send(this.createRequestBody(t,s))})}static createRequestBody(e,t){let s={filename:e,content:JSON.stringify(t)};return this.convertObjectToURLSearchParams(s)}static convertObjectToURLSearchParams(e){return new URLSearchParams(e)}},hh=class{constructor(e,t){this.thresholdOfTapTime=100,this.thresholdOfTapDistance=10,this.moveTimestamp=0,this.scene=e;let s={camera:this.scene.cameras.main,kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!1,wheelScrollAmount:100,wheelDeceleration:.95,onUpdate:null,scrollMultiplier:1};this.settings=P(P({},s),t),this.tempCameraBounds=new Phaser.Geom.Rectangle}addPointerListeners(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.endMove,this),this.scene.input.on("pointermove",this.move,this),(this.settings.verticalWheel||this.settings.horizontalWheel)&&this.scene.input.on(Phaser.Input.Events.POINTER_WHEEL,this.onPointerWheel,this)}onPointerDown(e,t){t.length>0||this.beginMove(e)}onPointerWheel(e,t,s,i){this.settings.verticalWheel&&(this.velocityWheelY=-Phaser.Math.Sign(i)*this.settings.wheelScrollAmount)}removePointerListeners(){this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.endMove,this),this.scene.input.off("pointermove",this.move,this),this.scene.input.off(Phaser.Input.Events.POINTER_WHEEL,this.onPointerWheel,this)}beginMove(e){this.pointerId=e.id,this.startX=this.scene.input.x,this.startY=this.scene.input.y,this.screenX=e.screenX,this.screenY=e.screenY,this.pressedDown=!0,this.timestamp=this.getNow(),this.beginTime=this.timestamp,this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0}canCameraMoveY(){let e=this.settings.camera;return e.getBounds(this.tempCameraBounds),e.scrollY>0&&e.scrollY+e.height<this.tempCameraBounds.height}canCameraMoveX(){let e=this.settings.camera;return e.getBounds(this.tempCameraBounds),e.scrollX>0&&e.scrollX+e.width<this.tempCameraBounds.right}move(e){let t=e.x,s=e.y;if(!this.pressedDown||this.pointerId!==e.id)return;this.now=this.getNow();let i=this.now-this.timestamp;this.timestamp=this.now;let a=0,n=0;if(this.isTap(e))return;let r=this.settings.camera;this.settings.horizontalScroll&&(a=t-this.startX,a!==0&&(this.dragging=!0),this.startX=t,this.velocityX=.8*(1e3*a/(1+i))+.2*this.velocityX,r.setScroll(r.scrollX-a,r.scrollY)),this.settings.verticalScroll&&(n=(s-this.startY)*this.settings.scrollMultiplier,n!==0&&(this.dragging=!0),this.startY=s,this.velocityY=.8*(1e3*n/(1+i))+.2*this.velocityY,r.setScroll(r.scrollX,r.scrollY-n)),this.callCustomUpdate(a,n),this.moveTimestamp=this.getNow()}callCustomUpdate(e,t){if(typeof this.settings.onUpdate!="function")return;let s=this.canCameraMoveX()?e:0,i=this.canCameraMoveY()?t:0;this.settings.onUpdate(s,i)}isTap(e){return this.now-this.beginTime<this.thresholdOfTapTime&&Math.abs(e.screenY-this.screenY)<this.thresholdOfTapDistance&&Math.abs(e.screenX-this.screenX)<this.thresholdOfTapDistance}endMove(){if(this.pointerId=null,this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,!this.settings.kineticMovement)return;this.now=this.getNow();let e=this.settings.camera;this.withinGame()&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(e.scrollX-this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(e.scrollY-this.amplitudeY),this.autoScrollY=!0)),this.withinGame()||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.withinGame())&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.withinGame())&&(this.autoScrollY=!0))}update(){this.getNow()-this.moveTimestamp>20&&(this.velocityX=0,this.velocityY=0),this.elapsed=this.getNow()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY);let t=0,s=this.settings.camera;this.autoScrollX&&this.amplitudeX!==0&&(t=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveX()&&(t>.5||t<-.5)?s.setScroll(this.targetX-t,s.scrollY):(this.autoScrollX=!1,s.setScroll(this.targetX,s.scrollY))),this.autoScrollY&&this.amplitudeY!==0&&(t=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveY()&&(t>.5||t<-.5)?s.setScroll(s.scrollX,this.targetY-t):(this.autoScrollY=!1,s.setScroll(s.scrollX,this.targetY))),!this.autoScrollX&&!this.autoScrollY&&(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,s.setScroll(s.scrollX-this.velocityWheelX,s.scrollY),this.velocityWheelX*=this.settings.wheelDeceleration),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,s.setScroll(s.scrollX,s.scrollY-this.velocityWheelY),this.velocityWheelY*=this.settings.wheelDeceleration)}getNow(){return performance&&performance.now?performance.now():Date.now()}withinGame(){return!0}resetScroll(){this.autoScrollX=!1,this.autoScrollY=!1,this.velocityWheelX=0,this.velocityWheelY=0}},d0=class extends Phaser.GameObjects.Image{constructor(e,t,s,i){super(e,0,0,s,i);this.isDragged=!1,this.scrollTop=0,this.scrollBottom=0,this.scrollHeight=0,this.camera=t,this.setInteractive(),this.scene.input.setDraggable(this),this.input.cursor="pointer",this.on(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart,this),this.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd,this)}onDragStart(){this.isDragged=!0,document.onpointermove=e=>{let t=this.scene.scale.transformY(e.pageY);this.y=Phaser.Math.Clamp(t,this.scrollTop,this.scrollBottom),this.updateCameraPosition()}}updateCameraPosition(){let e=this.camera.getBounds(),t=e.y,s=e.bottom-E.GAME_HEIGHT/this.camera.zoom,i=(this.y-this.scrollTop)/this.scrollHeight;this.camera.scrollY=(s-t)*i}onDragEnd(){this.isDragged=!1,document.onpointermove=null}onResize(){let e=this.displayHeight/2+6*this.scaleY;this.scrollTop=e,this.scrollBottom=E.GAME_HEIGHT-e,this.scrollHeight=this.scrollBottom-this.scrollTop}preUpdate(e,t){if(this.isDragged)return;let s=this.camera.getBounds(),i=s.y,a=s.bottom-E.GAME_HEIGHT/this.camera.zoom,n=Math.max(0,this.camera.scrollY),r=Phaser.Math.Clamp(n/(a-i),0,1);this.y=this.scrollTop+(this.scrollBottom-this.scrollTop)*r}destroy(){document.onpointermove=null,this.off(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart,this),this.off(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd,this),super.destroy()}},lh=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="background",this.createPieces(t),this.alignPieces();let s=this.pieces[0].width,i=this.pieces[this.pieces.length-1].bottom;this.setSize(s,i)}createPieces(e){this.pieces=e.map(t=>{let s=this.scene.add.image(0,0,t.texture,t.frame);return s.setOrigin(0),this.add(s),s})}alignPieces(){this.pieces.forEach((e,t)=>{let s=this.pieces[t-1];s?e.y=s.bottom:e.y=0})}cull(e,t,s){this.pieces.forEach(i=>{let a=i.y,n=i.y+i.displayHeight;t>=a&&t<n||s>a&&s<n?i.revive():i.kill()})}},u0=class extends ct{init(){super.init(),this.config=this.cache.json.get("level_map_config"),this.lastTapTime=0}create(){this.addBackground(),this.addLevelIcons(),this.addScrollbar(),this.addCameraScroll(),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.resize()}addBackground(){this.background=new lh(this,this.config.background),this.add.existing(this.background)}addLevelIcons(){this.levelIcons=[],this.config.levelIcons.forEach(e=>{this.doAddLevelIcon(e.level_number,e.x,e.y)})}addScrollbar(){this.scrollbar=new d0(this,this.cameras.main,"level_map","scrollbar"),this.scrollbar.setAlpha(.5),this.scrollbar.on(Phaser.Input.Events.DRAG_START,this.onScrollbarDragStart,this),this.add.existing(this.scrollbar)}onScrollbarDragStart(){this.cameraScroll.resetScroll()}addCameraScroll(){this.cameraScroll=new hh(this,{camera:this.cameras.main,timeConstantScroll:300,horizontalScroll:!1,verticalScroll:!0,verticalWheel:!0,wheelScrollAmount:50,scrollMultiplier:2}),this.cameraScroll.addPointerListeners()}addPointerCallbacks(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on(Phaser.Input.Events.DRAG,this.onPointerDrag,this)}onPointerDown(e,t){let s=Date.now();if(t.length>0){this.lastTapTime=s;return}this.cameraScroll.beginMove(e),s-this.lastTapTime<300&&this.addLevelIcon(),this.lastTapTime=s}onPointerDrag(e,t,s,i){t!==this.scrollbar&&(t.x=s,t.y=i)}addLevelIcon(){let e={x:this.input.activePointer.worldX,y:this.input.activePointer.worldY},t=e.x,s=e.y,i=Math.max(...this.levelIcons.map(a=>a.levelNumber),0)+1;this.doAddLevelIcon(i,t,s)}doAddLevelIcon(e,t,s){let i=new oh(this);return i.x=t,i.y=s,i.levelNumber=e,i.on(Phaser.Input.Events.GAMEOBJECT_POINTER_WHEEL,this.onLevelIconWheel.bind(this,i)),this.input.setDraggable(i),this.levelIcons.push(i),this.add.existing(i),i}onLevelIconWheel(e,t,s,i){!t.event.shiftKey||(e.levelNumber=Math.max(1,e.levelNumber-Phaser.Math.Sign(i)))}onPointerWheel(e,t,s,i){if(t.length>0)return;let a=this.cameras.main;a.scrollY+=Phaser.Math.Sign(i)*100}addKeyboardCallbacks(){this.onKeyDown("END",this.scrollToBottom,this),this.onKeyDown("HOME",this.scrollToTop,this),this.onKeyDown("S",this.saveConfig,this),this.onKeyDown("F",this.findLevelIcon,this),this.onKeyDown("DELETE",this.deleteLevelIcon,this),this.onKeyDown("PAGE_DOWN",this.scrollPageDown,this),this.onKeyDown("PAGE_UP",this.scrollPageUp,this),this.onceKeyDown("ESC",this.gotoLevelEditor,this),this.onceKeyDown("ENTER",this.gotoLevelMap,this)}gotoLevelEditor(){let e=this.game.levelConfigs.getLevelNumbers(),t=Di(e)||1;this.changeScene(M.LEVEL_EDITOR_ROOT,{levelNumber:t})}gotoLevelMap(){this.changeScene(M.LEVEL_MAP)}deleteLevelIcon(){this.input.hitTestPointer(this.input.activePointer).filter(e=>e instanceof oh).forEach(e=>{e.destroy(),hs(this.levelIcons,e)})}scrollToBottom(){let e=this.cameras.main;e.scrollY=e.getBounds().bottom}scrollToTop(){let e=this.cameras.main;e.scrollY=0}scrollPageDown(){this.cameras.main.scrollY+=E.GAME_HEIGHT}scrollPageUp(){this.cameras.main.scrollY-=E.GAME_HEIGHT}saveConfig(){this.updateConfig(),this.validateConfig(),c0.saveLocally("dev/assets/configs/level_map_config.json",this.config).then(()=>{}).catch(e=>{})}updateConfig(){this.config.levelIcons=to(this.levelIcons,"levelNumber").map(e=>({level_number:e.levelNumber,x:e.x,y:e.y}))}validateConfig(){let e=this.levelIcons.map(a=>a.levelNumber).sort((a,n)=>a-n),t=Object.values(qr(e)).filter(a=>a.length>1).map(a=>a[0]);t.length>0;let s=Kv(1,101),i=ME(s,e);i.length>0}findLevelIcon(){let e=this.levelIcons.map(l=>l.levelNumber),t=Math.min(...e),s=Math.max(...e),i=prompt(`Enter level number (between ${t} and ${s}`);if(i===null)return;let a=parseInt(i);if(isNaN(a))return;let n=this.levelIcons.find(l=>l.levelNumber===a);if(!n){""+a;return}let{main:r}=this.cameras,o=Phaser.Display.Bounds.GetCenterY(n);r.scrollY=o-r.displayHeight/2}resize(){super.resize(),this.resizeCamera(),this.alignScrollbar()}resizeCamera(){let e=this.cameras.main;e.setOrigin(0),e.zoom=E.GAME_WIDTH/this.background.width,e.setBounds((E.GAME_WIDTH-e.displayWidth)/2,(E.GAME_HEIGHT-e.displayHeight)/2,e.displayWidth,this.background.height)}alignScrollbar(){this.scrollbar.x=E.GAME_WIDTH-10,this.scrollbar.onResize()}update(e,t){this.cameraScroll.update()}onShutdown(){this.cameraScroll.removePointerListeners()}},nt;(function(e){e.LOCKED="LOCKED",e.UNLOCKED="UNLOCKED",e.COMPLETE="COMPLETE"})(nt||(nt={}));var ch=class extends Phaser.GameObjects.Container{get levelNumber(){return this._levelNumber}get iconState(){return this._iconState}constructor(e,t){super(e);this.iconData=t,this.name="level_icon_"+this.iconData.levelNumber.toString(),this._levelNumber=this.iconData.levelNumber,this.addBack(),this.addIcon(),this.addLevelNumber(),this.setSize(this.back.width,this.back.height),this.setInitialState()}setInitialState(){this.iconData.locked?this.setLocked():this.iconData.complete?this.setComplete():this.setUnlocked()}setLocked(){this._iconState=nt.LOCKED,this.back.setFrame("level_icons/level_icon_locked"),this.icon.kill(),this.levelNumberText.kill(),this.removeInteractive()}setUnlocked(){this._iconState=nt.UNLOCKED,this.back.setFrame(this.getBackFrame()),this.icon.revive(),this.levelNumberText.revive(),this.setInteractive(),this.input.cursor="pointer"}setComplete(){this._iconState=nt.COMPLETE,this.back.setFrame(this.getBackFrame()),this.icon.revive(),this.icon.setFrame("level_icons/check_icon"),this.levelNumberText.revive(),this.setInteractive(),this.input.cursor="pointer"}addBack(){let e=this.getBackFrame();this.back=this.scene.add.image(0,0,"level_map",e),this.add(this.back)}getBackFrame(){return this.iconData.isHard?"level_icons/level_icon_hard":"level_icons/level_icon_classic"}addIcon(){let e=this.iconData.isHard?"level_icons/skull_icon":"level_icons/chef_hat_icon";this.icon=this.scene.add.image(0,0,"level_map",e),this.icon.x=1,this.icon.y=-20,this.icon.alpha=.8,this.add(this.icon)}addLevelNumber(){let e=this.iconData.isHard?B.LEVEL_ICONS_HARD:B.LEVEL_ICONS_CLASSIC;this.levelNumberText=this.scene.add.bitmapText(0,0,e,this._levelNumber.toString(),32),this.levelNumberText.setLetterSpacing(1),this.levelNumberText.setOrigin(.5,.5),this.levelNumberText.x=-2,this.levelNumberText.y=24,this.add(this.levelNumberText)}},dh=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="label",this.addBack(),this.addIcon(t),this.addPlusButton(),this.addText(),this.addParticles(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"level_map","top_panel/label_back"),this.add(this.back)}addIcon(e){let t=this.scene.add.image(0,0,"level_map",e);this.icon=this.scene.add.container(0,0,t),this.icon.x=this.back.left,this.add(this.icon)}addPlusButton(){this.plusButton=this.scene.add.button("level_map","top_panel/PinkPurple-RectangleButton",this),this.plusButton.x=this.back.right,this.plusButton.y=-3,this.plusButton.inflateHitArea(10,10),this.add(this.plusButton)}addText(){let e="0000";this.text=this.scene.add.bitmapText(0,0,B.LEVEL_MAP_TOP_PANEL,e,25),this.text.setOrigin(.5,.5),this.text.y=4,this.add(this.text)}addParticles(){this.particles=this.scene.add.particles("level_map"),this.particles.x=this.icon.x,this.particles.y=this.icon.y,this.emitter=this.particles.createEmitter({frame:["circle_fx"],scale:{start:.66,end:1.33,ease:m.ExpoOut},alpha:{start:.55,end:0,ease:m.ExpoOut},lifespan:2e3,frequency:500,on:!1}),this.addAt(this.particles,0)}updateText(e){this.text.text=e}animateIcon(){var e;(e=this.iconTween)==null||e.remove(),this.iconTween=this.scene.tweens.add({targets:this.icon,duration:233,ease:Phaser.Math.Easing.Cubic.Out,scale:1.15,onComplete:()=>{this.scene.time.delayedCall(100,()=>{this.emitter.emitParticle()}),this.iconTween=this.scene.tweens.add({targets:this.icon,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}})}showTextFx(e){let t=this.createTextFx(e);t.setOrigin(.5,.5),t.setShadow(0,3,"rgba(0,0,0,0.3)",0),t.x=this.text.x,t.y=this.text.y+15,this.add(t),this.animateTextFx(t)}createTextFx(e){let t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"25px",color:"#FEEDBD",align:"center",resolution:2};return this.scene.add.text(0,0,e,t)}animateTextFx(e){e.alpha=0,this.scene.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{this.scene.tweens.add({delay:1300,targets:e,duration:500,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{e.destroy()}})}}),e.scale=.5,this.scene.tweens.add({targets:e,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1}),this.scene.tweens.add({targets:e,duration:1800,ease:Phaser.Math.Easing.Linear,y:"+=25"})}},p0=class extends dh{constructor(e,t){super(e,"top_panel/Red-Life-Icon");if(this.scene.sys.updateList.add(this),this.name="lives_label",this.addLivesText(),this.addFullLabel(),this.initLivesManager(t),this.updateLivesNum(this.lives.getLivesNum()),this.lives.isUnlimited()){this.onUnlimitedTimerStart();return}this.lives.isFull()?this.showFullLabel():this.hideFullLabel()}addLivesText(){let e=this.scene.game.store.getNumber(g.LIVES).toString(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center",strokeThickness:5,stroke:"#E63C7B"};this.livesTextDefaultStyle=t,this.livesText=this.scene.add.text(0,0,e,this.livesTextDefaultStyle),this.livesText.setOrigin(.5,.5),this.livesText.y=-1,this.icon.add(this.livesText)}addFullLabel(){let e=this.scene.texts.lives.full,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"22px",color:"#FEEDBD",align:"center"};this.fullLabel=this.scene.add.text(0,0,e,t),this.fullLabel.setOrigin(.5,.5),this.fullLabel.x=this.text.x,this.fullLabel.y=-1,this.fullLabel.kill(),this.add(this.fullLabel)}initLivesManager(e){this.lives=e,this.lives.on(N.REFILL_TIMER_START,this.onRefillTimerStart,this),this.lives.on(N.REFILL_TIMER_COMPLETE,this.onRefillTimerComplete,this),this.lives.on(N.UNLIMITED_TIMER_START,this.onUnlimitedTimerStart,this),this.lives.on(N.UNLIMITED_TIMER_COMPLETE,this.onUnlimitedTimerComplete,this),this.lives.on(N.LIVES_ADDED,this.onLivesAdded,this),this.lives.on(N.PAGE_VISIBLE,this.onPageVisible,this)}onRefillTimerStart(e,t){this.hideFullLabel(),this.updateLivesNum(e.getLivesNum()),this.updateText(e.refillTimer.getFormattedTime())}onRefillTimerComplete(){this.updateLivesNum(this.lives.getLivesNum()),this.animateIcon(),this.lives.isFull()&&this.showFullLabel()}onUnlimitedTimerStart(){this.hideFullLabel(),this.updateLivesNum(Infinity),this.updateText(this.lives.unlimitedTimer.getFormattedTime())}onUnlimitedTimerComplete(){this.updateLivesNum(this.lives.getLivesNum()),this.animateIcon(),this.lives.isFull()&&this.showFullLabel()}onLivesAdded(){this.updateLivesNum(this.lives.getLivesNum())}onPageVisible(e,t){t<=0||(this.updateLivesNum(this.lives.getLivesNum()),this.animateIcon(),this.lives.isFull()&&this.showFullLabel())}updateLivesNum(e){e===Infinity?(this.livesText.setFontFamily("Arial"),this.livesText.setFontSize(42),this.livesText.setFontStyle(Wt.BOLD),this.livesText.text=lo):(this.livesText.setStyle(this.livesTextDefaultStyle),this.livesText.text=e.toString())}showFullLabel(){this.fullLabel.revive(),this.text.kill()}hideFullLabel(){this.fullLabel.kill(),this.text.revive()}preUpdate(e,t){var s,i;if((s=this.lives.unlimitedTimer)==null?void 0:s.isRunning){this.updateText(this.lives.unlimitedTimer.getFormattedTime());return}((i=this.lives.refillTimer)==null?void 0:i.isRunning)&&this.updateText(this.lives.refillTimer.getFormattedTime())}onLanguageChange(){this.fullLabel.text=this.scene.texts.lives.full}preDestroy(){this.lives.off(N.REFILL_TIMER_START,this.onRefillTimerStart,this),this.lives.off(N.REFILL_TIMER_COMPLETE,this.onRefillTimerComplete,this),this.lives.off(N.UNLIMITED_TIMER_START,this.onUnlimitedTimerStart,this),this.lives.off(N.UNLIMITED_TIMER_COMPLETE,this.onUnlimitedTimerComplete,this),this.lives.off(N.LIVES_ADDED,this.onLivesAdded,this),this.lives.off(N.PAGE_VISIBLE,this.onPageVisible,this),this.scene.sys.updateList.remove(this),super.preDestroy()}},g0=class extends dh{constructor(e){super(e,"top_panel/Coin");this.scene.game.store.on(ht.CLEAR,this.onClearStore,this),this.coinSoundThrottled=Ft(this.playCoinAddSound.bind(this),100)}playCoinAddSound(){this.scene.audio.play(u.COIN_ADD)}onClearStore(){this.text.text=this.scene.game.store.getNumber(g.COINS).toLocaleString()}updateContent(e){var t;let s=this.text.text.replace(/[,. ]/g,""),i=parseInt(s)||0,a=e>0;(t=this.counterTween)==null||t.remove(),this.counterTween=this.scene.tweens.addCounter({from:i,to:e,duration:1e3,ease:Phaser.Math.Easing.Expo.Out,onUpdate:n=>{this.updateContentInstant(Math.round(n.getValue())),a&&n.progress<.85&&this.coinSoundThrottled()}})}updateContentInstant(e){this.text.text=e.toLocaleString()}syncWithGameStore(e){let t=this.scene.game.store.getNumber(g.COINS);e?this.updateContentInstant(t):this.updateContent(t)}showCoinsTextFx(e){let s=(e>=0?"+":"")+e.toString();super.showTextFx(s)}preDestroy(){this.coinSoundThrottled.cancel(),this.scene.game.store.off(ht.CLEAR,this.onClearStore,this),super.preDestroy()}},m0=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.name="top_panel",this.addBack(),this.addLivesLabel(),this.addCoinsLabel(),this.addSettingsButton(),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"level_map","top_panel/top_panel_back"),this.add(this.back)}addLivesLabel(){this.livesLabel=new p0(this.scene,this.scene.game.lives),this.livesLabel.x=this.back.left+150,this.livesLabel.y=45,this.add(this.livesLabel)}addCoinsLabel(){let e=this.scene.game.store.getNumber(g.COINS);this.coinsLabel=new g0(this.scene),this.coinsLabel.x=82,this.coinsLabel.y=this.livesLabel.y,this.coinsLabel.updateText(e.toLocaleString()),this.add(this.coinsLabel),this.scene.game.purchases||(this.coinsLabel.plusButton.kill(),this.coinsLabel.x=100)}addSettingsButton(){this.settingsButton=this.scene.add.button("level_map","top_panel/button_settings",this),this.settingsButton.x=this.back.right-70,this.settingsButton.y=this.coinsLabel.y-2}enableInteractiveItems(){this.getInteractiveItems().forEach(e=>e.enableInput())}disableInteractiveItems(){this.getInteractiveItems().forEach(e=>e.disableInput())}getInteractiveItems(){return[this.settingsButton,this.livesLabel.plusButton,this.coinsLabel.plusButton]}},f0=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);t?t.add(this):this.scene.add.existing(this),this.addBack(),this.addArrows(),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"level_map","settings/pink_button_long"),this.add(this.back)}addArrows(){let e=160,t=2;this.leftArrow=this.scene.add.button("level_map","settings/arrow_left",this),this.leftArrow.x=-e,this.leftArrow.y=t,this.rightArrow=this.scene.add.button("level_map","settings/arrow_right",this),this.rightArrow.x=e,this.rightArrow.y=t}addText(){this.text=this.scene.add.text(0,0,"Language",this.getTextStyle()),this.text.setOrigin(.5,.5),this.text.x=6,this.text.y=-2,this.add(this.text)}getTextStyle(){return{color:"#FFFFFF",fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"45px",align:"center",padding:{x:2,y:6},shadow:{fill:!0,blur:0,offsetY:3,color:"rgba(0,0,0,0.2)"}}}updateText(e){this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:this.text,duration:66,ease:Phaser.Math.Easing.Linear,alpha:0,onComplete:()=>{this.text.setText(e),this.adjustTextSize(),this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}})}adjustTextSize(){let e=this.leftArrow.right,i=(this.rightArrow.left-e)*.9;this.text.scale=Math.min(1,i/this.text.width)}},E0=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.atlasKey=t,this.name="buttons_container",this.addBackground(),this.addButtons(),this.addRoboWhaleInfo(),this.alignItems(),this.settingsContent=this.getSettingsContent(),this.creditsContent=[this.robowhaleInfo],this.showSettingsContent(),this.setSize(this.background.width,this.background.height)}getSettingsContent(){return[this.soundButton,this.musicButton,this.languagesButton,this.graphicsQualityButton]}showContent(e){e.forEach(t=>t.visible=!0),this.scene.tweens.add({targets:e,alpha:{from:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200},scale:{from:.75,to:1,ease:Phaser.Math.Easing.Back.Out,duration:400}})}hideContent(e){e.forEach(t=>t.visible=!1)}showSettingsContent(){this.showContent(this.settingsContent),this.hideContent(this.creditsContent),this.makePrimaryButton(this.settingsButton),this.makeSecondaryButton(this.creditsButton)}showCreditsContent(){this.showContent(this.creditsContent),this.hideContent(this.settingsContent),this.makePrimaryButton(this.creditsButton),this.makeSecondaryButton(this.settingsButton)}makePrimaryButton(e){e.disableInteractive(),this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.scene.tweens.add({targets:e,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.33],scale:1})}makeSecondaryButton(e){e.setInteractive(),this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:200,ease:Phaser.Math.Easing.Quadratic.Out,alpha:.7}),this.scene.tweens.add({targets:e,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.33],scale:.85})}addBackground(){this.background=this.scene.add.image(0,0,this.atlasKey,"settings/white_rect"),this.background.displayWidth=465,this.background.displayHeight=660,this.background.alpha=0,this.add(this.background)}addButtons(){this.settingsButton=this.scene.add.button(this.atlasKey,"settings/button_settings",this),this.settingsButton.areTweensEnabled=!1,this.settingsButton.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.showSettingsContent,this),this.creditsButton=this.scene.add.button(this.atlasKey,"settings/button_credits",this),this.creditsButton.areTweensEnabled=!1,this.creditsButton.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.showCreditsContent,this),this.soundButton=this.scene.add.soundButton(this.atlasKey,"settings/button_sound_on","settings/button_sound_off",this),this.musicButton=this.scene.add.musicButton(this.atlasKey,"settings/button_music_on","settings/button_music_off",this),this.addLanguageButton(),this.addGraphicsQualityButton()}addLanguageButton(){let e=vo(this.scene.game.texts.language);this.languagesButton=new f0(this.scene,this),this.languagesButton.leftArrow.on(_.PRESS,this.updateLanguage.bind(this,-1)),this.languagesButton.rightArrow.on(_.PRESS,this.updateLanguage.bind(this,1)),this.languagesButton.updateText(e)}updateLanguage(e){let t=this.scene.game.texts,s=t.language,i=t.allLanguages,a=i.indexOf(s),n=Phaser.Math.Wrap(a+e,0,i.length),r=i[n];this.scene.game.store.saveValue(g.LANGUAGE,r),this.scene.game.texts.setLanguage(r),this.languagesButton.updateText(vo(r))}addGraphicsQualityButton(){let e={back:{key:"level_map",frame:"settings/pink_button_long"},leftArrow:{key:"level_map",frame:"settings/arrow_left"},rightArrow:{key:"level_map",frame:"settings/arrow_right"},title:this.scene.texts.graphics_quality.title};this.graphicsQualityButton=new Ao(this.scene,e,this)}addRoboWhaleInfo(){this.robowhaleInfo=this.scene.add.image(0,0,this.atlasKey,"settings/robowhale_info"),this.add(this.robowhaleInfo)}onRobowhaleClick(){window.open("https://robowhale.com/?utm_source=papa_cherry_saga")}alignItems(){let e=this.background.getBounds(),t=86,s=e.top+this.settingsButton.displayHeight/2;this.settingsButton.x=e.centerX-t,this.settingsButton.y=s,this.creditsButton.x=e.centerX+t,this.creditsButton.y=s,this.alignMiddleButtons(e),this.languagesButton.y=e.bottom-255,this.graphicsQualityButton.y=e.bottom-this.graphicsQualityButton.displayHeight/2,this.robowhaleInfo.y=e.top+370}alignMiddleButtons(e){let t=e.top+232;this.soundButton.x=this.settingsButton.x,this.soundButton.y=t,this.musicButton.x=this.creditsButton.x,this.musicButton.y=t}onLanguageChange(){this.graphicsQualityButton.onLanguageChange()}},ws;(function(e){e.CLOSE="__CLOSE",e.CLEAR_SAVED_DATA="__CLEAR_SAVED_DATA"})(ws||(ws={}));var v0=class extends ie{constructor(e){super(e,{name:"settings_screen",backgroundKey:"level_map",backgroundFrame:"black_rect",backgroundAlpha:.85});this.isActive=!0,this.ignoreBackgroundClicks=!1,this.addContent(),this.addCloseButton(),this.addBuildInfo()}addContent(){this.content=new E0(this.scene,"level_map"),this.add(this.content),this.pin(this.content,.5,.48)}addCloseButton(){this.closeButton=this.scene.add.button("level_map","settings/button_close",this),this.pin(this.closeButton,1,0,-80,80)}addBuildInfo(){let e=window.game.config,t=e.build_version.toString(),s=e.build_time,i=e.publisher,a=`Build #${t} ${s}
${i}`,n={fontFamily:p.DEFAULT_FAMILY,fontStyle:"normal",fontSize:"24px",color:"#ffffff",padding:{x:20,y:12},align:"center"},r=.8;this.buildInfo=this.scene.add.text(0,0,a,n),this.buildInfo.setOrigin(.5,.5),this.buildInfo.alpha=r,this.buildInfo.originalAlpha=r,this.buildInfo.clicks=0,this.buildInfo.setInteractive(),this.buildInfo.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBuildInfoClick,this),this.buildInfo.input.cursor="pointer",this.add(this.buildInfo),this.pin(this.buildInfo,.5,1,0,-46)}onBuildInfoClick(){this.scene.audio.playClick(),++this.buildInfo.clicks==5&&(this.buildInfo.clicks=0,this.emit(ws.CLEAR_SAVED_DATA))}resize(){super.resize()}show(){this.alpha=1,this.revive(),this.showBackground(),this.showBuildInfo(),this.showContent(),this.emit(b.SHOW,this),this.closeButton.once(_.PRESS,this.close,this),this.background.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackgroundClick,this)}showBuildInfo(){this.scene.tweens.add({targets:this.buildInfo,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:{from:0,to:this.buildInfo.originalAlpha}})}showContent(){[this.content,this.closeButton].forEach((t,s)=>{let i=s*100;t.alpha=0,this.scene.tweens.add({delay:i,targets:t,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});let a=t.scale;t.scale=a*.8,this.scene.tweens.add({delay:i,targets:t,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:a})})}hide(){this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emit(b.HIDE_COMPLETE,this)}})}close(){this.emit(ws.CLOSE,this),this.closeButton.off(_.PRESS,this.close,this),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.close,this)}onBackgroundClick(){this.ignoreBackgroundClicks||(this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBackgroundClick,this),this.close())}activate(){this.isActive||(this.isActive=!0,this.content.revive(),this.content.alpha=0,this.scene.tweens.add({targets:this.content,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.content.scale=.75,this.scene.tweens.add({targets:this.content,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.closeButton.revive(),this.closeButton.alpha=0,this.scene.tweens.add({targets:this.closeButton,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.closeButton.scale=.75,this.scene.tweens.add({targets:this.closeButton,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.buildInfo.revive(),this.scene.tweens.add({targets:this.buildInfo,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.buildInfo.originalAlpha}))}deactivate(){this.isActive!==!1&&(this.isActive=!1,this.content.kill(),this.closeButton.kill(),this.buildInfo.kill())}onLanguageChange(){this.content.onLanguageChange()}},Ps;(function(e){e.SPIN_START="Wheel_SPIN_START",e.SPIN_COMPLETE="Wheel_SPIN_COMPLETE"})(Ps||(Ps={}));var T0=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.isSpinning=!1,this.isIdling=!1,this.scene.sys.updateList.add(this),this.name="wheel",this.addShine(),this.addWheel(),this.addArrow(),this.setSize(this.back.width,this.back.height)}addShine(){this.shine=this.scene.add.image(0,0,"level_map","wheel/Shine Background"),this.add(this.shine)}addWheel(){this.back=this.scene.add.image(0,0,"level_map","wheel/Center Background"),this.items=this.createWheelItems(),this.alignItems(),this.border=this.scene.add.image(0,0,"level_map","wheel/Border"),this.particles=this.createParticles(),this.wheel=this.scene.add.container(0,0,[this.back,...this.items,this.border,this.particles]),this.add(this.wheel)}createWheelItems(){return[R.SUPER_SPHERE,R.LOLLIPOP,R.COINS,R.ROLLING_PIN,R.GLOVE,R.STRIPES,R.UNDO,R.BOMB].map(t=>{let s=this.getFrameByItemType(t),i=this.scene.add.image(0,0,"level_map",s);return i.itemType=t,i})}getFrameByItemType(e){return{[R.SUPER_SPHERE]:"wheel/items/super_sphere",[R.LOLLIPOP]:"wheel/items/Lollipop",[R.COINS]:"wheel/items/Coin",[R.ROLLING_PIN]:"wheel/items/rolling_pin",[R.GLOVE]:"wheel/items/Glove",[R.STRIPES]:"wheel/items/stripes",[R.UNDO]:"wheel/items/undo",[R.BOMB]:"wheel/items/bomb"}[e]}alignItems(){let e=162,t=new Phaser.Geom.Circle(0,0,e),s=Phaser.Geom.Circle.GetPoints(t,this.items.length);s.unshift(s[s.length-1]),s.unshift(s[s.length-2]),this.items.forEach((i,a)=>{let n=s[a];i.x=n.x,i.y=n.y})}createParticles(){let e=this.scene.add.particles("level_map");return this.circles=e.createEmitter({frame:"particles/circle_fx_3",scale:{start:.6,end:1.5,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:1e3,on:!1}),this.sparks=e.createEmitter(k(P({},Me.getCircleEdgeEmitZone(35)),{speed:50,frame:"particles/star_1",lifespan:{min:500,max:900},scale:{start:1,end:.5},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1})),e}addArrow(){this.arrow=this.scene.add.image(0,0,"level_map","wheel/Prize Arrow"),this.add(this.arrow)}spin(){if(this.isSpinning)return;this.isIdling=!1,this.emit(Ps.SPIN_START,this);let e=360/this.items.length,t=this.items.length*2,s=Phaser.Math.RND.between(t,t*2),i=Phaser.Math.Snap.To(this.wheel.angle+s*e,e),a=e/2,n=this.getSpinDuration(s);this.scene.tweens.addCounter({from:this.wheel.angle,to:i,duration:n,ease:m.ExpoOut,onUpdate:(r,o)=>{this.wheel.angle=o.value,o.value>a&&(a+=e,this.flickArrow(Phaser.Math.MapLinear(r.progress,0,1,33,300)))},onComplete:()=>{this.onSpinComplete()}})}getSpinDuration(e){return w.has("wheel")?w.getNumber("wheel",300):e*250}flickArrow(e=66){this.arrow.angle=0;let t=this.scene.tweens.getTweensOf(this.arrow)[0];t&&(this.scene.audio.play(u.WHEEL_SPIN_TICK),t.remove()),this.scene.tweens.add({targets:this.arrow,duration:e,ease:Phaser.Math.Easing.Sine.InOut,angle:"+=10",yoyo:!0,onComplete:()=>{this.scene.audio.play(u.WHEEL_SPIN_TICK)}})}onSpinComplete(){let e=this.getCurrentItem();this.scene.tweens.add({targets:e,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1.25}),this.sparks.setPosition(e.x,e.y),this.sparks.explode(10,e.x,e.y),this.circles.emitParticle(3,e.x,e.y),this.scene.audio.play(u.TWINKLE_3),this.emit(Ps.SPIN_COMPLETE,this)}getCurrentItem(){let e=360/this.items.length,t=this.wheel.angle<0?this.wheel.angle+360:this.wheel.angle;t=(t+e/2)%360,t=360-t;let s=(Math.floor(t/e)+1)%this.items.length;return this.items[s]}reset(){this.wheel.angle=0,this.isIdling=!0,this.items.forEach(e=>e.scale=1)}preUpdate(e,t){this.isIdling&&(this.wheel.angle-=.01*t)}},rt;(function(e){e.SPIN_START="__SPIN_START",e.SPIN_COMPLETE="__SPIN_COMPLETE",e.START_FAST_FORWARD="__START_FAST_FORWARD",e.STOP_FAST_FORWARD="__STOP_FAST_FORWARD"})(rt||(rt={}));var _0=class extends ie{constructor(e){super(e,{name:"wheel_screen",backgroundKey:"level_map",backgroundFrame:"black_rect",backgroundAlpha:.85});this.addCloseButton(),this.addWheel(),this.addSpinButton()}addCloseButton(){this.closeButton=this.scene.add.button("level_map","wheel/Close Button",this),this.closeButton.on(_.PRESS,this.hide,this),this.add(this.closeButton),this.pin(this.closeButton,1,0,-64,64)}addWheel(){this.wheel=new T0(this.scene),this.wheel.on(Ps.SPIN_START,this.onSpinStart,this),this.wheel.on(Ps.SPIN_COMPLETE,this.onSpinComplete,this),this.add(this.wheel),this.pin(this.wheel,.5,.425)}onSpinStart(e){this.emit(rt.SPIN_START,this)}onSpinComplete(e){this.cancelFastForward(),this.background.off(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN),this.scene.tweens.add({delay:666,targets:e,duration:400,ease:Phaser.Math.Easing.Back.In,scale:0,alpha:0,onComplete:()=>{this.emit(rt.SPIN_COMPLETE,this,this.wheel),this.hideInstant()}})}addSpinButton(){this.spinButton=this.scene.add.button("level_map","wheel/Pink Button",this),this.spinButton.on(_.PRESS,this.onSpinButtonClick,this)}onSpinButtonClick(){this.hideCloseButton(),this.hideSpinButton(),this.wheel.spin(),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.applyFastForward,this)}applyFastForward(){this.emit(rt.START_FAST_FORWARD,this,4)}cancelFastForward(){this.emit(rt.STOP_FAST_FORWARD,this)}hideCloseButton(){this.closeButton.disableInput(),this.scene.tweens.add({targets:this.closeButton,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.closeButton.kill()}})}hideSpinButton(){this.spinButton.disableInput(),this.scene.tweens.add({targets:this.spinButton,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.stopAnimatingSpinButton(),this.spinButton.kill()}})}resize(){super.resize(),this.alignSpinButton()}alignSpinButton(){let e=this.wheel.y+this.wheel.height/2,s=this.screenHeight-e;this.spinButton.x=this.screenCenter.x,this.spinButton.y=e+s/2+35}show(){this.alpha=1,this.wheel.reset(),this.closeButton.alpha=1,this.closeButton.enableInput(),this.closeButton.revive(),this.spinButton.alpha=1,this.spinButton.enableInput(),this.spinButton.revive(),this.scene.audio.play(u.WHEEL_OPEN,{volume:.66}),this.revive(),this.showItems(),this.startAnimatingSpinButton(),this.emit(b.SHOW,this)}showItems(){let e=[this.wheel,this.spinButton,this.closeButton];e.forEach(s=>{s.alpha=0,s.scale=.8});let t=this.scene.tweens.stagger(100);this.scene.tweens.add({targets:e,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,delay:t}),this.scene.tweens.add({targets:e,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1,delay:t})}hide(){this.emit(b.HIDE_START,this),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.onHideComplete()}})}hideInstant(){this.emit(b.HIDE_START,this),this.onHideComplete()}onHideComplete(){this.kill(),this.stopAnimatingSpinButton(),this.emit(b.HIDE_COMPLETE,this)}startAnimatingSpinButton(){this.animateSpinButtonEvent=this.scene.time.addEvent({repeat:-1,startAt:2e3,delay:3e3,callback:this.shakeSpinButton,callbackScope:this})}shakeSpinButton(){this.scene.tweens.add({targets:this.spinButton,duration:266,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.1,scaleY:1.1,repeat:2,yoyo:!0})}stopAnimatingSpinButton(){var e;(e=this.animateSpinButtonEvent)==null||e.remove(),this.scene.tweens.killTweensOf(this.spinButton),this.spinButton.scale=1}preDestroy(){this.cancelFastForward(),super.preDestroy()}},uh;(function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"})(uh||(uh={}));var ph=class extends Phaser.GameObjects.Container{constructor(e){super(e);this.originalScale=1,this.wasInCamera=!1,this.direction=1,this.name="avatar",this.addAvatar(),this.addBorder(),this.setSize(this.avatar.width,this.avatar.height),this.setInteractive(),this.input.hitArea.y=this.avatar.y,this.input.cursor="pointer"}enableInput(){this.input.enabled=!0}disableInput(){this.input.enabled=!1}addAvatar(){this.avatar=this.scene.add.image(0,0,"level_map","avatar"),this.avatar.y=-74,this.add(this.avatar)}addBorder(){this.border=this.scene.add.image(0,0,"level_map","avatar_back"),this.add(this.border)}lookUp(){this.direction!==0&&(this.border.angle=-180,this.avatar.y=74,this.input.hitArea.y=this.avatar.y,this.direction=0)}lookBottom(){this.direction!==1&&(this.border.angle=0,this.avatar.y=-74,this.input.hitArea.y=this.avatar.y,this.direction=1)}show(){var e;return this.alpha=0,this.scale=.8,(e=this.showTween)==null||e.remove(),this.showTween=this.scene.tweens.add({targets:this,alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out},scale:{value:1,duration:400,ease:Phaser.Math.Easing.Back.Out}}),this.showTween}hide(){this.kill()}startWiggle(){var e;(e=this.wiggleTween)==null||e.remove(),this.wiggleTween=this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:this.originalScale*.9,repeat:-1,yoyo:!0})}stopWiggle(){var e;(e=this.wiggleTween)==null||e.remove(),this.wiggleTween=this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,scale:this.originalScale})}addParticles(){this.particles||(this.particles=this.scene.add.particles("level_map"),this.particles.x=this.avatar.x,this.particles.y=this.avatar.y,this.circlesEmitter=this.particles.createEmitter({frame:"circle_fx",scale:{start:1,end:2,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.ExpoOut},lifespan:2e3,frequency:500,on:!1}),this.add(this.particles))}getOffsetY(){return-70}budgeUp(){let e=20,t=this.direction===1?`-=${e}`:`+=${e}`;this.scene.tweens.add({targets:this.list,duration:188,ease:Phaser.Math.Easing.Sine.InOut,y:t,yoyo:!0})}showCircleFx(){this.particles||this.addParticles(),this.circlesEmitter.explode(1,0,0)}getGlobalCenter(){return this.avatar.getGlobalCenter()}moveBetweenLevelIcons(e){let t=600,s=200;this.scene.tweens.add({delay:s,targets:this,duration:t,ease:Phaser.Math.Easing.Quadratic.InOut,x:e.x,y:e.y});let i=15,a=e.x>this.x?-i:i;this.scene.tweens.add({targets:this,duration:s,ease:Phaser.Math.Easing.Cubic.Out,angle:a,onComplete:()=>{this.scene.tweens.add({targets:this,duration:t+50,ease:Phaser.Math.Easing.Cubic.Out,angle:this.angle*-1,onComplete:()=>{this.scene.tweens.add({targets:this,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],angle:0})}})}})}},y0=class extends ie{constructor(e){super(e,{name:"wheel_reward_screen",backgroundKey:"rewards",backgroundFrame:"rewards/black_rect.png",backgroundAlpha:.85});this.addFlags(),this.addParticles(),this.addRewardButtons(),this.addClaimRewardText()}addFlags(){this.leftFlags=this.scene.add.image(0,0,"rewards","rewards/flags_left.png"),this.add(this.leftFlags),this.pin(this.leftFlags,0,0),this.rightFlags=this.scene.add.image(0,0,"rewards","rewards/flags_right.png"),this.add(this.rightFlags),this.pin(this.rightFlags,1,0)}addParticles(){this.particles=this.scene.add.particles("rewards"),this.pin(this.particles,.5,.5),this.add(this.particles),this.circlesEmitter=this.particles.createEmitter({frame:"rewards/particles/wheel_reward_circle.png",scale:{start:.4,end:3,ease:m.ExpoOut},alpha:{start:.8,end:0,ease:m.CubicOut},lifespan:2e3,on:!1}),this.sparksEmitter=this.particles.createEmitter({frame:"rewards/particles/wheel_reward_spark.png",lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:m.ExpoOut},scale:{start:1.33,end:0},emitZone:{source:new Phaser.Geom.Circle(0,0,100),type:"random"},on:!1}),this.sparksEmitter.reserve(100)}addRewardButtons(){let e={extraButtonText:this.scene.texts.rewards.x2,claimButtonText:this.scene.texts.rewards.decline};this.rewardButtons=new nn(this,e),this.rewardButtons.extraRewardButton.on(_.RELEASE,this.onDoubleRewardButtonClick,this),this.rewardButtons.claimButton.on(_.PRESS,this.onClaimButtonClick,this)}onDoubleRewardButtonClick(){this.scene.game.ads.showRewardedAd("LevelMap:WheelReward:DoubleRewardButton").then(e=>{e&&this.onWheelRewardDoubled()})}onWheelRewardDoubled(){this.rewardButtons.extraRewardButton.kill(),this.rewardButtons.claimButton.kill(),this.onRewardDoubled()}onClaimButtonClick(){this.scene.game.toasts.dismissAll(),this.collectReward()}addClaimRewardText(){let e=this.scene.texts.stars_gift.claim_rewards,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.28)",strokeThickness:10};this.claimRewardText=this.scene.add.text(0,0,e,t),this.claimRewardText.setOrigin(.5,.5),this.claimRewardText.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.8,!0),this.claimRewardText.setLineSpacing(-8),this.claimRewardText.kill(),this.add(this.claimRewardText),this.pin(this.claimRewardText,.5,.8)}resize(){super.resize(),this.leftFlags.originalX=this.leftFlags.x,this.rightFlags.originalX=this.rightFlags.x,this.claimRewardText.originalY=this.claimRewardText.y}alignReward(){!this.reward||(this.reward.x=this.screenWidth/2,this.reward.y=this.screenHeight*this.reward.originalY)}addReward(e,t=1){this.reward||(this.reward=new Yi(this.scene),this.reward.updateView(e,t),this.reward.originalY=.425,this.add(this.reward),this.alignReward())}show(){this.scene.audio.play(u.WHEEL_REWARD,{volume:.5}),this.alpha=1,this.background.alpha=this.options.backgroundAlpha,this.rewardButtons.reset(),this.emit(b.SHOW,this),this.revive(),this.showFlags(300),this.showReward(),this.showParticles(),window.game.config.ads.rewarded?(this.rewardButtons.show(800),this.moveRewardUp(800)):(this.rewardButtons.extraRewardButton.kill(),this.rewardButtons.claimButton.kill(),this.showClaimRewardText(800),this.scene.time.delayedCall(800,()=>{this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.collectReward,this)}))}showFlags(e){this.leftFlags.alpha=0,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.leftFlags.scale=.75,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.rightFlags.alpha=0,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.rightFlags.scale=.75,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1});let t=60,s=50;this.leftFlags.x=this.leftFlags.originalX-t,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:this.leftFlags.originalX}),this.rightFlags.x=this.rightFlags.originalX+t,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:this.rightFlags.originalX}),this.leftFlags.y=-s,this.rightFlags.y=-s,this.scene.tweens.add({delay:e,targets:[this.leftFlags,this.rightFlags],duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],y:0})}showReward(){!this.reward||(this.reward.alpha=0,this.scene.tweens.add({targets:this.reward,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.reward.scale=.5,this.scene.tweens.add({targets:this.reward,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1,onComplete:()=>{var e;(e=this.reward)==null||e.startFloat(0)}}),this.reward.showText(300))}showParticles(){this.particles.setPosition(this.reward.x,this.reward.y),this.circlesEmitter.emitParticle(1,0,-6),this.sparksEmitter.emitParticle(100)}moveRewardUp(e){this.scene.tweens.add({delay:e,targets:this.reward,duration:400,ease:Phaser.Math.Easing.Quadratic.InOut,y:"-=60"})}onRewardDoubled(){this.scene.audio.play(u.WHEEL_REWARD,{volume:.5}),this.showParticles(),this.doubleReward(),this.showClaimRewardText(600),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.collectReward,this)}doubleReward(){this.reward.stopFloat(),this.reward.setRewardNum(this.reward.rewardNum*2),this.reward.showTextDoubled(300),this.reward.alpha=0,this.scene.tweens.add({targets:this.reward,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.reward.scale=.3,this.scene.tweens.add({targets:this.reward,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1,onComplete:()=>{var e;(e=this.reward)==null||e.startFloat()}})}showClaimRewardText(e){this.claimRewardText.revive(),this.claimRewardText.alpha=0,this.scene.tweens.add({delay:e,targets:this.claimRewardText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.claimRewardText.y=this.claimRewardText.originalY+20,this.scene.tweens.add({delay:e,targets:this.claimRewardText,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.claimRewardText.originalY}),this.scene.tweens.add({delay:e,targets:this.claimRewardText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}collectReward(){this.scene.audio.play(u.FANCY_TAP),this.emit(Fs.COLLECT_START,this),this.rewardButtons.hide(),this.hideFlags(),this.hideClaimRewardsText(),this.doCollectReward()}hideFlags(){this.scene.tweens.add({targets:this.leftFlags,duration:300,ease:Phaser.Math.Easing.Cubic.Out,x:"-=60",alpha:0}),this.scene.tweens.add({targets:this.rightFlags,duration:300,ease:Phaser.Math.Easing.Cubic.Out,x:"+=60",alpha:0})}hideClaimRewardsText(){this.scene.tweens.killTweensOf(this.claimRewardText),this.scene.tweens.add({targets:this.claimRewardText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,y:"+=30",alpha:0,onComplete:()=>{this.claimRewardText.kill()}})}doCollectReward(){this.reward.hideTextAndRays(),this.reward.stopFloat(),this.scene.tweens.add({targets:this.reward,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=30",onComplete:()=>{this.emit(Fs.COLLECT_COMPLETE,this.reward),this.reward.destroy(),this.reward=null,this.hide()}})}hide(){this.emit(b.HIDE_START,this),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill(),this.emit(b.HIDE_COMPLETE,this)}})}onLanguageChange(){this.rewardButtons.extraRewardButton.text.text=this.scene.texts.rewards.x2,this.rewardButtons.claimButton.text.text=this.scene.texts.rewards.decline,this.claimRewardText.text=this.scene.texts.stars_gift.claim_rewards}},ca;(function(e){e.ALL_REWARDS_COLLECTED="__ALL_REWARDS_COLLECTED"})(ca||(ca={}));var C0=class extends ie{constructor(e){super(e,{name:"gift_screen",backgroundKey:"rewards",backgroundFrame:"rewards/black_rect.png",backgroundAlpha:.85});this.autoPlay=!1,this.addRewards(),this.addGift(),this.addRewardButtons(),this.addClaimRewardsText()}addRewards(){let e=this.scene.game.gifts.getGiftRewards(3);this.rewards=e.map(t=>{let s=new Vi(this.scene,t.type,t.num);return s.kill(),this.add(s),s})}addGift(){this.gift=new Po(this.scene),this.add(this.gift),this.pin(this.gift,.5,.62)}addRewardButtons(){let e={extraButtonText:this.scene.texts.rewards.bonus,claimButtonText:this.scene.texts.rewards.decline};this.rewardButtons=new nn(this,e)}addClaimRewardsText(){let e=this.scene.texts.stars_gift.claim_rewards,t=this.getHintTextStyle();this.claimRewardsText=this.scene.add.text(0,0,e,t),this.claimRewardsText.setWordWrapWidth(E.SOURCE_GAME_WIDTH*.75,!0),this.claimRewardsText.setLineSpacing(-8),this.claimRewardsText.setOrigin(.5,.5),this.claimRewardsText.kill(),this.claimRewardsText.originalY=this.claimRewardsText.y,this.pin(this.claimRewardsText,.5,.87),this.add(this.claimRewardsText)}getHintTextStyle(){return{fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"36px",color:"#ffffff",align:"center",stroke:"rgba(0,0,0,0.28)",strokeThickness:10}}resize(){super.resize(),this.alignRewards(),this.alignHintTexts()}alignRewards(){let e=this.screenWidth/2,t=this.screenHeight*.3,s=230,i=50;this.rewards[0].x=e-s,this.rewards[0].y=t+i,this.rewards[1].x=e,this.rewards[1].y=t,this.rewards[2].x=e+s,this.rewards[2].y=t+i}alignHintTexts(){let e=this.gift.y,s=this.screenHeight-e,i=e+s/2;this.claimRewardsText.x=this.screenWidth/2,this.claimRewardsText.y=i}show(){this.emit(b.SHOW,this),this.revive(),this.showBackground(),this.showGift(200),this.autoPlay?this.scene.time.delayedCall(400,()=>this.openGift()):this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.openGift,this)}showGift(e){this.gift.alpha=0,this.scene.tweens.add({delay:e,targets:this.gift,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.gift.scale=.66,this.scene.tweens.add({delay:e,targets:this.gift,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onStart:()=>{this.gift.show()}})}openGift(){this.scene.audio.playClick(),this.gift.once(js.EXPLODE_COMPLETE,this.onGiftExplodeComplete,this),this.gift.explode()}onGiftExplodeComplete(){this.scene.time.delayedCall(1500,()=>{this.gift.kill()}),this.showRewards(0),window.game.config.ads.rewarded?(this.rewardButtons.show(400),this.rewardButtons.extraRewardButton.once(_.RELEASE,this.showBonusRewardVideo,this),this.rewardButtons.claimButton.once(_.PRESS,this.claimRewards,this)):(this.showClaimRewardText(0),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.claimRewards,this))}showRewards(e){this.rewards.forEach((t,s)=>{let i=e+s*100,a=t.x,n=t.y;t.revive(),t.startFloat(i),t.alpha=0,this.scene.tweens.add({targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{t.showParticles()}}),t.scale=.66,this.scene.tweens.add({targets:t,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],scale:1}),t.x=this.gift.x,t.y=this.gift.y,this.scene.tweens.add({targets:t,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:a,y:n})})}showClaimRewardText(e){this.claimRewardsText.revive(),this.claimRewardsText.alpha=0,this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.claimRewardsText.y=this.claimRewardsText.originalY+30,this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.claimRewardsText.originalY}),this.scene.tweens.add({delay:e,targets:this.claimRewardsText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})}showBonusRewardVideo(){this.scene.game.ads.showRewardedAd("LevelMap:GiftScreen:BonusButton").then(e=>{!e||(this.rewardButtons.hide(),this.addBonusReward(200),this.showClaimRewardText(500),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.claimRewards,this),this.scene.audio.play(u.WHEEL_REWARD,{volume:.5}))})}addBonusReward(e){let t=this.getBonusRewardType(),s=this.getBonusRewardsNum(t),i=new Vi(this.scene,t,s);i.x=this.screenWidth/2,i.y=this.rewards[1].y+270,this.add(i),this.rewards.push(i),i.alpha=0,this.scene.tweens.add({delay:e,targets:i,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:()=>{i.startFloat(0),i.showParticles()}}),i.scale=.5,this.scene.tweens.add({delay:e,targets:i,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1});let a=i.y;i.y=a+50,this.scene.tweens.add({delay:e,targets:i,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],y:a})}getBonusRewardType(){let e=dt.getAllTypes(),t=this.rewards.map(i=>i.rewardType),s=Tt(e,...t);return Phaser.Math.RND.pick(s)}getBonusRewardsNum(e){var t;return(t=window.game.config.video_rewards[e])!=null?t:1}claimRewards(){this.rewardButtons.hide(),this.hideClaimRewardsText(),this.collectRewards(),this.scene.game.toasts.dismissAll(),this.scene.audio.play(u.FANCY_TAP),this.scene.time.delayedCall(300,()=>{this.hide()})}hideClaimRewardsText(){this.scene.tweens.killTweensOf(this.claimRewardsText),this.scene.tweens.add({targets:this.claimRewardsText,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=30",onComplete:()=>{this.claimRewardsText.kill()}})}collectRewards(){this.scene.tweens.add({targets:this.rewards,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=30"})}hide(){this.emitHideStartEvent(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.emitRewardsCollectedEvent(),this.emitHideCompleteEvent(),this.destroy()}})}emitRewardsCollectedEvent(){let e=this.rewards.map(t=>({type:t.rewardType,num:t.rewardNum}));this.emit(ca.ALL_REWARDS_COLLECTED,e)}},_n=class extends fe{constructor(e,t,s,i){super(e,t,s,i);this.addBitmapText("0000",B.LEVEL_MAP_BOTTOM_LABELS,24),this.bitmapText.setLetterSpacing(1)}},S0=class extends _n{constructor(e){super(e,"level_map","button_gift");this.name="button_gift",this.store=this.scene.game.store,this.giftsManager=this.scene.game.gifts,this.currentStars=this.giftsManager.getCurrentStars(),this.targetStars=this.giftsManager.getTargetStars(),this.back.y=32,this.doAddIcon(),this.addParticles(),this.setupText(),this.currentStars>=this.targetStars&&this.onTargetStarsNumReached()}doAddIcon(){this.addIcon("level_map","button_gift_star",0,18),this.icon.originalX=this.icon.x,this.icon.originalY=this.icon.y}addParticles(){this.circlesManager=this.scene.add.particles("level_map"),this.circlesManager.setPosition(0,-10),this.addAt(this.circlesManager,0),this.circles=this.circlesManager.createEmitter({frame:"particles/circle_fx_2",scale:{start:.5,end:2,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1600,on:!1}),this.sparksManager=this.scene.add.particles("level_map"),this.add(this.sparksManager),this.sparks=this.sparksManager.createEmitter({speed:30,frame:"particles/star_1",lifespan:{min:800,max:1400},rotate:{start:0,end:180,random:!0},angle:-90,scale:{start:1,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:m.ExpoOut},frequency:300,on:!1}),this.sparks.setEmitZone({source:new Phaser.Geom.Circle(0,0,this.back.displayWidth*.4),type:"random",quantity:360})}setupText(){this.updateTextContent(),this.bitmapText.x=-2,this.bitmapText.y=52,this.bitmapText.originalX=this.bitmapText.x,this.bitmapText.originalY=this.bitmapText.y,this.bringToTop(this.bitmapText)}updateTextContent(){this.bitmapText.text=`${this.currentStars}/${this.targetStars}`}isGiftReady(){return this.currentStars>=this.targetStars}onStarArrived(){var e;this.circles.emitParticle(1),this.bitmapText.scale=1,this.scene.tweens.killTweensOf(this.bitmapText),this.scene.tweens.add({targets:this.bitmapText,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,yoyo:!0}),this.icon.y=this.icon.originalY,this.icon.scale=1,this.scene.tweens.killTweensOf(this.icon),this.scene.tweens.add({targets:this.icon,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,y:this.icon.originalY-14,yoyo:!0}),!((e=this.squeezeTween)==null?void 0:e.isPlaying())&&(this.back.scaleX=1,this.back.scaleY=1,this.scene.tweens.killTweensOf(this.back),this.scene.tweens.add({targets:this.back,duration:233,ease:Phaser.Math.Easing.Sine.InOut,scaleX:.9,scaleY:1.1,yoyo:!0}))}incrementStarsNum(){this.currentStars++,this.updateTextContent(),this.store.saveValue(g.GIFT_STARS_NUM,this.currentStars),this.currentStars===this.targetStars&&(this.scene.tweens.add({targets:this.back,duration:233,ease:Phaser.Math.Easing.Sine.InOut,y:"-=18",yoyo:!0}),this.onTargetStarsNumReached())}onTargetStarsNumReached(){this.bitmapText.kill(),this.icon.kill(),this.sparks.on=!0,this.playSqueezeTween()}playSqueezeTween(){this.back.scaleX=1,this.back.scaleY=1,this.scene.tweens.killTweensByProperty(this.back,"scaleX","scaleY"),this.squeezeTween=this.scene.tweens.add({targets:this.back,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.06,scaleY:.94,yoyo:!0,repeat:-1})}stopSqueezeTween(){var e;(e=this.squeezeTween)==null||e.remove(),this.squeezeTween=null,this.scene.tweens.add({targets:this.back,duration:150,ease:Phaser.Math.Easing.Linear,scaleX:1,scaleY:1})}onGiftRewardClaimed(){this.giftsManager.onGiftOpen(),this.currentStars=this.giftsManager.getCurrentStars(),this.targetStars=this.giftsManager.getTargetStars(),this.isGiftReady()===!1&&(this.bitmapText.revive(),this.icon.revive(),this.sparks.on=!1,this.updateTextContent(),this.stopSqueezeTween())}shakeText(){this.bitmapText.x=this.bitmapText.originalX,this.scene.tweens.killTweensByProperty(this.bitmapText,"x"),this.scene.tweens.add({targets:this.bitmapText,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:this.bitmapText.x+Phaser.Math.RND.sign()*8,yoyo:!0,repeat:3})}},pt;(function(e){e.LOCKED="LOCKED",e.DISABLED="DISABLED",e.ENABLED="ENABLED"})(pt||(pt={}));var O0=class extends _n{constructor(e){super(e,"level_map","button_wheel");this.name="button_wheel",this.store=this.scene.game.store,this.addCircles(),this.setupBitmapText(),this.setInitialState()}addCircles(){this.circlesManager=this.scene.add.particles("level_map"),this.circlesManager.setPosition(0,-10),this.addAt(this.circlesManager,0),this.circles=this.circlesManager.createEmitter({frame:"particles/circle_fx_2",scale:{start:.5,end:1.6,ease:m.ExpoOut},alpha:{start:1,end:0,ease:m.CubicOut},lifespan:1800,on:!1})}setupBitmapText(){this.bitmapText.x=-2,this.bitmapText.y=50,this.bitmapText.originalX=this.bitmapText.x,this.bitmapText.originalY=this.bitmapText.y,this.bitmapText.updateTimer=0}setInitialState(){let e=window.game.config.wheel_unlock_level-1;if(!!this.scene.game.store.getLevelResult(e)===!1){this.setLockedState();return}let s=this.store.getBoolean(g.WHEEL_LOCKED),i=Date.now()>this.store.getNumber(g.WHEEL_RESET_TIMESTAMP);s&&i===!1?this.setDisabledState():this.setEnabledState()}setLockedState(){this.buttonState=pt.LOCKED,this.bitmapText.kill(),this.back.alpha=.75}setDisabledState(){var e;this.buttonState=pt.DISABLED,this.bitmapText.revive(),this.bitmapText.updateTimer=1e3,this.back.alpha=1,this.back.scaleX=1,this.back.scaleY=1,(e=this.backTween)==null||e.remove()}setEnabledState(){this.buttonState=pt.ENABLED,this.bitmapText.kill(),this.back.alpha=1,this.backTween=this.scene.tweens.add({targets:this.back,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.07,scaleY:.93,yoyo:!0,repeat:-1})}shakeTimer(){this.bitmapText.x=this.bitmapText.originalX,this.scene.tweens.killTweensByProperty(this.bitmapText,"x"),this.scene.tweens.add({targets:this.bitmapText,duration:44,ease:Phaser.Math.Easing.Sine.InOut,x:this.bitmapText.x+Phaser.Math.RND.sign()*8,yoyo:!0,repeat:3})}showTimer(){this.bitmapText.alpha=0,this.scene.tweens.add({targets:this.bitmapText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.bitmapText.scale=.66,this.scene.tweens.add({targets:this.bitmapText,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})}preUpdate(e,t){this.buttonState===pt.DISABLED&&this.updateDisabledTimer(t)}updateDisabledTimer(e){let s=this.store.getNumber(g.WHEEL_RESET_TIMESTAMP)-Date.now();s<=1e3?(this.store.saveValue(g.WHEEL_LOCKED,!1),this.circles.emitParticle(1),this.setEnabledState()):(this.bitmapText.updateTimer+=e,this.bitmapText.updateTimer>=1e3&&(this.bitmapText.updateTimer-=1e3,this.doUpdateDisabledTimer(s)))}doUpdateDisabledTimer(e){let t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4),i=Math.floor(e%36e4%6e4/1e3),a=t.toString().padStart(2,"0"),n=s.toString().padStart(2,"0"),r=i.toString().padStart(2,"0");t>0?this.bitmapText.text=`${a}:${n}:${r}`:this.bitmapText.text=`${n}:${r}`}},b0=class extends Phaser.Events.EventEmitter{constructor(e){super();this.scene=e,this.addKinecticScroll()}addKinecticScroll(){this.kineticScroll=new hh(this.scene,{camera:this.scene.firstCamera,timeConstantScroll:300,horizontalScroll:!1,verticalScroll:!0,verticalWheel:!0,wheelScrollAmount:50}),this.kineticScroll.onPointerDown=this.onPointerDown.bind(this),this.kineticScroll.addPointerListeners()}onPointerDown(e,t){t.every(i=>i instanceof ch)!==!1&&this.kineticScroll.beginMove(e)}onResize(){let e=this.scene.firstCamera.zoom;this.kineticScroll.settings.scrollMultiplier=1/e*1.33}update(e){this.kineticScroll.update()}enable(){this.scene.isLocked||(this.kineticScroll.settings.verticalWheel=!0,this.kineticScroll.addPointerListeners())}disable(){this.kineticScroll.settings.verticalWheel=!1,this.kineticScroll.removePointerListeners()}scrollToBottom(){var e;(e=this.cameraScrollTween)==null||e.remove(),this.kineticScroll.resetScroll(),this.scene.firstCamera.scrollY=this.scene.firstCamera.getBounds().bottom}scrollToTop(){var e;(e=this.cameraScrollTween)==null||e.remove(),this.kineticScroll.resetScroll(),this.scene.firstCamera.scrollY=0}scrollToLevel(e){if(this.cameraScrollTween)return;let t=this.getCameraScrollByLevelNumber(e);t!==null&&(this.kineticScroll.resetScroll(),this.cameraScrollTween=this.scene.tweens.add({targets:this.scene.firstCamera,duration:500,ease:Phaser.Math.Easing.Quadratic.InOut,scrollY:t,onComplete:()=>{this.cameraScrollTween=null}}))}scrollTo(e){this.kineticScroll.resetScroll(),this.cameraScrollTween=this.scene.tweens.add({targets:this.scene.firstCamera,duration:500,ease:Phaser.Math.Easing.Quadratic.InOut,scrollY:e,onComplete:()=>{this.cameraScrollTween=null}})}scrollToLevelInstant(e){let t=this.getCameraScrollByLevelNumber(e);t!==null&&(this.scene.firstCamera.scrollY=t)}getCameraScrollByLevelNumber(e){let t=this.scene.levelIcons.getByLevelNumber(e);return t?this.getCameraScroll(Phaser.Display.Bounds.GetCenterY(t)):null}getCameraScroll(e){return e-this.scene.firstCamera.displayHeight/2}},Ue;(function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.LEVEL_ICONS=1]="LEVEL_ICONS",e[e.LEVEL_ICONS_FX=2]="LEVEL_ICONS_FX",e[e.LEVEL_ICONS_FX_PARTICLES=3]="LEVEL_ICONS_FX_PARTICLES",e[e.LEVEL_ICONS_SNEAK_PEEKS=4]="LEVEL_ICONS_SNEAK_PEEKS",e[e.CLOUDS=5]="CLOUDS",e[e.LEVEL_ICON_AVATAR=6]="LEVEL_ICON_AVATAR",e[e.LEVEL_ICON_TUTORIAL_HAND=7]="LEVEL_ICON_TUTORIAL_HAND",e[e.EDGE_AVATAR=8]="EDGE_AVATAR"})(Ue||(Ue={}));var w0=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.scene=e,this.addIcons(t),this.lastCompleteIcon=this.getLastCompleteIcon(),this.lastUnlockedIcon=this.getLastUnlockedLevelIcon()}addIcons(e){this.levelIcons=e.levelIcons.map(t=>{let s=t.level_number,i=this.scene.game.levelConfigs.get(s),a=i&&i.hard,n=this.getLevelIconData(s,a),r=new ch(this.scene,n);return r.x=t.x,r.y=t.y,r.setData("type","LevelIcon"),r.setDepth(Ue.LEVEL_ICONS),i||(r.alpha=.5),this.scene.add.existing(r),r})}getLevelIconData(e,t){let s=this.scene.game.store.getLevelResult(e);return s?{levelNumber:e,isHard:t,complete:s.complete,locked:!1}:{levelNumber:e,isHard:t,complete:!1,locked:this.isLevelLocked(e)}}isLevelLocked(e){if(e===1)return!1;let t=e-1,s=this.scene.game.store.getLevelResult(t);return!(s&&s.complete)}getLastUnlockedLevelIcon(){let e=this.levelIcons.filter(t=>t.iconState===nt.UNLOCKED);return ze(e,"levelNumber")}getLastCompleteIcon(){let e=this.levelIcons.filter(t=>t.iconState===nt.COMPLETE);return ze(e,"levelNumber")}getCurrentIcon(){return this.getLastUnlockedLevelIcon()||this.getLastCompleteIcon()||this.levelIcons[0]}getByLevelNumber(e){return this.levelIcons.find(t=>t.levelNumber===e)}disable(){this.levelIcons.forEach(e=>e.disableInteractive())}enable(){this.levelIcons.filter(e=>e.iconState!==nt.LOCKED).forEach(e=>e.setInteractive())}unlockAll(){this.levelIcons.forEach(e=>{e.iconState===nt.LOCKED&&e.setUnlocked()})}resetToInitialState(){this.levelIcons.forEach(e=>{e.setInitialState()})}findAndScrollToLevelIcon(){let e=this.levelIcons.map(r=>r.levelNumber),t=Math.min(...e),s=Math.max(...e),i=prompt(`Enter level number (between ${t} and ${s})`);if(i===null)return;let a=parseInt(i);if(isNaN(a))return;if(e.includes(a)===!1){""+a;return}this.scene.scroll.scrollToLevelInstant(a)}},P0=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="unlock_level_icon",this.originalIcon=t,this.addLockedIcon(),this.addWhite(),this.addParticles()}addLockedIcon(){this.locked=this.scene.add.image(0,0,"level_map","level_icons/level_icon_locked"),this.add(this.locked)}addParticles(){this.particles=this.scene.add.particles("level_map"),this.particles.setDepth(Ue.LEVEL_ICONS_FX_PARTICLES),this.attractCircles=this.particles.createEmitter({frame:"particles/circle_fx_3",alpha:{start:0,end:.4,ease:m.ExpoOut},scale:{start:2.2,end:.33,ease:m.Linear},lifespan:600,frequency:333,on:!1}),this.explodeSparks=this.particles.createEmitter(k(P({},Me.getCircleEdgeEmitZone(40,30)),{frame:"particles/double_spheres_particle",lifespan:600,speed:{min:150,max:250},scale:{start:1,end:0},alpha:{start:1,end:0,ease:m.ExpoIn},on:!1})),this.explodeCircles=this.particles.createEmitter({frame:"particles/circle_fx_3",alpha:{start:1,end:0,ease:m.CubicOut},scale:{start:.4,end:6,ease:m.Linear},lifespan:1200,on:!1})}addWhite(){this.white=this.scene.add.image(0,0,"level_map","level_icons/level_icon_white"),this.add(this.white)}show(e){let t=this.x,s=1e3;this.scene.time.delayedCall(e+50,()=>{var i;(i=this.scene.audio.play(u.LEVEL_ICON_UNLOCK))==null||i.fade(0,.75,s),this.attractCircles.flow(150,1)}),this.fadeInWhite(e,s),this.playShakeTween(e),this.playShrinkTween(e,s,t)}fadeInWhite(e,t){this.white.alpha=0,this.scene.tweens.add({delay:e,targets:this.white,duration:t,ease:Phaser.Math.Easing.Linear,alpha:1})}playShakeTween(e){this.shakeTween=this.scene.tweens.addYoyoTween({delay:e,target:this,duration:16,property:"x",base:this.x,delta:4,repeat:-1})}playShrinkTween(e,t,s){this.scene.tweens.add({delay:e,targets:this,duration:t,ease:Phaser.Math.Easing.Linear,scale:.6,onComplete:()=>{this.locked.kill(),this.attractCircles.killAll(),this.attractCircles.on=!1,this.moveToOriginalPosition(s),this.playExplodeTweens()}})}moveToOriginalPosition(e){this.shakeTween.remove(),this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Linear,x:e})}playExplodeTweens(){let e=66;this.scene.tweens.add({delay:e,targets:this,duration:800,ease:Phaser.Math.Easing.Expo.Out,scale:2.5,onStart:()=>{this.explodeSparks.explode(30,0,0),this.explodeCircles.explode(1,0,0)}}),this.scene.tweens.add({delay:e,targets:this,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"-=50",onComplete:()=>{this.destroy()}})}preUpdate(e,t){this.attractCircles.on&&this.particles.setPosition(this.x,this.y)}preDestroy(){this.particles.destroy(),super.preDestroy()}},L0=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.originalScale=1,this.name="popover",this.addBack(t,s),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addText(){let e="Some long ass text and little bit more. And MOAR!",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"},s=340,i=120;this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(s*.9,!0),this.text.x=this.back.left+12+s/2,this.text.y=this.back.top+11+i/2,this.add(this.text),this.adjustTextScale()}adjustTextScale(){this.text.scale=Math.min(1,110/this.text.height)}updateText(e){this.text.setText(e),this.adjustTextScale()}show(){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=this.originalScale*.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.originalScale,onComplete:()=>{this.hide(1600)}})}hide(e){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}},I0=class extends Phaser.GameObjects.Image{constructor(e,t,s){super(e,0,0,t,s);this.speed=1}preUpdate(e,t){this.x+=this.speed*t,this.x>E.SOURCE_GAME_WIDTH+this.displayWidth/2&&(this.x=-this.displayWidth/2)}},A0=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.originalScale=1,this.name="popover",this.addBack(t,s),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight),this.setInteractive(new Phaser.Geom.Rectangle(12,-60,340,120),Phaser.Geom.Rectangle.Contains),this.input.cursor="pointer"}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addText(){let e="Some long ass text and little bit more. And MOAR!",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"},s=340,i=120;this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(s*.9,!0),this.text.x=this.back.left+12+s/2,this.text.y=this.back.top+11+i/2,this.add(this.text),this.adjustTextScale()}adjustTextScale(){this.text.scale=Math.min(1,110/this.text.height)}updateText(e){this.text.setText(e),this.adjustTextScale()}show(){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=this.originalScale*.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.originalScale})}hide(e){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}},da;(function(e){e.RESET_DATA="__RESET_DATA"})(da||(da={}));var x0=class extends Ho{constructor(e){super(e);this.yesClicks=0,this.addConfirmPopover(),this.yesButton.on(_.PRESS,this.onYesButtonClick,this)}onYesButtonClick(){this.yesClicks++,this.yesClicks===1?this.confirmPopover.show():this.yesClicks===2&&this.emit(da.RESET_DATA,this)}addConfirmPopover(){let e=this.scene.texts.reset_data.press_to_\u0441onfirm;this.confirmPopover=new A0(this.scene,"popups","popups/quit/popover.png"),this.confirmPopover.x=this.yesButton.x,this.confirmPopover.y=this.yesButton.y-32,this.confirmPopover.updateText(e),this.confirmPopover.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPopoverClick,this),this.add(this.confirmPopover)}onPopoverClick(){this.yesClicks=0,this.confirmPopover.hide(0)}onShow(){this.confirmPopover.kill(),this.yesClicks=0}onHide(){}onLanguageChange(){super.onLanguageChange();let{title:e,text:t,press_to_\u0441onfirm:s}=this.scene.texts.reset_data;this.title.text=e,this.adjustTitleTextSize(),this.text.setText(t),this.confirmPopover.updateText(s)}},B0=class extends ie{constructor(e){super(e,{name:"confirm_data_reset_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.001,backgroundInteractive:!1});this.addPopup()}addPopup(){let{title:e,text:t}=this.scene.texts.reset_data,s={title:e,text:t};this.popup=new x0(this.scene),this.popup.updateData(s),this.popup.closeButton.on(_.PRESS,this.hide,this),this.popup.noButton.on(_.PRESS,this.hide,this),this.add(this.popup),this.pin(this.popup,.5,.5)}resize(){super.resize()}show(){this.alpha=1,this.emitShowEvent(),this.revive(),this.showPopup()}showPopup(){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.scale=.85,this.scene.tweens.add({delay:0,targets:this.popup,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1}),this.popup.y+=100,this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.Out,y:"-=100"}),this.popup.closeButton.enableInput(),this.popup.noButton.enableInput(),this.popup.yesButton.enableInput(),this.popup.onShow()}hide(){this.emitHideStartEvent(),this.popup.closeButton.disableInput(),this.popup.noButton.disableInput(),this.popup.yesButton.disableInput(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.popup.onHide(),this.kill(),this.emitHideCompleteEvent()}})}onLanguageChange(){this.popup.onLanguageChange()}},k0=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.name="special_offer_popup",this.options=t,this.addBack(),this.addTitleBack(),this.addTitleText(),this.addCloseButton(),this.addOffer(),this.addDiscountLabel(),this.addBuyButton(),this.bringToTop(this.buyButton),this.bringToTop(this.title),this.setSize(this.back.width,this.back.height)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/popup_small_back.png"),this.add(this.back)}addTitleBack(){this.titleBack=this.scene.add.image(0,0,"popups","popups/special_offer/headline_flag_pink.png"),this.titleBack.y=this.back.top+36,this.add(this.titleBack)}addTitleText(){let e=this.scene.texts.shop.special_offer,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"40px",color:"#ffffff",align:"center"};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.scale=Math.min(1,210/this.title.width),this.title.setShadow(0,2,"rgba(0,0,0,0.2)",0),this.title.x=this.titleBack.x,this.title.y=this.titleBack.y-4,this.add(this.title)}addCloseButton(){this.closeButton=this.scene.add.button("popups","popups/Close Button.png",this),this.closeButton.x=this.back.right-60,this.closeButton.y=this.back.top+46}addOffer(){this.offer=new Uo(this.scene,this.options),this.offer.y=-25,this.offer.title.y+=10,this.offer.title.setText(this.scene.texts.shop.sale),this.offer.subtitle.y+=14,this.offer.button.kill(),this.add(this.offer)}addDiscountLabel(){let e=this.scene.add.image(0,0,"popups","popups/special_offer/discount_label_back.png"),t=this.createDiscountLabelText();this.discountLabel=this.scene.add.container(0,0,[e,t]),this.discountLabel.back=e,this.discountLabel.text=t,this.discountLabel.text.y=-1,this.discountLabel.x=this.offer.title.x,this.discountLabel.y=this.offer.subtitle.y+60,this.offer.add(this.discountLabel),this.adjustDiscountLabelTextSize()}createDiscountLabelText(){let e=this.getDiscountLabelContent(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"22px",color:"#ffffff",align:"center"},s=this.scene.add.text(0,0,e,t);return s.setOrigin(.5,.5),s.setShadow(0,2,"rgba(0,0,0,0.2)",0),s}getDiscountLabelContent(){return this.scene.texts.shop.discount.replace("#",this.options.discount.toString())}adjustDiscountLabelTextSize(){let{back:e,text:t}=this.discountLabel,s=e.displayWidth*.75;t.scale=Math.min(1,s/t.width)}addBuyButton(){let e={type:"common",price:this.options.price,offerId:this.options.offerId};this.buyButton=new ln(this.scene,e),this.buyButton.back.setFrame("popups/special_offer/button_pink_large.png"),this.buyButton.text.setFontSize(28),this.buyButton.y=133,this.buyButton.on(_.PRESS,this.stopBuyButtonAnimation,this),this.add(this.buyButton)}onShow(){this.startBuyButtonAnimation(),this.showCloseButton(2e3)}showBuyButton(e){this.buyButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.buyButton,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.buyButton.scale=.8,this.scene.tweens.add({delay:e,targets:this.buyButton,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:1})}showCloseButton(e){this.closeButton.kill(),this.closeButton.alpha=0,this.scene.tweens.add({delay:e,targets:this.closeButton,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1,onStart:()=>{this.closeButton.revive()}})}onHide(){this.stopBuyButtonAnimation()}startBuyButtonAnimation(){this.buyButtonAnimateEvent=this.scene.time.addEvent({repeat:-1,startAt:2500,delay:3e3,callback:this.shakeBuyButton,callbackScope:this})}stopBuyButtonAnimation(){var e;(e=this.buyButtonAnimateEvent)==null||e.remove(),this.scene.tweens.killTweensOf(this.buyButton),this.buyButton.scale=1}shakeBuyButton(){this.scene.tweens.add({targets:this.buyButton,duration:600,ease:Phaser.Math.Easing.Quadratic.Out,scale:.83,onComplete:()=>{this.scene.tweens.add({targets:this.buyButton,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})}})}onLanguageChange(){}},yn;(function(e){e.PURCHASE_COMPLETE="__PURCHASE_COMPLETE"})(yn||(yn={}));var M0=class extends ie{constructor(e){super(e,{name:"special_offer_screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.purchases=this.scene.game.purchases,this.addFlags(),this.addPopup(),this.addAdsText()}addFlags(){this.leftFlags=this.scene.add.image(0,0,"rewards","rewards/flags_left.png"),this.add(this.leftFlags),this.pin(this.leftFlags,0,0),this.rightFlags=this.scene.add.image(0,0,"rewards","rewards/flags_right.png"),this.add(this.rightFlags),this.pin(this.rightFlags,1,0)}addPopup(){let e="special_30000",t=this.scene.game.purchases.getOfferById(e),s={offerId:e,coinsNum:t.content.coins,livesNum:t.content.lives,price:t.price,isSpecial:!0,height:0,discount:50,iconFrame:"popups/shop/coins_chest.png",useSeparator:!1};this.popup=new k0(this.scene,s),this.popup.closeButton.on(_.PRESS,this.hide,this),this.popup.buyButton.on(_.RELEASE,this.onBuyButtonClick.bind(this,e)),this.add(this.popup),this.pin(this.popup,.5,.55)}onBuyButtonClick(e){this.purchases.make(e,"SpecialOffer").then(()=>{this.onPurchaseComplete(e)})}onPurchaseComplete(e){this.purchases.savePurchase(e),this.popup.closeButton.disableInput(),this.popup.buyButton.disableInput(),this.emit(yn.PURCHASE_COMPLETE,this,e)}addAdsText(){let e=this.scene.texts.shop.ads_hint,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#FFE0AD",align:"center",stroke:"#41211F",strokeThickness:6};this.adsText=this.scene.add.text(0,0,e,t),this.adsText.setOrigin(.5,.5),this.adsText.setWordWrapWidth(this.popup.width*.85),this.adsText.setLineSpacing(-6),this.adsText.alpha=.85,this.adsText.originalAlpha=this.adsText.alpha,this.adsText.originalScale=1,this.add(this.adsText)}resize(){super.resize(),this.leftFlags.originalX=this.leftFlags.x,this.rightFlags.originalX=this.rightFlags.x,this.resizePopup(),this.alignAdsText()}resizePopup(){let e=this.screenHeight*.8;this.popup.scale=Math.min(1,e/this.popup.height),this.popup.originalScale=this.popup.scale,this.popup.originalY=this.popup.y}alignAdsText(){let e=this.popup.y+this.popup.displayHeight/2-40,s=this.screenHeight-e;this.adsText.x=this.screenWidth/2,this.adsText.y=e+s/2,this.adsText.originalY=this.adsText.y}show(e){this.alpha=1,this.emitShowEvent(),this.revive(),this.showFlags(0),this.showPopup(),this.showAdsText(66),e.showBackground?(this.background.revive(),this.showBackground({duration:200,ease:Phaser.Math.Easing.Quadratic.Out})):this.background.kill(),this.scene.audio.play(u.SHOP_OPEN,{volume:.25,seek:.3})}showFlags(e){this.leftFlags.alpha=0,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.leftFlags.scale=.75,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:1}),this.rightFlags.alpha=0,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.rightFlags.scale=.75,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:1});let t=60,s=50;this.leftFlags.x=this.leftFlags.originalX-t,this.scene.tweens.add({delay:e,targets:this.leftFlags,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:this.leftFlags.originalX}),this.rightFlags.x=this.rightFlags.originalX+t,this.scene.tweens.add({delay:e,targets:this.rightFlags,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],x:this.rightFlags.originalX}),this.leftFlags.y=-s,this.rightFlags.y=-s,this.scene.tweens.add({delay:e,targets:[this.leftFlags,this.rightFlags],duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.55],y:0})}showPopup(){this.popup.alpha=0,this.scene.tweens.add({delay:0,targets:this.popup,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}}),this.popup.y+=60,this.scene.tweens.add({targets:this.popup,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"}),this.popup.onShow()}showAdsText(e){this.adsText.alpha=0,this.scene.tweens.add({delay:e,targets:this.adsText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.adsText.originalAlpha}),this.adsText.y+=60,this.scene.tweens.add({delay:e,targets:this.adsText,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:"-=60"})}hide(){this.emitHideStartEvent(),this.scene.audio.stop(u.SHOP_OPEN),this.popup.onHide(),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.kill(),this.emitHideCompleteEvent()}})}onLanguageChange(){this.adsText.text=this.scene.texts.shop.ads_hint,this.popup.onLanguageChange()}preDestroy(){this.scene.audio.stop(u.SHOP_OPEN),super.preDestroy()}},R0=class extends _n{constructor(e){super(e,"level_map","button_piggy");this.name="button_piggy_bank",this.back.x-=2,this.back.y-=4,this.doAddIcon(),this.setupText(),this.addFullPopover(),this.isPiggyBankFull()&&(this.fullPopover.revive(),this.animateFullPopover())}doAddIcon(){this.addIcon("level_map","button_piggy_coin"),this.icon.scale=.9,this.icon.x=2,this.icon.y=13}setupText(){let e=this.scene.game.store.getNumber(g.PIGGY_BANK_COINS);this.bitmapText.setLetterSpacing(2),this.bitmapText.text=e.toString(),this.bitmapText.y=48}addFullPopover(){let e=this.scene.add.image(0,0,"level_map","piggy_bank_popover"),t=this.createFullText(e.width*.8);t.y=-28,this.fullPopover=this.scene.add.container(0,0,[e,t]),this.fullPopover.text=t,this.fullPopover.x=-18,this.fullPopover.y=-60,this.fullPopover.kill(),this.add(this.fullPopover)}createFullText(e){let t=this.scene.texts.piggy_bank.full,s={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"24px",color:"#ffffff",align:"center",padding:{x:0,y:2}},i=this.scene.add.text(0,0,t,s);return i.setOrigin(.5,.5),i.setShadow(0,2,"rgba(0,0,0,0.2)"),i.scale=Math.min(1,e/i.width),i}isPiggyBankFull(){let e=this.scene.game.store.getNumber(g.PIGGY_BANK_COINS),t=window.game.config.piggy_bank.max_capacity;return e>=t}animateFullPopover(){let e=5;this.fullPopover.angle=-e,this.scene.tweens.add({targets:this.fullPopover,duration:900,ease:Phaser.Math.Easing.Sine.InOut,angle:e,yoyo:!0,repeat:-1})}updateCoinsNum(e){this.bitmapText.text=e.toString()}showFullPopover(e){this.fullPopover.alpha=0,this.scene.tweens.add({delay:e,targets:this.fullPopover,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.fullPopover.scale=.75,this.scene.tweens.add({delay:e,targets:this.fullPopover,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})}hideFullPopover(){this.fullPopover.visible!==!1&&(this.scene.tweens.killTweensOf(this.fullPopover),this.scene.tweens.add({targets:this.fullPopover,y:"-=10",duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,onComplete:()=>{this.fullPopover.kill()}}))}onLanguageChange(){this.fullPopover.text.text=this.scene.texts.piggy_bank.full}},gh=class extends Phaser.GameObjects.Container{constructor(e,t){super(e);this.options=t,this.addBack(),this.addTitleBack(),this.addTitleText(),this.addCoinsIcon(),this.addCoinsParticles(),this.addCoinsText(),this.addLives(),this.addButton(),this.bringToTop(this.button),this.bringToTop(this.titleText),this.bringToTop(this.coinsText),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(){this.back=this.scene.add.image(0,0,"popups","popups/greetings/card_back.png"),this.add(this.back)}addTitleBack(){this.titleBack=this.scene.add.image(0,0,"popups","popups/greetings/title_back.png"),this.titleBack.x=2,this.titleBack.y=this.back.top+58,this.add(this.titleBack)}addTitleText(){let e=this.options.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"30px",color:"#ffffff",align:"center",padding:{x:0,y:4}};this.titleText=this.scene.add.text(0,0,e,t),this.titleText.setOrigin(.5,.5),this.titleText.setShadow(0,3,"rgba(0,0,0,0.15)",0),this.titleText.x=0,this.titleText.y=this.titleBack.y-9,this.add(this.titleText)}addCoinsIcon(){this.coinsIcon=this.scene.add.image(0,0,"popups",this.options.coinsIconFrame),this.coinsIcon.y=70,this.add(this.coinsIcon)}addCoinsParticles(){this.options.coinsParticles!==!1&&(this.sparksManager=this.scene.add.particles("popups"),this.add(this.sparksManager),this.sparks=this.sparksManager.createEmitter({speed:30,frame:"popups/particles/star_1.png",lifespan:{min:800,max:1400},rotate:{start:0,end:180,random:!0},angle:-90,scale:{start:1,end:0,ease:m.ExpoIn},alpha:{start:0,end:1,ease:m.ExpoOut},frequency:300,on:!0}),this.sparks.setEmitZone({source:new Phaser.Geom.Circle(0,0,this.coinsIcon.displayWidth*.4),type:"random",quantity:360}))}addCoinsText(){let e=this.options.content.coins.toString(),t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"34px",color:"#ffffff",align:"center",stroke:"#AA5800",strokeThickness:8};this.coinsText=this.scene.add.text(0,0,e,t),this.coinsText.setOrigin(.5,.5),this.coinsText.setShadow(0,3,"rgba(0,0,0,0.15)",0,!0,!1),this.coinsText.y=68,this.add(this.coinsText)}addLives(){if(this.options.content.unlimitedLivesMs<=0)return;let e=this.getUnlimLivesDurationFormatted();this.livesIcon=new hn(this.scene),this.livesIcon.text.setFontSize(22),this.livesIcon.updateTextContent(e),this.livesIcon.x=106,this.livesIcon.y=-100,this.add(this.livesIcon);let t=this.scene.add.image(0,0,"popups","popups/greetings/plus_sign.png");t.x=44,t.y=this.livesIcon.y+10,this.add(t)}getUnlimLivesDurationFormatted(){let e=this.scene.texts.greetings,t=Fo(this.options.content.unlimitedLivesMs),s=t.hours>0?e.hours.replace("#",t.hours.toString()):"",i=t.minutes>0?e.minutes.replace("#",t.minutes.toString()):"";return[s,i].filter(Boolean).join(" ")}addButton(){this.button=this.options.buttonType==="normal"?this.createNormalButton():this.createVideoButton(),this.button.inflateHitArea(15,15),this.button.x=0,this.button.y=this.back.bottom-70,this.add(this.button)}createNormalButton(){let e=this.scene.texts.greetings.take,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"25px",color:"#ffffff",align:"center",stroke:"#F06B5C",strokeThickness:5},s=new fe(this.scene,"popups","popups/greetings/button_pink.png");return s.addText(e,t,0,-4),s}createVideoButton(){let e=new fe(this.scene,"popups","popups/greetings/button_pink.png");return e.addIcon("popups","popups/greetings/watch ad.png",0,-15),e.icon.scale=.66,e.on(_.PRESS,this.stopButtonAnimation,this),e}onShow(){this.options.buttonType==="rewarded_ad"&&this.startButtonAnimation()}startButtonAnimation(){this.buttonAnimateEvent=this.scene.time.addEvent({repeat:-1,startAt:2300,delay:3e3,callback:this.animateButton,callbackScope:this})}stopButtonAnimation(){var e;(e=this.buttonAnimateEvent)==null||e.remove(),this.scene.tweens.killTweensOf(this.button),this.button.scale=1}animateButton(){this.scene.tweens.add({targets:this.button,duration:600,ease:Phaser.Math.Easing.Quadratic.Out,scale:1.15,onComplete:()=>{var e;(e=this.scene)==null||e.tweens.add({targets:this.button,duration:900,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})}})}preDestroy(){this.stopButtonAnimation(),super.preDestroy()}},N0=class extends Phaser.GameObjects.Container{constructor(e,t,s){super(e);this.originalScale=1,this.name="popover",this.addBack(t,s),this.addText(),this.setSize(this.back.displayWidth,this.back.displayHeight)}addBack(e,t){this.back=this.scene.add.image(0,0,e,t),this.add(this.back)}addText(){let e="Some long ass text and little bit more. And MOAR!",t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"26px",color:"#B35F44",align:"center"},s=340,i=120;this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(s*.9,!0),this.text.x=this.back.left+39+s/2,this.text.y=this.back.top+11+i/2,this.add(this.text),this.adjustTextScale()}adjustTextScale(){this.text.scale=Math.min(1,110/this.text.height)}updateText(e){this.text.setText(e),this.adjustTextScale()}show(){this.scene.tweens.killTweensOf(this),this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scale=this.originalScale*.66,this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.originalScale,onComplete:()=>{this.hide(1600)}})}hide(e){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({delay:e,targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.kill()}})}},ua;(function(e){e.GIFTS_OPEN_COMPLETE="__GIFTS_OPEN_COMPLETE"})(ua||(ua={}));var D0=class extends ie{constructor(e){super(e,{name:"greetings-screen",backgroundKey:"popups",backgroundFrame:"popups/black_rect.png",backgroundAlpha:.85});this.addTitle(),this.addBonusCard(),this.addSuperBonusCard(),this.addChef(),this.addChefPopover()}addTitle(){let e=this.scene.texts.greetings.title,t={fontFamily:p.DEFAULT_FAMILY,fontStyle:p.DEFAULT_WEIGHT,fontSize:"55px",color:"#FFA48E",align:"center",padding:{x:0,y:10}};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.setShadow(0,4,"#AC4717",2),this.add(this.title),this.pin(this.title,.5,0)}addBonusCard(){let e=window.game.config.greetings_screen,t={title:this.scene.texts.greetings.bonus,buttonType:"normal",coinsIconFrame:"popups/greetings/Coins Bag.png",coinsParticles:!1,content:{coins:e.bonus.coins,unlimitedLivesMs:e.bonus.unlimitedLivesMs}};this.bonusCard=new gh(this.scene,t),this.bonusCard.name="bonus_card",this.bonusCard.button.once(_.PRESS,this.onBonusCardClick,this),this.bonusCard.button.name="bonus_button",this.add(this.bonusCard),this.pin(this.bonusCard,.25,.5,10)}onBonusCardClick(){this.emitGiftsOpenEvent(this.bonusCard.options.content.coins,this.bonusCard.options.content.unlimitedLivesMs),this.hide()}addSuperBonusCard(){let e=window.game.config.greetings_screen,t={title:this.scene.texts.greetings.super_bonus,buttonType:"rewarded_ad",coinsIconFrame:"popups/greetings/Coins Chest.png",coinsParticles:!0,content:{coins:e.superBonus.coins,unlimitedLivesMs:e.superBonus.unlimitedLivesMs}};this.superBonusCard=new gh(this.scene,t),this.superBonusCard.name="super_bonus_card",this.superBonusCard.button.on(_.RELEASE,this.onSuperBonusCardClick,this),this.superBonusCard.button.name="super_bonus_button",this.add(this.superBonusCard),this.pin(this.superBonusCard,.75,.5,-10)}onSuperBonusCardClick(e){let t=()=>{this.scene.game.ads.showRewardedAd("GreetingsScreen").then(s=>{s?(e.disableInput(),this.emitGiftsOpenEvent(this.superBonusCard.options.content.coins,this.superBonusCard.options.content.unlimitedLivesMs),this.hide()):e.enableInput()})};e.disableInput(),this.scene.audio.isLocked()?this.scene.time.delayedCall(100,t):t()}addChef(){this.chef=this.scene.add.image(0,0,"popups","popups/Chef Cherry.png"),this.add(this.chef),this.pin(this.chef,0,1,200)}addChefPopover(){let e=this.scene.texts.greetings.greeting,t=this.pinner.getPin(this.chef);this.chefPopover=new N0(this.scene,"popups","popups/greetings/popover.png"),this.chefPopover.updateText(e),this.add(this.chefPopover),this.pin(this.chefPopover,t.x,t.y,290,-100)}resize(){super.resize(),this.alignCards(),this.alignTitle()}alignCards(){let e=this.chef.y-this.chef.displayHeight,t=this.bonusCard.y+this.bonusCard.displayHeight/2,s=Math.min(t,e+40);this.bonusCard.y=s-this.bonusCard.displayHeight/2,this.bonusCard.originalY=this.bonusCard.y,this.superBonusCard.y=this.bonusCard.y,this.superBonusCard.originalY=this.superBonusCard.y}alignTitle(){let e=this.bonusCard.y-this.bonusCard.displayHeight/2,t=e>200?e-100:e/2;this.title.y=t,this.title.originalY=this.title.y,this.title.visible=e>150}show(){this.emitShowEvent(),this.showBackground(),this.showTitle(0),this.showCards(100),this.showChef(0),this.showChefPopover(100),this.scene.time.delayedCall(200,()=>{this.scene.audio.play(u.WHOOSH_1,{volume:.33})})}showTitle(e){this.title.alpha=0,this.scene.tweens.add({delay:e,targets:this.title,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.title.scale=.75,this.scene.tweens.add({delay:e,targets:this.title,duration:500,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],scale:1}),this.title.y=this.title.originalY-100,this.scene.tweens.add({delay:e,targets:this.title,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:this.title.originalY})}showCards(e){[this.bonusCard,this.superBonusCard].forEach((s,i)=>{let a=e+i*66;s.alpha=0,this.scene.tweens.add({delay:a,targets:s,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),s.scale=.8,this.scene.tweens.add({delay:a,targets:s,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1}),s.y=s.originalY-100,this.scene.tweens.add({delay:a,targets:s,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.5],y:s.originalY}),s.onShow()})}showChef(e){this.chef.alpha=0,this.scene.tweens.add({delay:e,targets:this.chef,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.chef.scale=.75,this.scene.tweens.add({delay:e,targets:this.chef,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1})}showChefPopover(e){this.chefPopover.alpha=0,this.scene.tweens.add({delay:e,targets:this.chefPopover,duration:150,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.chefPopover.scale=.75,this.scene.tweens.add({delay:e,targets:this.chefPopover,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1}),this.chefPopover.angle=-1,this.scene.tweens.add({targets:this.chefPopover,duration:900,ease:Phaser.Math.Easing.Sine.InOut,angle:Math.abs(this.chefPopover.angle),yoyo:!0,repeat:-1})}emitGiftsOpenEvent(e,t){this.emit(ua.GIFTS_OPEN_COMPLETE,e,t)}hide(){this.emitHideStartEvent(),this.bonusCard.button.disableInput(),this.superBonusCard.button.disableInput(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:()=>{this.emitHideCompleteEvent(),this.destroy()}})}},H0=class extends ct{init(e){super.init(e),this.pointerDownPosition={x:0,y:0},this.pointerDownTime=0,this.pointerDownLevelIcon=null,this.cameraScrollY=0,this.isLocked=!1,this.resetDataScreen=null,this.shopScreen=null,this.specialOfferScreen=null,this.piggyBankScreen=null,this.greetingsScreen=null,this.config=this.cache.json.get("level_map_config"),this.tutorialHand=null}create(){this.addBackground(),this.addLevelIcons(),this.addSneakPeeks(),this.addTopCover(),this.addClouds(),this.addIconAvatar(),this.addEdgeAvatar(),this.addTopPanel(),this.addGiftButton(),this.addPiggyBankButton(),this.addPopover(),this.addSettingsScreen(),this.addStartLevelScreen(),this.addLivesScreen(),this.addPregameBoosterBuyScreen(),this.addTutorial(),this.setupCameras(),this.setupScroll(),this.cullLevelIconsThrottled=Ft(this.doCullLevelIcons.bind(this),66,{trailing:!0}),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.addLanguageChangeCallback(),this.resize(),this.onCreateComplete()}onCreateComplete(){if(!this.initData||!this.initData.type){this.onCreateCompleteAfterPreloader();return}if(this.initData.type!=="complete"){this.doInitialScroll();return}let e=this.game.store.getLevelResult(this.initData.levelNumber);e&&e.timesCompleteNum===1?this.playLevelUnlockAnimation(this.initData.levelNumber):this.doInitialScroll()}onCreateCompleteAfterPreloader(){this.doInitialScroll(),this.canShowGreetingsScreen()&&this.showGreetingsScreen()}canShowGreetingsScreen(){if(!window.game.config.ads.rewarded||window.game.config.greetings_screen.enabled===!1)return!1;if(w.getBool("greetings"))return!0;if(this.game.store.getNumber(g.LOGIN_NUM)===1)return!1;let s=window.game.config.greetings_screen.displayInterval,i=this.game.store.getNumber(g.GREETING_GIFT_OPEN_TS);return Date.now()-i>s}showGreetingsScreen(){this.greetingsScreen=new D0(this),this.greetingsScreen.once(ua.GIFTS_OPEN_COMPLETE,this.onGreetingsGiftsOpen,this),this.greetingsScreen.on(b.SHOW,()=>this.scroll.disable()),this.greetingsScreen.on(b.HIDE_COMPLETE,this.onGreetingsScreenHideComplete,this),this.greetingsScreen.resize(),this.add.existing(this.greetingsScreen),this.firstCamera.ignore(this.greetingsScreen),this.greetingsScreen.show()}onGreetingsGiftsOpen(e,t){var s;this.game.store.saveValue(g.GREETING_GIFT_OPEN_TS,Date.now()),this.game.store.changeNumber(g.COINS,e),this.topPanel.coinsLabel.syncWithGameStore(!1),this.topPanel.coinsLabel.showCoinsTextFx(e),this.livesScreen.coinsLabel.syncWithGameStore(!0),(s=this.pregameBoosterBuyScreen)==null||s.coinsLabel.syncWithGameStore(!0),t>0&&(this.game.lives.startUnlimitedLives(t),this.topPanel.livesLabel.animateIcon())}onGreetingsScreenHideComplete(){this.scroll.enable(),this.greetingsScreen=null,this.showSpecialOfferScreen()}showSpecialOfferScreen(e={force:!1}){return e.force===!1&&this.canShowSpecialOfferScreen()===!1?!1:(this.addSpecialOfferScreen(),this.specialOfferScreen.resize(),this.specialOfferScreen.show({showBackground:!0}),this.game.store.saveValue(g.SHOP_SPECIAL_OFFER_DISPLAY_TS,Date.now()),!0)}canShowSpecialOfferScreen(){if(!this.game.purchases||this.game.store.getBoolean(g.SHOP_ANY_PURCHASE_COMPLETE)||this.game.store.getCompleteLevelsNum()<10)return!1;let s=Date.now()-this.game.store.getNumber(g.SHOP_SPECIAL_OFFER_DISPLAY_TS),i=Gi({hours:8});return!(s<i)}isFeedbackLevel(e){return[21,51,100,150,200].includes(e)}playLevelUnlockAnimation(e){let t=this.levelIcons.getByLevelNumber(e);if(!t){this.doInitialScroll();return}let s=t.levelNumber+1,i=this.levelIcons.getByLevelNumber(s);if(!i){this.pointIconAvatarAt(t.levelNumber),this.scroll.scrollToLevelInstant(t.levelNumber);return}this.lockScene(),this.hideCloudsOver(t,i),this.scroll.scrollToLevelInstant(t.levelNumber),this.game.globalScene.input.once(Phaser.Input.Events.POINTER_DOWN,this.applyFastForward,this);let a=new P0(this,i);a.x=i.x,a.y=i.y,a.setDepth(Ue.LEVEL_ICONS_FX),a.show(500),this.add.existing(a),this.secondCamera.ignore(a),i.alpha=0,this.time.delayedCall(1700,()=>{this.showNextLevelIcon(i),this.showLevelUnlockParticles(i)});let n=this.getIconAvatarPosition(t);this.iconAvatar.x=n.x,this.iconAvatar.y=n.y,this.time.delayedCall(2e3,()=>{let r=this.getIconAvatarPosition(i);this.iconAvatar.moveBetweenLevelIcons(r),this.scroll.scrollToLevel(i.levelNumber),this.time.delayedCall(220,()=>{this.audio.play(u.WHOOSH_2,{volume:.5})})}),this.time.delayedCall(3300,()=>{this.onLevelUnlockAnimationComplete(e,s)})}onLevelUnlockAnimationComplete(e,t){this.unlockScene(),this.cancelFastForward(),!(this.showFeedbackDialog(e)||[10].includes(e)&&this.showSpecialOfferScreen())&&(e===window.game.config.wheel_unlock_level-1?this.openWheelScreen():this.openStartLevelPopup(t))}showFeedbackDialog(e){return window.game.config.feedback_enabled===!1||this.isFeedbackLevel(e)===!1||this.game.store.getBoolean(g.GAVE_FEEDBACK)?!1:(this.game.feedbackWidget.show(),!0)}applyFastForward(){this.fastForward.start(2)}cancelFastForward(){this.game.globalScene.input.off(Phaser.Input.Events.POINTER_DOWN,this.applyFastForward,this),this.fastForward.stop()}hideCloudsOver(e,t){let s=Math.min(e.y,t.y)-120,i=Math.max(e.y,t.y)+120;this.clouds.some(a=>{if(a.y>s&&a.y<i)return a.kill(),!0})}showNextLevelIcon(e){e.alpha=0,this.tweens.add({targets:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),e.scale=.5,this.tweens.add({targets:e,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:1})}showLevelUnlockParticles(e){let t=this.add.particles("level_map");t.setDepth(Ue.LEVEL_ICONS_FX),this.secondCamera.ignore(t);let s=12,i=t.createEmitter({gravityY:-100,delay:{min:0,max:500,steps:s},frame:"particles/star_white_1",lifespan:600,scale:{start:0,end:1,ease:gs.BellQuad},on:!1});i.setEmitZone({source:new Phaser.Geom.Circle(0,0,55),type:"random",quantity:360});let a=vt(s,()=>t.destroy());i.onParticleDeath(a),i.explode(s,e.x,e.y)}doInitialScroll(){var e;let t=(e=this.levelIcons.lastUnlockedIcon)!=null?e:this.levelIcons.lastCompleteIcon;if(t){this.scroll.scrollToLevelInstant(t.levelNumber);return}this.scroll.scrollToLevelInstant(1)}setupCameras(){this.firstCamera=this.cameras.main,this.firstCamera.ignore([this.topPanel,this.giftButton,this.piggyBankButton,this.popover,this.settingsScreen,this.startLevelScreen,this.pregameBoosterBuyScreen,this.livesScreen]),this.secondCamera=this.cameras.add(),this.secondCamera.ignore([this.background,this.topCover,...this.levelIcons.levelIcons,...this.sneakPeaks,...this.clouds,this.iconAvatar,this.edgeAvatar]),this.tutorialHand&&this.secondCamera.ignore(this.tutorialHand)}addBackground(){this.background=new lh(this,this.config.background),this.background.setDepth(Ue.BACKGROUND),this.add.existing(this.background)}addLevelIcons(){this.levelIcons=new w0(this,this.config);let e=this.getLevelsToUnlock();e>0&&this.levelIcons.levelIcons.forEach(t=>{t.levelNumber<=e&&t.setUnlocked()})}getLevelsToUnlock(){let e=w.get("unlockLevels");if(e===null)return 0;if(e==="all")return this.game.levelConfigs.getLastLevelNumber();let t=parseInt(e);return isNaN(t)?0:t}addSneakPeeks(){let t=this.game.levelConfigs.getAll().filter(s=>s.newElement!=="none").filter(s=>this.levelIcons.getByLevelNumber(s.levelNumber).iconState===nt.LOCKED);this.sneakPeaks=t.map((s,i)=>{let a=s.levelNumber,r=`sneak_peeks/popover_${s.newElement}`,o=this.add.image(0,0,"level_map",r);o.setDepth(Ue.LEVEL_ICONS_SNEAK_PEEKS),o.setData("levelNumber",a);let l=this.levelIcons.getByLevelNumber(a);o.x=l.x,o.y=l.y-40;let d=600,f=i%2==0?0:d/2;return this.tweens.addYoyoTween({delay:f,target:o,property:"angle",base:0,delta:6,duration:d,repeat:-1}),o})}addTopCover(){this.topCover=this.add.image(0,0,"level_map","top_cover"),this.topCover.scale=2,this.topCover.x=E.SOURCE_GAME_WIDTH/2,this.topCover.y=-180}addClouds(){let e=13,t=750,a=(this.background.height-400-t)/(e-1),n=a/4,r=["clouds/Cloud1","clouds/Cloud2","clouds/Cloud3"];this.clouds=ke(e,o=>{let l=t+o*a+Phaser.Math.RND.between(-n,n),d=Phaser.Math.RND.pick(r),f=new I0(this,"level_map",d);return f.x=Phaser.Math.RND.between(0,E.SOURCE_GAME_WIDTH),f.y=l,f.speed=Phaser.Math.RND.realInRange(.05,.1),f.setDepth(Ue.CLOUDS),this.add.existing(f),f})}addIconAvatar(){this.iconAvatar=new ph(this),this.iconAvatar.disableInteractive(),this.iconAvatar.startWiggle(),this.iconAvatar.setDepth(Ue.LEVEL_ICON_AVATAR),this.add.existing(this.iconAvatar);let e=this.levelIcons.getCurrentIcon();e?this.pointIconAvatarAt(e.levelNumber):this.iconAvatar.kill()}pointIconAvatarAt(e){let t=this.levelIcons.getByLevelNumber(e);if(t){let{x:s,y:i}=this.getIconAvatarPosition(t);return this.iconAvatar.x=s,this.iconAvatar.y=i,!0}return!1}getIconAvatarPosition(e){let t=e.getWorldPosition();return{x:t.x,y:t.y-46}}addEdgeAvatar(){this.edgeAvatar=new ph(this),this.edgeAvatar.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onAvatarPointerDown,this),this.edgeAvatar.setDepth(Ue.EDGE_AVATAR),this.add.existing(this.edgeAvatar)}onAvatarPointerDown(){this.game.audio.playClick();let e=this.scroll.getCameraScroll(this.iconAvatar.y);this.scroll.scrollTo(e)}addTopPanel(){this.topPanel=new m0(this),this.topPanel.settingsButton.on(_.PRESS,this.showSettings,this),this.pin(this.topPanel,.5,0,0,-1),this.size(this.topPanel),this.add.existing(this.topPanel),this.topPanel.livesLabel.plusButton.on(_.PRESS,this.onPlusLifeButtonClick,this),this.topPanel.coinsLabel.plusButton.on(_.PRESS,this.onPlusCoinsButtonClick,this)}onPlusLifeButtonClick(){this.scroll.disable(),this.livesScreen.once(b.HIDE_COMPLETE,this.scroll.enable,this.scroll),this.livesScreen.show()}onPlusCoinsButtonClick(){this.showShopScreen("LevelMap:CoinsLabel",{showBackground:!0})}addGiftButton(){this.giftButton=new S0(this),this.giftButton.on(_.RELEASE,this.onGiftButtonClick,this),this.add.existing(this.giftButton),this.pin(this.giftButton,1,1,-85,-95),this.size(this.giftButton)}onGiftButtonClick(){this.giftButton.isGiftReady()===!1?(this.audio.play(u.BOOSTER_CANT_USE),this.giftButton.shakeText(),this.showGiftPopover()):this.openGiftScreen()}showGiftPopover(){let e=this.firstCamera.zoom,t=this.texts.stars_gift.collect_popover.replace("#",this.giftButton.targetStars.toString());this.popover.updateText(t),this.popover.x=this.giftButton.x-70*e,this.popover.y=this.giftButton.y-10*e,this.popover.show()}openGiftScreen(){let e=new C0(this);e.autoPlay=w.getBool("autoGift"),e.on(b.SHOW,this.scroll.disable,this.scroll),e.on(Phaser.GameObjects.Events.DESTROY,this.scroll.enable,this.scroll),e.once(ca.ALL_REWARDS_COLLECTED,this.onGiftRewardsCollected,this),this.add.existing(e),this.firstCamera.ignore(e),e.resize(),e.show()}onGiftRewardsCollected(e){if(this.giftButton.onGiftRewardClaimed(),this.game.gifts.saveRewards(...e),e.find(s=>s.type===R.COINS)){let s=this.game.store.getNumber(g.COINS);this.topPanel.coinsLabel.updateContent(s)}}addWheelButton(){this.wheelButton=new O0(this),this.wheelButton.on(_.PRESS,this.onWheelButtonClick,this),this.add.existing(this.wheelButton),this.pin(this.wheelButton,1,1,-85,-80),this.size(this.wheelButton)}onWheelButtonClick(){switch(this.wheelButton.buttonState){case pt.LOCKED:this.showWheelPopover();break;case pt.DISABLED:this.wheelButton.shakeTimer();break;case pt.ENABLED:this.openWheelScreen();break}}showWheelPopover(){let e=this.firstCamera.zoom,t=this.texts.wheel_lock.replace("#",window.game.config.wheel_unlock_level.toString());this.popover.updateText(t),this.popover.x=this.wheelButton.x-70*e,this.popover.y=this.wheelButton.y,this.popover.show()}openWheelScreen(){var e;(e=this.wheelScreen)==null||e.show()}addPiggyBankButton(){this.piggyBankButton=new R0(this),this.piggyBankButton.on(_.RELEASE,()=>this.showPiggyBackScreen({showBackground:!0})),this.pin(this.piggyBankButton,1,1,-85,-260),this.size(this.piggyBankButton),this.game.piggyBank||this.piggyBankButton.kill()}showPiggyBackScreen(e){this.piggyBankScreen||this.addPiggyBankScreen();let t={currentCoins:this.game.store.getNumber(g.PIGGY_BANK_COINS),maxCoins:window.game.config.piggy_bank.max_capacity};this.piggyBankScreen.resize(),this.piggyBankScreen.updateData(t),this.piggyBankScreen.show({showBackground:e.showBackground})}addPopover(){this.popover=new L0(this,"level_map","popover"),this.popover.kill(),this.add.existing(this.popover),this.size(this.popover)}addSettingsScreen(){this.settingsScreen=new v0(this),this.settingsScreen.on(ws.CLOSE,this.hideSettings,this),this.settingsScreen.on(ws.CLEAR_SAVED_DATA,this.showResetDataScreen,this),this.settingsScreen.on(b.SHOW,()=>this.scroll.disable()),this.settingsScreen.on(b.HIDE_COMPLETE,()=>this.scroll.enable()),this.settingsScreen.kill(),this.add.existing(this.settingsScreen)}showResetDataScreen(){this.resetDataScreen||this.addResetDataScreen(),this.resetDataScreen.resize(),this.resetDataScreen.show()}showShopScreen(e,t){this.shopScreen||this.addShopScreen(),this.shopScreen.referrer=e,this.shopScreen.resize(),this.shopScreen.show(t)}showSettings(){this.settingsScreen.visible===!1&&this.settingsScreen.show()}hideSettings(){this.settingsScreen.hide()}addResetDataScreen(){this.resetDataScreen=new B0(this),this.resetDataScreen.popup.once(da.RESET_DATA,this.resetSavedData,this),this.resetDataScreen.on(b.SHOW,this.onResetDataScreenShow,this),this.resetDataScreen.on(b.HIDE_START,this.onResetDataScreenHide,this),this.resetDataScreen.kill(),this.add.existing(this.resetDataScreen),this.firstCamera.ignore(this.resetDataScreen)}resetSavedData(){this.game.store.resetSaveData().finally(()=>{this.restart({})})}onResetDataScreenShow(){this.settingsScreen.ignoreBackgroundClicks=!0,this.settingsScreen.deactivate()}onResetDataScreenHide(){this.settingsScreen.ignoreBackgroundClicks=!1,this.settingsScreen.activate()}addShopScreen(){this.shopScreen=new Yo(this),this.shopScreen.on(b.SHOW,this.onShopScreenShow,this),this.shopScreen.on(b.HIDE_START,this.onShopScreenHideStart,this),this.shopScreen.on(_s.PURCHASE_COMPLETE,this.onPurchaseComplete,this),this.shopScreen.kill(),this.add.existing(this.shopScreen),this.firstCamera.ignore(this.shopScreen)}onShopScreenShow(){this.scroll.disable(),this.livesScreen.visible&&this.livesScreen.deactivate(),this.pregameBoosterBuyScreen.visible&&this.pregameBoosterBuyScreen.deactivate()}onShopScreenHideStart(){this.livesScreen.visible&&this.livesScreen.activate(),this.pregameBoosterBuyScreen.visible&&this.pregameBoosterBuyScreen.activate(),!this.livesScreen.visible&&!this.startLevelScreen.visible&&!this.pregameBoosterBuyScreen.visible&&this.scroll.enable()}onPurchaseComplete(e,t){var s;let i=this.game.store.getNumber(g.COINS);this.topPanel.coinsLabel.updateContentInstant(i),this.livesScreen.coinsLabel.updateCoinsNumInstant(i),(s=this.pregameBoosterBuyScreen)==null||s.coinsLabel.syncWithGameStore(!0)}addSpecialOfferScreen(){this.specialOfferScreen=new M0(this),this.specialOfferScreen.on(b.SHOW,()=>this.scroll.disable()),this.specialOfferScreen.on(b.HIDE_START,()=>this.scroll.enable()),this.specialOfferScreen.on(_s.PURCHASE_COMPLETE,this.onSpecialOfferPurchaseComplete,this),this.specialOfferScreen.kill(),this.add.existing(this.specialOfferScreen),this.firstCamera.ignore(this.specialOfferScreen)}onSpecialOfferPurchaseComplete(){this.specialOfferScreen.hide(),this.time.delayedCall(300,()=>{var e;this.topPanel.livesLabel.animateIcon(),this.topPanel.coinsLabel.syncWithGameStore(!1),this.livesScreen.coinsLabel.syncWithGameStore(!0),(e=this.pregameBoosterBuyScreen)==null||e.coinsLabel.syncWithGameStore(!0)})}addStartLevelScreen(){this.startLevelScreen=new No(this),this.startLevelScreen.popup.playButton.on(_.RELEASE,this.onPlayButtonClick,this),this.startLevelScreen.popup.pregameBoosters.on(st.ADD_BOOSTER_CLICK,this.onBoosterClick,this),this.startLevelScreen.on(b.SHOW,this.onStartLevelPopupShow,this),this.startLevelScreen.on(b.HIDE_COMPLETE,this.onStartLevelPopupHideComplete,this),this.startLevelScreen.on(ei.SHOW_PIGGY_BANK_SCREEN,()=>this.showPiggyBackScreen({showBackground:!1})),this.startLevelScreen.kill(),this.add.existing(this.startLevelScreen)}onBoosterClick(e){let t=Oe.getRewardByPregameBooster(e.type);this.openPregameBoosterBuyScreen(t)}addLivesScreen(){this.livesScreen=new Do(this),this.livesScreen.on(b.SHOW,this.onLivesScreenShow,this),this.livesScreen.on(b.HIDE_START,this.onLivesScreenHide,this),this.livesScreen.on(vs.SHOW_COINS_SHOP,()=>this.showShopScreen("LevelMap:LivesScreen",{showBackground:!1})),this.livesScreen.on(vs.LIVES_PURCHASE_COMPLETE,this.onLivesPurchaseComplete,this),this.livesScreen.kill(),this.add.existing(this.livesScreen)}onLivesScreenShow(){this.startLevelScreen.visible&&(this.livesScreen.hideBackground(),this.startLevelScreen.deactivate())}onLivesScreenHide(){this.game.toasts.dismissAll(),this.startLevelScreen.isDeactivated&&this.startLevelScreen.activate()}onLivesPurchaseComplete(){var e;this.topPanel.coinsLabel.syncWithGameStore(!0),(e=this.shopScreen)==null||e.coinsLabel.syncWithGameStore(!0),this.pregameBoosterBuyScreen.coinsLabel.syncWithGameStore(!0)}addPregameBoosterBuyScreen(){this.pregameBoosterBuyScreen=new on(this),this.pregameBoosterBuyScreen.on(Xe.SHOW_SHOP,()=>this.showShopScreen("LevelMap:PregameBoosterBuyScreen",{showBackground:!1})),this.pregameBoosterBuyScreen.on(Xe.BOOSTER_BUY_COMPLETE,this.onVideoRewardAdComplete,this),this.pregameBoosterBuyScreen.on(b.SHOW,this.onRewardPopupShow,this),this.pregameBoosterBuyScreen.on(b.HIDE_START,this.onRewardPopupHideStart,this),this.pregameBoosterBuyScreen.kill(),this.add.existing(this.pregameBoosterBuyScreen)}onVideoRewardAdComplete(e,t){t==="coins"&&(this.topPanel.coinsLabel.syncWithGameStore(!0),this.livesScreen.coinsLabel.syncWithGameStore(!0)),this.saveVideoReward(e.rewardType,e.rewardNum),this.pregameBoosterBuyScreen.hide()}saveVideoReward(e,t){switch(e){case D.STRIPES:case D.BOMB:case D.SUPER_SPHERE:let s=Oe.getPregameBoosterByReward(e);this.game.analytics.addResource(ue.PREGAME_BOOSTERS,t,s,"StartLevelPopup"),this.game.pregameBoosters.getByType(s).num+=t,this.startLevelScreen.popup.pregameBoosters.getByType(s).onRewardArrive(t);break;default:break}}onRewardPopupShow(){this.startLevelScreen.visible&&this.startLevelScreen.deactivate()}onRewardPopupHideStart(){this.startLevelScreen.isDeactivated&&this.startLevelScreen.activate(),this.game.toasts.dismissAll()}openPregameBoosterBuyScreen(e){let t=k(P({},Oe.getVideoRewardScreenData(e,this.texts)),{boosterPriceInCoins:1e3,coinsTotal:this.game.store.getNumber(g.COINS),disableVideoButton:window.game.config.ads.rewarded===!1});this.pregameBoosterBuyScreen.updateData(t),this.pregameBoosterBuyScreen.show({showBackground:!1})}onWheelRewardCollected(e){this.game.gifts.saveReward(e.rewardType,e.rewardNum),e.rewardType===R.COINS&&this.topPanel.coinsLabel.syncWithGameStore(!1)}addWheelScreen(){this.wheelScreen=new _0(this),this.wheelScreen.on(b.SHOW,this.disableScroll,this),this.wheelScreen.on(b.HIDE_COMPLETE,this.onWheelScreenHideComplete,this),this.wheelScreen.on(rt.SPIN_START,this.onWheelSpinStart,this),this.wheelScreen.on(rt.SPIN_COMPLETE,this.onWheelSpinComplete,this),this.wheelScreen.on(rt.START_FAST_FORWARD,(e,t)=>this.fastForward.start(t)),this.wheelScreen.on(rt.STOP_FAST_FORWARD,()=>this.fastForward.stop()),this.wheelScreen.kill(),this.add.existing(this.wheelScreen)}onWheelScreenHideComplete(){this.wheelRewardScreen.visible===!1&&this.enableScroll()}onWheelSpinStart(){let e=new Date,t=new Date(e);t.setDate(t.getDate()+1),t.setHours(0,0,0,0),this.game.store.saveValue(g.WHEEL_LOCKED,!0),this.game.store.saveValue(g.WHEEL_RESET_TIMESTAMP,t.getTime()),this.wheelButton.setDisabledState(),this.wheelButton.showTimer()}onWheelSpinComplete(e,t){let s=t.getCurrentItem().itemType,i=dt.getRewardNum(s);this.wheelRewardScreen.addReward(s,i),this.wheelRewardScreen.show()}addWheelRewardScreen(){this.wheelRewardScreen=new y0(this),this.wheelRewardScreen.on(b.SHOW,this.disableScroll,this),this.wheelRewardScreen.on(b.HIDE_COMPLETE,this.enableScroll,this),this.wheelRewardScreen.on(Fs.COLLECT_COMPLETE,this.onWheelRewardCollected,this),this.wheelRewardScreen.kill(),this.add.existing(this.wheelRewardScreen)}openWheelRewardScreen(e){let t=dt.getRewardNum(e);this.wheelRewardScreen.addReward(e,t),this.wheelRewardScreen.show()}addPiggyBankScreen(){this.piggyBankScreen=new Vo(this),this.piggyBankScreen.on(b.SHOW,this.onPiggyBankScreenShow,this),this.piggyBankScreen.on(b.HIDE_START,this.onPiggyBankScreenHideStart,this),this.piggyBankScreen.on(si.BREAK,this.onPiggyBankBreak,this),this.piggyBankScreen.kill(),this.add.existing(this.piggyBankScreen)}onPiggyBankScreenShow(){this.scroll.disable(),this.startLevelScreen.visible&&this.startLevelScreen.deactivate()}onPiggyBankScreenHideStart(){this.startLevelScreen.visible&&this.startLevelScreen.activate(),this.startLevelScreen.visible===!1&&this.scroll.enable()}onPiggyBankBreak(e,t){this.time.delayedCall(300,()=>{var s;this.topPanel.coinsLabel.syncWithGameStore(!0),this.livesScreen.coinsLabel.syncWithGameStore(!0),(s=this.pregameBoosterBuyScreen)==null||s.coinsLabel.syncWithGameStore(!0),this.piggyBankButton.hideFullPopover(),this.piggyBankButton.updateCoinsNum(0)})}addTutorial(){if(this.isAnyLevelComplete())return;let t=this.levelIcons.getByLevelNumber(1);t.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.tutorialHand.stopAnimation(),this.tutorialHand.kill()}),this.piggyBankButton.kill(),this.giftButton.kill(),this.addTutorialHand(t),this.hideCloudsOver(t,t)}isAnyLevelComplete(){return this.game.levelConfigs.getLevelNumbers().some(t=>{let s=this.game.store.getLevelResult(t);if(s&&s.complete)return!0})}addTutorialHand(e){this.tutorialHand=new ms(this,"popups","popups/start_level/hand.png"),this.tutorialHand.setDepth(Ue.LEVEL_ICON_TUTORIAL_HAND),this.tutorialHand.x=e.x+74,this.tutorialHand.y=e.y+60,this.tutorialHand.playAnimation(800),this.add.existing(this.tutorialHand)}onPlayButtonClick(){if(this.game.lives.getLivesNum()===0){this.livesScreen.show({backgroundAlpha:.001,autoCloseAfterAd:!0});return}let t=this.startLevelScreen.levelNumber;t===1&&this.game.analytics.sendDesignEvent(`LevelMap:PlayButtonClick:Level_${t}`),this.startLevelScreen.popup.playButton.disableInput();let s=()=>this.gotoLevel(t);this.game.ads.showInterstitialAd("LevelMap:PlayButton").finally(()=>s())}gotoLevel(e){let t=this.startLevelScreen.popup.pregameBoosters.getSelectedBoosters();this.changeScene(M.GAMEPLAY_ROOT,{type:"play",levelNumber:e,pregameBoosters:t})}onStartLevelPopupShow(){this.scroll.disable()}onStartLevelPopupHideComplete(){this.scroll.enable()}setupScroll(){this.scroll=new b0(this)}addPointerCallbacks(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this)}onPointerDown(e,t){this.pointerDownPosition.x=e.x,this.pointerDownPosition.y=e.y,this.pointerDownTime=Date.now(),this.pointerDownLevelIcon=t.find(s=>s.getData("type")==="LevelIcon")}onPointerUp(e,t){let s=t.find(i=>i.getData("type")==="LevelIcon");if(s&&this.pointerDownLevelIcon===s){let i=Phaser.Math.Distance.Between(this.pointerDownPosition.x,this.pointerDownPosition.y,e.x,e.y),a=Date.now()-this.pointerDownTime;i<s.height/2&&a<150&&this.onLevelIconClick(s)}}onLevelIconClick(e){e.levelNumber===1&&this.game.analytics.sendDesignEvent(`LevelMap:LevelIconClick:Level_${e.levelNumber}`),this.game.audio.playClick(),this.openStartLevelPopup(e.levelNumber)}openStartLevelPopup(e){this.game.levelConfigs.check(e)&&(this.startLevelScreen.updateData(e),this.startLevelScreen.show({fadeInBackground:!0}))}addKeyboardCallbacks(){ye.development&&(this.onKeyDown("HOME",this.scroll.scrollToBottom,this.scroll),this.onKeyDown("END",this.scroll.scrollToTop,this.scroll),this.onKeyDown("R",()=>this.restart()),this.onKeyDown("PLUS",this.addGiftStar,this),this.onKeyDown("OPEN_BRACKET",this.removeLife,this),this.onKeyDown("LEFT",this.updateStartLevelPopup.bind(this,-1)),this.onKeyDown("RIGHT",this.updateStartLevelPopup.bind(this,1)),this.onKeyDown("U",this.levelIcons.unlockAll,this.levelIcons),this.onKeyDown("L",this.levelIcons.resetToInitialState,this.levelIcons),this.onKeyDown("W",this.openWheelScreen,this),this.onKeyDown("G",this.openGiftScreen,this),this.onKeyDown("F",this.levelIcons.findAndScrollToLevelIcon,this.levelIcons),this.onKeyDown("ONE",this.setGraphicsQuality.bind(this,Ye.LOW)),this.onKeyDown("TWO",this.setGraphicsQuality.bind(this,Ye.MEDIUM)),this.onKeyDown("THREE",this.setGraphicsQuality.bind(this,Ye.HIGH))),ye.editorEnabled&&this.onceKeyDown("E",this.gotoLevelMapEditor,this),ye.development?this.onKeyDown("X",this.testSentry,this):this.onceKeyDown("X",this.testSentry,this)}setGraphicsQuality(e){this.game.store.saveValue(g.GRAPHICS_QUALITY,e),this.game.scaler.setQuality(e)}testSentry(){return $(this,null,function*(){var e;!this.game.sentry||this.game.sentry.isEnabled===!1||this.shiftKey.isDown!==!1&&(this.game.sentry.captureException(new Error("test error"),{extra:{snapshot:yield this.game.sentry.getGameSnapshotAsBlob(),json:JSON.stringify({key:"value"})}}),(e=this.game.toasts)==null||e.show({message:"[Sentry] Test",lifespan:3e3}))})}gotoLevelMapEditor(){this.changeScene(M.LEVEL_MAP_EDITOR)}removeLife(){this.game.lives.removeLife()}addGiftStar(){this.giftButton.onStarArrived(),this.giftButton.incrementStarsNum()}updateStartLevelPopup(e){if(this.startLevelScreen.visible===!1)return;let t=this.startLevelScreen.levelNumber+e;this.game.levelConfigs.check(t)&&this.startLevelScreen.updateData(t)}resize(){var e,t,s,i,a,n,r;super.resize(),this.resizeCamera(),this.scroll.onResize(),this.piggyBankButton.originalScale=this.piggyBankButton.scale,this.giftButton.originalScale=this.giftButton.scale,this.popover.originalScale=this.popover.scale,this.livesScreen.resize(),this.settingsScreen.resize(),this.startLevelScreen.resize(),this.pregameBoosterBuyScreen.resize(),(e=this.wheelScreen)==null||e.resize(),(t=this.wheelRewardScreen)==null||t.resize(),(s=this.resetDataScreen)==null||s.resize(),(i=this.shopScreen)==null||i.resize(),(a=this.specialOfferScreen)==null||a.resize(),(n=this.piggyBankScreen)==null||n.resize(),(r=this.greetingsScreen)==null||r.resize()}resizeCamera(){let e=this.firstCamera;e.setOrigin(0),e.zoom=E.GAME_WIDTH/this.background.width;let t=(E.GAME_WIDTH-e.displayWidth)/2,s=(E.GAME_HEIGHT-e.displayHeight)/2;e.setBounds(t,s,e.displayWidth,this.background.height)}update(e,t){super.update(e,t),this.scroll.update(t),this.updateAvatars(),this.cullItems()}updateAvatars(){let e=this.topPanel.height,t=this.firstCamera.clampY(this.firstCamera.scrollY)+e,s=t+this.firstCamera.displayHeight-e,i=this.iconAvatar.y-this.iconAvatar.height,a=this.iconAvatar.y,n=a>t&&i<s;if(this.iconAvatar.wasInCamera&&n===!1&&(this.edgeAvatar.revive(),this.edgeAvatar.show()),this.iconAvatar.wasInCamera===!1&&n&&this.edgeAvatar.hide(),this.iconAvatar.visible){this.edgeAvatar.x=this.firstCamera.displayWidth/2;let r=s-t,o=t+r/2;a>o?(this.edgeAvatar.y=s-14,this.edgeAvatar.lookBottom()):(this.edgeAvatar.y=t,this.edgeAvatar.lookUp())}this.iconAvatar.wasInCamera=n}cullItems(){let e=this.firstCamera,t=Phaser.Math.Clamp(e.scrollY,0,e._bounds.height-e.displayHeight),s=t+e.displayHeight;t===this.cameraScrollY&&s===this.cameraBottom||(this.cameraScrollY=t,this.cameraTop=t,this.cameraBottom=s,this.background.cull(e,this.cameraTop,this.cameraBottom),this.cullLevelIconsThrottled(e,this.cameraTop,this.cameraBottom),this.cullClouds(e,this.cameraTop,this.cameraBottom))}doCullLevelIcons(e,t,s){let i=e.zoom,a=t-10*i,n=s+100*i;this.levelIcons.levelIcons.forEach(r=>{r.y>a&&r.y<n?r.revive():r.kill()})}cullClouds(e,t,s){this.clouds.forEach(i=>{i.y>t-130&&i.y<s+130?i.revive():i.kill()})}lockScene(){this.isLocked||(this.isLocked=!0,this.input.enabled=!1,this.levelIcons.disable(),this.disableScroll())}unlockScene(){this.isLocked!==!1&&(this.isLocked=!1,this.input.enabled=!0,this.levelIcons.enable(),this.enableScroll())}enableScroll(){this.scroll.enable()}disableScroll(){this.scroll.disable()}addLanguageChangeCallback(){this.game.texts.on(Ne.LANGUAGE_CHANGE,this.onLanguageChange,this)}onLanguageChange(e){var t,s,i,a,n;this.livesScreen.onLanguageChange(),this.topPanel.livesLabel.onLanguageChange(),(t=this.wheelRewardScreen)==null||t.onLanguageChange(),(s=this.resetDataScreen)==null||s.onLanguageChange(),this.startLevelScreen.onLanguageChange(),this.settingsScreen.onLanguageChange(),(i=this.shopScreen)==null||i.onLanguageChange(),(a=this.specialOfferScreen)==null||a.onLanguageChange(),(n=this.piggyBankScreen)==null||n.onLanguageChange(),this.piggyBankButton.onLanguageChange()}onShutdown(){this.game.texts.off(Ne.LANGUAGE_CHANGE,this.onLanguageChange,this),this.cancelFastForward(),super.onShutdown()}},Cn;(function(e){e.INIT="__INIT"})(Cn||(Cn={}));var G0=class extends Phaser.Events.EventEmitter{constructor(e){super();this.adProvider="gd-sdk",this._adblock=!1,this.rewardedAdTimestamp=0,this.interstitialAdTimestamp=0,this.game=e,this.onSdkReady()}get adblock(){return this._adblock}onSdkReady(){this.state="ready",this._adblock=!1,this.onSdkInitComplete()}onSdkError(e){var t;this.state="error",this._adblock=e.message.includes("Blocked"),(t=this.game.analytics)==null||t.sendError(`GdSdk:${e.name}:${e.message}`),this.onSdkInitComplete()}onSdkInitComplete(){this.sendAdblockStatusToAnalytics(),this.emit(Cn.INIT,this)}sendAdblockStatusToAnalytics(){let e=this._adblock?"adblock_enabled":"adblock_disabled";GameAnalytics("setCustomDimension03",e)}showInterstitialAd(e){var t,s;return window.game.config.ads.interstitials===!1||this.state!=="ready"||this.game.store.getBoolean(g.SHOP_ANY_PURCHASE_COMPLETE)?Promise.resolve():this.canShowInterstitialAd()===!1?((t=this.game.analytics)==null||t.sendDesignEvent("Ad:Interstitial:Skipped"),Promise.resolve()):((s=this.game.analytics)==null||s.sendAdEvent(us.Clicked,St.Interstitial,e,this.adProvider),this.addAdBreadcrumb(de.INTERSTITIAL,"requested",e),new Promise(n=>{this.game.adsHelper.onBeforeAdStart(de.INTERSTITIAL).finally(()=>{this.doShowInsterstitialAd(e,n)})}))}canShowInterstitialAd(){let e=Date.now(),t=window.game.config.ads.minIntervalMs,s=e-this.interstitialAdTimestamp,i=e-this.rewardedAdTimestamp;return s>t&&i>t}doShowFakeInterstitialAd(e){return new Promise(t=>{this.game.adsHelper.onBeforeAdStart(de.INTERSTITIAL).finally(()=>{setTimeout(()=>{t(),this.game.adsHelper.onAdComplete(de.INTERSTITIAL)},e)})})}doShowInsterstitialAd(e,t){PokiSDK.commercialBreak().then(()=>{var s;this.interstitialAdTimestamp=Date.now(),(s=this.game.analytics)==null||s.sendAdEvent(us.Show,St.Interstitial,e,this.adProvider),this.game.store.changeNumber(g.INTERSTITIAL_ADS_WATCHED,1),this.addAdBreadcrumb(de.INTERSTITIAL,"complete",e)}).catch((s="Unknown")=>{this.sendAdError(de.INTERSTITIAL,s.toString(),e),this.addAdBreadcrumb(de.INTERSTITIAL,"failed",e)}).finally(()=>{this.game.adsHelper.onAdComplete(de.INTERSTITIAL),t()})}showRewardedAd(e){var t;if(window.game.config.ads.rewarded===!1)return Promise.resolve(!1);if(w.getBool("fakeAds")){let i=w.getNumber("fakeAdsDuration",1e3);return this.doShowFakeRewardedAd(i)}return this.state!=="ready"?(this.game.toasts.showVideoAdWarning(),Promise.resolve(!1)):((t=this.game.analytics)==null||t.sendAdEvent(us.Clicked,St.RewardedVideo,e,this.adProvider),this.addAdBreadcrumb(de.REWARDED,"requested",e),new Promise(i=>{this.game.adsHelper.onBeforeAdStart(de.REWARDED).finally(()=>{this.doShowRewardedAd(e,i)})}))}doShowFakeRewardedAd(e=1e3){return new Promise(t=>{this.game.adsHelper.onBeforeAdStart(de.REWARDED).finally(()=>{setTimeout(()=>{t(!0),this.game.adsHelper.onAdComplete(de.REWARDED)},e)})})}doShowRewardedAd(e,t){PokiSDK.rewardedBreak().then(s=>{var i;if(s===!1){this.resolveOnAdTimerComplete(t);return}this.rewardedAdTimestamp=Date.now(),(i=this.game.analytics)==null||i.sendAdEvent(us.Show,St.RewardedVideo,e,this.adProvider),this.game.store.changeNumber(g.REWARDED_ADS_WATCHED,1),this.game.adsHelper.onAdComplete(de.REWARDED),this.addAdBreadcrumb(de.REWARDED,"complete",e),this.preloadAd(),t(!0)}).catch((s="Unknown")=>{this.addAdBreadcrumb(de.REWARDED,"failed",e),this.sendAdError(de.REWARDED,s.toString(),e),this.resolveOnAdTimerComplete(t)})}resolveOnAdTimerComplete(e){this.game.adsHelper.waitUntilAdTimeComplete().finally(()=>{this.game.adsHelper.onAdComplete(de.REWARDED),e(!0)})}sendAdError(e,t,s){var i,a;t&&t.includes("The advertisement was requested too soon")||((i=this.game.analytics)==null||i.sendAdFailedEvent(this.convertToGAAdType(e),s,this.adProvider),(a=this.game.analytics)==null||a.sendError(`Ads:${e}:${t}`,Za.Warning))}convertToGAAdType(e){switch(e){case de.REWARDED:return St.RewardedVideo;default:return St.Interstitial}}addAdBreadcrumb(e,t,s){this.game.sentry.addBreadcrumb({category:"ads",message:`${e} ad ${t}`,data:{placement:s}})}preloadAd(){return!1}},F0=class{constructor(e,t){this.parent=e,this.setParentSize(t),this.options=t,this.circumference=this.options.radius*2*Math.PI,this.createCircle()}setParentSize(e){let t=e.radius*2+e.strokeWidth*2;this.parent.setAttribute("width",t.toString()),this.parent.setAttribute("height",t.toString())}createCircle(){var e;let t=this.options.radius+this.options.strokeWidth,s=t;this.circle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.circle.setAttributeNS(null,"cx",t.toString()),this.circle.setAttributeNS(null,"cy",s.toString()),this.circle.setAttributeNS(null,"r",this.options.radius.toString()),this.circle.setAttributeNS(null,"fill","transparent"),this.circle.setAttributeNS(null,"stroke",this.options.strokeColor),this.circle.setAttributeNS(null,"stroke-width",this.options.strokeWidth.toString()),this.circle.setAttributeNS(null,"stroke-linecap",(e=this.options.linecap)!=null?e:"round"),this.circle.style.strokeDasharray=`${this.circumference} ${this.circumference}`,this.circle.style.strokeDashoffset=`${this.circumference}`,this.parent.appendChild(this.circle)}setProgress(e){this.circle.style.strokeDashoffset=(this.circumference-e*this.circumference).toString()}};function xt(e,t,s){return typeof e.onanimationend=="undefined"?Promise.resolve():(typeof s=="number"&&e.style.setProperty("--animate-duration",`${s/1e3}s`),new Promise(i=>{e.classList.add("animate__animated",t),e.onanimationend=()=>{e.classList.remove(t),i()}}))}var U0=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.game=e,this.container=t,this.icon=this.container.querySelector("#game-icon"),this.progressBar=this.createProgressBar(),this.progressText=this.container.querySelector("p")}createProgressBar(){let e=this.container.querySelector("svg"),t={radius:77,strokeWidth:7,strokeColor:"white",linecap:"round"};return new F0(e,t)}show(){this.container.style.display="flex",xt(this.container,"animate__fadeIn",300)}hide(){this.container.style.display="none"}updateProgress(e){this.progressText.innerText=(e*100).toFixed(0),this.progressBar.setProgress(e)}},W0=class{constructor(e){this.game=e,this.overlay=document.getElementById("loading-overlay"),this.overlay.classList.add("animate__animated"),this.preloader=new U0(this.game,document.getElementById("preloader")),this.spinner=this.overlay.querySelector(".loading-spinner"),this.copyright=this.overlay.querySelector(".copyright"),this.copyright.innerText=this.getCopyrightContent(),window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()}getCopyrightContent(){let e=2020,t=new Date().getUTCFullYear();return`Developed by RoboWhale, ${t===e?t.toString():`${e}-${t}`}
Use with permission`}onWindowResize(){let e=window.innerWidth*.33,t=window.innerHeight*.33,s=e/this.preloader.icon.clientWidth,i=t/this.preloader.icon.clientHeight,n=`scale(${Math.min(1,s,i)})`;this.preloader.container.style.transform=n,this.copyright.style.transform=n}showPreloader(){this.preloader.show(),this.onWindowResize()}hidePreloader(){this.preloader.hide()}fadeIn(){this.overlay.style.display="flex",this.overlay.classList.remove("animate__fadeOut"),xt(this.overlay,"animate__fadeIn",300)}fadeOut(){if(w.getBool("instantSceneChange")){this.overlay.style.display="none";return}this.overlay.classList.remove("animate__fadeIn"),xt(this.overlay,"animate__fadeOut",200).then(()=>{this.overlay.style.display="none"})}isVisible(){return this.overlay.style.display==="flex"}trackProgress(e){}};function Y0(e,t,s){return!e||e.isEnabled===!1?Promise.resolve(""):e.sendFeedback(s,t)}function V0(e,t,s,i){return $(this,null,function*(){let a={sentryEventId:t,build:window.game.config.build_version,date:new Date().toUTCString().slice(4,-4),completeLevelsNum:e.store.getCompleteLevelsNum(),email:s,message:i},n=yield fetch(window.game.config.feedback_url,{method:"POST",body:JSON.stringify([a]),headers:{"Content-Type":"application/json"}});return n.status>=200&&n.status<300})}var pa;(function(e){e.OPEN="__OPEN",e.CLOSE="__CLOSE"})(pa||(pa={}));var K0=class extends Phaser.Events.EventEmitter{constructor(e){super();this._isVisible=!1,this.game=e,this.container=document.getElementById("feedback-widget-container"),this.container.addEventListener("click",t=>{(t.target===this.container||t.target===this.alert)&&this.hide()}),this.initAlert(),this.initWidget(),this.addWindowResizeListener(),this.setCanHoverClass()}get isVisible(){return this._isVisible}initAlert(){this.alert=this.container.querySelector("#alert"),this.alert.classList.add("animate__animated")}initWidget(){this.wrapper=document.getElementById("feedback-widget-wrapper"),this.widget=document.getElementById("feedback-widget"),this.widget.classList.add("animate__animated"),this.title=this.widget.querySelector(".title"),this.subtitle=this.widget.querySelector(".subtitle");let e="message";this.messageLabel=this.widget.querySelector(`label[for=${e}]`),this.messageTextArea=this.widget.querySelector(`#${e}`);let t="email";this.emailLabel=this.widget.querySelector(`label[for=${t}]`),this.emailInput=this.widget.querySelector(`#${t}`),this.sendButton=this.widget.querySelector(".button"),this.sendButton.addEventListener("click",this.onSendButtonClick.bind(this)),this.closeButton=this.widget.querySelector(".button-close"),this.closeButton.addEventListener("click",this.hide.bind(this))}onSendButtonClick(){let e=this.messageTextArea.value,t=this.emailInput.value;if(e.length===0){xt(this.messageTextArea,"animate__wrongInput"),this.sendButton.blur(),this.messageTextArea.focus({preventScroll:!1});return}this.isValidMessage(e)&&this.sendFeedback({email:t,message:cT(e)}),this.messageTextArea.value="",this.hideWidget(),this.showAlert(this.getTexts().thank_you),this.scrollWindowToTop(),this.hideTimeoutId=setTimeout(()=>{this.hide()},2500)}isValidMessage(e){let t=e.includes(" ");return e.length>5&&e.length<1500&&t}sendFeedback(e){return $(this,null,function*(){try{let t=yield Y0(this.game.sentry,e.email,e.message);(yield V0(this.game,t,e.email,e.message))||this.game.sentry.captureMessage("Can't send feedback to Google Sheets!")}catch(t){this.game.sentry.captureException(t)}})}hideWidget(){xt(this.widget,"animate__fadeOut",300).then(()=>{this.widget.style.display="none"})}showAlert(e){this.alert.style.display="flex",this.alert.innerText=e,xt(this.alert,"animate__fadeInUpLight",300)}addWindowResizeListener(){let e=Ft(this.resize.bind(this),100,{leading:!1});window.addEventListener("resize",e)}setCanHoverClass(){!matchMedia("(hover: none)").matches&&document.body.classList.add("can-hover")}show(){this._isVisible=!0,this.container.style.display="flex",this.alert.style.display="none",this.widget.style.display="flex",this.messageTextArea.focus(),xt(this.widget,"animate__fadeInUpLight",300),this.updateTexts(),this.resize(),this.handleInputOnShow(),this.emit(pa.OPEN,this)}handleInputOnShow(){this.wasInputEnabled=this.game.input.enabled,this.wasKeyboardEnabled=this.game.input.keyboard.enabled,this.game.input.enabled=!1,this.game.input.keyboard.enabled=!1}updateTexts(){let e=this.getTexts();this.title.innerText=e.feedback,this.subtitle.innerText=e.feedback_subtitle,this.messageLabel.textContent=e.message,this.emailLabel.textContent=e.email,this.sendButton.textContent=e.send}resize(){let e=window.innerWidth*.85,t=window.innerHeight*.8,s=e/this.wrapper.clientWidth,i=t/this.wrapper.clientHeight,a=Math.min(1,s,i);this.wrapper.style.transform=`scale(${a})`}hide(){typeof this.hideTimeoutId!="undefined"&&clearTimeout(this.hideTimeoutId),xt(this.container,"animate__fadeOut",150).then(()=>{this.container.style.display="none",this._isVisible=!1,this.handleInputOnHide(),this.scrollWindowToTop(),this.emit(pa.CLOSE,this)})}handleInputOnHide(){this.game.input.enabled=this.wasInputEnabled,this.game.input.keyboard.enabled=this.wasKeyboardEnabled}scrollWindowToTop(){window.scrollTo(0,0)}getTexts(){return this.game.texts.texts.feedback_dialog}},ga;(function(e){e.PAUSE="__PAUSE",e.RESUME="__RESUME"})(ga||(ga={}));var z0=class extends Phaser.Events.EventEmitter{constructor(e,t){super();this.isPaused=!1,this.pausedScenes=[],this.game=e,this.options=t}pause(){var e;this.isPaused||(this.isPaused=!0,this.pausedScenes=this.game.scene.getScenes(!0),this.pausedScenes.forEach(t=>t.scene.pause()),this.options.muteOnPause&&((e=this.game.audio.global)==null||e.mute(!0)),this.game.events.emit(ga.PAUSE,this.game))}resume(){var e;this.isPaused!==!1&&(this.isPaused=!1,this.pausedScenes.forEach(t=>t.scene.resume()),this.pausedScenes.length=0,this.options.muteOnPause&&((e=this.game.audio.global)==null||e.mute(!1)),this.game.events.emit(ga.RESUME,this.game))}},j0=class{constructor(e,t){this.isFtue=!1,this.game=e,this.saveKey=t,this.checkFtue(),this.sendEvent("Startup")}checkFtue(){try{let e=localStorage.getItem(this.saveKey);localStorage.setItem(this.saveKey,"true"),this.isFtue=e===null}catch(e){}}sendEvent(e){this.isFtue!==!1&&GameAnalytics("addDesignEvent",`FTUE:${e}`)}},qt=class extends Phaser.Game{constructor(){qt.detectDevMode(),qt.detectEditorMode(),io.polyfill(),oo.extend(),super(HT.create()),this.webp=!1,this.avif=!1,this.loadingScreen=new W0(this),this.store=new PT(this,`papa-cherry-saga--${window.game.config.publisher}`),this.audio=new kT(this,{muteTrigger:"hidden"}),this.adsHelper=new KT(this,{muteMethod:"context_suspend",disableInput:!0}),this.ads=new G0(this),this.feedbackWidget=new K0(this),this.pauseHandler=new z0(this,{muteOnPause:!0}),this.ftue=new j0(this,`papa-cherry--${window.game.config.publisher}`),this.addScenes()}static detectDevMode(){qt.development=w.getBool("dev"),qt.development}static detectEditorMode(){["localhost","192.168","robowhale"].some(s=>location.hostname.includes(s))&&w.getBool("editor")&&(qt.editorEnabled=!0,document.title=document.title+" + Editor")}addScenes(){this.scene.add(M.GLOBAL,XT),this.scene.add(M.BOOT,c_,!0),this.scene.add(M.PRELOADER,R_),this.scene.add(M.LEVEL_MAP,H0),this.scene.add(M.GAMEPLAY_ROOT,SS),this.scene.add(M.GAMEPLAY,yS),this.scene.add(M.GAMEPLAY_GUI,dC),qt.editorEnabled&&(this.scene.add(M.LEVEL_MAP_EDITOR,u0),this.scene.add(M.LEVEL_EDITOR_ROOT,n0),this.scene.add(M.LEVEL_EDITOR,s0),this.scene.add(M.LEVEL_EDITOR_GUI,l0))}changeScene(e,t,s){this.globalScene.sceneTransition.changeScene(e,t,s)}restartScene(e,t){this.globalScene.sceneTransition.changeScene(e,e,t)}injectIntoScenes(e,t){this.scene.scenes.forEach(s=>{if(s.hasOwnProperty(t)){""+t+s.scene.key;return}s[t]=e})}pause(){this.pauseHandler.pause()}resume(){this.pauseHandler.resume()}},ye=qt;ye.development=!1,ye.editorEnabled=!1;var gi=We(require("@sentry/browser")),mh=!1,X0=["gameanalytics.com","adnxs.com","headerlift.com","360yield.com","pubmatic.com","doubleclick.net","smartadserver.com","criteo.com","id5-sync.com","msgrt.gamedistribution.com","tracker.gamedock.io"];function $0(){var e;w.getBool("sentry")===!1&&window.environment===lt.DEVELOP||(gi.init({dsn:"https://a63d1fe2b8b342d28e6720187f9af089@o122971.ingest.sentry.io/5509553",environment:window.environment,release:window.game.config.build_version.toString(),tracesSampleRate:1,ignoreErrors:["freed script","out of memory","Blocked a restricted frame","NS_ERROR_NOT_INITIALIZED","Non-Error promise rejection captured","Permission denied to access property","An attempt was made to use an object","Failed to fetch"],denyUrls:[/adnxs\.com/,/improvedigital\.com/,/imasdk\.googleapis\.com/,/innovid\.com/],beforeBreadcrumb:q0,beforeSend:Q0}),gi.setTags({buildTime:window.game.config.build_time,publisher:window.game.config.publisher,browserLanguage:navigator.language,webWorker:typeof Worker=="function",serviceWorker:"serviceWorker"in navigator,engine:"Phaser","engine.version":Phaser.VERSION,"device.memory":(e=ho())!=null?e:"unknown"}),Z0(),J0())}function q0(e,t){var s,i;if(e.category==="console"&&e.level==="warning"&&delete e.data,(s=e.message)==null?void 0:s.includes("https://phaser.io"))return null;if(e.category==="console"&&e.level==="warning"){let a=e.message;if(a==null?void 0:a.startsWith("Warning/GameAnalytics: Event queue: Failed to send events to collector"))return null;if((a==null?void 0:a.includes("Warning/GameAnalytics"))&&(a==null?void 0:a.includes("SDK is disabled"))){if(mh===!0)return null;mh=!0}}if(e.category==="xhr"||e.category==="fetch"){let a=(i=e.data)==null?void 0:i.url;if(a&&X0.some(r=>a.includes(r))||e.category==="fetch"&&typeof a=="string"&&a.startsWith("data:image"))return null;if(e.category==="xhr"&&typeof a=="string"){let n=e.data;if(n&&n.status_code===200&&a.match(/^(assets\/)|(css\/)|(js\/)/g))return null}return e}return e.category==="ui.click"?null:e}function Q0(e,t){if(!e.exception)return e;let i=[/game(\.[a-z0-9]{10})?\.js/g,/game(\.[a-z0-9]{10})?\.min\.js/g,/tweakpane\.min(\.[a-z0-9]{10})?\.js/g];return e.exception.values.some(n=>{let r=n.stacktrace;if(typeof r!="undefined"===!1)return!1;let l=r.frames;return!l||l.length===0?!1:l.some(d=>i.some(f=>d.filename.match(f)))})?e:null}function Z0(){gi.addGlobalEventProcessor((e,t)=>{try{let s="snapshot";if(!e.extra||!e.extra[s])return e;let i=e.extra[s];if(eO(i)===!1)return e;let a=sO(i);return fh(e.event_id,a,"snapshot"),delete e.extra[s],e}catch(s){}})}function J0(){gi.addGlobalEventProcessor((e,t)=>{try{let s="json";if(!e.extra||!e.extra[s])return e;let i=e.extra[s];if(typeof i!="string")return e;let a=iO(i);return fh(e.event_id,a,"json"),delete e.extra[s],e}catch(s){}})}function eO(e){return typeof Blob=="undefined"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"}function tO(e,t){const{host:s,path:i,projectId:a,port:n,protocol:r,user:o}=e;return`${r}://${s}${n!==""?`:${n}`:""}${i!==""?`/${i}`:""}/api/${a}/events/${t}/attachments/?sentry_key=${o}&sentry_version=7&sentry_client=custom-javascript`}function sO(e){let t=e.type==="image/jpeg"?"jpg":"png",s=new FormData;return s.append("screenshot",e,`screenshot.${t}`),s}function iO(e){let t=new Blob([e],{type:"application/json"}),s=new FormData;return s.append("data",t,"data.json"),s}function fh(e,t,s){let i=gi.getCurrentHub().getClient(),a=tO(i.getDsn(),e);fetch(a,{method:"POST",body:t}).then(n=>{n.status>=200&&n.status<300||(n.status,n.statusText)}).catch(n=>{})}var Sn;(function(e){e.ROBOWHALE="robowhale",e.GAME_DISTRIBUTION="game-distribution",e.GAME_DISTRIBUTION_PREMIUM="game-distribution-premium",e.GAME_DISTRIBUTION_ANDROID="game-distribution-android",e.POKI="poki",e.CRAZY_GAMES="crazy-games",e.WORKER_BEE="worker-bee",e.WORKER_BEE_NO_REWARDED="worker-bee-no-rewarded",e.YANDEX="yandex",e.VK="vk",e.OK="ok",e.FACEBOOK="facebook",e.ORANGE_FRANCE="orange-france",e.GAME_MONETIZE="game-monetize",e.LAGGED="lagged",e.UFREE_GAMES="ufree-games",e.KILOO="kiloo",e.GAME_REVSHARE="game-revshare",e.GAMEPIX="gamepix",e.OTHER="other"})(Sn||(Sn={}));var On=class{static getCurrentHost(){return window.location&&window.location.hostname?window.location.hostname:null}static isLocalhost(...e){return On.isHostAllowed([...e,"localhost"])}static isHostAllowed(e){let t=On.getCurrentHost();return t?e.some(s=>t.includes(s)):!1}static inIFrame(){try{return window.self!==window.top}catch(e){return!0}}};function aO(){var e;(e=window.GameAnalytics)!=null||(window.GameAnalytics=function(){(GameAnalytics.q=GameAnalytics.q||[]).push(arguments)});let t=w.getBool("analyticsLog");GameAnalytics("setEnabledInfoLog",t),GameAnalytics("configureBuild",window.game.config.build_version.toString()),GameAnalytics("configureAvailableResourceCurrencies",Object.values(ue)),GameAnalytics("configureAvailableResourceItemTypes",Object.values(Te)),GameAnalytics("configureAvailableCustomDimensions01",Object.values(Sn)),GameAnalytics("configureAvailableCustomDimensions02",[yt.CANVAS,yt.WEBGL]),GameAnalytics("configureAvailableCustomDimensions03",["adblock_enabled","adblock_disabled"]);let{gameKey:s,secret:i}=nO();GameAnalytics("initialize",s,i),GameAnalytics("addDesignEvent","Startup")}function nO(){let e={gameKey:"",secret:""},t=On.getCurrentHost(),s=["robowhale.com","localhost","192.168"].some(n=>t.includes(n)),i=w.getBool("dev")||w.has("unlockLevels")||w.getBool("fakeAds");return window.environment===lt.DEVELOP||s||i?(e.gameKey="a3bef38f8d6f806f9e82d95c5372ab8d",e.secret="065467ce1790a9a891e5ceb07bb695d3bb1b38c4"):(e.gameKey="39cc03509731bff78f56ac3df452387a",e.secret="9837cc71274790b27002f348006ea23331f4fd2b"),e}function rO(e,t){let s=new URLSearchParams(window.location.search);return t?s.set(e,t):s.delete(e),window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+s.toString()}function oO(){w.getBool("skipSitelock","1")||window.environment===lt.PRODUCTION&&hO()}function hO(){var e=["LnBva2kuY29t","bG9jYWxob3N0","139KObtWR","6505XySddN","1187125jopCbV","913662FnvCIe","740825sNyBkZ","459327dmigPF","335606FqHNeg","770186hYUBAW","some","top","I3ViZzIzNQ==","location","length","href"],t=function(s,i){s=s-340;var a=e[s];return a};(function(s,i){for(var a=t;[];)try{var n=parseInt(a(349))+parseInt(a(348))+-parseInt(a(350))+parseInt(a(345))*parseInt(a(344))+-parseInt(a(346))+-parseInt(a(351))+parseInt(a(347));if(n===i)break;s.push(s.shift())}catch(r){s.push(s.shift())}})(e,725092),function(){"use strict";var s=t,i=window.location.hostname;[s(343),s(342),"LnBva2ktZ2RuLmNvbQ=="].map(function(a){return atob(a)})[s(352)](function(a){return function(n,r){var o=t;return r.charAt(0)==="."?n.indexOf(r,n[o(340)]-r[o(340)])!==-1:r===n}(i,a)})||(window[s(355)][s(341)]==atob(s(354)),window[s(353)][s(355)]!==window[s(355)]&&(window[s(353)][s(355)]==window[s(355)]))}()}window.addEventListener("load",()=>{oO(),lO(),IT(),$0(),aO(),uO()});function lO(){let e=w.getNumber("console");if(e<=0){Eh();return}cO(e)}function Eh(){""+window.game.config.build_version,window.game.config.build_time}function cO(e){let t=document.getElementsByTagName("body")[0],s=document.createElement("script");s.src="//cdn.jsdelivr.net/npm/eruda",s.type="text/javascript",s.onload=dO.bind(this,e),t.appendChild(s)}function dO(e){eruda.init({tool:["console","elements","info"]}),Eh(),e===2&&eruda.show()}function uO(){try{window.gameInstance=new ye}catch(e){if(pO(e.toString())){gO(e.toString());return}throw e}}function pO(e){return["WebGL unsupported","Framebuffer status","Vertex Shader failed","Fragment Shader failed","Link Program failed"].some(s=>e.includes(s))}function gO(e){try{localStorage.setItem("webgl_error",e)}catch(s){}window.location.search.includes("forceCanvas=1")===!1&&location.replace(rO("forceCanvas","1"))}})();
//# sourceMappingURL=game.min.js.map?v=4fe477d26c
